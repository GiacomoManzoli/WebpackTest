var requirejs,require,define;(function(a,c){var e,t,i=0,r=/^ui-id-\d+$/;function n(e,t){var i,r,n,s=e.nodeName.toLowerCase();return"area"===s?(r=(i=e.parentNode).name,!(!e.href||!r||"map"!==i.nodeName.toLowerCase())&&(!!(n=a("img[usemap=#"+r+"]")[0])&&o(n))):(/input|select|textarea|button|object/.test(s)?!e.disabled:"a"===s&&e.href||t)&&o(e)}function o(e){return a.expr.filters.visible(e)&&!a(e).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:(e=a.fn.focus,function(t,i){return"number"==typeof t?this.each(function(){var e=this;setTimeout(function(){a(e).focus(),i&&i.call(e)},t)}):e.apply(this,arguments)}),scrollParent:function(){var e;return e=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?a(document):e},zIndex:function(e){if(e!==c)return this.css("zIndex",e);if(this.length)for(var t,i,r=a(this[0]);r.length&&r[0]!==document;){if(("absolute"===(t=r.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(r.css("zIndex"),10),!isNaN(i)&&0!==i))return i;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(t){return function(e){return!!a.data(e,t)}}):function(e,t,i){return!!a.data(e,i[3])},focusable:function(e){return n(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(e){var t=a.attr(e,"tabindex"),i=isNaN(t);return(i||0<=t)&&n(e,!i)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(e,i){var n="Width"===i?["Left","Right"]:["Top","Bottom"],r=i.toLowerCase(),s={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function o(e,t,i,r){return a.each(n,function(){t-=parseFloat(a.css(e,"padding"+this))||0,i&&(t-=parseFloat(a.css(e,"border"+this+"Width"))||0),r&&(t-=parseFloat(a.css(e,"margin"+this))||0)}),t}a.fn["inner"+i]=function(e){return e===c?s["inner"+i].call(this):this.each(function(){a(this).css(r,o(this,e)+"px")})},a.fn["outer"+i]=function(e,t){return"number"!=typeof e?s["outer"+i].call(this,e):this.each(function(){a(this).css(r,o(this,e,!0,t)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=(t=a.fn.removeData,function(e){return arguments.length?t.call(this,a.camelCase(e)):t.call(this)})),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(e,t,i){var r,n=a.ui[e].prototype;for(r in i)n.plugins[r]=n.plugins[r]||[],n.plugins[r].push([t,i[r]])},call:function(e,t,i){var r,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;r<n.length;r++)e.options[n[r][0]]&&n[r][1].apply(e.element,i)}},hasScroll:function(e,t){if("hidden"===a(e).css("overflow"))return!1;var i,r=t&&"left"===t?"scrollLeft":"scrollTop";return 0<e[r]||(e[r]=1,i=0<e[r],e[r]=0,i)}})}(jQuery),function(l,a){var i=0,c=Array.prototype.slice,r=l.cleanData;l.cleanData=function(e){for(var t,i=0;null!=(t=e[i]);i++)try{l(t).triggerHandler("remove")}catch(e){}r(e)},l.widget=function(e,i,t){var r,n,s,o,a={},c=e.split(".")[0];e=e.split(".")[1],r=c+"-"+e,t||(t=i,i=l.Widget),l.expr[":"][r.toLowerCase()]=function(e){return!!l.data(e,r)},l[c]=l[c]||{},n=l[c][e],s=l[c][e]=function(e,t){if(!this._createWidget)return new s(e,t);arguments.length&&this._createWidget(e,t)},l.extend(s,n,{version:t.version,_proto:l.extend({},t),_childConstructors:[]}),(o=new i).options=l.widget.extend({},o.options),l.each(t,function(t,r){var n,s;l.isFunction(r)?a[t]=(n=function(){return i.prototype[t].apply(this,arguments)},s=function(e){return i.prototype[t].apply(this,e)},function(){var e,t=this._super,i=this._superApply;return this._super=n,this._superApply=s,e=r.apply(this,arguments),this._super=t,this._superApply=i,e}):a[t]=r}),s.prototype=l.widget.extend(o,{widgetEventPrefix:n?o.widgetEventPrefix:e},a,{constructor:s,namespace:c,widgetName:e,widgetFullName:r}),n?(l.each(n._childConstructors,function(e,t){var i=t.prototype;l.widget(i.namespace+"."+i.widgetName,s,t._proto)}),delete n._childConstructors):i._childConstructors.push(s),l.widget.bridge(e,s)},l.widget.extend=function(e){for(var t,i,r=c.call(arguments,1),n=0,s=r.length;n<s;n++)for(t in r[n])i=r[n][t],r[n].hasOwnProperty(t)&&i!==a&&(l.isPlainObject(i)?e[t]=l.isPlainObject(e[t])?l.widget.extend({},e[t],i):l.widget.extend({},i):e[t]=i);return e},l.widget.bridge=function(s,t){var o=t.prototype.widgetFullName||s;l.fn[s]=function(i){var e="string"==typeof i,r=c.call(arguments,1),n=this;return i=!e&&r.length?l.widget.extend.apply(null,[i].concat(r)):i,e?this.each(function(){var e,t=l.data(this,o);return t?l.isFunction(t[i])&&"_"!==i.charAt(0)?(e=t[i].apply(t,r))!==t&&e!==a?(n=e&&e.jquery?n.pushStack(e.get()):e,!1):void 0:l.error("no such method '"+i+"' for "+s+" widget instance"):l.error("cannot call methods on "+s+" prior to initialization; attempted to call method '"+i+"'")}):this.each(function(){var e=l.data(this,o);e?e.option(i||{})._init():l.data(this,o,new t(i,this))}),n}},l.Widget=function(){},l.Widget._childConstructors=[],l.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,t){t=l(t||this.defaultElement||this)[0],this.element=l(t),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=l.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=l(),this.hoverable=l(),this.focusable=l(),t!==this&&(l.data(t,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===t&&this.destroy()}}),this.document=l(t.style?t.ownerDocument:t.document||t),this.window=l(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:l.noop,_getCreateEventData:l.noop,_create:l.noop,_init:l.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(l.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:l.noop,widget:function(){return this.element},option:function(e,t){var i,r,n,s=e;if(0===arguments.length)return l.widget.extend({},this.options);if("string"==typeof e)if(s={},e=(i=e.split(".")).shift(),i.length){for(r=s[e]=l.widget.extend({},this.options[e]),n=0;n<i.length-1;n++)r[i[n]]=r[i[n]]||{},r=r[i[n]];if(e=i.pop(),t===a)return r[e]===a?null:r[e];r[e]=t}else{if(t===a)return this.options[e]===a?null:this.options[e];s[e]=t}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(o,a,e){var c,h=this;"boolean"!=typeof o&&(e=a,a=o,o=!1),e?(a=c=l(a),this.bindings=this.bindings.add(a)):(e=a,a=this.element,c=this.widget()),l.each(e,function(e,t){function i(){if(o||!0!==h.options.disabled&&!l(this).hasClass("ui-state-disabled"))return("string"==typeof t?h[t]:t).apply(h,arguments)}"string"!=typeof t&&(i.guid=t.guid=t.guid||i.guid||l.guid++);var r=e.match(/^(\w+)\s*(.*)$/),n=r[1]+h.eventNamespace,s=r[2];s?c.delegate(s,n,i):a.bind(n,i)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){l(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){l(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){l(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){l(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,t,i){var r,n,s=this.options[e];if(i=i||{},(t=l.Event(t)).type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),t.target=this.element[0],n=t.originalEvent)for(r in n)r in t||(t[r]=n[r]);return this.element.trigger(t,i),!(l.isFunction(s)&&!1===s.apply(this.element[0],[t].concat(i))||t.isDefaultPrevented())}},l.each({show:"fadeIn",hide:"fadeOut"},function(s,o){l.Widget.prototype["_"+s]=function(t,e,i){"string"==typeof e&&(e={effect:e});var r,n=e?!0===e||"number"==typeof e?o:e.effect||o:s;"number"==typeof(e=e||{})&&(e={duration:e}),r=!l.isEmptyObject(e),e.complete=i,e.delay&&t.delay(e.delay),r&&l.effects&&l.effects.effect[n]?t[s](e):n!==s&&t[n]?t[n](e.duration,e.easing,i):t.queue(function(e){l(this)[s](),i&&i.call(t[0]),e()})}})}(jQuery),function(n,e){var s=!1;n(document).mouseup(function(){s=!1}),n.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(e){if(!0===n.data(e.target,t.widgetName+".preventClickEvent"))return n.removeData(e.target,t.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!s){this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var t=this,i=1===e.which,r=!("string"!=typeof this.options.cancel||!e.target.nodeName)&&n(e.target).closest(this.options.cancel).length;return!(i&&!r&&this._mouseCapture(e))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){t.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(e),!this._mouseStarted)?(e.preventDefault(),!0):(!0===n.data(e.target,this.widgetName+".preventClickEvent")&&n.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return t._mouseMove(e)},this._mouseUpDelegate=function(e){return t._mouseUp(e)},n(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),s=!0))}},_mouseMove:function(e){return n.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,e),this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return n(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&n.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(E,e){E.ui=E.ui||{};var n,x=Math.max,M=Math.abs,w=Math.round,r=/left|center|right/,s=/top|center|bottom/,o=/[\+\-]\d+(\.[\d]+)?%?/,a=/^\w+/,c=/%$/,h=E.fn.position;function C(e,t,i){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?i/100:1)]}function J(e,t){return parseInt(E.css(e,t),10)||0}E.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,t,i=E("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),r=i.children()[0];return E("body").append(i),e=r.offsetWidth,i.css("overflow","scroll"),e===(t=r.offsetWidth)&&(t=i[0].clientWidth),i.remove(),n=e-t},getScrollInfo:function(e){var t=e.isWindow?"":e.element.css("overflow-x"),i=e.isWindow?"":e.element.css("overflow-y"),r="scroll"===t||"auto"===t&&e.width<e.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&e.height<e.element[0].scrollHeight?E.position.scrollbarWidth():0,height:r?E.position.scrollbarWidth():0}},getWithinInfo:function(e){var t=E(e||window),i=E.isWindow(t[0]);return{element:t,isWindow:i,offset:t.offset()||{left:0,top:0},scrollLeft:t.scrollLeft(),scrollTop:t.scrollTop(),width:i?t.width():t.outerWidth(),height:i?t.height():t.outerHeight()}}},E.fn.position=function(u){if(!u||!u.of)return h.apply(this,arguments);u=E.extend({},u);var d,p,f,g,m,e,t,i,_=E(u.of),S=E.position.getWithinInfo(u.within),v=E.position.getScrollInfo(S),y=(u.collision||"flip").split(" "),b={};return e=9===(i=(t=_)[0]).nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:E.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()},_[0].preventDefault&&(u.at="left top"),p=e.width,f=e.height,g=e.offset,m=E.extend({},g),E.each(["my","at"],function(){var e,t,i=(u[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):s.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=s.test(i[1])?i[1]:"center",e=o.exec(i[0]),t=o.exec(i[1]),b[this]=[e?e[0]:0,t?t[0]:0],u[this]=[a.exec(i[0])[0],a.exec(i[1])[0]]}),1===y.length&&(y[1]=y[0]),"right"===u.at[0]?m.left+=p:"center"===u.at[0]&&(m.left+=p/2),"bottom"===u.at[1]?m.top+=f:"center"===u.at[1]&&(m.top+=f/2),d=C(b.at,p,f),m.left+=d[0],m.top+=d[1],this.each(function(){var i,e,o=E(this),a=o.outerWidth(),c=o.outerHeight(),t=J(this,"marginLeft"),r=J(this,"marginTop"),n=a+t+J(this,"marginRight")+v.width,s=c+r+J(this,"marginBottom")+v.height,h=E.extend({},m),l=C(b.my,o.outerWidth(),o.outerHeight());"right"===u.my[0]?h.left-=a:"center"===u.my[0]&&(h.left-=a/2),"bottom"===u.my[1]?h.top-=c:"center"===u.my[1]&&(h.top-=c/2),h.left+=l[0],h.top+=l[1],E.support.offsetFractions||(h.left=w(h.left),h.top=w(h.top)),i={marginLeft:t,marginTop:r},E.each(["left","top"],function(e,t){E.ui.position[y[e]]&&E.ui.position[y[e]][t](h,{targetWidth:p,targetHeight:f,elemWidth:a,elemHeight:c,collisionPosition:i,collisionWidth:n,collisionHeight:s,offset:[d[0]+l[0],d[1]+l[1]],my:u.my,at:u.at,within:S,elem:o})}),u.using&&(e=function(e){var t=g.left-h.left,i=t+p-a,r=g.top-h.top,n=r+f-c,s={target:{element:_,left:g.left,top:g.top,width:p,height:f},element:{element:o,left:h.left,top:h.top,width:a,height:c},horizontal:i<0?"left":0<t?"right":"center",vertical:n<0?"top":0<r?"bottom":"middle"};p<a&&M(t+i)<p&&(s.horizontal="center"),f<c&&M(r+n)<f&&(s.vertical="middle"),x(M(t),M(i))>x(M(r),M(n))?s.important="horizontal":s.important="vertical",u.using.call(this,e,s)}),o.offset(E.extend(h,{using:e}))})},E.ui.position={fit:{left:function(e,t){var i,r=t.within,n=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,o=e.left-t.collisionPosition.marginLeft,a=n-o,c=o+t.collisionWidth-s-n;t.collisionWidth>s?0<a&&c<=0?(i=e.left+a+t.collisionWidth-s-n,e.left+=a-i):e.left=0<c&&a<=0?n:c<a?n+s-t.collisionWidth:n:0<a?e.left+=a:0<c?e.left-=c:e.left=x(e.left-o,e.left)},top:function(e,t){var i,r=t.within,n=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,a=n-o,c=o+t.collisionHeight-s-n;t.collisionHeight>s?0<a&&c<=0?(i=e.top+a+t.collisionHeight-s-n,e.top+=a-i):e.top=0<c&&a<=0?n:c<a?n+s-t.collisionHeight:n:0<a?e.top+=a:0<c?e.top-=c:e.top=x(e.top-o,e.top)}},flip:{left:function(e,t){var i,r,n=t.within,s=n.offset.left+n.scrollLeft,o=n.width,a=n.isWindow?n.scrollLeft:n.offset.left,c=e.left-t.collisionPosition.marginLeft,h=c-a,l=c+t.collisionWidth-o-a,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,d="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];h<0?((i=e.left+u+d+p+t.collisionWidth-o-s)<0||i<M(h))&&(e.left+=u+d+p):0<l&&(0<(r=e.left-t.collisionPosition.marginLeft+u+d+p-a)||M(r)<l)&&(e.left+=u+d+p)},top:function(e,t){var i,r,n=t.within,s=n.offset.top+n.scrollTop,o=n.height,a=n.isWindow?n.scrollTop:n.offset.top,c=e.top-t.collisionPosition.marginTop,h=c-a,l=c+t.collisionHeight-o-a,u="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];h<0?(r=e.top+u+d+p+t.collisionHeight-o-s,e.top+u+d+p>h&&(r<0||r<M(h))&&(e.top+=u+d+p)):0<l&&(i=e.top-t.collisionPosition.marginTop+u+d+p-a,e.top+u+d+p>l&&(0<i||M(i)<l)&&(e.top+=u+d+p))}},flipfit:{left:function(){E.ui.position.flip.left.apply(this,arguments),E.ui.position.fit.left.apply(this,arguments)},top:function(){E.ui.position.flip.top.apply(this,arguments),E.ui.position.fit.top.apply(this,arguments)}}},function(){var e,t,i,r,n,s=document.getElementsByTagName("body")[0],o=document.createElement("div");for(n in e=document.createElement(s?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&E.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"}),i)e.style[n]=i[n];e.appendChild(o),(t=s||document.documentElement).insertBefore(e,t.firstChild),o.style.cssText="position: absolute; left: 10.7432222px;",r=E(o).offset().left,E.support.offsetFractions=10<r&&r<11,e.innerHTML="",t.removeChild(e)}()}(jQuery),function(v,e){v.widget("ui.draggable",v.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var t=this.options;return!(this.helper||t.disabled||0<v(e.target).closest(".ui-resizable-handle").length)&&(this.handle=this._getHandle(e),!!this.handle&&(v(!0===t.iframeFix?"iframe":t.iframeFix).each(function(){v("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(v(this).offset()).appendTo("body")}),!0))},_mouseStart:function(e){var t=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),v.ui.ddmanager&&(v.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,v.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,t.cursorAt&&this._adjustOffsetFromHelper(t.cursorAt),this._setContainment(),!1===this._trigger("start",e)?(this._clear(),!1):(this._cacheHelperProportions(),v.ui.ddmanager&&!t.dropBehaviour&&v.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),v.ui.ddmanager&&v.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,t){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!t){var i=this._uiHash();if(!1===this._trigger("drag",e,i))return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),v.ui.ddmanager&&v.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var t=this,i=!1;return v.ui.ddmanager&&!this.options.dropBehaviour&&(i=v.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),("original"!==this.options.helper||v.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||v.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?v(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==t._trigger("stop",e)&&t._clear()}):!1!==this._trigger("stop",e)&&this._clear()),!1},_mouseUp:function(e){return v("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),v.ui.ddmanager&&v.ui.ddmanager.dragStop(this,e),v.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return!this.options.handle||!!v(e.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(e){var t=this.options,i=v.isFunction(t.helper)?v(t.helper.apply(this.element[0],[e])):"clone"===t.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===t.appendTo?this.element[0].parentNode:t.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),v.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&v.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i,r=this.options;r.containment?"window"!==r.containment?"document"!==r.containment?r.containment.constructor!==Array?("parent"===r.containment&&(r.containment=this.helper[0].parentNode),(i=(t=v(r.containment))[0])&&(e="hidden"!==t.css("overflow"),this.containment=[(parseInt(t.css("borderLeftWidth"),10)||0)+(parseInt(t.css("paddingLeft"),10)||0),(parseInt(t.css("borderTopWidth"),10)||0)+(parseInt(t.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t.css("borderRightWidth"),10)||0)-(parseInt(t.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t.css("borderBottomWidth"),10)||0)-(parseInt(t.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=t)):this.containment=r.containment:this.containment=[0,0,v(document).width()-this.helperProportions.width-this.margins.left,(v(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[v(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,v(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,v(window).scrollLeft()+v(window).width()-this.helperProportions.width-this.margins.left,v(window).scrollTop()+(v(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(e){var t,i,r,n,s=this.options,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&v.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=e.pageX,c=e.pageY;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),t=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):t=this.containment,e.pageX-this.offset.click.left<t[0]&&(a=t[0]+this.offset.click.left),e.pageY-this.offset.click.top<t[1]&&(c=t[1]+this.offset.click.top),e.pageX-this.offset.click.left>t[2]&&(a=t[2]+this.offset.click.left),e.pageY-this.offset.click.top>t[3]&&(c=t[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=t?r-this.offset.click.top>=t[1]||r-this.offset.click.top>t[3]?r:r-this.offset.click.top>=t[1]?r-s.grid[1]:r+s.grid[1]:r,n=s.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,a=t?n-this.offset.click.left>=t[0]||n-this.offset.click.left>t[2]?n:n-this.offset.click.left>=t[0]?n-s.grid[0]:n+s.grid[0]:n)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,t,i){return i=i||this._uiHash(),v.ui.plugin.call(this,e,[t,i]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),v.Widget.prototype._trigger.call(this,e,t,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),v.ui.plugin.add("draggable","connectToSortable",{start:function(t,e){var i=v(this).data("ui-draggable"),r=i.options,n=v.extend({},e,{item:i.element});i.sortables=[],v(r.connectToSortable).each(function(){var e=v.data(this,"ui-sortable");e&&!e.options.disabled&&(i.sortables.push({instance:e,shouldRevert:e.options.revert}),e.refreshPositions(),e._trigger("activate",t,n))})},stop:function(e,t){var i=v(this).data("ui-draggable"),r=v.extend({},t,{item:i.element});v.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(i,r){var n=v(this).data("ui-draggable"),s=this;v.each(n.sortables,function(){var e=!1,t=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(e=!0,v.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==t&&this.instance._intersectsWith(this.instance.containerCache)&&v.contains(t.instance.element[0],this.instance.element[0])&&(e=!1),e})),e?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=v(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return r.helper[0]},i.target=this.instance.currentItem[0],this.instance._mouseCapture(i,!0),this.instance._mouseStart(i,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",i),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(i)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",i,this.instance._uiHash(this.instance)),this.instance._mouseStop(i,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",i),n.dropped=!1)})}}),v.ui.plugin.add("draggable","cursor",{start:function(){var e=v("body"),t=v(this).data("ui-draggable").options;e.css("cursor")&&(t._cursor=e.css("cursor")),e.css("cursor",t.cursor)},stop:function(){var e=v(this).data("ui-draggable").options;e._cursor&&v("body").css("cursor",e._cursor)}}),v.ui.plugin.add("draggable","opacity",{start:function(e,t){var i=v(t.helper),r=v(this).data("ui-draggable").options;i.css("opacity")&&(r._opacity=i.css("opacity")),i.css("opacity",r.opacity)},stop:function(e,t){var i=v(this).data("ui-draggable").options;i._opacity&&v(t.helper).css("opacity",i._opacity)}}),v.ui.plugin.add("draggable","scroll",{start:function(){var e=v(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var t=v(this).data("ui-draggable"),i=t.options,r=!1;t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(t.overflowOffset.top+t.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?t.scrollParent[0].scrollTop=r=t.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-t.overflowOffset.top<i.scrollSensitivity&&(t.scrollParent[0].scrollTop=r=t.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(t.overflowOffset.left+t.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?t.scrollParent[0].scrollLeft=r=t.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-t.overflowOffset.left<i.scrollSensitivity&&(t.scrollParent[0].scrollLeft=r=t.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(e.pageY-v(document).scrollTop()<i.scrollSensitivity?r=v(document).scrollTop(v(document).scrollTop()-i.scrollSpeed):v(window).height()-(e.pageY-v(document).scrollTop())<i.scrollSensitivity&&(r=v(document).scrollTop(v(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(e.pageX-v(document).scrollLeft()<i.scrollSensitivity?r=v(document).scrollLeft(v(document).scrollLeft()-i.scrollSpeed):v(window).width()-(e.pageX-v(document).scrollLeft())<i.scrollSensitivity&&(r=v(document).scrollLeft(v(document).scrollLeft()+i.scrollSpeed)))),!1!==r&&v.ui.ddmanager&&!i.dropBehaviour&&v.ui.ddmanager.prepareOffsets(t,e)}}),v.ui.plugin.add("draggable","snap",{start:function(){var i=v(this).data("ui-draggable"),e=i.options;i.snapElements=[],v(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var e=v(this),t=e.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:t.top,left:t.left})})},drag:function(e,t){var i,r,n,s,o,a,c,h,l,u,d=v(this).data("ui-draggable"),p=d.options,f=p.snapTolerance,g=t.offset.left,m=g+d.helperProportions.width,_=t.offset.top,S=_+d.helperProportions.height;for(l=d.snapElements.length-1;0<=l;l--)a=(o=d.snapElements[l].left)+d.snapElements[l].width,h=(c=d.snapElements[l].top)+d.snapElements[l].height,m<o-f||a+f<g||S<c-f||h+f<_||!v.contains(d.snapElements[l].item.ownerDocument,d.snapElements[l].item)?(d.snapElements[l].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,e,v.extend(d._uiHash(),{snapItem:d.snapElements[l].item})),d.snapElements[l].snapping=!1):("inner"!==p.snapMode&&(i=Math.abs(c-S)<=f,r=Math.abs(h-_)<=f,n=Math.abs(o-m)<=f,s=Math.abs(a-g)<=f,i&&(t.position.top=d._convertPositionTo("relative",{top:c-d.helperProportions.height,left:0}).top-d.margins.top),r&&(t.position.top=d._convertPositionTo("relative",{top:h,left:0}).top-d.margins.top),n&&(t.position.left=d._convertPositionTo("relative",{top:0,left:o-d.helperProportions.width}).left-d.margins.left),s&&(t.position.left=d._convertPositionTo("relative",{top:0,left:a}).left-d.margins.left)),u=i||r||n||s,"outer"!==p.snapMode&&(i=Math.abs(c-_)<=f,r=Math.abs(h-S)<=f,n=Math.abs(o-g)<=f,s=Math.abs(a-m)<=f,i&&(t.position.top=d._convertPositionTo("relative",{top:c,left:0}).top-d.margins.top),r&&(t.position.top=d._convertPositionTo("relative",{top:h-d.helperProportions.height,left:0}).top-d.margins.top),n&&(t.position.left=d._convertPositionTo("relative",{top:0,left:o}).left-d.margins.left),s&&(t.position.left=d._convertPositionTo("relative",{top:0,left:a-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[l].snapping&&(i||r||n||s||u)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,e,v.extend(d._uiHash(),{snapItem:d.snapElements[l].item})),d.snapElements[l].snapping=i||r||n||s||u)}}),v.ui.plugin.add("draggable","stack",{start:function(){var t,e=this.data("ui-draggable").options,i=v.makeArray(v(e.stack)).sort(function(e,t){return(parseInt(v(e).css("zIndex"),10)||0)-(parseInt(v(t).css("zIndex"),10)||0)});i.length&&(t=parseInt(v(i[0]).css("zIndex"),10)||0,v(i).each(function(e){v(this).css("zIndex",t+e)}),this.css("zIndex",t+i.length))}}),v.ui.plugin.add("draggable","zIndex",{start:function(e,t){var i=v(t.helper),r=v(this).data("ui-draggable").options;i.css("zIndex")&&(r._zIndex=i.css("zIndex")),i.css("zIndex",r.zIndex)},stop:function(e,t){var i=v(this).data("ui-draggable").options;i._zIndex&&v(t.helper).css("zIndex",i._zIndex)}})}(jQuery),function(a,e){function d(e,t,i){return t<e&&e<t+i}a.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e=this.options,t=e.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(t)?t:function(e){return e.is(t)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[e.scope]=a.ui.ddmanager.droppables[e.scope]||[],a.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,t=a.ui.ddmanager.droppables[this.options.scope];e<t.length;e++)t[e]===this&&t.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,t){"accept"===e&&(this.accept=a.isFunction(t)?t:function(e){return e.is(t)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var t=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",e,this.ui(t))},_deactivate:function(e){var t=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",e,this.ui(t))},_over:function(e){var t=a.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(t)))},_out:function(e){var t=a.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(t)))},_drop:function(e,t){var i=t||a.ui.ddmanager.current,r=!1;return!(!i||(i.currentItem||i.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=a.data(this,"ui-droppable");if(e.options.greedy&&!e.options.disabled&&e.options.scope===i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&a.ui.intersect(i,a.extend(e,{offset:e.element.offset()}),e.options.tolerance))return!(r=!0)}),!r&&(!!this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(i)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),a.ui.intersect=function(e,t,i){if(!t.offset)return!1;var r,n=(e.positionAbs||e.position.absolute).left,s=n+e.helperProportions.width,o=(e.positionAbs||e.position.absolute).top,a=o+e.helperProportions.height,c=t.offset.left,h=c+t.proportions.width,l=t.offset.top,u=l+t.proportions.height;switch(i){case"fit":return c<=n&&s<=h&&l<=o&&a<=u;case"intersect":return c<n+e.helperProportions.width/2&&s-e.helperProportions.width/2<h&&l<o+e.helperProportions.height/2&&a-e.helperProportions.height/2<u;case"pointer":return r=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,d((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,l,t.proportions.height)&&d(r,c,t.proportions.width);case"touch":return(l<=o&&o<=u||l<=a&&a<=u||o<l&&u<a)&&(c<=n&&n<=h||c<=s&&s<=h||n<c&&h<s);default:return!1}},a.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,t){var i,r,n=a.ui.ddmanager.droppables[e.options.scope]||[],s=t?t.type:null,o=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<n.length;i++)if(!(n[i].options.disabled||e&&!n[i].accept.call(n[i].element[0],e.currentItem||e.element))){for(r=0;r<o.length;r++)if(o[r]===n[i].element[0]){n[i].proportions.height=0;continue e}n[i].visible="none"!==n[i].element.css("display"),n[i].visible&&("mousedown"===s&&n[i]._activate.call(n[i],t),n[i].offset=n[i].element.offset(),n[i].proportions={width:n[i].element[0].offsetWidth,height:n[i].element[0].offsetHeight})}},drop:function(e,t){var i=!1;return a.each((a.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(e,this,this.options.tolerance)&&(i=this._drop.call(this,t)||i),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),i},dragStart:function(e,t){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||a.ui.ddmanager.prepareOffsets(e,t)})},drag:function(s,o){s.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(s,o),a.each(a.ui.ddmanager.droppables[s.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var e,t,i,r=a.ui.intersect(s,this,this.options.tolerance),n=!r&&this.isover?"isout":r&&!this.isover?"isover":null;n&&(this.options.greedy&&(t=this.options.scope,(i=this.element.parents(":data(ui-droppable)").filter(function(){return a.data(this,"ui-droppable").options.scope===t})).length&&((e=a.data(i[0],"ui-droppable")).greedyChild="isover"===n)),e&&"isover"===n&&(e.isover=!1,e.isout=!0,e._out.call(e,o)),this[n]=!0,this["isout"===n?"isover":"isout"]=!1,this["isover"===n?"_over":"_out"].call(this,o),e&&"isout"===n&&(e.isout=!1,e.isover=!0,e._over.call(e,o)))}})},dragStop:function(e,t){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||a.ui.ddmanager.prepareOffsets(e,t)}}}(jQuery),function(_,e){function d(e){return parseInt(e,10)||0}function u(e){return!isNaN(parseInt(e,10))}_.widget("ui.resizable",_.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,t,i,r,n=this,s=this.options;if(this.element.addClass("ui-resizable"),_.extend(this,{_aspectRatio:!!s.aspectRatio,aspectRatio:s.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:s.helper||s.ghost||s.animate?s.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(_("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=s.handles||(_(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},t=0;t<e.length;t++)i=_.trim(e[t]),(r=_("<div class='ui-resizable-handle "+("ui-resizable-"+i)+"'></div>")).css({zIndex:s.zIndex}),"se"===i&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(r);this._renderAxis=function(e){var t,i,r,n;for(t in e=e||this.element,this.handles)this.handles[t].constructor===String&&(this.handles[t]=_(this.handles[t],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(i=_(this.handles[t],this.element),n=/sw|ne|nw|se|n|s/.test(t)?i.outerHeight():i.outerWidth(),r=["padding",/ne|nw|n/.test(t)?"Top":/se|sw|s/.test(t)?"Bottom":/^e$/.test(t)?"Right":"Left"].join(""),e.css(r,n),this._proportionallyResize()),_(this.handles[t]).length},this._renderAxis(this.element),this._handles=_(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){n.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),n.axis=r&&r[1]?r[1]:"se")}),s.autoHide&&(this._handles.hide(),_(this.element).addClass("ui-resizable-autohide").mouseenter(function(){s.disabled||(_(this).removeClass("ui-resizable-autohide"),n._handles.show())}).mouseleave(function(){s.disabled||n.resizing||(_(this).addClass("ui-resizable-autohide"),n._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,t=function(e){_(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(t(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(e){var t,i,r=!1;for(t in this.handles)((i=_(this.handles[t])[0])===e.target||_.contains(i,e.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(e){var t,i,r,n=this.options,s=this.element.position(),o=this.element;return this.resizing=!0,/absolute/.test(o.css("position"))?o.css({position:"absolute",top:o.css("top"),left:o.css("left")}):o.is(".ui-draggable")&&o.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy(),t=d(this.helper.css("left")),i=d(this.helper.css("top")),n.containment&&(t+=_(n.containment).scrollLeft()||0,i+=_(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:t,top:i},this.size=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.originalPosition={left:t,top:i},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=_(".ui-resizable-"+this.axis).css("cursor"),_("body").css("cursor","auto"===r?this.axis+"-resize":r),o.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var t,i=this.helper,r={},n=this.originalMousePosition,s=this.axis,o=this.position.top,a=this.position.left,c=this.size.width,h=this.size.height,l=e.pageX-n.left||0,u=e.pageY-n.top||0,d=this._change[s];return d&&(t=d.apply(this,[e,l,u]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(t=this._updateRatio(t,e)),t=this._respectSize(t,e),this._updateCache(t),this._propagate("resize",e),this.position.top!==o&&(r.top=this.position.top+"px"),this.position.left!==a&&(r.left=this.position.left+"px"),this.size.width!==c&&(r.width=this.size.width+"px"),this.size.height!==h&&(r.height=this.size.height+"px"),i.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),_.isEmptyObject(r)||this._trigger("resize",e,this.ui())),!1},_mouseStop:function(e){this.resizing=!1;var t,i,r,n,s,o,a,c=this.options,h=this;return this._helper&&(r=(i=(t=this._proportionallyResizeElements).length&&/textarea/i.test(t[0].nodeName))&&_.ui.hasScroll(t[0],"left")?0:h.sizeDiff.height,n=i?0:h.sizeDiff.width,s={width:h.helper.width()-n,height:h.helper.height()-r},o=parseInt(h.element.css("left"),10)+(h.position.left-h.originalPosition.left)||null,a=parseInt(h.element.css("top"),10)+(h.position.top-h.originalPosition.top)||null,c.animate||this.element.css(_.extend(s,{top:a,left:o})),h.helper.height(h.size.height),h.helper.width(h.size.width),this._helper&&!c.animate&&this._proportionallyResize()),_("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,r,n,s,o=this.options;s={minWidth:u(o.minWidth)?o.minWidth:0,maxWidth:u(o.maxWidth)?o.maxWidth:1/0,minHeight:u(o.minHeight)?o.minHeight:0,maxHeight:u(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,n=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),r>s.minHeight&&(s.minHeight=r),i<s.maxWidth&&(s.maxWidth=i),n<s.maxHeight&&(s.maxHeight=n)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),u(e.left)&&(this.position.left=e.left),u(e.top)&&(this.position.top=e.top),u(e.height)&&(this.size.height=e.height),u(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,r=this.axis;return u(e.height)?e.width=e.height*this.aspectRatio:u(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,r=u(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=u(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=u(e.width)&&t.minWidth&&t.minWidth>e.width,o=u(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,h=/sw|nw|w/.test(i),l=/nw|ne|n/.test(i);return s&&(e.width=t.minWidth),o&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),s&&h&&(e.left=a-t.minWidth),r&&h&&(e.left=a-t.maxWidth),o&&l&&(e.top=c-t.minHeight),n&&l&&(e.top=c-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,r,n,s=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(n=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(r[t],10)||0);n.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,t=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||_("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var r=this.originalSize;return{top:this.originalPosition.top+i,height:r.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(e,t,i){return _.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},sw:function(e,t,i){return _.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,t,i]))},ne:function(e,t,i){return _.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,t,i]))},nw:function(e,t,i){return _.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,t,i]))}},_propagate:function(e,t){_.ui.plugin.call(this,e,[t,this.ui()]),"resize"!==e&&this._trigger(e,t,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),_.ui.plugin.add("resizable","animate",{stop:function(t){var i=_(this).data("ui-resizable"),e=i.options,r=i._proportionallyResizeElements,n=r.length&&/textarea/i.test(r[0].nodeName),s=n&&_.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,o=n?0:i.sizeDiff.width,a={width:i.size.width-o,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,h=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(_.extend(a,h&&c?{top:h,left:c}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var e={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&_(r[0]).css({width:e.width,height:e.height}),i._updateCache(e),i._propagate("resize",t)}})}}),_.ui.plugin.add("resizable","containment",{start:function(){var i,r,e,t,n,s,o,a=_(this).data("ui-resizable"),c=a.options,h=a.element,l=c.containment,u=l instanceof _?l.get(0):/parent/.test(l)?h.parent().get(0):l;u&&(a.containerElement=_(u),/document/.test(l)||l===document?(a.containerOffset={left:0,top:0},a.containerPosition={left:0,top:0},a.parentData={element:_(document),left:0,top:0,width:_(document).width(),height:_(document).height()||document.body.parentNode.scrollHeight}):(i=_(u),r=[],_(["Top","Right","Left","Bottom"]).each(function(e,t){r[e]=d(i.css("padding"+t))}),a.containerOffset=i.offset(),a.containerPosition=i.position(),a.containerSize={height:i.innerHeight()-r[3],width:i.innerWidth()-r[1]},e=a.containerOffset,t=a.containerSize.height,n=a.containerSize.width,s=_.ui.hasScroll(u,"left")?u.scrollWidth:n,o=_.ui.hasScroll(u)?u.scrollHeight:t,a.parentData={element:u,left:e.left,top:e.top,width:s,height:o}))},resize:function(e){var t,i,r,n,s=_(this).data("ui-resizable"),o=s.options,a=s.containerOffset,c=s.position,h=s._aspectRatio||e.shiftKey,l={top:0,left:0},u=s.containerElement;u[0]!==document&&/static/.test(u.css("position"))&&(l=a),c.left<(s._helper?a.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-a.left:s.position.left-l.left),h&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=o.helper?a.left:0),c.top<(s._helper?a.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-a.top:s.position.top),h&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?a.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,t=Math.abs((s._helper,s.offset.left-l.left+s.sizeDiff.width)),i=Math.abs((s._helper?s.offset.top-l.top:s.offset.top-a.top)+s.sizeDiff.height),r=s.containerElement.get(0)===s.element.parent().get(0),n=/relative|absolute/.test(s.containerElement.css("position")),r&&n&&(t-=s.parentData.left),t+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-t,h&&(s.size.height=s.size.width/s.aspectRatio)),i+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-i,h&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var e=_(this).data("ui-resizable"),t=e.options,i=e.containerOffset,r=e.containerPosition,n=e.containerElement,s=_(e.helper),o=s.offset(),a=s.outerWidth()-e.sizeDiff.width,c=s.outerHeight()-e.sizeDiff.height;e._helper&&!t.animate&&/relative/.test(n.css("position"))&&_(this).css({left:o.left-r.left-i.left,width:a,height:c}),e._helper&&!t.animate&&/static/.test(n.css("position"))&&_(this).css({left:o.left-r.left-i.left,width:a,height:c})}}),_.ui.plugin.add("resizable","alsoResize",{start:function(){var e=_(this).data("ui-resizable").options,t=function(e){_(e).each(function(){var e=_(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof e.alsoResize||e.alsoResize.parentNode?t(e.alsoResize):e.alsoResize.length?(e.alsoResize=e.alsoResize[0],t(e.alsoResize)):_.each(e.alsoResize,function(e){t(e)})},resize:function(e,s){var t=_(this).data("ui-resizable"),i=t.options,r=t.originalSize,n=t.originalPosition,o={height:t.size.height-r.height||0,width:t.size.width-r.width||0,top:t.position.top-n.top||0,left:t.position.left-n.left||0},a=function(e,i){_(e).each(function(){var e=_(this),r=_(this).data("ui-resizable-alsoresize"),n={},t=i&&i.length?i:e.parents(s.originalElement[0]).length?["width","height"]:["width","height","top","left"];_.each(t,function(e,t){var i=(r[t]||0)+(o[t]||0);i&&0<=i&&(n[t]=i||null)}),e.css(n)})};"object"!=typeof i.alsoResize||i.alsoResize.nodeType?a(i.alsoResize):_.each(i.alsoResize,function(e,t){a(e,t)})},stop:function(){_(this).removeData("resizable-alsoresize")}}),_.ui.plugin.add("resizable","ghost",{start:function(){var e=_(this).data("ui-resizable"),t=e.options,i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof t.ghost?t.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=_(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=_(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),_.ui.plugin.add("resizable","grid",{resize:function(){var e=_(this).data("ui-resizable"),t=e.options,i=e.size,r=e.originalSize,n=e.originalPosition,s=e.axis,o="number"==typeof t.grid?[t.grid,t.grid]:t.grid,a=o[0]||1,c=o[1]||1,h=Math.round((i.width-r.width)/a)*a,l=Math.round((i.height-r.height)/c)*c,u=r.width+h,d=r.height+l,p=t.maxWidth&&t.maxWidth<u,f=t.maxHeight&&t.maxHeight<d,g=t.minWidth&&t.minWidth>u,m=t.minHeight&&t.minHeight>d;t.grid=o,g&&(u+=a),m&&(d+=c),p&&(u-=a),f&&(d-=c),/^(se|s|e)$/.test(s)?(e.size.width=u,e.size.height=d):/^(ne)$/.test(s)?(e.size.width=u,e.size.height=d,e.position.top=n.top-l):(/^(sw)$/.test(s)?(e.size.width=u,e.size.height=d):(e.size.width=u,e.size.height=d,e.position.top=n.top-l),e.position.left=n.left-h)}})}(jQuery),function(h,e){h.widget("ui.selectable",h.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,t=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(e=h(t.options.filter,t.element[0])).addClass("ui-selectee"),e.each(function(){var e=h(this),t=e.offset();h.data(this,"selectable-item",{element:this,$element:e,left:t.left,top:t.top,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=h("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(i){var r=this,e=this.options;this.opos=[i.pageX,i.pageY],this.options.disabled||(this.selectees=h(e.filter,this.element[0]),this._trigger("start",i),h(e.appendTo).append(this.helper),this.helper.css({left:i.pageX,top:i.pageY,width:0,height:0}),e.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var e=h.data(this,"selectable-item");e.startselected=!0,i.metaKey||i.ctrlKey||(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,r._trigger("unselecting",i,{unselecting:e.element}))}),h(i.target).parents().addBack().each(function(){var e,t=h.data(this,"selectable-item");if(t)return e=!i.metaKey&&!i.ctrlKey||!t.$element.hasClass("ui-selected"),t.$element.removeClass(e?"ui-unselecting":"ui-selected").addClass(e?"ui-selecting":"ui-unselecting"),t.unselecting=!e,t.selecting=e,(t.selected=e)?r._trigger("selecting",i,{selecting:t.element}):r._trigger("unselecting",i,{unselecting:t.element}),!1}))},_mouseDrag:function(i){if(this.dragged=!0,!this.options.disabled){var e,r=this,n=this.options,s=this.opos[0],o=this.opos[1],a=i.pageX,c=i.pageY;return a<s&&(e=a,a=s,s=e),c<o&&(e=c,c=o,o=e),this.helper.css({left:s,top:o,width:a-s,height:c-o}),this.selectees.each(function(){var e=h.data(this,"selectable-item"),t=!1;e&&e.element!==r.element[0]&&("touch"===n.tolerance?t=!(e.left>a||e.right<s||e.top>c||e.bottom<o):"fit"===n.tolerance&&(t=e.left>s&&e.right<a&&e.top>o&&e.bottom<c),t?(e.selected&&(e.$element.removeClass("ui-selected"),e.selected=!1),e.unselecting&&(e.$element.removeClass("ui-unselecting"),e.unselecting=!1),e.selecting||(e.$element.addClass("ui-selecting"),e.selecting=!0,r._trigger("selecting",i,{selecting:e.element}))):(e.selecting&&((i.metaKey||i.ctrlKey)&&e.startselected?(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.$element.addClass("ui-selected"),e.selected=!0):(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.startselected&&(e.$element.addClass("ui-unselecting"),e.unselecting=!0),r._trigger("unselecting",i,{unselecting:e.element}))),e.selected&&(i.metaKey||i.ctrlKey||e.startselected||(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,r._trigger("unselecting",i,{unselecting:e.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,h(".ui-unselecting",this.element[0]).each(function(){var e=h.data(this,"selectable-item");e.$element.removeClass("ui-unselecting"),e.unselecting=!1,e.startselected=!1,i._trigger("unselected",t,{unselected:e.element})}),h(".ui-selecting",this.element[0]).each(function(){var e=h.data(this,"selectable-item");e.$element.removeClass("ui-selecting").addClass("ui-selected"),e.selecting=!1,e.selected=!0,e.startselected=!0,i._trigger("selected",t,{selected:e.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(p,e){function f(e,t,i){return t<e&&e<t+i}function g(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}p.widget("ui.sortable",p.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||g(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;0<=e;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,t){"disabled"===e?(this.options[e]=t,this.widget().toggleClass("ui-sortable-disabled",!!t)):p.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,t){var i=null,r=!1,n=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(e),p(e.target).parents().each(function(){if(p.data(this,n.widgetName+"-item")===n)return i=p(this),!1}),p.data(e.target,n.widgetName+"-item")===n&&(i=p(e.target)),!!i&&(!(this.options.handle&&!t&&(p(this.options.handle,i).find("*").addBack().each(function(){this===e.target&&(r=!0)}),!r))&&(this.currentItem=i,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(e,t,i){var r,n,s=this.options;if((this.currentContainer=this).refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},p.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",s.cursor),this.storedStylesheet=p("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(n)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(r=this.containers.length-1;0<=r;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return p.ui.ddmanager&&(p.ui.ddmanager.current=this),p.ui.ddmanager&&!s.dropBehaviour&&p.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var t,i,r,n,s=this.options,o=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-p(document).scrollTop()<s.scrollSensitivity?o=p(document).scrollTop(p(document).scrollTop()-s.scrollSpeed):p(window).height()-(e.pageY-p(document).scrollTop())<s.scrollSensitivity&&(o=p(document).scrollTop(p(document).scrollTop()+s.scrollSpeed)),e.pageX-p(document).scrollLeft()<s.scrollSensitivity?o=p(document).scrollLeft(p(document).scrollLeft()-s.scrollSpeed):p(window).width()-(e.pageX-p(document).scrollLeft())<s.scrollSensitivity&&(o=p(document).scrollLeft(p(document).scrollLeft()+s.scrollSpeed))),!1!==o&&p.ui.ddmanager&&!s.dropBehaviour&&p.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t=this.items.length-1;0<=t;t--)if(r=(i=this.items[t]).item[0],(n=this._intersectsWithPointer(i))&&i.instance===this.currentContainer&&!(r===this.currentItem[0]||this.placeholder[1===n?"next":"prev"]()[0]===r||p.contains(this.placeholder[0],r)||"semi-dynamic"===this.options.type&&p.contains(this.element[0],r))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(e,i),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),p.ui.ddmanager&&p.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,t){if(e){if(p.ui.ddmanager&&!this.options.dropBehaviour&&p.ui.ddmanager.drop(this,e),this.options.revert){var i=this,r=this.placeholder.offset(),n=this.options.axis,s={};n&&"x"!==n||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,p(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,t);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),p.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?p(this.domPosition.prev).after(this.currentItem):p(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var e=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},p(e).each(function(){var e=(p(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);e&&i.push((t.key||e[1]+"[]")+"="+(t.key&&t.expression?e[1]:e[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(e){var t=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t.each(function(){i.push(p(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,s=e.left,o=s+e.width,a=e.top,c=a+e.height,h=this.offset.click.top,l=this.offset.click.left,u="x"===this.options.axis||a<r+h&&r+h<c,d="y"===this.options.axis||s<t+l&&t+l<o,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:s<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<o&&a<r+this.helperProportions.height/2&&n-this.helperProportions.height/2<c},_intersectsWithPointer:function(e){var t="x"===this.options.axis||f(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||f(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=t&&i,n=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return!!r&&(this.floating?s&&"right"===s||"down"===n?2:1:n&&("down"===n?2:1))},_intersectsWithSides:function(e){var t=f(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=f(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:r&&("down"===r&&t||"up"===r&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(0<e?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(0<e?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(e){var t,i,r,n,s=[],o=[],a=this._connectWith();if(a&&e)for(t=a.length-1;0<=t;t--)for(i=(r=p(a[t])).length-1;0<=i;i--)(n=p.data(r[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&o.push([p.isFunction(n.options.items)?n.options.items.call(n.element):p(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);for(o.push([p.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):p(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),t=o.length-1;0<=t;t--)o[t][0].each(function(){s.push(this)});return p(s)},_removeCurrentsFromItems:function(){var i=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=p.grep(this.items,function(e){for(var t=0;t<i.length;t++)if(i[t]===e.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var t,i,r,n,s,o,a,c,h=this.items,l=[[p.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):p(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(t=u.length-1;0<=t;t--)for(i=(r=p(u[t])).length-1;0<=i;i--)(n=p.data(r[i],this.widgetFullName))&&n!==this&&!n.options.disabled&&(l.push([p.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):p(n.options.items,n.element),n]),this.containers.push(n));for(t=l.length-1;0<=t;t--)for(s=l[t][1],i=0,c=(o=l[t][0]).length;i<c;i++)(a=p(o[i])).data(this.widgetName+"-item",s),h.push({item:a,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){var t,i,r,n;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),t=this.items.length-1;0<=t;t--)(i=this.items[t]).instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?p(this.options.toleranceElement,i.item):i.item,e||(i.width=r.outerWidth(),i.height=r.outerHeight()),n=r.offset(),i.left=n.left,i.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(t=this.containers.length-1;0<=t;t--)n=this.containers[t].element.offset(),this.containers[t].containerCache.left=n.left,this.containers[t].containerCache.top=n.top,this.containers[t].containerCache.width=this.containers[t].element.outerWidth(),this.containers[t].containerCache.height=this.containers[t].element.outerHeight();return this},_createPlaceholder:function(i){var r,n=(i=i||this).options;n.placeholder&&n.placeholder.constructor!==String||(r=n.placeholder,n.placeholder={element:function(){var e=i.currentItem[0].nodeName.toLowerCase(),t=p("<"+e+">",i.document[0]).addClass(r||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===e?i.currentItem.children().each(function(){p("<td>&#160;</td>",i.document[0]).attr("colspan",p(this).attr("colspan")||1).appendTo(t)}):"img"===e&&t.attr("src",i.currentItem.attr("src")),r||t.css("visibility","hidden"),t},update:function(e,t){r&&!n.forcePlaceholderSize||(t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}),i.placeholder=p(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(e){var t,i,r,n,s,o,a,c,h,l,u=null,d=null;for(t=this.containers.length-1;0<=t;t--)if(!p.contains(this.currentItem[0],this.containers[t].element[0]))if(this._intersectsWith(this.containers[t].containerCache)){if(u&&p.contains(this.containers[t].element[0],u.element[0]))continue;u=this.containers[t],d=t}else this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",e,this._uiHash(this)),this.containers[t].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[d].containerCache.over||(this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1);else{for(r=1e4,n=null,s=(l=u.floating||g(this.currentItem))?"left":"top",o=l?"width":"height",a=this.positionAbs[s]+this.offset.click[s],i=this.items.length-1;0<=i;i--)p.contains(this.containers[d].element[0],this.items[i].item[0])&&this.items[i].item[0]!==this.currentItem[0]&&(l&&!f(this.positionAbs.top+this.offset.click.top,this.items[i].top,this.items[i].height)||(c=this.items[i].item.offset()[s],h=!1,Math.abs(c-a)>Math.abs(c+this.items[i][o]-a)&&(h=!0,c+=this.items[i][o]),Math.abs(c-a)<r&&(r=Math.abs(c-a),n=this.items[i],this.direction=h?"up":"down")));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[d])return;n?this._rearrange(e,n,null,!0):this._rearrange(e,null,this.containers[d].element,!0),this._trigger("change",e,this._uiHash()),this.containers[d]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[d],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",e,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(e){var t=this.options,i=p.isFunction(t.helper)?p(t.helper.apply(this.element[0],[e,this.currentItem])):"clone"===t.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||p("parent"!==t.appendTo?t.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),i[0].style.width&&!t.forceHelperSize||i.width(this.currentItem.width()),i[0].style.height&&!t.forceHelperSize||i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),p.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&p.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&p.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,t,i,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),"document"!==r.containment&&"window"!==r.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,p("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(p("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=p(r.containment)[0],t=p(r.containment).offset(),i="hidden"!==p(e).css("overflow"),this.containment=[t.left+(parseInt(p(e).css("borderLeftWidth"),10)||0)+(parseInt(p(e).css("paddingLeft"),10)||0)-this.margins.left,t.top+(parseInt(p(e).css("borderTopWidth"),10)||0)+(parseInt(p(e).css("paddingTop"),10)||0)-this.margins.top,t.left+(i?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(p(e).css("borderLeftWidth"),10)||0)-(parseInt(p(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,t.top+(i?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(p(e).css("borderTopWidth"),10)||0)-(parseInt(p(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&p.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(r[0].tagName);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:r.scrollTop())*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:r.scrollLeft())*i}},_generatePosition:function(e){var t,i,r=this.options,n=e.pageX,s=e.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&p.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(t=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?t-this.offset.click.top>=this.containment[1]&&t-this.offset.click.top<=this.containment[3]?t:t-this.offset.click.top>=this.containment[1]?t-r.grid[1]:t+r.grid[1]:t,i=this.originalPageX+Math.round((n-this.originalPageX)/r.grid[0])*r.grid[0],n=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-r.grid[0]:i+r.grid[0]:i)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:o.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:o.scrollLeft())}},_rearrange:function(e,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var i,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;0<=i;i--)t||r.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<r.length;i++)r[i].call(this,e);this._trigger("stop",e,this._uiHash())}return!(this.fromOutside=!1)},_trigger:function(){!1===p.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(e){var t=e||this;return{helper:t.helper,placeholder:t.placeholder||p([]),position:t.position,originalPosition:t.originalPosition,offset:t.positionAbs,item:t.currentItem,sender:e?e.element:null}}})}(jQuery),function(h,e){var n=0,d={},p={};d.height=d.paddingTop=d.paddingBottom=d.borderTopWidth=d.borderBottomWidth="hide",p.height=p.paddingTop=p.paddingBottom=p.borderTopWidth=p.borderBottomWidth="show",h.widget("ui.accordion",{version:"1.10.3",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var e=this.options;this.prevShow=this.prevHide=h(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||!1!==e.active&&null!=e.active||(e.active=0),this._processPanels(),e.active<0&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():h(),content:this.active.length?this.active.next():h()}},_createIcons:function(){var e=this.options.icons;e&&(h("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)):this._activate(t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var t=h.ui.keyCode,i=this.headers.length,r=this.headers.index(e.target),n=!1;switch(e.keyCode){case t.RIGHT:case t.DOWN:n=this.headers[(r+1)%i];break;case t.LEFT:case t.UP:n=this.headers[(r-1+i)%i];break;case t.SPACE:case t.ENTER:this._eventHandler(e);break;case t.HOME:n=this.headers[0];break;case t.END:n=this.headers[i-1]}n&&(h(e.target).attr("tabIndex",-1),h(n).attr("tabIndex",0),n.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===h.ui.keyCode.UP&&e.ctrlKey&&h(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),!1===e.active&&!0===e.collapsible||!this.headers.length?(e.active=!1,this.active=h()):!1===e.active?this._activate(0):this.active.length&&!h.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=h()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var i,e=this.options,t=e.heightStyle,r=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++n);this.active=this._findActive(e.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(e){var t=h(this),i=t.attr("id"),r=t.next(),n=r.attr("id");i||(i=s+"-header-"+e,t.attr("id",i)),n||(n=s+"-panel-"+e,r.attr("id",n)),t.attr("aria-controls",n),r.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(e.event),"fill"===t?(i=r.height(),this.element.siblings(":visible").each(function(){var e=h(this),t=e.css("position");"absolute"!==t&&"fixed"!==t&&(i-=e.outerHeight(!0))}),this.headers.each(function(){i-=h(this).outerHeight(!0)}),this.headers.next().each(function(){h(this).height(Math.max(0,i-h(this).innerHeight()+h(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.headers.next().each(function(){i=Math.max(i,h(this).css("height","").height())}).height(i))},_activate:function(e){var t=this._findActive(e)[0];t!==this.active[0]&&(t=t||this.active[0],this._eventHandler({target:t,currentTarget:t,preventDefault:h.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):h()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&h.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var t=this.options,i=this.active,r=h(e.currentTarget),n=r[0]===i[0],s=n&&t.collapsible,o=s?h():r.next(),a=i.next(),c={oldHeader:i,oldPanel:a,newHeader:s?h():r,newPanel:o};e.preventDefault(),n&&!t.collapsible||!1===this._trigger("beforeActivate",e,c)||(t.active=!s&&this.headers.index(r),this.active=n?h():r,this._toggle(c),i.removeClass("ui-accordion-header-active ui-state-active"),t.icons&&i.children(".ui-accordion-header-icon").removeClass(t.icons.activeHeader).addClass(t.icons.header),n||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),t.icons&&r.children(".ui-accordion-header-icon").removeClass(t.icons.header).addClass(t.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var t=e.newPanel,i=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=t,this.prevHide=i,this.options.animate?this._animate(t,i,e):(i.hide(),t.show(),this._toggleComplete(e)),i.attr({"aria-expanded":"false","aria-hidden":"true"}),i.prev().attr("aria-selected","false"),t.length&&i.length?i.prev().attr("tabIndex",-1):t.length&&this.headers.filter(function(){return 0===h(this).attr("tabIndex")}).attr("tabIndex",-1),t.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,i,t){var r,n,s,o=this,a=0,c=e.length&&(!i.length||e.index()<i.index()),h=this.options.animate||{},l=c&&h.down||h,u=function(){o._toggleComplete(t)};return"number"==typeof l&&(s=l),"string"==typeof l&&(n=l),n=n||l.easing||h.easing,s=s||l.duration||h.duration,i.length?e.length?(r=e.show().outerHeight(),i.animate(d,{duration:s,easing:n,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(p,{duration:s,easing:n,complete:u,step:function(e,t){t.now=Math.round(e),"height"!==t.prop?a+=t.now:"content"!==o.options.heightStyle&&(t.now=Math.round(r-i.outerHeight()-a),a=0)}})):i.animate(d,s,n,u):e.animate(p,s,n,u)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(o,e){var r=0;o.widget("ui.autocomplete",{version:"1.10.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var i,r,n,e=this.element[0].nodeName.toLowerCase(),t="textarea"===e,s="input"===e;this.isMultiLine=!!t||!s&&this.element.prop("isContentEditable"),this.valueMethod=this.element[t||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(e){if(this.element.prop("readOnly"))r=n=i=!0;else{r=n=i=!1;var t=o.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:i=!0,this._move("previousPage",e);break;case t.PAGE_DOWN:i=!0,this._move("nextPage",e);break;case t.UP:i=!0,this._keyEvent("previous",e);break;case t.DOWN:i=!0,this._keyEvent("next",e);break;case t.ENTER:case t.NUMPAD_ENTER:this.menu.active&&(i=!0,e.preventDefault(),this.menu.select(e));break;case t.TAB:this.menu.active&&this.menu.select(e);break;case t.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(e),e.preventDefault());break;default:r=!0,this._searchTimeout(e)}}},keypress:function(e){if(i)return i=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||e.preventDefault());if(!r){var t=o.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this._move("previousPage",e);break;case t.PAGE_DOWN:this._move("nextPage",e);break;case t.UP:this._keyEvent("previous",e);break;case t.DOWN:this._keyEvent("next",e)}}},input:function(e){if(n)return n=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=o("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];o(e.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(e){e.target===t.element[0]||e.target===i||o.contains(i,e.target)||t.close()})})},menufocus:function(e,t){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){o(e.target).trigger(e.originalEvent)});var i=t.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:i})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=o("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?o(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var i,r,n=this;o.isArray(this.options.source)?(i=this.options.source,this.source=function(e,t){t(o.ui.autocomplete.filter(i,e.term))}):"string"==typeof this.options.source?(r=this.options.source,this.source=function(e,t){n.xhr&&n.xhr.abort(),n.xhr=o.ajax({url:r,data:e,dataType:"json",success:function(e){t(e)},error:function(){t([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=this,i=++r;return function(e){i===r&&t.__response(e),t.pending--,t.pending||t.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:o.map(e,function(e){return"string"==typeof e?{label:e,value:e}:o.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var t=this.menu.element.empty();this._renderMenu(t,e),this.isNewMenu=!0,this.menu.refresh(),t.show(),this._resizeMenu(),t.position(o.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(i,e){var r=this;o.each(e,function(e,t){r._renderItemData(i,t)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(e,t){return o("<li>").append(o("<a>").text(t.label)).appendTo(e)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),o.extend(o.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,t){var i=new RegExp(o.ui.autocomplete.escapeRegex(t),"i");return o.grep(e,function(e){return i.test(e.label||e.value||e)})}}),o.widget("ui.autocomplete",o.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(1<e?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(s,e){var o,a,c,h,l="ui-button ui-widget ui-state-default ui-corner-all",u="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",d=function(){var e=s(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},p=function(e){var t=e.name,i=e.form,r=s([]);return t&&(t=t.replace(/'/g,"\\'"),r=i?s(i).find("[name='"+t+"']"):s("[name='"+t+"']",e.ownerDocument).filter(function(){return!this.form})),r};s.widget("ui.button",{version:"1.10.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,d),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,e="checkbox"===this.type||"radio"===this.type,r=e?"":"ui-state-active",n="ui-state-focus";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(l).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===o&&s(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||s(this).removeClass(r)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){t.buttonElement.addClass(n)}).bind("blur"+this.eventNamespace,function(){t.buttonElement.removeClass(n)}),e&&(this.element.bind("change"+this.eventNamespace,function(){h||t.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){i.disabled||(h=!1,a=e.pageX,c=e.pageY)}).bind("mouseup"+this.eventNamespace,function(e){i.disabled||a===e.pageX&&c===e.pageY||(h=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled||h)return!1}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled||h)return!1;s(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var e=t.element[0];p(e).not(e).map(function(){return s(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;s(this).addClass("ui-state-active"),o=this,t.document.one("mouseup",function(){o=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;s(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){if(i.disabled)return!1;e.keyCode!==s.ui.keyCode.SPACE&&e.keyCode!==s.ui.keyCode.ENTER||s(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){s(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===s.ui.keyCode.SPACE&&s(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(l+" ui-state-hover ui-state-active  "+u).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super(e,t),"disabled"!==e?this._resetButton():t?this.element.prop("disabled",!0):this.element.prop("disabled",!1)},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?p(this.element[0]).each(function(){s(this).is(":checked")?s(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):s(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var e=this.buttonElement.removeClass(u),t=s("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),i=this.options.icons,r=i.primary&&i.secondary,n=[];i.primary||i.secondary?(this.options.text&&n.push("ui-button-text-icon"+(r?"s":i.primary?"-primary":"-secondary")),i.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+i.primary+"'></span>"),i.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+i.secondary+"'></span>"),this.options.text||(n.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",s.trim(t)))):n.push("ui-button-text-only"),e.addClass(n.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),s.widget("ui.buttonset",{version:"1.10.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var e="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return s(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return s(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(x,c){x.extend(x.ui,{datepicker:{version:"1.10.3"}});var n,u="datepicker";function e(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},x.extend(this._defaults,this.regional[""]),this.dpDiv=i(x("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function i(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){x(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&x(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&x(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){x.datepicker._isDisabledDatepicker(n.inline?e.parent()[0]:n.input[0])||(x(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),x(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&x(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&x(this).addClass("ui-datepicker-next-hover"))})}function d(e,t){for(var i in x.extend(e,t),t)null==t[i]&&(e[i]=t[i]);return e}x.extend(e.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return d(this._defaults,e||{}),this},_attachDatepicker:function(e,t){var i,r,n;r="div"===(i=e.nodeName.toLowerCase())||"span"===i,e.id||(this.uuid+=1,e.id="dp"+this.uuid),(n=this._newInst(x(e),r)).settings=x.extend({},t||{}),"input"===i?this._connectDatepicker(e,n):r&&this._inlineDatepicker(e,n)},_newInst:function(e,t){return{id:e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?i(x("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,t){var i=x(e);t.append=x([]),t.trigger=x([]),i.hasClass(this.markerClassName)||(this._attachments(i,t),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(t),x.data(e,u,t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var i,r,n,s=this._get(t,"appendText"),o=this._get(t,"isRTL");t.append&&t.append.remove(),s&&(t.append=x("<span class='"+this._appendClass+"'>"+s+"</span>"),e[o?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove(),"focus"!==(i=this._get(t,"showOn"))&&"both"!==i||e.focus(this._showDatepicker),"button"!==i&&"both"!==i||(r=this._get(t,"buttonText"),n=this._get(t,"buttonImage"),t.trigger=x(this._get(t,"buttonImageOnly")?x("<img/>").addClass(this._triggerClass).attr({src:n,alt:r,title:r}):x("<button type='button'></button>").addClass(this._triggerClass).html(n?x("<img/>").attr({src:n,alt:r,title:r}):r)),e[o?"before":"after"](t.trigger),t.trigger.click(function(){return x.datepicker._datepickerShowing&&x.datepicker._lastInput===e[0]?x.datepicker._hideDatepicker():(x.datepicker._datepickerShowing&&x.datepicker._lastInput!==e[0]&&x.datepicker._hideDatepicker(),x.datepicker._showDatepicker(e[0])),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,r,n,s=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(n=r=i=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,r=n);return r},s.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length)}},_inlineDatepicker:function(e,t){var i=x(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(t.dpDiv),x.data(e,u,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,i,r,n){var s,o,a,c,h,l=this._dialogInst;return l||(this.uuid+=1,s="dp"+this.uuid,this._dialogInput=x("<input type='text' id='"+s+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),x("body").append(this._dialogInput),(l=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},x.data(this._dialogInput[0],u,l)),d(l.settings,r||{}),t=t&&t.constructor===Date?this._formatDate(l,t):t,this._dialogInput.val(t),this._pos=n?n.length?n:[n.pageX,n.pageY]:null,this._pos||(o=document.documentElement.clientWidth,a=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[o/2-100+c,a/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),l.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),x.blockUI&&x.blockUI(this.dpDiv),x.data(this._dialogInput[0],u,l),this},_destroyDatepicker:function(e){var t,i=x(e),r=x.data(e,u);i.hasClass(this.markerClassName)&&(t=e.nodeName.toLowerCase(),x.removeData(e,u),"input"===t?(r.append.remove(),r.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==t&&"span"!==t||i.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var e,i,r=x(t),n=x.data(t,u);r.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==e&&"span"!==e||((i=r.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=x.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var e,i,r=x(t),n=x.data(t,u);r.hasClass(this.markerClassName)&&("input"===(e=t.nodeName.toLowerCase())?(t.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==e&&"span"!==e||((i=r.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=x.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(e){try{return x.data(e,u)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var r,n,s,o,a=this._getInst(e);if(2===arguments.length&&"string"==typeof t)return"defaults"===t?x.extend({},x.datepicker._defaults):a?"all"===t?x.extend({},a.settings):this._get(a,t):null;r=t||{},"string"==typeof t&&((r={})[t]=i),a&&(this._curInst===a&&this._hideDatepicker(),n=this._getDateDatepicker(e,!0),s=this._getMinMaxDate(a,"min"),o=this._getMinMaxDate(a,"max"),d(a.settings,r),null!==s&&r.dateFormat!==c&&r.minDate===c&&(a.settings.minDate=this._formatDate(a,s)),null!==o&&r.dateFormat!==c&&r.maxDate===c&&(a.settings.maxDate=this._formatDate(a,o)),"disabled"in r&&(r.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(x(e),a),this._autoSize(a),this._setDate(a,n),this._updateAlternate(a),this._updateDatepicker(a))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(e){var t,i,r,n=x.datepicker._getInst(e.target),s=!0,o=n.dpDiv.is(".ui-datepicker-rtl");if(n._keyEvent=!0,x.datepicker._datepickerShowing)switch(e.keyCode){case 9:x.datepicker._hideDatepicker(),s=!1;break;case 13:return(r=x("td."+x.datepicker._dayOverClass+":not(."+x.datepicker._currentClass+")",n.dpDiv))[0]&&x.datepicker._selectDay(e.target,n.selectedMonth,n.selectedYear,r[0]),(t=x.datepicker._get(n,"onSelect"))?(i=x.datepicker._formatDate(n),t.apply(n.input?n.input[0]:null,[i,n])):x.datepicker._hideDatepicker(),!1;case 27:x.datepicker._hideDatepicker();break;case 33:x.datepicker._adjustDate(e.target,e.ctrlKey?-x.datepicker._get(n,"stepBigMonths"):-x.datepicker._get(n,"stepMonths"),"M");break;case 34:x.datepicker._adjustDate(e.target,e.ctrlKey?+x.datepicker._get(n,"stepBigMonths"):+x.datepicker._get(n,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&x.datepicker._clearDate(e.target),s=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&x.datepicker._gotoToday(e.target),s=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,o?1:-1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&x.datepicker._adjustDate(e.target,e.ctrlKey?-x.datepicker._get(n,"stepBigMonths"):-x.datepicker._get(n,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,-7,"D"),s=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,o?-1:1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&x.datepicker._adjustDate(e.target,e.ctrlKey?+x.datepicker._get(n,"stepBigMonths"):+x.datepicker._get(n,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&x.datepicker._adjustDate(e.target,7,"D"),s=e.ctrlKey||e.metaKey;break;default:s=!1}else 36===e.keyCode&&e.ctrlKey?x.datepicker._showDatepicker(this):s=!1;s&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t,i,r=x.datepicker._getInst(e.target);if(x.datepicker._get(r,"constrainInput"))return t=x.datepicker._possibleChars(x.datepicker._get(r,"dateFormat")),i=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||i<" "||!t||-1<t.indexOf(i)},_doKeyUp:function(e){var t=x.datepicker._getInst(e.target);if(t.input.val()!==t.lastVal)try{x.datepicker.parseDate(x.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,x.datepicker._getFormatConfig(t))&&(x.datepicker._setDateFromField(t),x.datepicker._updateAlternate(t),x.datepicker._updateDatepicker(t))}catch(e){}return!0},_showDatepicker:function(e){var t,i,r,n,s,o,a;("input"!==(e=e.target||e).nodeName.toLowerCase()&&(e=x("input",e.parentNode)[0]),x.datepicker._isDisabledDatepicker(e)||x.datepicker._lastInput===e)||(t=x.datepicker._getInst(e),x.datepicker._curInst&&x.datepicker._curInst!==t&&(x.datepicker._curInst.dpDiv.stop(!0,!0),t&&x.datepicker._datepickerShowing&&x.datepicker._hideDatepicker(x.datepicker._curInst.input[0])),!1!==(r=(i=x.datepicker._get(t,"beforeShow"))?i.apply(e,[e,t]):{})&&(d(t.settings,r),t.lastVal=null,x.datepicker._lastInput=e,x.datepicker._setDateFromField(t),x.datepicker._inDialog&&(e.value=""),x.datepicker._pos||(x.datepicker._pos=x.datepicker._findPos(e),x.datepicker._pos[1]+=e.offsetHeight),n=!1,x(e).parents().each(function(){return!(n|="fixed"===x(this).css("position"))}),s={left:x.datepicker._pos[0],top:x.datepicker._pos[1]},x.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),x.datepicker._updateDatepicker(t),s=x.datepicker._checkOffset(t,s,n),t.dpDiv.css({position:x.datepicker._inDialog&&x.blockUI?"static":n?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"}),t.inline||(o=x.datepicker._get(t,"showAnim"),a=x.datepicker._get(t,"duration"),t.dpDiv.zIndex(x(e).zIndex()+1),x.datepicker._datepickerShowing=!0,x.effects&&x.effects.effect[o]?t.dpDiv.show(o,x.datepicker._get(t,"showOptions"),a):t.dpDiv[o||"show"](o?a:null),x.datepicker._shouldFocusInput(t)&&t.input.focus(),x.datepicker._curInst=t)))},_updateDatepicker:function(e){this.maxRows=4,(n=e).dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var t,i=this._getNumberOfMonths(e),r=i[1];e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),1<r&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",17*r+"em"),e.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===x.datepicker._curInst&&x.datepicker._datepickerShowing&&x.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(t=e.yearshtml,setTimeout(function(){t===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),t=e.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(e,t,i){var r=e.dpDiv.outerWidth(),n=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,o=e.input?e.input.outerHeight():0,a=document.documentElement.clientWidth+(i?0:x(document).scrollLeft()),c=document.documentElement.clientHeight+(i?0:x(document).scrollTop());return t.left-=this._get(e,"isRTL")?r-s:0,t.left-=i&&t.left===e.input.offset().left?x(document).scrollLeft():0,t.top-=i&&t.top===e.input.offset().top+o?x(document).scrollTop():0,t.left-=Math.min(t.left,t.left+r>a&&r<a?Math.abs(t.left+r-a):0),t.top-=Math.min(t.top,t.top+n>c&&n<c?Math.abs(n+o):0),t},_findPos:function(e){for(var t,i=this._getInst(e),r=this._get(i,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||x.expr.filters.hidden(e));)e=e[r?"previousSibling":"nextSibling"];return[(t=x(e).offset()).left,t.top]},_hideDatepicker:function(e){var t,i,r,n,s=this._curInst;!s||e&&s!==x.data(e,u)||this._datepickerShowing&&(t=this._get(s,"showAnim"),i=this._get(s,"duration"),r=function(){x.datepicker._tidyDialog(s)},x.effects&&(x.effects.effect[t]||x.effects[t])?s.dpDiv.hide(t,x.datepicker._get(s,"showOptions"),i,r):s.dpDiv["slideDown"===t?"slideUp":"fadeIn"===t?"fadeOut":"hide"](t?i:null,r),t||r(),this._datepickerShowing=!1,(n=this._get(s,"onClose"))&&n.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),x.blockUI&&(x.unblockUI(),x("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(x.datepicker._curInst){var t=x(e.target),i=x.datepicker._getInst(t[0]);(t[0].id===x.datepicker._mainDivId||0!==t.parents("#"+x.datepicker._mainDivId).length||t.hasClass(x.datepicker.markerClassName)||t.closest("."+x.datepicker._triggerClass).length||!x.datepicker._datepickerShowing||x.datepicker._inDialog&&x.blockUI)&&(!t.hasClass(x.datepicker.markerClassName)||x.datepicker._curInst===i)||x.datepicker._hideDatepicker()}},_adjustDate:function(e,t,i){var r=x(e),n=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(n,t+("M"===i?this._get(n,"showCurrentAtPos"):0),i),this._updateDatepicker(n))},_gotoToday:function(e){var t,i=x(e),r=this._getInst(i[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(t=new Date,r.selectedDay=t.getDate(),r.drawMonth=r.selectedMonth=t.getMonth(),r.drawYear=r.selectedYear=t.getFullYear()),this._notifyChange(r),this._adjustDate(i)},_selectMonthYear:function(e,t,i){var r=x(e),n=this._getInst(r[0]);n["selected"+("M"===i?"Month":"Year")]=n["draw"+("M"===i?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(n),this._adjustDate(r)},_selectDay:function(e,t,i,r){var n,s=x(e);x(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||((n=this._getInst(s[0])).selectedDay=n.currentDay=x("a",r).html(),n.selectedMonth=n.currentMonth=t,n.selectedYear=n.currentYear=i,this._selectDate(e,this._formatDate(n,n.currentDay,n.currentMonth,n.currentYear)))},_clearDate:function(e){var t=x(e);this._selectDate(t,"")},_selectDate:function(e,t){var i,r=x(e),n=this._getInst(r[0]);t=null!=t?t:this._formatDate(n),n.input&&n.input.val(t),this._updateAlternate(n),(i=this._get(n,"onSelect"))?i.apply(n.input?n.input[0]:null,[t,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t,i,r,n=this._get(e,"altField");n&&(t=this._get(e,"altFormat")||this._get(e,"dateFormat"),i=this._getDate(e),r=this.formatDate(t,i,this._getFormatConfig(e)),x(n).each(function(){x(this).val(r)}))},noWeekends:function(e){var t=e.getDay();return[0<t&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(i,s,e){if(null==i||null==s)throw"Invalid arguments";if(""===(s="object"==typeof s?s.toString():s+""))return null;var r,t,n,o,a=0,c=(e?e.shortYearCutoff:null)||this._defaults.shortYearCutoff,h="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),l=(e?e.dayNamesShort:null)||this._defaults.dayNamesShort,u=(e?e.dayNames:null)||this._defaults.dayNames,d=(e?e.monthNamesShort:null)||this._defaults.monthNamesShort,p=(e?e.monthNames:null)||this._defaults.monthNames,f=-1,g=-1,m=-1,_=-1,S=!1,v=function(e){var t=r+1<i.length&&i.charAt(r+1)===e;return t&&r++,t},y=function(e){var t=v(e),i=new RegExp("^\\d{1,"+("@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2)+"}"),r=s.substring(a).match(i);if(!r)throw"Missing number at position "+a;return a+=r[0].length,parseInt(r[0],10)},b=function(e,t,i){var r=-1,n=x.map(v(e)?i:t,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(x.each(n,function(e,t){var i=t[1];if(s.substr(a,i.length).toLowerCase()===i.toLowerCase())return r=t[0],a+=i.length,!1}),-1!==r)return r+1;throw"Unknown name at position "+a},E=function(){if(s.charAt(a)!==i.charAt(r))throw"Unexpected literal at position "+a;a++};for(r=0;r<i.length;r++)if(S)"'"!==i.charAt(r)||v("'")?E():S=!1;else switch(i.charAt(r)){case"d":m=y("d");break;case"D":b("D",l,u);break;case"o":_=y("o");break;case"m":g=y("m");break;case"M":g=b("M",d,p);break;case"y":f=y("y");break;case"@":f=(o=new Date(y("@"))).getFullYear(),g=o.getMonth()+1,m=o.getDate();break;case"!":f=(o=new Date((y("!")-this._ticksTo1970)/1e4)).getFullYear(),g=o.getMonth()+1,m=o.getDate();break;case"'":v("'")?E():S=!0;break;default:E()}if(a<s.length&&(n=s.substr(a),!/^\s+/.test(n)))throw"Extra/unparsed characters found in date: "+n;if(-1===f?f=(new Date).getFullYear():f<100&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=h?0:-100)),-1<_)for(g=1,m=_;;){if(m<=(t=this._getDaysInMonth(f,g-1)))break;g++,m-=t}if((o=this._daylightSavingAdjust(new Date(f,g-1,m))).getFullYear()!==f||o.getMonth()+1!==g||o.getDate()!==m)throw"Invalid date";return o},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(i,e,t){if(!e)return"";var r,n=(t?t.dayNamesShort:null)||this._defaults.dayNamesShort,s=(t?t.dayNames:null)||this._defaults.dayNames,o=(t?t.monthNamesShort:null)||this._defaults.monthNamesShort,a=(t?t.monthNames:null)||this._defaults.monthNames,c=function(e){var t=r+1<i.length&&i.charAt(r+1)===e;return t&&r++,t},h=function(e,t,i){var r=""+t;if(c(e))for(;r.length<i;)r="0"+r;return r},l=function(e,t,i,r){return c(e)?r[t]:i[t]},u="",d=!1;if(e)for(r=0;r<i.length;r++)if(d)"'"!==i.charAt(r)||c("'")?u+=i.charAt(r):d=!1;else switch(i.charAt(r)){case"d":u+=h("d",e.getDate(),2);break;case"D":u+=l("D",e.getDay(),n,s);break;case"o":u+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=h("m",e.getMonth()+1,2);break;case"M":u+=l("M",e.getMonth(),o,a);break;case"y":u+=c("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":c("'")?u+="'":d=!0;break;default:u+=i.charAt(r)}return u},_possibleChars:function(i){var r,e="",t=!1,n=function(e){var t=r+1<i.length&&i.charAt(r+1)===e;return t&&r++,t};for(r=0;r<i.length;r++)if(t)"'"!==i.charAt(r)||n("'")?e+=i.charAt(r):t=!1;else switch(i.charAt(r)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":n("'")?e+="'":t=!0;break;default:e+=i.charAt(r)}return e},_get:function(e,t){return e.settings[t]!==c?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),s=n,o=this._getFormatConfig(e);try{s=this.parseDate(i,r,o)||n}catch(e){r=t?"":r}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=r?s.getDate():0,e.currentMonth=r?s.getMonth():0,e.currentYear=r?s.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(a,e,t){var i,r,n=null==e||""===e?t:"string"==typeof e?function(e){try{return x.datepicker.parseDate(x.datepicker._get(a,"dateFormat"),e,x.datepicker._getFormatConfig(a))}catch(e){}for(var t=(e.toLowerCase().match(/^c/)?x.datepicker._getDate(a):null)||new Date,i=t.getFullYear(),r=t.getMonth(),n=t.getDate(),s=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,o=s.exec(e);o;){switch(o[2]||"d"){case"d":case"D":n+=parseInt(o[1],10);break;case"w":case"W":n+=7*parseInt(o[1],10);break;case"m":case"M":r+=parseInt(o[1],10),n=Math.min(n,x.datepicker._getDaysInMonth(i,r));break;case"y":case"Y":i+=parseInt(o[1],10),n=Math.min(n,x.datepicker._getDaysInMonth(i,r))}o=s.exec(e)}return new Date(i,r,n)}(e):"number"==typeof e?isNaN(e)?t:(i=e,(r=new Date).setDate(r.getDate()+i),r):new Date(e.getTime());return(n=n&&"Invalid Date"===n.toString()?t:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(12<e.getHours()?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var r=!t,n=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&s===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){x.datepicker._adjustDate(i,-t,"M")},next:function(){x.datepicker._adjustDate(i,+t,"M")},hide:function(){x.datepicker._hideDatepicker()},today:function(){x.datepicker._gotoToday(i)},selectDay:function(){return x.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return x.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return x.datepicker._selectMonthYear(i,this,"Y"),!1}};x(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,r,n,s,o,a,c,h,l,u,d,p,f,g,m,_,S,v,y,b,E,x,M,w,C,J,T,N,R,I,D,F,k,A,L,U,P,B,O=new Date,V=this._daylightSavingAdjust(new Date(O.getFullYear(),O.getMonth(),O.getDate())),z=this._get(e,"isRTL"),j=this._get(e,"showButtonPanel"),G=this._get(e,"hideIfNoPrevNext"),W=this._get(e,"navigationAsDateFormat"),H=this._getNumberOfMonths(e),Y=this._get(e,"showCurrentAtPos"),q=this._get(e,"stepMonths"),X=1!==H[0]||1!==H[1],Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),K=this._getMinMaxDate(e,"min"),Z=this._getMinMaxDate(e,"max"),$=e.drawMonth-Y,ee=e.drawYear;if($<0&&($+=12,ee--),Z)for(t=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-H[0]*H[1]+1,Z.getDate())),t=K&&t<K?K:t;this._daylightSavingAdjust(new Date(ee,$,1))>t;)--$<0&&($=11,ee--);for(e.drawMonth=$,e.drawYear=ee,i=this._get(e,"prevText"),i=W?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,$-q,1)),this._getFormatConfig(e)):i,r=this._canAdjustMonth(e,-1,ee,$)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>":G?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=W?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,$+q,1)),this._getFormatConfig(e)):n,s=this._canAdjustMonth(e,1,ee,$)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>":G?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?Q:V,o=W?this.formatDate(o,a,this._getFormatConfig(e)):o,c=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",h=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(z?c:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(z?"":c)+"</div>":"",l=parseInt(this._get(e,"firstDay"),10),l=isNaN(l)?0:l,u=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),g=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),_=this._get(e,"showOtherMonths"),S=this._get(e,"selectOtherMonths"),v=this._getDefaultDate(e),y="",E=0;E<H[0];E++){for(x="",this.maxRows=4,M=0;M<H[1];M++){if(w=this._daylightSavingAdjust(new Date(ee,$,e.selectedDay)),C=" ui-corner-all",J="",X){if(J+="<div class='ui-datepicker-group",1<H[1])switch(M){case 0:J+=" ui-datepicker-group-first",C=" ui-corner-"+(z?"right":"left");break;case H[1]-1:J+=" ui-datepicker-group-last",C=" ui-corner-"+(z?"left":"right");break;default:J+=" ui-datepicker-group-middle",C=""}J+="'>"}for(J+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&0===E?z?s:r:"")+(/all|right/.test(C)&&0===E?z?r:s:"")+this._generateMonthYearHeader(e,$,ee,K,Z,0<E||0<M,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",T=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",b=0;b<7;b++)T+="<th"+(5<=(b+l+6)%7?" class='ui-datepicker-week-end'":"")+"><span title='"+d[N=(b+l)%7]+"'>"+p[N]+"</span></th>";for(J+=T+"</tr></thead><tbody>",R=this._getDaysInMonth(ee,$),ee===e.selectedYear&&$===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,R)),I=(this._getFirstDayOfMonth(ee,$)-l+7)%7,D=Math.ceil((I+R)/7),F=X&&this.maxRows>D?this.maxRows:D,this.maxRows=F,k=this._daylightSavingAdjust(new Date(ee,$,1-I)),A=0;A<F;A++){for(J+="<tr>",L=u?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(k)+"</td>":"",b=0;b<7;b++)U=m?m.apply(e.input?e.input[0]:null,[k]):[!0,""],B=(P=k.getMonth()!==$)&&!S||!U[0]||K&&k<K||Z&&Z<k,L+="<td class='"+(5<=(b+l+6)%7?" ui-datepicker-week-end":"")+(P?" ui-datepicker-other-month":"")+(k.getTime()===w.getTime()&&$===e.selectedMonth&&e._keyEvent||v.getTime()===k.getTime()&&v.getTime()===w.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(P&&!_?"":" "+U[1]+(k.getTime()===Q.getTime()?" "+this._currentClass:"")+(k.getTime()===V.getTime()?" ui-datepicker-today":""))+"'"+(P&&!_||!U[2]?"":" title='"+U[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+k.getMonth()+"' data-year='"+k.getFullYear()+"'")+">"+(P&&!_?"&#xa0;":B?"<span class='ui-state-default'>"+k.getDate()+"</span>":"<a class='ui-state-default"+(k.getTime()===V.getTime()?" ui-state-highlight":"")+(k.getTime()===Q.getTime()?" ui-state-active":"")+(P?" ui-priority-secondary":"")+"' href='#'>"+k.getDate()+"</a>")+"</td>",k.setDate(k.getDate()+1),k=this._daylightSavingAdjust(k);J+=L+"</tr>"}11<++$&&($=0,ee++),x+=J+="</tbody></table>"+(X?"</div>"+(0<H[0]&&M===H[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}y+=x}return y+=h,e._keyEvent=!1,y},_generateMonthYearHeader:function(e,t,i,r,n,s,o,a){var c,h,l,u,d,p,f,g,m=this._get(e,"changeMonth"),_=this._get(e,"changeYear"),S=this._get(e,"showMonthAfterYear"),v="<div class='ui-datepicker-title'>",y="";if(s||!m)y+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(c=r&&r.getFullYear()===i,h=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",l=0;l<12;l++)(!c||l>=r.getMonth())&&(!h||l<=n.getMonth())&&(y+="<option value='"+l+"'"+(l===t?" selected='selected'":"")+">"+a[l]+"</option>");y+="</select>"}if(S||(v+=y+(!s&&m&&_?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",s||!_)v+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),f=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t})(u[0]),g=Math.max(f,p(u[1]||"")),f=r?Math.max(f,r.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f<=g;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",v+=e.yearshtml,e.yearshtml=null}return v+=this._get(e,"yearSuffix"),S&&(v+=(!s&&m&&_?"":"&#xa0;")+y),v+="</div>"},_adjustInstDate:function(e,t,i){var r=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,n,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),n=i&&t<i?i:t;return r&&r<n?r:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,r){var n=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(i,r+(t<0?t:n[0]*n[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var i,r,n=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),o=null,a=null,c=this._get(e,"yearRange");return c&&(i=c.split(":"),r=(new Date).getFullYear(),o=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=r),i[1].match(/[+\-].*/)&&(a+=r)),(!n||t.getTime()>=n.getTime())&&(!s||t.getTime()<=s.getTime())&&(!o||t.getFullYear()>=o)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(r,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),x.fn.datepicker=function(e){if(!this.length)return this;x.datepicker.initialized||(x(document).mousedown(x.datepicker._checkExternalClick),x.datepicker.initialized=!0),0===x("#"+x.datepicker._mainDivId).length&&x("body").append(x.datepicker.dpDiv);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this].concat(t)):x.datepicker._attachDatepicker(this,e)}):x.datepicker["_"+e+"Datepicker"].apply(x.datepicker,[this[0]].concat(t))},x.datepicker=new e,x.datepicker.initialized=!1,x.datepicker.uuid=(new Date).getTime(),x.datepicker.version="1.10.3"}(jQuery),function(o,e){var s={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},a={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};o.widget("ui.dialog",{version:"1.10.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var t=o(this).css(e).offset().top;t<0&&o(this).css("top",e.top-t)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&o.fn.draggable&&this._makeDraggable(),this.options.resizable&&o.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?o(e):this.document.find(e||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:o.noop,enable:o.noop,close:function(e){var t=this;this._isOpen&&!1!==this._trigger("beforeClose",e)&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||o(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){t._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!t&&this._trigger("focus",e),i},open:function(){var e=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=o(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._trigger("open"))},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(e){function t(){var e=this.document[0].activeElement;this.uiDialog[0]===e||o.contains(this.uiDialog[0],e)||this._focusTabbable()}e.preventDefault(),t.call(this),this._delay(t)},_createWrapper:function(){this.uiDialog=o("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===o.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===o.ui.keyCode.TAB){var t=this.uiDialog.find(":tabbable"),i=t.filter(":first"),r=t.filter(":last");e.target!==r[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==i[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(r.focus(1),e.preventDefault()):(i.focus(1),e.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=o("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){o(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=o("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),e=o("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=o("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=o("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var n=this,e=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),o.isEmptyObject(e)||o.isArray(e)&&!e.length?this.uiDialog.removeClass("ui-dialog-buttons"):(o.each(e,function(e,t){var i,r;t=o.isFunction(t)?{click:t,text:e}:t,t=o.extend({type:"button"},t),i=t.click,t.click=function(){i.apply(n.element[0],arguments)},r={icons:t.icons,text:t.showText},delete t.icons,delete t.showText,o("<button></button>",t).button(r).appendTo(n.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var i=this,r=this.options;function n(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(e,t){o(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",e,n(t))},drag:function(e,t){i._trigger("drag",e,n(t))},stop:function(e,t){r.position=[t.position.left-i.document.scrollLeft(),t.position.top-i.document.scrollTop()],o(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",e,n(t))}})},_makeResizable:function(){var i=this,r=this.options,e=r.resizable,t=this.uiDialog.css("position"),n="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";function s(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:n,start:function(e,t){o(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",e,s(t))},resize:function(e,t){i._trigger("resize",e,s(t))},stop:function(e,t){r.height=o(this).height(),r.width=o(this).width(),o(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",e,s(t))}}).css("position",t)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(e){var i=this,r=!1,n={};o.each(e,function(e,t){i._setOption(e,t),e in s&&(r=!0),e in a&&(n[e]=t)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,r,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=n.is(":data(ui-draggable)"))&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((r=n.is(":data(ui-resizable)"))&&!t&&n.resizable("destroy"),r&&"string"==typeof t&&n.resizable("option","handles",t),r||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-e):"none","auto"===r.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=o(this);return o("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return!!o(e.target).closest(".ui-dialog").length||!!o(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,i=this.widgetFullName;o.ui.dialog.overlayInstances||this._delay(function(){o.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(e){t._allowInteraction(e)||(e.preventDefault(),o(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=o("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),o.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(o.ui.dialog.overlayInstances--,o.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),o.ui.dialog.overlayInstances=0,!1!==o.uiBackCompat&&o.widget("ui.dialog",o.ui.dialog,{_position:function(){var e,t=this.options.position,i=[],r=[0,0];t?(("string"==typeof t||"object"==typeof t&&"0"in t)&&(1===(i=t.split?t.split(" "):[t[0],t[1]]).length&&(i[1]=i[0]),o.each(["left","top"],function(e,t){+i[e]===i[e]&&(r[e]=i[e],i[e]=t)}),t={my:i[0]+(r[0]<0?r[0]:"+"+r[0])+" "+i[1]+(r[1]<0?r[1]:"+"+r[1]),at:i.join(" ")}),t=o.extend({},o.ui.dialog.prototype.options.position,t)):t=o.ui.dialog.prototype.options.position,(e=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.position(t),e||this.uiDialog.hide()}})}(jQuery),function(c,e){c.widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,c.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(e){var t=c(e.target).closest(".ui-menu-item");!this.mouseHandled&&t.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(e),t.has(".ui-menu").length?this.expand(e):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var t=c(e.currentTarget);t.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,t)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(e){this._delay(function(){c.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){c(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=c(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){var t,i,r,n,s,o=!0;function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(e.keyCode){case c.ui.keyCode.PAGE_UP:this.previousPage(e);break;case c.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case c.ui.keyCode.HOME:this._move("first","first",e);break;case c.ui.keyCode.END:this._move("last","last",e);break;case c.ui.keyCode.UP:this.previous(e);break;case c.ui.keyCode.DOWN:this.next(e);break;case c.ui.keyCode.LEFT:this.collapse(e);break;case c.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case c.ui.keyCode.ENTER:case c.ui.keyCode.SPACE:this._activate(e);break;case c.ui.keyCode.ESCAPE:this.collapse(e);break;default:o=!1,i=this.previousFilter||"",r=String.fromCharCode(e.keyCode),n=!1,clearTimeout(this.filterTimer),r===i?n=!0:r=i+r,s=new RegExp("^"+a(r),"i"),t=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(c(this).children("a").text())}),(t=n&&-1!==t.index(this.active.next())?this.active.nextAll(".ui-menu-item"):t).length||(r=String.fromCharCode(e.keyCode),s=new RegExp("^"+a(r),"i"),t=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(c(this).children("a").text())})),t.length?(this.focus(e,t),1<t.length?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}o&&e.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var e,r=this.options.icons.submenu,t=this.element.find(this.options.menus);t.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=c(this),t=e.prev("a"),i=c("<span>").addClass("ui-menu-icon ui-icon "+r).data("ui-menu-submenu-carat",!0);t.attr("aria-haspopup","true").prepend(i),e.attr("aria-labelledby",t.attr("id"))}),(e=t.add(this.element)).children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=c(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!c.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var i,r;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),r=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(e){var t,i,r,n,s,o;this._hasScroll()&&(t=parseFloat(c.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(c.css(this.activeMenu[0],"paddingTop"))||0,r=e.offset().top-this.activeMenu.offset().top-t-i,n=this.activeMenu.scrollTop(),s=this.activeMenu.height(),o=e.height(),r<0?this.activeMenu.scrollTop(n+r):s<r+o&&this.activeMenu.scrollTop(n+r-s+o))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(e){var t=c.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(t)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var e=i?this.element:c(t&&t.target).closest(this.element.find(".ui-menu"));e.length||(e=this.element),this._close(e),this.blur(t),this.activeMenu=e},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var r;this.active&&(r="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,r)},nextPage:function(e){var t,i,r;this.active?this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return(t=c(this)).offset().top-i-r<0}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())):this.next(e)},previousPage:function(e){var t,i,r;this.active?this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return 0<(t=c(this)).offset().top-i+r}),this.focus(e,t)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())):this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||c(e.target).closest(".ui-menu-item");var t={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,t)}})}(jQuery),function(i,e){i.widget("ui.progressbar",{version:"1.10.3",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=i("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(void 0===e)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,t=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(t.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=i("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}})}(jQuery),function(l,e){l.widget("ui.slider",l.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,t,i=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),n=[];for(t=i.values&&i.values.length||1,r.length>t&&(r.slice(t).remove(),r=r.slice(0,t)),e=r.length;e<t;e++)n.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=r.add(l(n.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){l(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,t="";e.range?(!0===e.range&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:l.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=l("<div></div>").appendTo(this.element),t="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(t+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):this.range=l([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var t,i,r,n,s,o,a,c=this,h=this.options;return!h.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var t=Math.abs(i-c.values(e));(t<r||r===t&&(e===c._lastChangedValue||c.values(e)===h.min))&&(r=t,n=l(this),s=e)}),!1!==this._start(e,s)&&(this._mouseSliding=!0,this._handleIndex=s,n.addClass("ui-state-active").focus(),o=n.offset(),a=!l(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=a?{left:0,top:0}:{left:e.pageX-o.left-n.width()/2,top:e.pageY-o.top-n.height()/2-(parseInt(n.css("borderTopWidth"),10)||0)-(parseInt(n.css("borderBottomWidth"),10)||0)+(parseInt(n.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,s,i),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,r,n,s;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),1<(r=i/t)&&(r=1),r<0&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),s=this._valueMin()+r*n,this._trimAlignValue(s)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var r,n,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&r<i||1===t&&i<r)&&(i=r),i!==this.values(t)&&((n=this.values())[t]=i,s=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),r=this.values(t?0:1),!1!==s&&this.values(t,i,!0))):i!==this.value()&&!1!==(s=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,t){var i,r,n;if(1<arguments.length)return this.options.values[e]=this._trimAlignValue(t),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!l.isArray(e))return this.options.values&&this.options.values.length?this._values(e):this.value();for(i=this.options.values,r=e,n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(r[n]),this._change(null,n);this._refreshValue()},_setOption:function(e,t){var i,r=0;switch("range"===e&&!0===this.options.range&&("min"===t?(this.options.value=this._values(0),this.options.values=null):"max"===t&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),l.isArray(this.options.values)&&(r=this.options.values.length),l.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;i<r;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),r=0;r<i.length;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=0<this.options.step?this.options.step:1,i=(e-this._valueMin())%t,r=e-i;return 2*Math.abs(i)>=t&&(r+=0<i?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,e,r,n,s=this.options.range,o=this.options,a=this,c=!this._animateOff&&o.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(e){i=(a.values(e)-a._valueMin())/(a._valueMax()-a._valueMin())*100,h["horizontal"===a.orientation?"left":"bottom"]=i+"%",l(this).stop(1,1)[c?"animate":"css"](h,o.animate),!0===a.options.range&&("horizontal"===a.orientation?(0===e&&a.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},o.animate),1===e&&a.range[c?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===e&&a.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},o.animate),1===e&&a.range[c?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(e=this.value(),r=this._valueMin(),n=this._valueMax(),i=n!==r?(e-r)/(n-r)*100:0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](h,o.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},o.animate),"max"===s&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:o.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},o.animate),"max"===s&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:o.animate}))},_handleEvents:{keydown:function(e){var t,i,r,n=l(e.target).data("ui-slider-handle-index");switch(e.keyCode){case l.ui.keyCode.HOME:case l.ui.keyCode.END:case l.ui.keyCode.PAGE_UP:case l.ui.keyCode.PAGE_DOWN:case l.ui.keyCode.UP:case l.ui.keyCode.RIGHT:case l.ui.keyCode.DOWN:case l.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,l(e.target).addClass("ui-state-active"),!1===this._start(e,n)))return}switch(r=this.options.step,t=i=this.options.values&&this.options.values.length?this.values(n):this.value(),e.keyCode){case l.ui.keyCode.HOME:i=this._valueMin();break;case l.ui.keyCode.END:i=this._valueMax();break;case l.ui.keyCode.PAGE_UP:i=this._trimAlignValue(t+(this._valueMax()-this._valueMin())/5);break;case l.ui.keyCode.PAGE_DOWN:i=this._trimAlignValue(t-(this._valueMax()-this._valueMin())/5);break;case l.ui.keyCode.UP:case l.ui.keyCode.RIGHT:if(t===this._valueMax())return;i=this._trimAlignValue(t+r);break;case l.ui.keyCode.DOWN:case l.ui.keyCode.LEFT:if(t===this._valueMin())return;i=this._trimAlignValue(t-r)}this._slide(e,n,i)},click:function(e){e.preventDefault()},keyup:function(e){var t=l(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,t),this._change(e,t),l(e.target).removeClass("ui-state-active"))}}})}(jQuery),function(s){function t(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}s.widget("ui.spinner",{version:"1.10.3",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var r={},n=this.element;return s.each(["min","max","step"],function(e,t){var i=n.attr(t);void 0!==i&&i.length&&(r[t]=i)}),r},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((0<t?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(e){var t;function i(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=t,this._delay(function(){this.previous=t}))}t=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(e)&&this._repeat(null,s(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){if(s(e.currentTarget).hasClass("ui-state-active"))return!1!==this._start(e)&&void this._repeat(null,s(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&0<e.height()&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(e){var t=this.options,i=s.ui.keyCode;switch(e.keyCode){case i.UP:return this._repeat(null,1,e),!0;case i.DOWN:return this._repeat(null,-1,e),!0;case i.PAGE_UP:return this._repeat(null,t.page,e),!0;case i.PAGE_DOWN:return this._repeat(null,-t.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var t=this.options.incremental;return t?s.isFunction(t)?t(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,r=this.options;return i=e-(t=null!==r.min?r.min:0),e=t+(i=Math.round(i/r.step)*r.step),e=parseFloat(e.toFixed(this._precision())),null!==r.max&&e>r.max?r.max:null!==r.min&&e<r.min?r.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})}(jQuery),function(h,e){var t=0,i=/#.*$/;function l(e){return 1<e.hash.length&&decodeURIComponent(e.href.replace(i,""))===decodeURIComponent(location.href.replace(i,""))}h.widget("ui.tabs",{version:"1.10.3",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,e=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",e.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){h(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){h(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),e.active=this._initialActive(),h.isArray(e.disabled)&&(e.disabled=h.unique(e.disabled.concat(h.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(e.active):this.active=h(),this._refresh(),this.active.length&&this.load(e.active)},_initialActive:function(){var i=this.options.active,e=this.options.collapsible,r=location.hash.substring(1);return null===i&&(r&&this.tabs.each(function(e,t){if(h(t).attr("aria-controls")===r)return i=e,!1}),null===i&&(i=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==i&&-1!==i||(i=!!this.tabs.length&&0)),!1!==i&&-1===(i=this.tabs.index(this.tabs.eq(i)))&&(i=!e&&0),!e&&!1===i&&this.anchors.length&&(i=0),i},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):h()}},_tabKeydown:function(e){var t=h(this.document[0].activeElement).closest("li"),i=this.tabs.index(t),r=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case h.ui.keyCode.RIGHT:case h.ui.keyCode.DOWN:i++;break;case h.ui.keyCode.UP:case h.ui.keyCode.LEFT:r=!1,i--;break;case h.ui.keyCode.END:i=this.anchors.length-1;break;case h.ui.keyCode.HOME:i=0;break;case h.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),void this._activate(i);case h.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),void this._activate(i!==this.options.active&&i);default:return}e.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,r),e.ctrlKey||(t.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===h.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(e){return e.altKey&&e.keyCode===h.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===h.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,t){var i=this.tabs.length-1;for(;-1!==h.inArray((i<e&&(e=0),e<0&&(e=i),e),this.options.disabled);)e=t?e+1:e-1;return e},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){"active"!==e?"disabled"!==e?(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._setupDisabled(t):this._activate(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+ ++t},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,t=this.tablist.children(":has(a[href])");e.disabled=h.map(t.filter(".ui-state-disabled"),function(e){return t.index(e)}),this._processTabs(),!1!==e.active&&this.anchors.length?this.active.length&&!h.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=h()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=h()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var c=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return h("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=h(),this.anchors.each(function(e,t){var i,r,n,s=h(t).uniqueId().attr("id"),o=h(t).closest("li"),a=o.attr("aria-controls");l(t)?(i=t.hash,r=c.element.find(c._sanitizeSelector(i))):(i="#"+(n=c._tabId(o)),(r=c.element.find(i)).length||(r=c._createPanel(n)).insertAfter(c.panels[e-1]||c.tablist),r.attr("aria-live","polite")),r.length&&(c.panels=c.panels.add(r)),a&&o.data("ui-tabs-aria-controls",a),o.attr({"aria-controls":i.substring(1),"aria-labelledby":s}),r.attr("aria-labelledby",s)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(e){return h("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){h.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var t,i=0;t=this.tabs[i];i++)!0===e||-1!==h.inArray(i,e)?h(t).addClass("ui-state-disabled").attr("aria-disabled","true"):h(t).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={click:function(e){e.preventDefault()}};e&&h.each(e.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,t=this.element.parent();"fill"===e?(i=t.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=h(this),t=e.css("position");"absolute"!==t&&"fixed"!==t&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=h(this).outerHeight(!0)}),this.panels.each(function(){h(this).height(Math.max(0,i-h(this).innerHeight()+h(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,h(this).height("").height())}).height(i))},_eventHandler:function(e){var t=this.options,i=this.active,r=h(e.currentTarget).closest("li"),n=r[0]===i[0],s=n&&t.collapsible,o=s?h():this._getPanelForTab(r),a=i.length?this._getPanelForTab(i):h(),c={oldTab:i,oldPanel:a,newTab:s?h():r,newPanel:o};e.preventDefault(),r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||n&&!t.collapsible||!1===this._trigger("beforeActivate",e,c)||(t.active=!s&&this.tabs.index(r),this.active=n?h():r,this.xhr&&this.xhr.abort(),a.length||o.length||h.error("jQuery UI Tabs: Mismatching fragment identifier."),o.length&&this.load(this.tabs.index(r),e),this._toggle(e,c))},_toggle:function(e,t){var i=this,r=t.newPanel,n=t.oldPanel;function s(){i.running=!1,i._trigger("activate",e,t)}function o(){t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),r.length&&i.options.show?i._show(r,i.options.show,s):(r.show(),s())}this.running=!0,n.length&&this.options.hide?this._hide(n,this.options.hide,function(){t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),o()}):(t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n.hide(),o()),n.attr({"aria-expanded":"false","aria-hidden":"true"}),t.oldTab.attr("aria-selected","false"),r.length&&n.length?t.oldTab.attr("tabIndex",-1):r.length&&this.tabs.filter(function(){return 0===h(this).attr("tabIndex")}).attr("tabIndex",-1),r.attr({"aria-expanded":"true","aria-hidden":"false"}),t.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var t,i=this._findActive(e);i[0]!==this.active[0]&&(i.length||(i=this.active),t=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:t,currentTarget:t,preventDefault:h.noop}))},_findActive:function(e){return!1===e?h():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){h.data(this,"ui-tabs-destroy")?h(this).remove():h(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=h(this),t=e.data("ui-tabs-aria-controls");t?e.attr("aria-controls",t).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var e=this.options.disabled;!1!==e&&(void 0===i?e=!1:(i=this._getIndex(i),e=h.isArray(e)?h.map(e,function(e){return e!==i?e:null}):h.map(this.tabs,function(e,t){return t!==i?t:null})),this._setupDisabled(e))},disable:function(e){var t=this.options.disabled;if(!0!==t){if(void 0===e)t=!0;else{if(e=this._getIndex(e),-1!==h.inArray(e,t))return;t=h.isArray(t)?h.merge([e],t).sort():[e]}this._setupDisabled(t)}},load:function(e,t){e=this._getIndex(e);var i=this,r=this.tabs.eq(e),n=r.find(".ui-tabs-anchor"),s=this._getPanelForTab(r),o={tab:r,panel:s};l(n[0])||(this.xhr=h.ajax(this._ajaxSettings(n,t,o)),this.xhr&&"canceled"!==this.xhr.statusText&&(r.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){s.html(e),i._trigger("load",t,o)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&i.panels.stop(!1,!0),r.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),e===i.xhr&&delete i.xhr},1)})))},_ajaxSettings:function(e,i,r){var n=this;return{url:e.attr("href"),beforeSend:function(e,t){return n._trigger("beforeLoad",i,h.extend({jqXHR:e,ajaxSettings:t},r))}}},_getPanelForTab:function(e){var t=h(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+t))}})}(jQuery),function(u){var r=0;u.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var e=u(this).attr("title")||"";return u("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,t){var i=this;if("disabled"===e)return this[t?"_disable":"_enable"](),void(this.options[e]=t);this._super(e,t),"content"===e&&u.each(this.tooltips,function(e,t){i._updateContent(t)})},_disable:function(){var r=this;u.each(this.tooltips,function(e,t){var i=u.Event("blur");i.target=i.currentTarget=t[0],r.close(i,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=u(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=u(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,t=u(e?e.target:this.element).closest(this.options.items);t.length&&!t.data("ui-tooltip-id")&&(t.attr("title")&&t.data("ui-tooltip-title",t.attr("title")),t.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&t.parents().each(function(){var e,t=u(this);t.data("ui-tooltip-open")&&((e=u.Event("blur")).target=e.currentTarget=this,i.close(e,!0)),t.attr("title")&&(t.uniqueId(),i.parents[this.id]={element:this,title:t.attr("title")},t.attr("title",""))}),this._updateContent(t,e))},_updateContent:function(t,i){var e,r=this.options.content,n=this,s=i?i.type:null;if("string"==typeof r)return this._open(i,t,r);(e=r.call(t[0],function(e){t.data("ui-tooltip-open")&&n._delay(function(){i&&(i.type=s),this._open(i,t,e)})}))&&this._open(i,t,e)},_open:function(e,i,t){var r,n,s,o,a,c,h=u.extend({},this.options.position);t&&((r=this._find(i)).length?r.find(".ui-tooltip-content").html(t):(i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),r=this._tooltip(i),o=i,a=r.attr("id"),(c=(o.attr("aria-describedby")||"").split(/\s+/)).push(a),o.data("ui-tooltip-id",a).attr("aria-describedby",u.trim(c.join(" "))),r.find(".ui-tooltip-content").html(t),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:l}),l(e)):r.position(u.extend({of:i},this.options.position)),r.hide(),this._show(r,this.options.show),this.options.show&&this.options.show.delay&&(s=this.delayedShow=setInterval(function(){r.is(":visible")&&(l(h.of),clearInterval(s))},u.fx.interval)),this._trigger("open",e,{tooltip:r}),n={keyup:function(e){if(e.keyCode===u.ui.keyCode.ESCAPE){var t=u.Event(e);t.currentTarget=i[0],this.close(t,!0)}},remove:function(){this._removeTooltip(r)}},e&&"mouseover"!==e.type||(n.mouseleave="close"),e&&"focusin"!==e.type||(n.focusout="close"),this._on(!0,i,n)));function l(e){h.of=e,r.is(":hidden")||r.position(h)}},close:function(e){var t,i,r,n,s=this,o=u(e?e.currentTarget:this.element),a=this._find(o);this.closing||(clearInterval(this.delayedShow),o.data("ui-tooltip-title")&&o.attr("title",o.data("ui-tooltip-title")),i=(t=o).data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),-1!==(n=u.inArray(i,r))&&r.splice(n,1),t.removeData("ui-tooltip-id"),(r=u.trim(r.join(" ")))?t.attr("aria-describedby",r):t.removeAttr("aria-describedby"),a.stop(!0),this._hide(a,this.options.hide,function(){s._removeTooltip(u(this))}),o.removeData("ui-tooltip-open"),this._off(o,"mouseleave focusout keyup"),o[0]!==this.element[0]&&this._off(o,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&u.each(this.parents,function(e,t){u(t.element).attr("title",t.title),delete s.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:a}),this.closing=!1)},_tooltip:function(e){var t="ui-tooltip-"+r++,i=u("<div>").attr({id:t,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return u("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[t]=e,i},_find:function(e){var t=e.data("ui-tooltip-id");return t?u("#"+t):u()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var r=this;u.each(this.tooltips,function(e,t){var i=u.Event("blur");i.target=i.currentTarget=t[0],r.close(i,!0),u("#"+e).remove(),t.data("ui-tooltip-title")&&(t.attr("title",t.data("ui-tooltip-title")),t.removeData("ui-tooltip-title"))})}})}(jQuery),function(l,e){var i,a="ui-effects-";l.effects={effect:{}},function(l,u){var h,d=/^([\-+])=\s*(\d+\.?\d*)/,e=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],p=l.Color=function(e,t,i,r){return new l.Color.fn.parse(e,t,i,r)},f={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},g={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},o=p.support={},t=l("<p>")[0],m=l.each;function _(e,t,i){var r=g[t.type]||{};return null==e?i||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:e<0?0:r.max<e?r.max:e)}function a(o){var a=p(),c=a._rgba=[];return o=o.toLowerCase(),m(e,function(e,t){var i,r=t.re.exec(o),n=r&&t.parse(r),s=t.space||"rgba";if(n)return i=a[s](n),a[f[s].cache]=i[f[s].cache],c=a._rgba=i._rgba,!1}),c.length?("0,0,0,0"===c.join()&&l.extend(c,h.transparent),a):h[o]}function c(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}t.style.cssText="background-color:rgba(1,1,1,.5)",o.rgba=-1<t.style.backgroundColor.indexOf("rgba"),m(f,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),p.fn=l.extend(p.prototype,{parse:function(n,e,t,i){if(n===u)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=l(n).css(e),e=u);var s=this,r=l.type(n),o=this._rgba=[];return e!==u&&(n=[n,e,t,i],r="array"),"string"===r?this.parse(a(n)||h._default):"array"===r?(m(f.rgba.props,function(e,t){o[t.idx]=_(n[t.idx],t)}),this):"object"===r?(m(f,n instanceof p?function(e,t){n[t.cache]&&(s[t.cache]=n[t.cache].slice())}:function(e,i){var r=i.cache;m(i.props,function(e,t){if(!s[r]&&i.to){if("alpha"===e||null==n[e])return;s[r]=i.to(s._rgba)}s[r][t.idx]=_(n[e],t,!0)}),s[r]&&l.inArray(null,s[r].slice(0,3))<0&&(s[r][3]=1,i.from&&(s._rgba=i.from(s[r])))}),this):void 0},is:function(e){var n=p(e),s=!0,o=this;return m(f,function(e,t){var i,r=n[t.cache];return r&&(i=o[t.cache]||t.to&&t.to(o._rgba)||[],m(t.props,function(e,t){if(null!=r[t.idx])return s=r[t.idx]===i[t.idx]})),s}),s},_space:function(){var i=[],r=this;return m(f,function(e,t){r[t.cache]&&i.push(e)}),i.pop()},transition:function(e,o){var a=p(e),t=a._space(),i=f[t],r=0===this.alpha()?p("transparent"):this,c=r[i.cache]||i.to(r._rgba),h=c.slice();return a=a[i.cache],m(i.props,function(e,t){var i=t.idx,r=c[i],n=a[i],s=g[t.type]||{};null!==n&&(null===r?h[i]=n:(s.mod&&(n-r>s.mod/2?r+=s.mod:r-n>s.mod/2&&(r-=s.mod)),h[i]=_((n-r)*o+r,t)))}),this[t](h)},blend:function(e){if(1===this._rgba[3])return this;var t=this._rgba.slice(),i=t.pop(),r=p(e)._rgba;return p(l.map(t,function(e,t){return(1-i)*r[t]+i*e}))},toRgbaString:function(){var e="rgba(",t=l.map(this._rgba,function(e,t){return null==e?2<t?1:0:e});return 1===t[3]&&(t.pop(),e="rgb("),e+t.join()+")"},toHslaString:function(){var e="hsla(",t=l.map(this.hsla(),function(e,t){return null==e&&(e=2<t?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e});return 1===t[3]&&(t.pop(),e="hsl("),e+t.join()+")"},toHexString:function(e){var t=this._rgba.slice(),i=t.pop();return e&&t.push(~~(255*i)),"#"+l.map(t,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),p.fn.parse.prototype=p.fn,f.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,r=e[0]/255,n=e[1]/255,s=e[2]/255,o=e[3],a=Math.max(r,n,s),c=Math.min(r,n,s),h=a-c,l=a+c,u=.5*l;return t=c===a?0:r===a?60*(n-s)/h+360:n===a?60*(s-r)/h+120:60*(r-n)/h+240,i=0===h?0:u<=.5?h/l:h/(2-l),[Math.round(t)%360,i,u,null==o?1:o]},f.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],r=e[2],n=e[3],s=r<=.5?r*(1+i):r+i-r*i,o=2*r-s;return[Math.round(255*c(o,s,t+1/3)),Math.round(255*c(o,s,t)),Math.round(255*c(o,s,t-1/3)),n]},m(f,function(c,e){var i=e.props,o=e.cache,a=e.to,h=e.from;p.fn[c]=function(e){if(a&&!this[o]&&(this[o]=a(this._rgba)),e===u)return this[o].slice();var t,r=l.type(e),n="array"===r||"object"===r?e:arguments,s=this[o].slice();return m(i,function(e,t){var i=n["object"===r?e:t.idx];null==i&&(i=s[t.idx]),s[t.idx]=_(i,t)}),h?((t=p(h(s)))[o]=s,t):p(s)},m(i,function(o,a){p.fn[o]||(p.fn[o]=function(e){var t,i=l.type(e),r="alpha"===o?this._hsla?"hsla":"rgba":c,n=this[r](),s=n[a.idx];return"undefined"===i?s:("function"===i&&(e=e.call(this,s),i=l.type(e)),null==e&&a.empty?this:("string"===i&&(t=d.exec(e))&&(e=s+parseFloat(t[2])*("+"===t[1]?1:-1)),n[a.idx]=e,this[r](n)))})})}),p.hook=function(e){var t=e.split(" ");m(t,function(e,s){l.cssHooks[s]={set:function(e,t){var i,r,n="";if("transparent"!==t&&("string"!==l.type(t)||(i=a(t)))){if(t=p(i||t),!o.rgba&&1!==t._rgba[3]){for(r="backgroundColor"===s?e.parentNode:e;(""===n||"transparent"===n)&&r&&r.style;)try{n=l.css(r,"backgroundColor"),r=r.parentNode}catch(e){}t=t.blend(n&&"transparent"!==n?n:"_default")}t=t.toRgbaString()}try{e.style[s]=t}catch(e){}}},l.fx.step[s]=function(e){e.colorInit||(e.start=p(e.elem,s),e.end=p(e.end),e.colorInit=!0),l.cssHooks[s].set(e.elem,e.start.transition(e.end,e.pos))}})},p.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),l.cssHooks.borderColor={expand:function(i){var r={};return m(["Top","Right","Bottom","Left"],function(e,t){r["border"+t+"Color"]=i}),r}},h=l.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){var s,n,o,a=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function h(e){var t,i,r=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,n={};if(r&&r.length&&r[0]&&r[r[0]])for(i=r.length;i--;)"string"==typeof r[t=r[i]]&&(n[l.camelCase(t)]=r[t]);else for(t in r)"string"==typeof r[t]&&(n[t]=r[t]);return n}l.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,t){l.fx.step[t]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,t,e.end),e.setAttr=!0)}}),l.fn.addBack||(l.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),l.effects.animateClass=function(n,e,t,i){var s=l.speed(e,t,i);return this.queue(function(){var e,i=l(this),t=i.attr("class")||"",r=s.children?i.find("*").addBack():i;r=r.map(function(){return{el:l(this),start:h(this)}}),(e=function(){l.each(a,function(e,t){n[t]&&i[t+"Class"](n[t])})})(),r=r.map(function(){return this.end=h(this.el[0]),this.diff=function(e,t){var i,r,n={};for(i in t)r=t[i],e[i]!==r&&(c[i]||!l.fx.step[i]&&isNaN(parseFloat(r))||(n[i]=r));return n}(this.start,this.end),this}),i.attr("class",t),r=r.map(function(){var e=this,t=l.Deferred(),i=l.extend({},s,{queue:!1,complete:function(){t.resolve(e)}});return this.el.animate(this.diff,i),t.promise()}),l.when.apply(l,r.get()).done(function(){e(),l.each(arguments,function(){var t=this.el;l.each(this.diff,function(e){t.css(e,"")})}),s.complete.call(i[0])})})},l.fn.extend({addClass:(o=l.fn.addClass,function(e,t,i,r){return t?l.effects.animateClass.call(this,{add:e},t,i,r):o.apply(this,arguments)}),removeClass:(n=l.fn.removeClass,function(e,t,i,r){return 1<arguments.length?l.effects.animateClass.call(this,{remove:e},t,i,r):n.apply(this,arguments)}),toggleClass:(s=l.fn.toggleClass,function(e,t,i,r,n){return"boolean"==typeof t||void 0===t?i?l.effects.animateClass.call(this,t?{add:e}:{remove:e},i,r,n):s.apply(this,arguments):l.effects.animateClass.call(this,{toggle:e},t,i,r)}),switchClass:function(e,t,i,r,n){return l.effects.animateClass.call(this,{add:t,remove:e},i,r,n)}})}(),function(){function r(e,t,i,r){return l.isPlainObject(e)&&(e=(t=e).effect),e={effect:e},null==t&&(t={}),l.isFunction(t)&&(r=t,i=null,t={}),("number"==typeof t||l.fx.speeds[t])&&(r=i,i=t,t={}),l.isFunction(i)&&(r=i,i=null),t&&l.extend(e,t),i=i||t.duration,e.duration=l.fx.off?0:"number"==typeof i?i:i in l.fx.speeds?l.fx.speeds[i]:l.fx.speeds._default,e.complete=r||t.complete,e}function i(e){return!(e&&"number"!=typeof e&&!l.fx.speeds[e])||("string"==typeof e&&!l.effects.effect[e]||(!!l.isFunction(e)||"object"==typeof e&&!e.effect))}var n,s,o;l.extend(l.effects,{version:"1.10.3",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data(a+t[i],e[0].style[t[i]])},restore:function(e,t){var i,r;for(r=0;r<t.length;r++)null!==t[r]&&(void 0===(i=e.data(a+t[r]))&&(i=""),e.css(t[r],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,r;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:i}},createWrapper:function(i){if(i.parent().is(".ui-effects-wrapper"))return i.parent();var r={width:i.outerWidth(!0),height:i.outerHeight(!0),float:i.css("float")},e=l("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),t={width:i.width(),height:i.height()},n=document.activeElement;try{n.id}catch(e){n=document.body}return i.wrap(e),(i[0]===n||l.contains(i[0],n))&&l(n).focus(),e=i.parent(),"static"===i.css("position")?(e.css({position:"relative"}),i.css({position:"relative"})):(l.extend(r,{position:i.css("position"),zIndex:i.css("z-index")}),l.each(["top","left","bottom","right"],function(e,t){r[t]=i.css(t),isNaN(parseInt(r[t],10))&&(r[t]="auto")}),i.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),i.css(t),e.css(r).show()},removeWrapper:function(e){var t=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===t||l.contains(e[0],t))&&l(t).focus()),e},setTransition:function(r,e,n,s){return s=s||{},l.each(e,function(e,t){var i=r.cssUnit(t);0<i[0]&&(s[t]=i[0]*n+i[1])}),s}}),l.fn.extend({effect:function(){var s=r.apply(this,arguments),e=s.mode,t=s.queue,o=l.effects.effect[s.effect];if(l.fx.off||!o)return e?this[e](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)});function i(e){var t=l(this),i=s.complete,r=s.mode;function n(){l.isFunction(i)&&i.call(t[0]),l.isFunction(e)&&e()}(t.is(":hidden")?"hide"===r:"show"===r)?(t[r](),n()):o.call(t[0],s,n)}return!1===t?this.each(i):this.queue(t||"fx",i)},show:(o=l.fn.show,function(e){if(i(e))return o.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="show",this.effect.call(this,t)}),hide:(s=l.fn.hide,function(e){if(i(e))return s.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="hide",this.effect.call(this,t)}),toggle:(n=l.fn.toggle,function(e){if(i(e)||"boolean"==typeof e)return n.apply(this,arguments);var t=r.apply(this,arguments);return t.mode="toggle",this.effect.call(this,t)}),cssUnit:function(e){var i=this.css(e),r=[];return l.each(["em","px","%","pt"],function(e,t){0<i.indexOf(t)&&(r=[parseFloat(i),t])}),r}})}(),i={},l.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,e){i[e]=function(e){return Math.pow(e,t+2)}}),l.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),l.each(i,function(e,t){l.easing["easeIn"+e]=t,l.easing["easeOut"+e]=function(e){return 1-t(1-e)},l.easing["easeInOut"+e]=function(e){return e<.5?t(2*e)/2:1-t(-2*e+2)/2}})}(jQuery),function(g,e){var m=/up|down|vertical/,_=/up|left|vertical|horizontal/;g.effects.effect.blind=function(e,t){var i,r,n,s=g(this),o=["position","top","bottom","left","right","height","width"],a=g.effects.setMode(s,e.mode||"hide"),c=e.direction||"up",h=m.test(c),l=h?"height":"width",u=h?"top":"left",d=_.test(c),p={},f="show"===a;s.parent().is(".ui-effects-wrapper")?g.effects.save(s.parent(),o):g.effects.save(s,o),s.show(),r=(i=g.effects.createWrapper(s).css({overflow:"hidden"}))[l](),n=parseFloat(i.css(u))||0,p[l]=f?r:0,d||(s.css(h?"bottom":"right",0).css(h?"top":"left","auto").css({position:"absolute"}),p[u]=f?n:r+n),f&&(i.css(l,0),d||i.css(u,n+r)),i.animate(p,{duration:e.duration,easing:e.easing,queue:!1,complete:function(){"hide"===a&&s.hide(),g.effects.restore(s,o),g.effects.removeWrapper(s),t()}})}}(jQuery),function(y,e){y.effects.effect.bounce=function(e,t){var i,r,n,s=y(this),o=["position","top","bottom","left","right","height","width"],a=y.effects.setMode(s,e.mode||"effect"),c="hide"===a,h="show"===a,l=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(h||c?1:0),f=e.duration/p,g=e.easing,m="up"===l||"down"===l?"top":"left",_="up"===l||"left"===l,S=s.queue(),v=S.length;for((h||c)&&o.push("opacity"),y.effects.save(s,o),s.show(),y.effects.createWrapper(s),u||(u=s["top"===m?"outerHeight":"outerWidth"]()/3),h&&((n={opacity:1})[m]=0,s.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),c&&(u/=Math.pow(2,d-1)),i=(n={})[m]=0;i<d;i++)(r={})[m]=(_?"-=":"+=")+u,s.animate(r,f,g).animate(n,f,g),u=c?2*u:u/2;c&&((r={opacity:0})[m]=(_?"-=":"+=")+u,s.animate(r,f,g)),s.queue(function(){c&&s.hide(),y.effects.restore(s,o),y.effects.removeWrapper(s),t()}),1<v&&S.splice.apply(S,[1,0].concat(S.splice(v,p+1))),s.dequeue()}}(jQuery),function(d,e){d.effects.effect.clip=function(e,t){var i,r,n,s=d(this),o=["position","top","bottom","left","right","height","width"],a="show"===d.effects.setMode(s,e.mode||"hide"),c="vertical"===(e.direction||"vertical"),h=c?"height":"width",l=c?"top":"left",u={};d.effects.save(s,o),s.show(),i=d.effects.createWrapper(s).css({overflow:"hidden"}),n=(r="IMG"===s[0].tagName?i:s)[h](),a&&(r.css(h,0),r.css(l,n/2)),u[h]=a?n:0,u[l]=a?0:n/2,r.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){a||s.hide(),d.effects.restore(s,o),d.effects.removeWrapper(s),t()}})}}(jQuery),function(u,e){u.effects.effect.drop=function(e,t){var i,r=u(this),n=["position","top","bottom","left","right","opacity","height","width"],s=u.effects.setMode(r,e.mode||"hide"),o="show"===s,a=e.direction||"left",c="up"===a||"down"===a?"top":"left",h="up"===a||"left"===a?"pos":"neg",l={opacity:o?1:0};u.effects.save(r,n),r.show(),u.effects.createWrapper(r),i=e.distance||r["top"===c?"outerHeight":"outerWidth"](!0)/2,o&&r.css("opacity",0).css(c,"pos"===h?-i:i),l[c]=(o?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+i,r.animate(l,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&r.hide(),u.effects.restore(r,n),u.effects.removeWrapper(r),t()}})}}(jQuery),function(_,e){_.effects.effect.explode=function(e,t){var i,r,n,s,o,a,c=e.pieces?Math.round(Math.sqrt(e.pieces)):3,h=c,l=_(this),u="show"===_.effects.setMode(l,e.mode||"hide"),d=l.show().css("visibility","hidden").offset(),p=Math.ceil(l.outerWidth()/h),f=Math.ceil(l.outerHeight()/c),g=[];function m(){g.push(this),g.length===c*h&&function(){l.css({visibility:"visible"}),_(g).remove(),u||l.hide();t()}()}for(i=0;i<c;i++)for(s=d.top+i*f,a=i-(c-1)/2,r=0;r<h;r++)n=d.left+r*p,o=r-(h-1)/2,l.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-r*p,top:-i*f}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:p,height:f,left:n+(u?o*p:0),top:s+(u?a*f:0),opacity:u?0:1}).animate({left:n+(u?0:o*p),top:s+(u?0:a*f),opacity:u?1:0},e.duration||500,e.easing,m)}}(jQuery),function(n,e){n.effects.effect.fade=function(e,t){var i=n(this),r=n.effects.setMode(i,e.mode||"toggle");i.animate({opacity:r},{queue:!1,duration:e.duration,easing:e.easing,complete:t})}}(jQuery),function(_,e){_.effects.effect.fold=function(e,t){var i,r,n=_(this),s=["position","top","bottom","left","right","height","width"],o=_.effects.setMode(n,e.mode||"hide"),a="show"===o,c="hide"===o,h=e.size||15,l=/([0-9]+)%/.exec(h),u=!!e.horizFirst,d=a!==u,p=d?["width","height"]:["height","width"],f=e.duration/2,g={},m={};_.effects.save(n,s),n.show(),i=_.effects.createWrapper(n).css({overflow:"hidden"}),r=d?[i.width(),i.height()]:[i.height(),i.width()],l&&(h=parseInt(l[1],10)/100*r[c?0:1]),a&&i.css(u?{height:0,width:h}:{height:h,width:0}),g[p[0]]=a?r[0]:h,m[p[1]]=a?r[1]:0,i.animate(g,f,e.easing).animate(m,f,e.easing,function(){c&&n.hide(),_.effects.restore(n,s),_.effects.removeWrapper(n),t()})}}(jQuery),function(o,e){o.effects.effect.highlight=function(e,t){var i=o(this),r=["backgroundImage","backgroundColor","opacity"],n=o.effects.setMode(i,e.mode||"show"),s={backgroundColor:i.css("backgroundColor")};"hide"===n&&(s.opacity=0),o.effects.save(i,r),i.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(s,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===n&&i.hide(),o.effects.restore(i,r),t()}})}}(jQuery),function(p,e){p.effects.effect.pulsate=function(e,t){var i,r=p(this),n=p.effects.setMode(r,e.mode||"show"),s="show"===n,o="hide"===n,a=s||"hide"===n,c=2*(e.times||5)+(a?1:0),h=e.duration/c,l=0,u=r.queue(),d=u.length;for(!s&&r.is(":visible")||(r.css("opacity",0).show(),l=1),i=1;i<c;i++)r.animate({opacity:l},h,e.easing),l=1-l;r.animate({opacity:l},h,e.easing),r.queue(function(){o&&r.hide(),t()}),1<d&&u.splice.apply(u,[1,0].concat(u.splice(d,c+1))),r.dequeue()}}(jQuery),function(S,e){S.effects.effect.puff=function(e,t){var i=S(this),r=S.effects.setMode(i,e.mode||"hide"),n="hide"===r,s=parseInt(e.percent,10)||150,o=s/100,a={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};S.extend(e,{effect:"scale",queue:!1,fade:!0,mode:r,complete:t,percent:n?s:100,from:n?a:{height:a.height*o,width:a.width*o,outerHeight:a.outerHeight*o,outerWidth:a.outerWidth*o}}),i.effect(e)},S.effects.effect.scale=function(e,t){var i=S(this),r=S.extend(!0,{},e),n=S.effects.setMode(i,e.mode||"effect"),s=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===n?0:100),o=e.direction||"both",a=e.origin,c={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()},h="horizontal"!==o?s/100:1,l="vertical"!==o?s/100:1;r.effect="size",r.queue=!1,r.complete=t,"effect"!==n&&(r.origin=a||["middle","center"],r.restore=!0),r.from=e.from||("show"===n?{height:0,width:0,outerHeight:0,outerWidth:0}:c),r.to={height:c.height*h,width:c.width*l,outerHeight:c.outerHeight*h,outerWidth:c.outerWidth*l},r.fade&&("show"===n&&(r.from.opacity=0,r.to.opacity=1),"hide"===n&&(r.from.opacity=1,r.to.opacity=0)),i.effect(r)},S.effects.effect.size=function(s,e){var t,i,o,a=S(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],c=["width","height","overflow"],n=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=S.effects.setMode(a,s.mode||"effect"),d=s.restore||"effect"!==u,p=s.scale||"both",f=s.origin||["middle","center"],g=a.css("position"),m=d?r:["position","top","bottom","left","right","overflow","opacity"],_={height:0,width:0,outerHeight:0,outerWidth:0};"show"===u&&a.show(),t={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===s.mode&&"show"===u?(a.from=s.to||_,a.to=s.from||t):(a.from=s.from||("show"===u?_:t),a.to=s.to||("hide"===u?_:t)),o={from:{y:a.from.height/t.height,x:a.from.width/t.width},to:{y:a.to.height/t.height,x:a.to.width/t.width}},"box"!==p&&"both"!==p||(o.from.y!==o.to.y&&(m=m.concat(h),a.from=S.effects.setTransition(a,h,o.from.y,a.from),a.to=S.effects.setTransition(a,h,o.to.y,a.to)),o.from.x!==o.to.x&&(m=m.concat(l),a.from=S.effects.setTransition(a,l,o.from.x,a.from),a.to=S.effects.setTransition(a,l,o.to.x,a.to))),"content"!==p&&"both"!==p||o.from.y!==o.to.y&&(m=m.concat(n).concat(c),a.from=S.effects.setTransition(a,n,o.from.y,a.from),a.to=S.effects.setTransition(a,n,o.to.y,a.to)),S.effects.save(a,m),a.show(),S.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),f&&(i=S.effects.getBaseline(f,t),a.from.top=(t.outerHeight-a.outerHeight())*i.y,a.from.left=(t.outerWidth-a.outerWidth())*i.x,a.to.top=(t.outerHeight-a.to.outerHeight)*i.y,a.to.left=(t.outerWidth-a.to.outerWidth)*i.x),a.css(a.from),"content"!==p&&"both"!==p||(h=h.concat(["marginTop","marginBottom"]).concat(n),l=l.concat(["marginLeft","marginRight"]),c=r.concat(h).concat(l),a.find("*[width]").each(function(){var e=S(this),t=e.height(),i=e.width(),r=e.outerHeight(),n=e.outerWidth();d&&S.effects.save(e,c),e.from={height:t*o.from.y,width:i*o.from.x,outerHeight:r*o.from.y,outerWidth:n*o.from.x},e.to={height:t*o.to.y,width:i*o.to.x,outerHeight:t*o.to.y,outerWidth:i*o.to.x},o.from.y!==o.to.y&&(e.from=S.effects.setTransition(e,h,o.from.y,e.from),e.to=S.effects.setTransition(e,h,o.to.y,e.to)),o.from.x!==o.to.x&&(e.from=S.effects.setTransition(e,l,o.from.x,e.from),e.to=S.effects.setTransition(e,l,o.to.x,e.to)),e.css(e.from),e.animate(e.to,s.duration,s.easing,function(){d&&S.effects.restore(e,c)})})),a.animate(a.to,{queue:!1,duration:s.duration,easing:s.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===u&&a.hide(),S.effects.restore(a,m),d||("static"===g?a.css({position:"relative",top:a.to.top,left:a.to.left}):S.each(["top","left"],function(n,e){a.css(e,function(e,t){var i=parseInt(t,10),r=n?a.to.left:a.to.top;return"auto"===t?r+"px":i+r+"px"})})),S.effects.removeWrapper(a),e()}})}}(jQuery),function(S,e){S.effects.effect.shake=function(e,t){var i,r=S(this),n=["position","top","bottom","left","right","height","width"],s=S.effects.setMode(r,e.mode||"effect"),o=e.direction||"left",a=e.distance||20,c=e.times||3,h=2*c+1,l=Math.round(e.duration/h),u="up"===o||"down"===o?"top":"left",d="up"===o||"left"===o,p={},f={},g={},m=r.queue(),_=m.length;for(S.effects.save(r,n),r.show(),S.effects.createWrapper(r),p[u]=(d?"-=":"+=")+a,f[u]=(d?"+=":"-=")+2*a,g[u]=(d?"-=":"+=")+2*a,r.animate(p,l,e.easing),i=1;i<c;i++)r.animate(f,l,e.easing).animate(g,l,e.easing);r.animate(f,l,e.easing).animate(p,l/2,e.easing).queue(function(){"hide"===s&&r.hide(),S.effects.restore(r,n),S.effects.removeWrapper(r),t()}),1<_&&m.splice.apply(m,[1,0].concat(m.splice(_,h+1))),r.dequeue()}}(jQuery),function(u,e){u.effects.effect.slide=function(e,t){var i,r=u(this),n=["position","top","bottom","left","right","width","height"],s=u.effects.setMode(r,e.mode||"show"),o="show"===s,a=e.direction||"left",c="up"===a||"down"===a?"top":"left",h="up"===a||"left"===a,l={};u.effects.save(r,n),r.show(),i=e.distance||r["top"===c?"outerHeight":"outerWidth"](!0),u.effects.createWrapper(r).css({overflow:"hidden"}),o&&r.css(c,h?isNaN(i)?"-"+i:-i:i),l[c]=(o?h?"+=":"-=":h?"-=":"+=")+i,r.animate(l,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===s&&r.hide(),u.effects.restore(r,n),u.effects.removeWrapper(r),t()}})}}(jQuery),function(d,e){d.effects.effect.transfer=function(e,t){var i=d(this),r=d(e.to),n="fixed"===r.css("position"),s=d("body"),o=n?s.scrollTop():0,a=n?s.scrollLeft():0,c=r.offset(),h={top:c.top-o,left:c.left-a,height:r.innerHeight(),width:r.innerWidth()},l=i.offset(),u=d("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:l.top-o,left:l.left-a,height:i.innerHeight(),width:i.innerWidth(),position:n?"fixed":"absolute"}).animate(h,e.duration,e.easing,function(){u.remove(),t()})}}(jQuery),void 0===require)&&function(ba){function J(e){return"[object Function]"===N.call(e)}function K(e){return"[object Array]"===N.call(e)}function z(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function O(e,t){var i;if(e)for(i=e.length-1;-1<i&&(!e[i]||!t(e[i],i,e));i-=1);}function t(e,t){return ha.call(e,t)}function m(e,i){return t(e,i)&&e[i]}function H(e,i){for(var r in e)if(t(e,r)&&i(e[r],r))break}function S(r,e,n,s){return e&&H(e,function(e,i){!n&&t(r,i)||(s&&"string"!=typeof e?(r[i]||(r[i]={}),S(r[i],e,n,s)):r[i]=e)}),r}function v(e,t){return function(){return t.apply(e,arguments)}}function ca(e){throw e}function da(e){if(!e)return e;var t=ba;return z(e.split("."),function(e){t=t[e]}),t}function B(e,t,i,r){return(t=Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e)).requireType=e,t.requireModules=r,i&&(t.originalError=i),t}function ia(l){function u(e,t,i){var r,n,s,o,a,c,h,l=t&&t.split("/");r=l;var u=I.map,d=u&&u["*"];if(e&&"."===e.charAt(0))if(t){for(t=e=(r=m(I.pkgs,t)?l=[t]:l.slice(0,l.length-1)).concat(e.split("/")),r=0;t[r];r+=1)if("."===(n=t[r]))t.splice(r,1),r-=1;else if(".."===n){if(1===r&&(".."===t[2]||".."===t[0]))break;0<r&&(t.splice(r-1,2),r-=2)}r=m(I.pkgs,t=e[0]),e=e.join("/"),r&&e===t+"/"+r.main&&(e=t)}else 0===e.indexOf("./")&&(e=e.substring(2));if(i&&u&&(l||d)){for(r=(t=e.split("/")).length;0<r;r-=1){if(s=t.slice(0,r).join("/"),l)for(n=l.length;0<n;n-=1)if((i=m(u,l.slice(0,n).join("/")))&&(i=m(i,s))){o=i,a=r;break}if(o)break;!c&&d&&m(d,s)&&(c=m(d,s),h=r)}!o&&c&&(o=c,a=h),o&&(t.splice(0,a,o),e=t.join("/"))}return e}function d(t){A&&z(document.getElementsByTagName("script"),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===C.contextName)return e.parentNode.removeChild(e),!0})}function p(e){var t=m(I.paths,e);if(t&&K(t)&&1<t.length)return d(e),t.shift(),C.require.undef(e),C.require([e]),!0}function f(e){var t,i=e?e.indexOf("!"):-1;return-1<i&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function g(e,t,i,r){var n,s,o=null,a=t?t.name:null,c=e,h=!0,l="";return e||(h=!1,e="_@r"+(L+=1)),o=(e=f(e))[0],e=e[1],o&&(o=u(o,a,r),s=m(k,o)),e&&(o?l=s&&s.normalize?s.normalize(e,function(e){return u(e,a,r)}):u(e,a,r):(o=(e=f(l=u(e,a,r)))[0],l=e[1],i=!0,n=C.nameToUrl(l))),{prefix:o,name:l,parentMap:t,unnormalized:!!(i=!o||s||i?"":"_unnormalized"+(P+=1)),url:n,originalName:c,isDefine:h,id:(o?o+"!"+l:l)+i}}function _(e){var t=e.id,i=m(D,t);return i||(i=D[t]=new C.Module(e)),i}function s(e,i,r){var n=e.id,s=m(D,n);!t(k,n)||s&&!s.defineEmitComplete?(s=_(e)).error&&"error"===i?r(s.error):s.on(i,r):"defined"===i&&r(k[n])}function y(t,e){var i=t.requireModules,r=!1;e?e(t):(z(i,function(e){(e=m(D,e))&&(e.error=t,e.events.error&&(r=!0,e.emit("error",t)))}),r||h.onError(t))}function b(){U.length&&(ja.apply(a,[a.length-1,0].concat(U)),U=[])}function E(e){delete D[e],delete F[e]}function x(){var t,i,e,r,n=(e=1e3*I.waitSeconds)&&C.startTime+e<(new Date).getTime(),s=[],o=[],a=!1,c=!0;if(!w){if(w=!0,H(F,function(e){if(t=e.map,i=t.id,e.enabled&&(t.isDefine||o.push(e),!e.error))if(!e.inited&&n)p(i)?a=r=!0:(s.push(i),d(i));else if(!e.inited&&e.fetched&&t.isDefine&&(a=!0,!t.prefix))return c=!1}),n&&s.length)return(e=B("timeout","Load timeout for modules: "+s,null,s)).contextName=C.contextName,y(e);c&&z(o,function(e){!function n(s,o,a){var e=s.map.id;s.error?s.emit("error",s.error):(o[e]=!0,z(s.depMaps,function(e,t){var i=e.id,r=m(D,i);r&&!s.depMatched[t]&&!a[i]&&(m(o,i)?(s.defineDep(t,k[i]),s.check()):n(r,o,a))}),a[e]=!0)}(e,{},{})}),n&&!r||!a||!A&&!ea||N||(N=setTimeout(function(){N=0,x()},50)),w=!1}}function o(e){t(k,e[0])||_(g(e[0],null,!0)).init(e[1],e[2])}function i(e){e=e.currentTarget||e.srcElement;var t=C.onScriptLoad;return e.detachEvent&&!Z?e.detachEvent("onreadystatechange",t):e.removeEventListener("load",t,!1),t=C.onScriptError,(!e.detachEvent||Z)&&e.removeEventListener("error",t,!1),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function M(){var e;for(b();a.length;){if(null===(e=a.shift())[0])return y(B("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));o(e)}}var w,e,C,T,N,I={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},D={},F={},r={},a=[],k={},n={},L=1,P=1;return T={require:function(e){return e.require?e.require:e.require=C.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?e.exports:e.exports=k[e.map.id]={}},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e=m(I.pkgs,t.map.id);return m(I.config,e?t.map.id+"/"+e.main:t.map.id)||{}},exports:k[t.map.id]}}},(e=function(e){this.events=m(r,e.id)||{},this.map=e,this.shim=m(I.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,r){r=r||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=v(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,C.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();C.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],v(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;n[e]||(n[e]=!0,C.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var t,e,i=this.map.id;e=this.depExports;var r=this.exports,n=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(J(n)){if(this.events.error&&this.map.isDefine||h.onError!==ca)try{r=C.execCb(i,n,e,r)}catch(e){t=e}else r=C.execCb(i,n,e,r);if(this.map.isDefine&&((e=this.module)&&void 0!==e.exports&&e.exports!==this.exports?r=e.exports:void 0===r&&this.usingExports&&(r=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",y(this.error=t)}else r=n;this.exports=r,this.map.isDefine&&!this.ignore&&(k[i]=r,h.onResourceLoad)&&h.onResourceLoad(C,this.map,this.depMaps),E(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var c=this.map,l=c.id,e=g(c.prefix);this.depMaps.push(e),s(e,"defined",v(this,function(e){var o,i;i=this.map.name;var r=this.map.parentMap?this.map.parentMap.name:null,a=C.makeRequire(c.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(e.normalize&&(i=e.normalize(i,function(e){return u(e,r,!0)})||""),s(e=g(c.prefix+"!"+i,this.map.parentMap),"defined",v(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),(i=m(D,e.id))&&(this.depMaps.push(e),this.events.error&&i.on("error",v(this,function(e){this.emit("error",e)})),i.enable())):((o=v(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=v(this,function(e){this.inited=!0,(this.error=e).requireModules=[l],H(D,function(e){0===e.map.id.indexOf(l+"_unnormalized")&&E(e.map.id)}),y(e)}),o.fromText=v(this,function(e,i){var r=c.name,n=g(r),s=Q;i&&(e=i),s&&(Q=!1),_(n),t(I.config,l)&&(I.config[r]=I.config[l]);try{h.exec(e)}catch(e){return y(B("fromtexteval","fromText eval for "+l+" failed: "+e,e,[l]))}s&&(Q=!0),this.depMaps.push(n),C.completeLoad(r),a([r],o)}),e.load(c.name,a,o,I))})),C.enable(e,this),this.pluginMaps[e.id]=e},enable:function(){(F[this.map.id]=this).enabling=this.enabled=!0,z(this.depMaps,v(this,function(e,i){var r,n;if("string"==typeof e){if(e=g(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=e,r=m(T,e.id))return void(this.depExports[i]=r(this));this.depCount+=1,s(e,"defined",v(this,function(e){this.defineDep(i,e),this.check()})),this.errback&&s(e,"error",v(this,this.errback))}r=e.id,n=D[r],!t(T,r)&&n&&!n.enabled&&C.enable(e,this)})),H(this.pluginMaps,v(this,function(e){var t=m(D,e.id);t&&!t.enabled&&C.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){z(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(C={config:I,contextName:l,registry:D,defined:k,urlFetched:n,defQueue:a,Module:e,makeModuleMap:g,nextTick:h.nextTick,onError:y,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=I.pkgs,i=I.shim,r={paths:!0,config:!0,map:!0};H(e,function(e,t){r[t]?"map"===t?(I.map||(I.map={}),S(I[t],e,!0,!0)):S(I[t],e,!0):I[t]=e}),e.shim&&(H(e.shim,function(e,t){K(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=C.makeShimExports(e)),i[t]=e}),I.shim=i),e.packages&&(z(e.packages,function(e){t[(e="string"==typeof e?{name:e}:e).name]={name:e.name,location:e.location||e.name,main:(e.main||"main").replace(ka,"").replace(fa,"")}}),I.pkgs=t),H(D,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=g(t))}),(e.deps||e.callback)&&C.require(e.deps||[],e.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(ba,arguments)),e||t.exports&&da(t.exports)}},makeRequire:function(o,a){function c(e,i,r){var n,s;return a.enableBuildCallback&&i&&J(i)&&(i.__requireJsBuild=!0),"string"==typeof e?J(i)?y(B("requireargs","Invalid require call"),r):o&&t(T,e)?T[e](D[o.id]):h.get?h.get(C,e,o,c):(n=(n=g(e,o,!1,!0)).id,t(k,n)?k[n]:y(B("notloaded",'Module name "'+n+'" has not been loaded yet for context: '+l+(o?"":". Use require([])")))):(M(),C.nextTick(function(){M(),(s=_(g(null,o))).skipMap=a.skipMap,s.init(e,i,r,{enabled:!0}),x()}),c)}return a=a||{},S(c,{isBrowser:A,toUrl:function(e){var t,i=e.lastIndexOf("."),r=e.split("/")[0];return-1!==i&&("."!==r&&".."!==r||1<i)&&(t=e.substring(i,e.length),e=e.substring(0,i)),C.nameToUrl(u(e,o&&o.id,!0),t,!0)},defined:function(e){return t(k,g(e,o,!1,!0).id)},specified:function(e){return e=g(e,o,!1,!0).id,t(k,e)||t(D,e)}}),o||(c.undef=function(e){b();var t=g(e,o,!0),i=m(D,e);delete k[e],delete n[t.url],delete r[e],i&&(i.events.defined&&(r[e]=i.events),E(e))}),c},enable:function(e){m(D,e.id)&&_(e).enable()},completeLoad:function(e){var i,r,n=m(I.shim,e)||{},s=n.exports;for(b();a.length;){if(null===(r=a.shift())[0]){if(r[0]=e,i)break;i=!0}else r[0]===e&&(i=!0);o(r)}if(r=m(D,e),!i&&!t(k,e)&&r&&!r.inited){if(I.enforceDefine&&(!s||!da(s)))return p(e)?void 0:y(B("nodefine","No define call for "+e,null,[e]));o([e,n.deps||[],n.exportsFn])}x()},nameToUrl:function(e,t,i){var r,n,s,o,a,c;if(h.jsExtRegExp.test(e))o=e+(t||"");else{for(r=I.paths,n=I.pkgs,a=(o=e.split("/")).length;0<a;a-=1){if(s=m(n,c=o.slice(0,a).join("/")),c=m(r,c)){K(c)&&(c=c[0]),o.splice(0,a,c);break}if(s){e=e===s.name?s.location+"/"+s.main:s.location,o.splice(0,a,e);break}}o=o.join("/"),o=("/"===(o+=t||(/\?/.test(o)||i?"":".js")).charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":I.baseUrl)+o}return I.urlArgs?o+(-1===o.indexOf("?")?"?":"&")+I.urlArgs:o},load:function(e,t){h.load(C,e,t)},execCb:function(e,t,i,r){return t.apply(r,i)},onScriptLoad:function(e){("load"===e.type||la.test((e.currentTarget||e.srcElement).readyState))&&(R=null,e=i(e),C.completeLoad(e.id))},onScriptError:function(e){var t=i(e);if(!p(t.id))return y(B("scripterror","Script error for: "+t.id,e,[t.id]))}}).require=C.makeRequire(),C}var h,x,y,E,L,F,R,M,s,ga,ma=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,na=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,fa=/\.js$/,ka=/^\.\//;x=Object.prototype;var N=x.toString,ha=x.hasOwnProperty,ja=Array.prototype.splice,A=!("undefined"==typeof window||!navigator||!window.document),ea=!A&&"undefined"!=typeof importScripts,la=A&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,Z="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),G={},u={},U=[],Q=!1;if(void 0===define){if(void 0!==requirejs){if(J(requirejs))return;u=requirejs,requirejs=void 0}void 0!==require&&!J(require)&&(u=require,require=void 0),h=requirejs=function(e,t,i,r){var n,s="_";return!K(e)&&"string"!=typeof e&&(n=e,K(t)?(e=t,t=i,i=r):e=[]),n&&n.context&&(s=n.context),(r=m(G,s))||(r=G[s]=h.s.newContext(s)),n&&r.configure(n),r.require(e,t,i)},h.config=function(e){return h(e)},h.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=h),h.version="2.1.6",h.jsExtRegExp=/^\/|:|\?|\.js$/,h.isBrowser=A,x=h.s={contexts:G,newContext:ia},h({}),z(["toUrl","undef","defined","specified"],function(t){h[t]=function(){var e=G._;return e.require[t].apply(e,arguments)}}),A&&(y=x.head=document.getElementsByTagName("head")[0],E=document.getElementsByTagName("base")[0])&&(y=x.head=E.parentNode),h.onError=ca,h.load=function(t,i,r){var e,n=t&&t.config||{};if(A)return(e=n.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script")).type=n.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e.setAttribute("data-requirecontext",t.contextName),e.setAttribute("data-requiremodule",i),!e.attachEvent||e.attachEvent.toString&&e.attachEvent.toString().indexOf("[native code")<0||Z?(e.addEventListener("load",t.onScriptLoad,!1),e.addEventListener("error",t.onScriptError,!1)):(Q=!0,e.attachEvent("onreadystatechange",t.onScriptLoad)),e.src=r,M=e,E?y.insertBefore(e,E):y.appendChild(e),M=null,e;if(ea)try{importScripts(r),t.completeLoad(i)}catch(e){t.onError(B("importscripts","importScripts failed for "+i+" at "+r,e,[i]))}},A&&O(document.getElementsByTagName("script"),function(e){if(y||(y=e.parentNode),L=e.getAttribute("data-main"))return s=L,u.baseUrl||(s=(F=s.split("/")).pop(),ga=F.length?F.join("/")+"/":"./",u.baseUrl=ga),s=s.replace(fa,""),h.jsExtRegExp.test(s)&&(s=L),u.deps=u.deps?u.deps.concat(s):[s],!0}),define=function(e,i,t){var r,n;"string"!=typeof e&&(t=i,i=e,e=null),K(i)||(t=i,i=null),!i&&J(t)&&(i=[],t.length&&(t.toString().replace(ma,"").replace(na,function(e,t){i.push(t)}),i=(1===t.length?["require"]:["require","exports","module"]).concat(i))),Q&&((r=M)||(R&&"interactive"===R.readyState||O(document.getElementsByTagName("script"),function(e){if("interactive"===e.readyState)return R=e}),r=R),r&&(e||(e=r.getAttribute("data-requiremodule")),n=G[r.getAttribute("data-requirecontext")])),(n?n.defQueue:U).push([e,i,t])},define.amd={jQuery:!0},h.exec=function(b){return eval(b)},h(u)}}(this);WebGLDebugUtils=function(){var a=function(e){window.console&&window.console.log&&window.console.log(e)},n={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},i=null;function c(e){if(null==i)for(var t in i={},e)"number"==typeof e[t]&&(i[e[t]]=t)}function r(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function h(e){r();var t=i[e];return void 0!==t?t:"*UNKNOWN WebGL ENUM (0x"+e.toString(16)+")"}function l(e,t,i){var r=n[e];return void 0!==r&&r[t]?h(i):null===i?"null":void 0===i?"undefined":i.toString()}function x(e,t,i){e.__defineGetter__(i,function(){return t[i]}),e.__defineSetter__(i,function(e){t[i]=e})}function M(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(i);var n=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<n;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:c,mightBeEnum:function(e){return r(),void 0!==i[e]},glEnumToString:h,glFunctionArgToString:l,glFunctionArgsToString:function(e,t){for(var i="",r=0;r<t.length;++r)i+=(0==r?"":", ")+l(e,r,t[r]);return i},makeDebugContext:function(t,n,s){c(t),n=n||function(e,t,i){for(var r="",n=0;n<i.length;++n)r+=(0==n?"":", ")+l(t,n,i[n]);a("WebGL error "+h(e)+" in "+t+"("+r+")")};var o={};function e(i,r){return function(){s&&s(r,arguments);var e=i[r].apply(i,arguments),t=i.getError();return 0!=t&&(o[t]=!0,n(t,r,arguments)),e}}var i={};for(var r in t)"function"==typeof t[r]?i[r]=e(t,r):x(i,t,r);return i.getError=function(){for(var e in o)if(o.hasOwnProperty(e)&&o[e])return o[e]=!1,e;return t.NO_ERROR},i},makeLostContextSimulatingCanvas:function(r){var l,t,n=[],s=[],u={},d=1,p=!1,f=[],o=0,a=0,c=!1,h=0,g={};function i(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}r.getContext=(t=r.getContext,function(){var e=t.apply(r,arguments);if(e instanceof WebGLRenderingContext){if(e!=l){if(l)throw"got different context";u=function(i){for(var e in i)"function"==typeof i[e]?u[e]=b(i,e):x(u,i,e);u.getError=function(){if(y(),!p)for(;e=l.getError();)g[e]=!0;for(var e in g)if(g[e])return delete g[e],e;return u.NO_ERROR};for(var t=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<t.length;++r){var n=t[r];u[n]=function(t){return function(){if(y(),p)return null;var e=t.apply(i,arguments);return e.__webglDebugContextLostId__=d,f.push(e),e}}(i[n])}for(var s=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],r=0;r<s.length;++r){var n=s[r];u[n]=function(e){return function(){return y(),p?null:e.apply(i,arguments)}}(u[n])}for(var o=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],r=0;r<o.length;++r){var n=o[r];u[n]=function(e){return function(){return y(),!p&&e.apply(i,arguments)}}(u[n])}return u.checkFramebufferStatus=(h=u.checkFramebufferStatus,function(){return y(),p?u.FRAMEBUFFER_UNSUPPORTED:h.apply(i,arguments)}),u.getAttribLocation=(c=u.getAttribLocation,function(){return y(),p?-1:c.apply(i,arguments)}),u.getVertexAttribOffset=(a=u.getVertexAttribOffset,function(){return y(),p?0:a.apply(i,arguments)}),u.isContextLost=function(){return p},u;var a,c,h}(l=e)}return u}return e});var m,_,S=function(e){n.push(i(e))},v=function(e){s.push(i(e))};function y(){++a,p||o==a&&r.loseContext()}function b(e,t){var i=e[t];return function(){if(y(),!p)return i.apply(e,arguments)}}function E(e){return{statusMessage:e,preventDefault:function(){c=!0}}}return _=(m=r).addEventListener,m.addEventListener=function(e,t,i){switch(e){case"webglcontextlost":S(t);break;case"webglcontextrestored":v(t);break;default:_.apply(m,arguments)}},r.loseContext=function(){if(!p){for(p=!0,o=0,++d;l.getError(););!function(){for(var e=Object.keys(g),t=0;t<e.length;++t)delete g[e]}(),g[l.CONTEXT_LOST_WEBGL]=!0;var t=E("context lost"),i=n.slice();setTimeout(function(){for(var e=0;e<i.length;++e)i[e](t);0<=h&&setTimeout(function(){r.restoreContext()},h)},0)}},r.restoreContext=function(){p&&s.length&&setTimeout(function(){if(!c)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var e=0;e<f.length;++e){var t=f[e];t instanceof WebGLBuffer?l.deleteBuffer(t):t instanceof WebGLFramebuffer?l.deleteFramebuffer(t):t instanceof WebGLProgram?l.deleteProgram(t):t instanceof WebGLRenderbuffer?l.deleteRenderbuffer(t):t instanceof WebGLShader?l.deleteShader(t):t instanceof WebGLTexture&&l.deleteTexture(t)}}(),M(l),a=0,c=p=!1;for(var e=s.slice(),t=E("context restored"),i=0;i<e.length;++i)e[i](t)},0)},r.loseContextInNCalls=function(e){if(p)throw"You can not ask a lost contet to be lost";o=a+e},r.getNumCalls=function(){return a},r.setRestoreTimeout=function(e){h=e},r},resetToInitialState:M}}();var SceneJS_Map=function(e,t){this.items=e||[];var r=(t||0)+1;this.addItem=function(){var e;if(2==arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw SceneJS_error.fatalError(SceneJS.errors.ID_CLASH,"ID clash: '"+t+"'");return this.items[t]=e,t}for(;;){e=arguments[0];var i=r++;if(!this.items[i])return this.items[i]=e,i}},this.removeItem=function(e){delete this.items[e]}},SceneJS=new function(){this.VERSION="3.2",this._baseStateId=0,this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._engines={},this._engineIds=new SceneJS_Map,this.publish=function(e,t,i){i||(this._topicPubs[e]=t);var r=this._topicSubs[e];if(r)for(var n in r)r.hasOwnProperty(n)&&r[n].call(this,t)},this.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var i in t)t.hasOwnProperty(i)&&t[i].call(this,null);delete this._topicPubs[e]},this.on=function(e,t){var i=this._topicSubs[e];i||(i={},this._topicSubs[e]=i);var r=this._handleMap.addItem();i[r]=t,this._handleTopics[r]=e;var n=this._topicPubs[e];return n&&t.call(this,n),r},this.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var i=this._topicSubs[t];i&&delete i[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},this.once=function(e,t){var i=this,r=this.on(e,function(e){i.off(r),t(e)})},this.createScene=function(e,t){if((e=e||{}).id){if(this._engines[e.id])throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Scene already exists with this ID: '"+e.id+"'");this._engineIds.addItem(e.id,{})}else e.id=this._engineIds.addItem({});var i=new SceneJS_Engine(e,t);return this._engines[e.id]=i,SceneJS_events.fireEvent(SceneJS_events.SCENE_CREATED,{engine:i}),i.scene.start(t),i.scene},this.scene=function(e){var t=this._engines[e];return t?t.scene:null},this.getScene=function(e){if(!e)for(var e in this._engines)if(this._engines.hasOwnProperty(e))return this._engines[e].scene;var t=this._engines[e];return t?t.scene:null},this.getScenes=function(){var e={};for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e[t]=this._engines[t].scene);return e},this._isArray=function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},this._shallowClone=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},this._applyIf=function(e,t){for(var i in e)e.hasOwnProperty(i)&&(null!=t[i]&&null!=t[i]||(t[i]=e[i]));return t},this._apply=function(e,t,i){var r;if(i)for(r in t)t.hasOwnProperty(r)&&delete t[r];for(r in e)e.hasOwnProperty(r)&&null!=e[r]&&(t[r]=e[r]);return t};var i=Object.prototype.hasOwnProperty;this._isEmpty=function(e){if(null==e)return!0;if(0<e.length)return!1;if(0===e.length)return!0;for(var t in e)if(i.call(e,t))return!1;return!0},this.reset=function(){var e=[];for(var t in this._engines)this._engines.hasOwnProperty(t)&&(e.push(this._engines[t]),delete this._engines[t],this._engineIds.removeItem(t));for(;0<e.length;)e.pop().destroy();SceneJS_events.fireEvent(SceneJS_events.RESET)}};!function(){var i;SceneJS.on("configs",function(e){if(e.pluginPath!=i){var t=(i=e.pluginPath)+"/lib";require.config({paths:{scenejsPluginDeps:t}})}})}();var SceneJS_eventManager=function(){this._handlerIds=new SceneJS_Map,this.typeHandlers={}};SceneJS_eventManager.prototype.createEvent=function(e){this.typeHandlers[e]||(this.typeHandlers[e]={handlers:{},numSubs:0})},SceneJS_eventManager.prototype.onEvent=function(e,t){var i=this.typeHandlers[e]||(this.typeHandlers[e]={handlers:{},numSubs:0}),r=this._handlerIds.addItem(e);return i.handlers[r]=t,i.numSubs++,r},SceneJS_eventManager.prototype.fireEvent=function(e,t){var i=this.typeHandlers[e]||(this.typeHandlers[e]={handlers:{},numSubs:0});if(0<i.numSubs){var r=i.handlers;for(var n in r)r.hasOwnProperty(n)&&r[n](t)}},SceneJS_eventManager.prototype.unEvent=function(e){var t=this._handlerIds.items[e];if(t){this._handlerIds.removeItem(e);var i=this.typeHandlers[t];i&&(delete i[e],this.typeHandlers[t].numSubs--)}},SceneJS.Plugins=new function(){var c={},h={};function l(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t&&t())}:i.onload=function(){t&&t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}this.addPlugin=function(){var e,t,i,r,n,s,o=arguments[0],a=arguments[1];4==arguments.length?(e=arguments[2],t=arguments[3]):t=arguments[2],r=a,n=e,s=t,(c[i=o]||(c[i]={}))[r]=s,function e(t,i,r){if(!t||i>=t.length)r();else{var n=t[i],s=SceneJS_configsModule.configs.pluginPath;if(!s)throw"no pluginPath config";l(n=s+"/"+n,function(){e(t,i+1,r)})}}(n,0,function(){for(var e=i+r,t=h[e]||(h[e]=[]);0<t.length;)t.pop()(s);delete h[e]})},this.hasPlugin=function(e,t){var i=c[e];return i&&!!i[t]},this.getPlugin=function(e,t,i){var r=c[e];if(r){var n=r[t];if(n)return void i(n)}var s=e+t,o=h[s]||(h[s]=[]);if(o.push(i),!(1<o.length)){var a=SceneJS_configsModule.configs.pluginPath;if(!a)throw"no pluginPath config";l(a+"/"+e+"/"+t+".js")}}};var SceneJS_events=new function(){this.ERROR=0,this.RESET=1,this.NODE_CREATED=2,this.SCENE_CREATED=3,this.SCENE_COMPILING=4,this.SCENE_DESTROYED=5,this.OBJECT_COMPILING=6,this.WEBGL_CONTEXT_LOST=7,this.WEBGL_CONTEXT_RESTORED=8;var c=[];this.addListener=function(e,t,i){var r=c[e];r||(r=[],c[e]=r);for(var n={command:t,priority:null==i?r.length:i},s=-1,o=0,a=r.length;o<a;o++)if(!r[o]){s=o;break}return s<0&&(r.push(n),s=r.length-1),e+"."+s},this.removeListener=function(e){var t=e.lastIndexOf("."),i=parseInt(e.substr(0,t)),r=parseInt(e.substr(t+1)),n=c[i];n&&delete n[r]},this.fireEvent=function(e,t){var i=c[e];if(i){t=t||{};for(var r=0;r<i.length;r++)i[r]&&i[r].command(t)}}};SceneJS.bind=function(e,t){switch(e){case"error":return SceneJS_events.addListener(SceneJS_events.ERROR,t);case"reset":return SceneJS_events.addListener(SceneJS_events.RESET,function(){t()});case"webglcontextlost":return SceneJS_events.addListener(SceneJS_events.WEBGL_CONTEXT_LOST,function(e){t(e)});case"webglcontextrestored":return SceneJS_events.addListener(SceneJS_events.WEBGL_CONTEXT_RESTORED,function(e){t(e)});default:throw SceneJS_error.fatalError("SceneJS.bind - this event type not supported: '"+e+"'")}},SceneJS.onEvent=SceneJS.bind,SceneJS.unEvent=function(e){return SceneJS_events.removeListener(e)},SceneJS.subscribe=SceneJS.addListener=SceneJS.onEvent=SceneJS.bind,SceneJS.unsubscribe=SceneJS.unEvent,SceneJS.on=SceneJS.onEvent,SceneJS.off=SceneJS.unEvent;var SceneJS_Canvas=function(e,t,i,r){if(this.canvasId,!t){t="canvas-"+e;var n=document.getElementsByTagName("body")[0],s=document.createElement("div"),o=s.style;o.height="100%",o.width="100%",o.padding="0",o.margin="0",o.left="0",o.top="0",o.position="absolute",s.innerHTML+='<canvas id="'+t+'" style="width: 100%; height: 100%; margin: 0; padding: 0;"></canvas>',n.appendChild(s)}var a=document.getElementById(t);if(!a)throw SceneJS_error.fatalError(SceneJS.errors.CANVAS_NOT_FOUND,"SceneJS.Scene attribute 'canvasId' does not match any elements in the page");this.canvasId=t,this.options=r||{},this.canvas=this.options.simulateWebGLContextLost?WebGLDebugUtils.makeLostContextSimulatingCanvas(a):a,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.contextAttr=i,this.gl=null,this.initWebGL()};SceneJS_Canvas.prototype._WEBGL_CONTEXT_NAMES=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],SceneJS_Canvas.prototype.initWebGL=function(){for(var e=0;!this.gl&&e<this._WEBGL_CONTEXT_NAMES.length;e++)try{this.gl=this.canvas.getContext(this._WEBGL_CONTEXT_NAMES[e],this.contextAttr)}catch(e){}if(!this.gl)throw SceneJS_error.fatalError(SceneJS.errors.WEBGL_NOT_SUPPORTED,"Failed to get a WebGL context")},SceneJS_Canvas.prototype.loseWebGLContext=function(){this.options.simulateWebGLContextLost&&this.canvas.loseContext()};var SceneJS_Engine=function(e,t){e.type="scene",this.id=e.id,this._numPasses=e.numPasses||1,this.canvas=new SceneJS_Canvas(this.id,e.canvasId,e.contextAttr,t),this.events=new SceneJS_eventManager,this._coreFactory=new SceneJS_CoreFactory,this._nodeFactory=new SceneJS_NodeFactory,this.display=new SceneJS_Display({canvas:this.canvas,transparent:e.transparent,dof:e.dof}),this.sceneDirty=!1,this._sceneBranchesDirty=!1,this._nodesToDestroy=[],this._numNodesToDestroy=0,this.running=!1,this.paused=!1,this.destroyed=!1,this.sceneStatus={nodes:{},numTasks:0};var i=this,r=e.nodes;e.nodes=null,this.scene=this.createNode(e),r&&(e.nodes=r,this.scene.addNodes(r)),this.canvas.canvas.addEventListener("webglcontextlost",function(e){e.preventDefault(),i.stop(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_LOST,{scene:i.scene})},!1),this.canvas.canvas.addEventListener("webglcontextrestored",function(e){i.canvas.initWebGL(),i._coreFactory.webglRestored(),i.display.webglRestored(),SceneJS_events.fireEvent(SceneJS_events.WEBGL_CONTEXT_RESTORED,{scene:i.scene}),i.start()},!1)};SceneJS_Engine.prototype.setNumPasses=function(e){this._numPasses=e},SceneJS_Engine.prototype.loseWebGLContext=function(){this.canvas.loseWebGLContext()},SceneJS_Engine.prototype.getNodeType=function(e,t){SceneJS_NodeFactory.getNodeType(e,t)},SceneJS_Engine.prototype.hasNodeType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]},SceneJS_Engine.prototype.createNode=function(n,s){this._doDestroyNodes(),n.type=n.type||"node";var e=this._coreFactory.getCore(n.type,n.coreId),o=this;return this._nodeFactory.getNode(this,n,e,function(t){if(!t._fromPlugin&&n.nodes)for(var i=0,e=0,r=n.nodes.length;e<r;e++)o.createNode(n.nodes[e],function(e){t.addNode(e),++i==r&&(s&&s(t),o.scene.publish("nodes/"+t.id,t))});else s&&(s(t),o.scene.publish("nodes/"+t.id,t))})},SceneJS_Engine.prototype._doDestroyNodes=function(){for(var e;0<this._numNodesToDestroy;)(e=this._nodesToDestroy[--this._numNodesToDestroy])._doDestroy(),this._coreFactory.putCore(e._core),this._nodeFactory.putNode(e)},SceneJS_Engine.prototype.findNode=function(e){return this._nodeFactory.nodes.items[e]},SceneJS_Engine.prototype.findNodes=function(e){var t=new RegExp(e),i=[],r=this._nodeFactory.nodes.items;for(var n in r)r.hasOwnProperty(n)&&t.test(n)&&i.push(r[n]);return i},SceneJS_Engine.prototype.hasCore=function(e,t){return this._coreFactory.hasCore(e,t)},SceneJS_Engine.prototype.branchDirty=function(e){if(!this.sceneDirty&&e!=window){e.branchDirty=!0,e.dirty=!0;for(var t=e.parent;t&&!t.dirty&&!t.branchDirty;t=t.parent)t.dirty=!0;this._sceneBranchesDirty=!0}},SceneJS_Engine.prototype.renderFrame=function(e){var t=!1;if(this._needCompile()||e&&e.force)for(var i=(new Date).getTime(),r=0;r<this._numPasses;r++)this.scene.publish("rendering",{pass:r}),this._doCompile(),this.display.render({clear:0==r}),this.scene.publish("rendered",{sceneId:this.id,time:i,pass:r}),t=!0;return t},SceneJS_Engine.prototype.start=function(){if(!this.running){this.running=!0,this.paused=!1,this.sceneDirty=!0;var t=this,i="__scenejs_sceneLoop"+this.id,r=!1,n=(new Date).getTime(),s=n,o=n,a=this.scene,c=!1;this.events.fireEvent("started",{sceneId:t.id,startTime:o}),window[i]=function(){if(t.running&&!t.paused){if(n=(new Date).getTime(),a.publish("tick",{sceneId:t.id,startTime:o,prevTime:s,time:n}),s=n,!t.running)return;c=!1;for(var e=0;e<t._numPasses;e++)(t._needCompile()||c)&&(r=!1,a.publish("rendering",{pass:e}),t._doCompile(),t.display.render({clear:0==e}),a.publish("rendered",{sceneId:t.id,time:n,pass:e}),c=!0);c||(r||a.publish("sleep",{sceneId:t.id,startTime:o,prevTime:n,time:n}),r=!0)}t.running&&window.requestAnimationFrame(window[i])},window.requestAnimationFrame(window[i])}},SceneJS_Engine.prototype.pick=function(e,t,i){return this._needCompile()&&this._doCompile(),this.display.pick({canvasX:e,canvasY:t,rayPick:!!i&&i.rayPick})},SceneJS_Engine.prototype._needCompile=function(){return this.display.imageDirty||this.display.drawListDirty||this.display.stateSortDirty||this.display.stateOrderDirty||this.display.objectListDirty||this._sceneBranchesDirty||this.sceneDirty},SceneJS_Engine.prototype._doCompile=function(){if(this._sceneBranchesDirty||this.sceneDirty){this._sceneBranchesDirty=!1,SceneJS_events.fireEvent(SceneJS_events.SCENE_COMPILING,{engine:this}),this.pubSubProxy=new SceneJS_PubSubProxy(this.scene,null);var e={pubSubProxy:this.pubSubProxy};this.scene._compileNodes(e),this.sceneDirty=!1}this._doDestroyNodes()},SceneJS_Engine.prototype.pause=function(e){this.paused=e},SceneJS_Engine.prototype.stop=function(){this.running&&(this.running=!1,this.paused=!1,window["__scenejs_sceneLoop"+this.id]=null)},SceneJS_Engine.prototype.destroyNode=function(e){this._nodesToDestroy[this._numNodesToDestroy++]=e;var t=this.sceneStatus.nodes[e.id];t&&(this.sceneStatus.numTasks-=t.numTasks,delete this.sceneStatus.nodes[e.id])},SceneJS_Engine.prototype.destroy=function(){this.destroyed=!0},self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),function(){for(var s=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"RequestCancelAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),r=Math.max(0,16-(i-s)),n=window.setTimeout(function(){e(i+r)},r);return s=i+r,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var SceneJS_error=new function(){var r;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){r=e.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){r=null},1e5),this.fatalError=function(e,t){"string"==typeof e&&(t=e,e=SceneJS.errors.ERROR);var i={errorName:SceneJS.errors._getErrorName(e)||"ERROR",code:e,exception:t,fatal:!0};return r&&(i.sceneId=r),SceneJS_events.fireEvent(SceneJS_events.ERROR,i),t},this.error=function(e,t){var i={errorName:SceneJS.errors._getErrorName(e)||"ERROR",code:e,exception:t,fatal:!1};r&&(i.sceneId=r),SceneJS_events.fireEvent(SceneJS_events.ERROR,i)}};!function(){SceneJS.errors={};var e=0;SceneJS.errors.ERROR=e++,SceneJS.errors.WEBGL_NOT_SUPPORTED=e++,SceneJS.errors.WEBGL_CONTEXT_LOST=e++,SceneJS.errors.NODE_CONFIG_EXPECTED=e++,SceneJS.errors.ILLEGAL_NODE_CONFIG=e++,SceneJS.errors.SHADER_COMPILATION_FAILURE=e++,SceneJS.errors.SHADER_LINK_FAILURE=e++,SceneJS.errors.CANVAS_NOT_FOUND=e++,SceneJS.errors.OUT_OF_VRAM=e++,SceneJS.errors.WEBGL_UNSUPPORTED_NODE_CONFIG=e++,SceneJS.errors.NODE_NOT_FOUND=e++,SceneJS.errors.NODE_ILLEGAL_STATE=e++,SceneJS.errors.ID_CLASH=e++,SceneJS.errors.PLUGIN_INVALID=e++}(),SceneJS.errors._getErrorName=function(e){for(var t in SceneJS.errors)if(SceneJS.errors.hasOwnProperty(t)&&SceneJS.errors[t]==e)return t;return null};var SceneJS_configsModule=new function(){this.configs={};var h={};this.setConfigs=function(e,t){if(e){for(var i,r,n=e.split("."),s=this.configs,o=0;o<n.length-1;o++)(i=s[r=n[o]])||(i=s[r]={}),s=i;s[n.length-1]=t}else this.configs=t;var a=h[e||"_all"];if(a){o=0;for(var c=a.length;o<c;o++)a[o](s)}SceneJS.publish("configs",this.configs)},this.getConfigs=function(e){if(e){for(var t=this.configs,i=e.split("."),r=0;t&&r<i.length;r++)t=t[i[r]];return null!=t?t:{}}return this.configs},this.on=function(e,t){(h[e=e||"_all"]||(h[e]=[])).push(t),t(this.getConfigs(e))}};SceneJS.configure=SceneJS.setConfigs=SceneJS.setDebugConfigs=function(){if(1==arguments.length)SceneJS_configsModule.setConfigs(null,arguments[0]);else{if(2!=arguments.length)throw SceneJS_error.fatalError("Illegal arguments given to SceneJS.setDebugs - should be either ({String}:name, {Object}:cfg) or ({Object}:cfg)");SceneJS_configsModule.setConfigs(arguments[0],arguments[1])}},SceneJS.getConfigs=SceneJS.getDebugConfigs=function(e){return SceneJS_configsModule.getConfigs(e)},SceneJS.log=new function(){var i,n=null,s={},r=0,o="";SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){i=e.engine.id}),SceneJS_events.addListener(SceneJS_events.RESET,function(){s={},i=n=null},1e5),this._setIndent=function(e){r=e;for(var t=[],i=0;i<r;i++)t.push("----");o=t.join("")},this.error=function(e){this._log("error",e)},this.warn=function(e){this._log("warn",e)},this.info=function(e){this._log("info",e)},this.debug=function(e){this._log("debug",e)},this.setFuncs=function(e){if(e)for(var t in n=e,s)this._flush(t)},this._flush=function(e){var t=s[e];if(t){var i=n?n[e]:null;if(i){for(var r=0;r<t.length;r++)i(t[r]);s[e]=[]}}},this._log=function(e,t){if(SceneJS._isArray(t))for(var i=0;i<t.length;i++)this.__log(e,t[i]);else this.__log(e,t)},this.__log=function(e,t){t=i?o+i+": "+t:o+t,n&&n[e]?n[e](t):console&&console[e]&&console[e](t)},this.getFuncs=function(){return n}};var SceneJS_math_divVec3=function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},SceneJS_math_negateVector4=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},SceneJS_math_addVec4=function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i},SceneJS_math_addVec4s=function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},SceneJS_math_addVec3=function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},SceneJS_math_addVec3s=function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},SceneJS_math_addScalarVec4=function(e,t,i){return SceneJS_math_addVec4s(t,e,i)},SceneJS_math_subVec4=function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i},SceneJS_math_subVec3=function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i},SceneJS_math_lerpVec3=function(e,t,i,r,n){var s=(e-t)/(i-t),o=1-s;return{x:r.x*o+n.x*s,y:r.y*o+n.y*s,z:r.z*o+n.z*s}},SceneJS_math_subVec2=function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i},SceneJS_math_subVec4Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},SceneJS_math_subScalarVec4=function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},SceneJS_math_mulVec4=function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},SceneJS_math_mulVec4Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i},SceneJS_math_mulVec3Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i},SceneJS_math_mulVec2Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i},SceneJS_math_divVec4=function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},SceneJS_math_divScalarVec3=function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i},SceneJS_math_divVec3s=function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},SceneJS_math_divVec4s=function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},SceneJS_math_divScalarVec4=function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},SceneJS_math_dotVector4=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},SceneJS_math_cross3Vec4=function(e,t){var i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],a=t[2];return[r*a-n*o,n*s-i*a,i*o-r*s,0]},SceneJS_math_cross3Vec3=function(e,t,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],c=t[2];return i[0]=n*c-s*a,i[1]=s*o-r*c,i[2]=r*a-n*o,i},SceneJS_math_sqLenVec4=function(e){return SceneJS_math_dotVector4(e,e)},SceneJS_math_lenVec4=function(e){return Math.sqrt(SceneJS_math_sqLenVec4(e))},SceneJS_math_dotVector3=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},SceneJS_math_dotVector2=function(e,t){return e[0]*t[0]+e[1]*t[1]},SceneJS_math_sqLenVec3=function(e){return SceneJS_math_dotVector3(e,e)},SceneJS_math_sqLenVec2=function(e){return SceneJS_math_dotVector2(e,e)},SceneJS_math_lenVec3=function(e){return Math.sqrt(SceneJS_math_sqLenVec3(e))},SceneJS_math_lenVec2=function(e){return Math.sqrt(SceneJS_math_sqLenVec2(e))},SceneJS_math_rcpVec3=function(e,t){return SceneJS_math_divScalarVec3(1,e,t)},SceneJS_math_normalizeVec4=function(e,t){var i=1/SceneJS_math_lenVec4(e);return SceneJS_math_mulVec4Scalar(e,i,t)},SceneJS_math_normalizeVec3=function(e,t){var i=1/SceneJS_math_lenVec3(e);return SceneJS_math_mulVec3Scalar(e,i,t)},SceneJS_math_normalizeVec2=function(e,t){var i=1/SceneJS_math_lenVec2(e);return SceneJS_math_mulVec2Scalar(e,i,t)},SceneJS_math_mat4=function(){return new Array(16)},SceneJS_math_dupMat4=function(e){return e.slice(0,16)},SceneJS_math_getCellMat4=function(e,t,i){return e[t+4*i]},SceneJS_math_setCellMat4=function(e,t,i,r){e[t+4*i]=r},SceneJS_math_getRowMat4=function(e,t){return[e[t],e[t+4],e[t+8],e[t+12]]},SceneJS_math_setRowMat4=function(e,t,i){e[t]=i[0],e[t+4]=i[1],e[t+8]=i[2],e[t+12]=i[3]},SceneJS_math_setRowMat4c=function(e,t,i,r,n,s){SceneJS_math_setRowMat4(e,t,[i,r,n,s])},SceneJS_math_setRowMat4s=function(e,t,i){SceneJS_math_setRowMat4c(e,t,i,i,i,i)},SceneJS_math_getColMat4=function(e,t){var i=4*t;return[e[i],e[i+1],e[i+2],e[i+3]]},SceneJS_math_setColMat4v=function(e,t,i){var r=4*t;e[r]=i[0],e[r+1]=i[1],e[r+2]=i[2],e[r+3]=i[3]},SceneJS_math_setColMat4c=function(e,t,i,r,n,s){SceneJS_math_setColMat4v(e,t,[i,r,n,s])},SceneJS_math_setColMat4Scalar=function(e,t,i){SceneJS_math_setColMat4c(e,t,i,i,i,i)},SceneJS_math_mat4To3=function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},SceneJS_math_m4s=function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},SceneJS_math_setMat4ToZeroes=function(){return SceneJS_math_m4s(0)},SceneJS_math_setMat4ToOnes=function(){return SceneJS_math_m4s(1)},SceneJS_math_diagonalMat4v=function(e){return[e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]},SceneJS_math_diagonalMat4c=function(e,t,i,r){return SceneJS_math_diagonalMat4v([e,t,i,r])},SceneJS_math_diagonalMat4s=function(e){return SceneJS_math_diagonalMat4c(e,e,e,e)},SceneJS_math_identityMat4=function(){return SceneJS_math_diagonalMat4v([1,1,1,1])},SceneJS_math_isIdentityMat4=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},SceneJS_math_negateMat4=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},SceneJS_math_addMat4=function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i[9]=e[9]+t[9],i[10]=e[10]+t[10],i[11]=e[11]+t[11],i[12]=e[12]+t[12],i[13]=e[13]+t[13],i[14]=e[14]+t[14],i[15]=e[15]+t[15],i},SceneJS_math_addMat4Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i[4]=e[4]+t,i[5]=e[5]+t,i[6]=e[6]+t,i[7]=e[7]+t,i[8]=e[8]+t,i[9]=e[9]+t,i[10]=e[10]+t,i[11]=e[11]+t,i[12]=e[12]+t,i[13]=e[13]+t,i[14]=e[14]+t,i[15]=e[15]+t,i},SceneJS_math_addScalarMat4=function(e,t,i){return SceneJS_math_addMat4Scalar(t,e,i)},SceneJS_math_subMat4=function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i[9]=e[9]-t[9],i[10]=e[10]-t[10],i[11]=e[11]-t[11],i[12]=e[12]-t[12],i[13]=e[13]-t[13],i[14]=e[14]-t[14],i[15]=e[15]-t[15],i},SceneJS_math_subMat4Scalar=function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i[4]=e[4]-t,i[5]=e[5]-t,i[6]=e[6]-t,i[7]=e[7]-t,i[8]=e[8]-t,i[9]=e[9]-t,i[10]=e[10]-t,i[11]=e[11]-t,i[12]=e[12]-t,i[13]=e[13]-t,i[14]=e[14]-t,i[15]=e[15]-t,i},SceneJS_math_subScalarMat4=function(e,t,i){return i||(i=t),i[0]=e-t[0],i[1]=e-t[1],i[2]=e-t[2],i[3]=e-t[3],i[4]=e-t[4],i[5]=e-t[5],i[6]=e-t[6],i[7]=e-t[7],i[8]=e-t[8],i[9]=e-t[9],i[10]=e-t[10],i[11]=e-t[11],i[12]=e-t[12],i[13]=e-t[13],i[14]=e-t[14],i[15]=e-t[15],i},SceneJS_math_mulMat4=function(e,t,i){i||(i=e);var r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],_=e[14],S=e[15],v=t[0],y=t[1],b=t[2],E=t[3],x=t[4],M=t[5],w=t[6],C=t[7],J=t[8],T=t[9],N=t[10],R=t[11],I=t[12],D=t[13],F=t[14],k=t[15];return i[0]=v*r+y*a+b*u+E*g,i[1]=v*n+y*c+b*d+E*m,i[2]=v*s+y*h+b*p+E*_,i[3]=v*o+y*l+b*f+E*S,i[4]=x*r+M*a+w*u+C*g,i[5]=x*n+M*c+w*d+C*m,i[6]=x*s+M*h+w*p+C*_,i[7]=x*o+M*l+w*f+C*S,i[8]=J*r+T*a+N*u+R*g,i[9]=J*n+T*c+N*d+R*m,i[10]=J*s+T*h+N*p+R*_,i[11]=J*o+T*l+N*f+R*S,i[12]=I*r+D*a+F*u+k*g,i[13]=I*n+D*c+F*d+k*m,i[14]=I*s+D*h+F*p+k*_,i[15]=I*o+D*l+F*f+k*S,i},SceneJS_math_mulMat4s=function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i},SceneJS_math_mulMat4v4=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];return[e[0]*i+e[4]*r+e[8]*n+e[12]*s,e[1]*i+e[5]*r+e[9]*n+e[13]*s,e[2]*i+e[6]*r+e[10]*n+e[14]*s,e[3]*i+e[7]*r+e[11]*n+e[15]*s]},SceneJS_math_transposeMat4=function(e,t){var i=e[4],r=e[14],n=e[8],s=e[13],o=e[12],a=e[9];if(!t||e==t){var c=e[1],h=e[2],l=e[3],u=e[6],d=e[7],p=e[11];return e[1]=i,e[2]=n,e[3]=o,e[4]=c,e[6]=a,e[7]=s,e[8]=h,e[9]=u,e[11]=r,e[12]=l,e[13]=d,e[14]=p,e}return t[0]=e[0],t[1]=i,t[2]=n,t[3]=o,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=s,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},SceneJS_math_determinantMat4=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],c=e[7],h=e[8],l=e[9],u=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return p*l*a*n-h*f*a*n-p*o*u*n+s*f*u*n+h*o*g*n-s*l*g*n-p*l*r*c+h*f*r*c+p*i*u*c-t*f*u*c-h*i*g*c+t*l*g*c+p*o*r*d-s*f*r*d-p*i*a*d+t*f*a*d+s*i*g*d-t*o*g*d-h*o*r*m+s*l*r*m+h*i*a*m-t*l*a*m-s*i*u*m+t*o*u*m},SceneJS_math_inverseMat4=function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],c=e[6],h=e[7],l=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],_=e[15],S=i*a-r*o,v=i*c-n*o,y=i*h-s*o,b=r*c-n*a,E=r*h-s*a,x=n*h-s*c,M=l*g-u*f,w=l*m-d*f,C=l*_-p*f,J=u*m-d*g,T=u*_-p*g,N=d*_-p*m,R=1/(S*N-v*T+y*J+b*C-E*w+x*M);return t[0]=(a*N-c*T+h*J)*R,t[1]=(-r*N+n*T-s*J)*R,t[2]=(g*x-m*E+_*b)*R,t[3]=(-u*x+d*E-p*b)*R,t[4]=(-o*N+c*C-h*w)*R,t[5]=(i*N-n*C+s*w)*R,t[6]=(-f*x+m*y-_*v)*R,t[7]=(l*x-d*y+p*v)*R,t[8]=(o*T-a*C+h*M)*R,t[9]=(-i*T+r*C-s*M)*R,t[10]=(f*E-g*y+_*S)*R,t[11]=(-l*E+u*y-p*S)*R,t[12]=(-o*J+a*w-c*M)*R,t[13]=(i*J-r*w+n*M)*R,t[14]=(-f*b+g*v-m*S)*R,t[15]=(l*b-u*v+d*S)*R,t},SceneJS_math_traceMat4=function(e){return e[0]+e[5]+e[10]+e[15]},SceneJS_math_translationMat4v=function(e){var t=SceneJS_math_identityMat4();return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},SceneJS_math_translationMat4c=function(e,t,i){return SceneJS_math_translationMat4v([e,t,i])},SceneJS_math_translationMat4s=function(e){return SceneJS_math_translationMat4c(e,e,e)},SceneJS_math_rotationMat4v=function(e,t){var i,r,n,s,o,a,c=SceneJS_math_normalizeVec4([t[0],t[1],t[2],0]),h=Math.sin(e),l=Math.cos(e),u=1-l,d=c[0],p=c[1],f=c[2];i=d*p,r=p*f,n=f*d,s=d*h,o=p*h,a=f*h;var g=SceneJS_math_mat4();return g[0]=u*d*d+l,g[1]=u*i+a,g[2]=u*n-o,g[3]=0,g[4]=u*i-a,g[5]=u*p*p+l,g[6]=u*r+s,g[7]=0,g[8]=u*n+o,g[9]=u*r-s,g[10]=u*f*f+l,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},SceneJS_math_rotationMat4c=function(e,t,i,r){return SceneJS_math_rotationMat4v(e,[t,i,r])},SceneJS_math_scalingMat4v=function(e){var t=SceneJS_math_identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},SceneJS_math_scalingMat4c=function(e,t,i){return SceneJS_math_scalingMat4v([e,t,i])},SceneJS_math_scalingMat4s=function(e){return SceneJS_math_scalingMat4c(e,e,e)},SceneJS_math_LOOKAT_OBJ={eye:{x:0,y:0,z:10},look:{x:0,y:0,z:0},up:{x:0,y:1,z:0}},SceneJS_math_LOOKAT_ARRAYS={eye:[0,0,10],look:[0,0,0],up:[0,1,0]},SceneJS_math_ORTHO_OBJ={left:-1,right:1,bottom:-1,near:.1,top:1,far:5e3},SceneJS_math_lookAtMat4v=function(e,t,i,r){r||(r=SceneJS_math_mat4());var n,s,o,a,c,h,l,u,d,p,f=e[0],g=e[1],m=e[2],_=i[0],S=i[1],v=i[2],y=t[0],b=t[1],E=t[2];return f==y&&g==b&&m==E?SceneJS_math_identityMat4():(n=f-y,s=g-b,o=m-E,a=S*(o*=p=1/Math.sqrt(n*n+s*s+o*o))-v*(s*=p),c=v*(n*=p)-_*o,h=_*s-S*n,(p=Math.sqrt(a*a+c*c+h*h))?(a*=p=1/p,c*=p,h*=p):h=c=a=0,l=s*h-o*c,u=o*a-n*h,d=n*c-s*a,(p=Math.sqrt(l*l+u*u+d*d))?(l*=p=1/p,u*=p,d*=p):d=u=l=0,r[0]=a,r[1]=l,r[2]=n,r[3]=0,r[4]=c,r[5]=u,r[6]=s,r[7]=0,r[8]=h,r[9]=d,r[10]=o,r[11]=0,r[12]=-(a*f+c*g+h*m),r[13]=-(l*f+u*g+d*m),r[14]=-(n*f+s*g+o*m),r[15]=1,r)},SceneJS_math_lookAtMat4c=function(e,t,i,r,n,s,o,a,c){return SceneJS_math_lookAtMat4v([e,t,i],[r,n,s],[o,a,c])},SceneJS_math_orthoMat4c=function(e,t,i,r,n,s,o){o||(o=SceneJS_math_mat4());var a=t-e,c=r-i,h=s-n;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/h,o[11]=0,o[12]=-(e+t)/a,o[13]=-(r+i)/c,o[14]=-(s+n)/h,o[15]=1,o},SceneJS_math_frustumMat4v=function(e,t){var i=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0],n=SceneJS_math_mat4();SceneJS_math_addVec4(r,i,n);var s=SceneJS_math_mat4();SceneJS_math_subVec4(r,i,s);var o=2*i[2],a=SceneJS_math_mat4(),c=s[0],h=s[1],l=s[2];return a[0]=o/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o/h,a[6]=0,a[7]=0,a[8]=n[0]/c,a[9]=n[1]/h,a[10]=-n[2]/l,a[11]=-1,a[12]=0,a[13]=0,a[14]=-o*r[2]/l,a[15]=0,a},SceneJS_math_frustumMatrix4=function(e,t,i,r,n,s,o){o||(o=SceneJS_math_mat4());var a=t-e,c=r-i,h=s-n;return o[0]=2*n/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/c,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(r+i)/c,o[10]=-(s+n)/h,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*n*2/h,o[15]=0,o},SceneJS_math_perspectiveMatrix4=function(e,t,i,r){var n=[],s=[];return n[2]=i,s[2]=r,s[1]=n[2]*Math.tan(e/2),n[1]=-s[1],s[0]=s[1]*t,n[0]=-s[0],SceneJS_math_frustumMat4v(n,s)},SceneJS_math_transformPoint3=function(e,t){var i=t[0],r=t[1],n=t[2];return[e[0]*i+e[4]*r+e[8]*n+e[12],e[1]*i+e[5]*r+e[9]*n+e[13],e[2]*i+e[6]*r+e[10]*n+e[14],e[3]*i+e[7]*r+e[11]*n+e[15]]},SceneJS_math_transformPoints3=function(e,t){for(var i,r,n,s,o=new Array(t.length),a=t.length,c=e[0],h=e[1],l=e[2],u=e[3],d=e[4],p=e[5],f=e[6],g=e[7],m=e[8],_=e[9],S=e[10],v=e[11],y=e[12],b=e[13],E=e[14],x=e[15],M=0;M<a;++M)i=(s=t[M])[0],r=s[1],n=s[2],o[M]=[c*i+d*r+m*n+y,h*i+p*r+_*n+b,l*i+f*r+S*n+E,u*i+g*r+v*n+x];return o},SceneJS_math_transformVector3=function(e,t){var i=t[0],r=t[1],n=t[2];return[e[0]*i+e[4]*r+e[8]*n,e[1]*i+e[5]*r+e[9]*n,e[2]*i+e[6]*r+e[10]*n]},SceneJS_math_transformVector4=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3];return[e[0]*i+e[4]*r+e[8]*n+e[12]*s,e[1]*i+e[5]*r+e[9]*n+e[13]*s,e[2]*i+e[6]*r+e[10]*n+e[14]*s,e[3]*i+e[7]*r+e[11]*n+e[15]*s]},SceneJS_math_projectVec4=function(e){var t=1/e[3];return[e[0]*t,e[1]*t,e[2]*t,1]},SceneJS_math_Plane3=function(e,t,i){if(this.normal=[0,0,1],this.offset=0,e&&t){var r=e[0],n=e[1],s=e[2];if(this.offset=t,i){var o=Math.sqrt(r*r+n*n+s*s);0<o&&(o=1/o,this.normal[0]=r*o,this.normal[1]=n*o,this.normal[2]=s*o,this.offset*=o)}}},SceneJS_math_MAX_DOUBLE=Number.POSITIVE_INFINITY,SceneJS_math_MIN_DOUBLE=Number.NEGATIVE_INFINITY,SceneJS_math_Box3=function(e,t){this.min=e||[SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE,SceneJS_math_MAX_DOUBLE],this.max=t||[SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE,SceneJS_math_MIN_DOUBLE],this.init=function(e,t){return this.min[0]=e[0],this.min[1]=e[1],this.min[2]=e[2],this.max[0]=t[0],this.max[1]=t[1],this.max[2]=t[2],this},this.fromPoints=function(e){for(var t=e.length,i=0;i<t;++i){var r=e[i][3],n=e[i][0]/r,s=e[i][1]/r,o=e[i][2]/r;n<this.min[0]&&(this.min[0]=n),s<this.min[1]&&(this.min[1]=s),o<this.min[2]&&(this.min[2]=o),n>this.max[0]&&(this.max[0]=n),s>this.max[1]&&(this.max[1]=s),o>this.max[2]&&(this.max[2]=o)}return this},this.isEmpty=function(){return this.min[0]>=this.max[0]&&this.min[1]>=this.max[1]&&this.min[2]>=this.max[2]},this.getCenter=function(){return[(this.max[0]+this.min[0])/2,(this.max[1]+this.min[1])/2,(this.max[2]+this.min[2])/2]},this.getSize=function(){return[this.max[0]-this.min[0],this.max[1]-this.min[1],this.max[2]-this.min[2]]},this.getFacesAreas=function(){var e=this.size;return[e[1]*e[2],e[0]*e[2],e[0]*e[1]]},this.getSurfaceArea=function(){var e=this.getFacesAreas();return 2*(e[0]+e[1]+e[2])},this.getVolume=function(){var e=this.size;return e[0]*e[1]*e[2]},this.getOffset=function(e){return this.min[0]-=e,this.min[1]-=e,this.min[2]-=e,this.max[0]+=e,this.max[1]+=e,this.max[2]+=e,this}},SceneJS_math_AxisBox3=function(e,t){var i=e[0],r=e[1],n=e[2],s=t[0],o=t[1],a=t[2];this.verts=[[i,r,n],[s,r,n],[s,o,n],[i,o,n],[i,r,a],[s,r,a],[s,o,a],[i,o,a]],this.toBox3=function(){for(var e=new SceneJS_math_Box3,t=0;t<8;++t)for(var i=this.verts[t],r=0;r<3;++r)i[r]<e.min[r]&&(e.min[r]=i[r]),i[r]>e.max[r]&&(e.max[r]=i[r])}},SceneJS_math_Sphere3=function(e,t){this.center=[e[0],e[1],e[2]],this.radius=t,this.isEmpty=function(){return 0===this.radius},this.surfaceArea=function(){return 4*Math.PI*this.radius*this.radius},this.getVolume=function(){var e=this.radius;return 4/3*Math.PI*e*e*e}},SceneJS_math_billboardMat=function(e){var t=[SceneJS_math_getColMat4(e,0),SceneJS_math_getColMat4(e,1),SceneJS_math_getColMat4(e,2)],i=[SceneJS_math_lenVec4(t[0]),SceneJS_math_lenVec4(t[1]),SceneJS_math_lenVec4(t[2])],r=SceneJS_math_mat4();SceneJS_math_rcpVec3(i,r);var n=SceneJS_math_scalingMat4v(i);SceneJS_math_mulVec4Scalar(t[0],r[0]),SceneJS_math_mulVec4Scalar(t[1],r[1]),SceneJS_math_mulVec4Scalar(t[2],r[2]);var s=SceneJS_math_identityMat4();return SceneJS_math_setRowMat4(s,0,t[0]),SceneJS_math_setRowMat4(s,1,t[1]),SceneJS_math_setRowMat4(s,2,t[2]),SceneJS_math_mulMat4(s,n)},SceneJS_math_FrustumPlane=function(e,t,i,r){var n=1/Math.sqrt(e*e+t*t+i*i);this.normal=[e*n,t*n,i*n],this.offset=r*n,this.testVertex=[0<=this.normal[0]?1:0,0<=this.normal[1]?1:0,0<=this.normal[2]?1:0]},SceneJS_math_OUTSIDE_FRUSTUM=3,SceneJS_math_INTERSECT_FRUSTUM=4,SceneJS_math_INSIDE_FRUSTUM=5,SceneJS_math_Frustum=function(e,t,f){var i=SceneJS_math_mat4();SceneJS_math_mulMat4(t,e,i);var r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],c=i[5],h=i[6],l=i[7],u=i[8],d=i[9],p=i[10],g=i[11],m=i[12],_=i[13],S=i[14],v=i[15],y=[new SceneJS_math_FrustumPlane(o-r,l-a,g-u,v-m),new SceneJS_math_FrustumPlane(o+r,l+a,g+u,v+m),new SceneJS_math_FrustumPlane(o-n,l-c,g-d,v-_),new SceneJS_math_FrustumPlane(o+n,l+c,g+d,v+_),new SceneJS_math_FrustumPlane(o-s,l-h,g-p,v-S),new SceneJS_math_FrustumPlane(o+s,l+h,g+p,v+S)],b=[SceneJS_math_getColMat4(e,0),SceneJS_math_getColMat4(e,1),SceneJS_math_getColMat4(e,2)],E=[SceneJS_math_lenVec4(b[0]),SceneJS_math_lenVec4(b[1]),SceneJS_math_lenVec4(b[2])],x=SceneJS_math_rcpVec3(E),M=SceneJS_math_scalingMat4v(E),w=SceneJS_math_scalingMat4v(x);SceneJS_math_mulVec4Scalar(b[0],x[0]),SceneJS_math_mulVec4Scalar(b[1],x[1]),SceneJS_math_mulVec4Scalar(b[2],x[2]);var C=SceneJS_math_identityMat4();SceneJS_math_setRowMat4(C,0,b[0]),SceneJS_math_setRowMat4(C,1,b[1]),SceneJS_math_setRowMat4(C,2,b[2]),this.matrix||(this.matrix=SceneJS_math_mat4()),SceneJS_math_mulMat4(t,e,this.matrix),this.billboardMatrix||(this.billboardMatrix=SceneJS_math_mat4()),SceneJS_math_mulMat4(w,SceneJS_math_mulMat4(C,M),this.billboardMatrix),this.viewport=f.slice(0,4),this.textAxisBoxIntersection=function(e){for(var t=SceneJS_math_INSIDE_FRUSTUM,i=[e.min,e.max],r=null,n=0;n<6;++n){if((r=y[n]).normal[0]*i[r.testVertex[0]][0]+r.normal[1]*i[r.testVertex[1]][1]+r.normal[2]*i[r.testVertex[2]][2]+r.offset<0)return SceneJS_math_OUTSIDE_FRUSTUM;r.normal[0]*i[1-r.testVertex[0]][0]+r.normal[1]*i[1-r.testVertex[1]][1]+r.normal[2]*i[1-r.testVertex[2]][2]+r.offset<0&&(t=SceneJS_math_INTERSECT_FRUSTUM)}return t},this.getProjectedSize=function(e){var t=SceneJS_math_mat4();SceneJS_math_subVec3(e.max,e.min,t);var i=SceneJS_math_lenVec3(t),r=Math.abs(i),n=[.5*(e.min[0]+e.max[0]),.5*(e.min[1]+e.max[1]),.5*(e.min[2]+e.max[2]),0],s=.5*r,o=[-s,0,0,1],a=[s,0,0,1];return o=SceneJS_math_mulMat4v4(this.billboardMatrix,o),o=SceneJS_math_addVec4(o,n),o=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,o)),a=SceneJS_math_mulMat4v4(this.billboardMatrix,a),a=SceneJS_math_addVec4(a,n),a=SceneJS_math_projectVec4(SceneJS_math_mulMat4v4(this.matrix,a)),f[2]*Math.abs(a[0]-o[0])},this.getProjectedState=function(e){for(var t,i,r,n=SceneJS_math_transformPoints3(this.matrix,e),s=1e7,o=1e7,a=-1e7,c=-1e7,h=n.length,l=0;l<h;++l)(i=(t=SceneJS_math_projectVec4(n[l]))[0])<-.5&&(i=-.5),(r=t[1])<-.5&&(r=-.5),.5<i&&(i=.5),.5<r&&(r=.5),i<s&&(s=i),r<o&&(o=r),a<i&&(a=i),c<r&&(c=r);s+=.5,o+=.5,a+=.5,c+=.5;var u=f[2],d=f[3];s*=u+15,o*=d+15,a*=u+15,c*=d+15;var p=SceneJS_math_mat4();return SceneJS_math_subVec2([a,c],[s,o],p),s<0&&(s=0),u<a&&(a=u),o<0&&(o=0),d<c&&(c=d),{canvasBox:{min:[s,o],max:[a,c]},canvasSize:SceneJS_math_lenVec2(p)}}},SceneJS_math_identityQuaternion=function(){return[0,0,0,1]},SceneJS_math_angleAxisQuaternion=function(e,t,i,r){var n=r/180*Math.PI/2,s=Math.sin(n);return[s*e,s*t,s*i,Math.cos(n)]},SceneJS_math_mulQuaternions=function(e,t){var i=e[0],r=e[1],n=e[2],s=e[3],o=t[0],a=t[1],c=t[2],h=t[3];return[s*o+i*h+r*c-n*a,s*a+r*h+n*o-i*c,s*c+n*h+i*a-r*o,s*h-i*o-r*a-n*c]},SceneJS_math_newMat4FromQuaternion=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],s=2*t,o=2*i,a=2*r,c=s*n,h=o*n,l=a*n,u=s*t,d=o*t,p=a*t,f=o*i,g=a*i,m=a*r,_=SceneJS_math_identityMat4();return SceneJS_math_setCellMat4(_,0,0,1-(f+m)),SceneJS_math_setCellMat4(_,0,1,d-l),SceneJS_math_setCellMat4(_,0,2,p+h),SceneJS_math_setCellMat4(_,1,0,d+l),SceneJS_math_setCellMat4(_,1,1,1-(u+m)),SceneJS_math_setCellMat4(_,1,2,g-c),SceneJS_math_setCellMat4(_,2,0,p-h),SceneJS_math_setCellMat4(_,2,1,g+c),SceneJS_math_setCellMat4(_,2,2,1-(u+f)),_},SceneJS_math_slerp=function(e,t,i){var r=.0174532925*t[3],n=.0174532925*i[3],s=r*n+t[0]*i[0]+t[1]*i[1]+t[2]*i[2];if(1<=Math.abs(s))return[t[0],t[1],t[2],t[3]];var o=Math.acos(s),a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return[.5*t[0]+.5*i[0],.5*t[1]+.5*i[1],.5*t[2]+.5*i[2],.5*t[3]+.5*i[3]];var c=Math.sin((1-e)*o)/a,h=Math.sin(e*o)/a;return[t[0]*c+i[0]*h,t[1]*c+i[1]*h,t[2]*c+i[2]*h,57.295779579*(r*c+n*h)]},SceneJS_math_normalizeQuaternion=function(e){var t=SceneJS_math_lenVec4([e[0],e[1],e[2],e[3]]);return[e[0]/t,e[1]/t,e[2]/t,e[3]/t]},SceneJS_math_conjugateQuaternion=function(e){return[-e[0],-e[1],-e[2],e[3]]},SceneJS_math_angleAxisFromQuaternion=function(e){var t=(e=SceneJS_math_normalizeQuaternion(e))[3],i=2*Math.acos(t),r=Math.sqrt(1-t*t);return r<.001?{x:e[0],y:e[1],z:e[2],angle:57.295779579*i}:{x:e[0]/r,y:e[1]/r,z:e[2]/r,angle:57.295779579*i}},SceneJS_sceneStatusModule=new function(){this.sceneStatus={};var v=new SceneJS_Map,y={},b={},i=this;SceneJS_events.addListener(SceneJS_events.SCENE_DESTROYED,function(e){var t=e.engine.id;delete i.sceneStatus[t],delete b[t]}),this.taskStarted=function(e,t){var i=!1!==SceneJS_configsModule.configs.statusPopups,r=e.getScene(),n=r.getId(),s=e.getId(),o=(r.getCanvas(),v.addItem()),a=this.sceneStatus[n];a||(a=this.sceneStatus[n]={numTasks:0}),a.numTasks++;var c,h,l,u=b[n];u||(u=b[n]={sceneId:n,nodeStates:{},scene:r,popupContainer:i?(c=document.getElementsByTagName("body")[0],h=document.createElement("div"),l=h.style,l.position="absolute",l.width="200px",l.right="10px",l.top="0",l.padding="10px",l["z-index"]="10000",c.appendChild(h),h):null,descCounts:{}});var d=u.descCounts[t];null==d&&(d=u.descCounts[t]=0),u.descCounts[t]++;var p=u.nodeStates[s];p||(p=u.nodeStates[s]={nodeId:s,numTasks:0,tasks:{}}),t=t+" "+u.descCounts[t]+"...",p.numTasks++;var f,g,m,_,S={sceneState:u,nodeState:p,description:t,element:i?(f=u.popupContainer,g=t,m=document.createElement("div"),_=m.style,_["font-family"]="Helvetica",_["font-size"]="14px",_.padding="5px",_.margin="4px",_["padding-left"]="12px",_.border="1px solid #000055",_.color="black",_.background="#AAAAAA",_.opacity="0.8",_["border-radius"]="3px",_["-moz-border-radius"]="3px",_["box-shadow"]="3px 3px 3px #444444",m.innerHTML=g,f.appendChild(m),m):null};return p.tasks[o]=S,y[o]=S,o},this.taskFinished=function(e){if(-1==e||null==e)return null;var t=y[e];if(!t)return null;var i=t.sceneState;this.sceneStatus[i.sceneId].numTasks--,t.element&&function(e){e.style.background="#AAFFAA";var t=.8,i=setInterval(function(){t<=0?(e.parentNode.removeChild(e),clearInterval(i)):(e.style.opacity=t,t-=.1)},100)}(t.element);var r=t.nodeState;return--r.numTasks<0&&(r.numTasks=0),delete r.tasks[e],0==r.numTasks&&delete i.nodeStates[r.nodeId],null},this.taskFailed=function(e){if(-1==e||null==e)return null;var t=y[e];if(!t)return null;var i=!!SceneJS_configsModule.configs.statusPopups,r=t.sceneState;this.sceneStatus[r.sceneId].numTasks--,i&&(t.element.style.background="#FFAAAA");var n=t.nodeState;return n.numTasks--,delete n.tasks[e],0==n.numTasks&&delete t.sceneState.nodeStates[n.nodeId],null}};SceneJS._webgl={},SceneJS._webgl.ArrayBuffer=function(i,r,e,t,n,s){this.gl=i,this.type=r,this.itemSize=n,this._allocate=function(e,t){this.handle=i.createBuffer(),this.handle.numItems=t,this.handle.itemSize=n,i.bindBuffer(r,this.handle),i.bufferData(r,e,s),this.handle.numItems=t,i.bindBuffer(r,null),this.numItems=t,this.length=e.length},this._allocate(e,t),this.setData=function(e,t){e.length>this.length?(this.destroy(),this._allocate(e,e.length)):t||0===t?i.bufferSubData(r,t,e):i.bufferData(r,e)},this.unbind=function(){i.bindBuffer(r,null)},this.destroy=function(){i.deleteBuffer(this.handle)}},SceneJS._webgl.ArrayBuffer.prototype.bind=function(){this.gl.bindBuffer(this.type,this.handle)},SceneJS._webgl.Attribute=function(t,e,i,r,n,s){this.gl=t,this.location=s,this.bindFloatArrayBuffer=function(e){e&&(e.bind(),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,e.itemSize,t.FLOAT,!1,0,0))}},SceneJS._webgl.Attribute.prototype.bindInterleavedFloatArrayBuffer=function(e,t,i){this.gl.enableVertexAttribArray(this.location),this.gl.vertexAttribPointer(this.location,e,this.gl.FLOAT,!1,t,i)},SceneJS._webgl.enumMap={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipMapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipMapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipMapLinear:"NEAREST_MIPMAP_LINEAR",linearMipMapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"},SceneJS._webgl.RenderBuffer=function(e){var n,s=e.canvas,o=s.gl,a=!1;this.webglRestored=function(e){o=e,n=null},this.bind=function(){this._touch(),a||(o.bindFramebuffer(o.FRAMEBUFFER,n.framebuf),a=!0)},this._touch=function(){var t=s.canvas.width,i=s.canvas.height;if(n){if(n.width==t&&n.height==i)return;o.deleteTexture(n.texture),o.deleteFramebuffer(n.framebuf),o.deleteRenderbuffer(n.renderbuf)}n={framebuf:o.createFramebuffer(),renderbuf:o.createRenderbuffer(),texture:o.createTexture(),width:t,height:i},o.bindFramebuffer(o.FRAMEBUFFER,n.framebuf),o.bindTexture(o.TEXTURE_2D,n.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);try{o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,i,0,o.RGBA,o.UNSIGNED_BYTE,null)}catch(e){var r=new WebGLUnsignedByteArray(t*i*3);o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,i,0,o.RGBA,o.UNSIGNED_BYTE,r)}if(o.bindRenderbuffer(o.RENDERBUFFER,n.renderbuf),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,t,i),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n.texture,0),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,n.renderbuf),o.bindTexture(o.TEXTURE_2D,null),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,n.framebuf),!o.isFramebuffer(n.framebuf))throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Invalid framebuffer");var e=o.checkFramebufferStatus(o.FRAMEBUFFER);switch(e){case o.FRAMEBUFFER_COMPLETE:break;case o.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");case o.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");case o.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");case o.FRAMEBUFFER_UNSUPPORTED:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");default:throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Incomplete framebuffer: "+e)}a=!1},this.clear=function(){if(!a)throw"Render buffer not bound";o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.disable(o.BLEND)},this.read=function(e,t){var i=e,r=s.canvas.height-t,n=new Uint8Array(4);return o.readPixels(i,r,1,1,o.RGBA,o.UNSIGNED_BYTE,n),n},this.unbind=function(){o.bindFramebuffer(o.FRAMEBUFFER,null),a=!1},this.getTexture=function(){return{bind:function(e){return!(!n||!n.texture)&&(o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,n.texture),!0)},unbind:function(e){n&&n.texture&&(o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null))}}}},SceneJS._webgl.Program=function(t,e,i){var r,n,s,o,a,c;for(this._uniforms={},this._samplers={},this._attributes={},this.materialSettings={specularColor:[0,0,0],specular:0,shine:0,emit:0,alpha:0},this._shaders=[],n=0;n<e.length;n++)this._shaders.push(new SceneJS._webgl.Shader(t,t.VERTEX_SHADER,e[n]));for(n=0;n<i.length;n++)this._shaders.push(new SceneJS._webgl.Shader(t,t.FRAGMENT_SHADER,i[n]));var h=t.createProgram();for(n=0;n<this._shaders.length;n++)(c=this._shaders[n]).valid&&t.attachShader(h,c.handle);t.linkProgram(h);SceneJS_configsModule.getConfigs("shading");var l=t.getProgramParameter(h,t.ACTIVE_UNIFORMS);this.uniformValues=[];var u=0;for(n=0;n<l;++n)(s=t.getActiveUniform(h,n))&&("\0"==(o=s.name)[o.length-1]&&(o=o.substr(0,o.length-1)),a=t.getUniformLocation(h,o),s.type==t.SAMPLER_2D||s.type==t.SAMPLER_CUBE||35682==s.type?this._samplers[o]=new SceneJS._webgl.Sampler(t,h,o,s.type,s.size,a):(this._uniforms[o]=new SceneJS._webgl.Uniform(t,h,o,s.type,s.size,a,u),this.uniformValues[u]=null,++u));var d=t.getProgramParameter(h,t.ACTIVE_ATTRIBUTES);for(n=0;n<d;n++)(r=t.getActiveAttrib(h,n))&&(a=t.getAttribLocation(h,r.name),this._attributes[r.name]=new SceneJS._webgl.Attribute(t,h,r.name,r.type,r.size,a));this.setProfile=function(e){this._profile=e},this.bind=function(){t.useProgram(h),this._profile&&this._profile.program++},this.getUniformLocation=function(e){var t=this._uniforms[e];if(t)return t.getLocation()},this.getUniform=function(e){var t=this._uniforms[e];if(t)return t},this.getAttribute=function(e){var t=this._attributes[e];if(t)return t},this.bindFloatArrayBuffer=function(e,t){var i=this._attributes[e];i&&(i.bindFloatArrayBuffer(t),this._profile&&this._profile.varying++)},this.bindTexture=function(e,t,i){var r=this._samplers[e];return!!r&&(this._profile&&this._profile.texture++,r.bindTexture(t,i))},this.destroy=function(){if(this.valid){for(var e in t.deleteProgram(h),this._shaders)t.deleteShader(this._shaders[e].handle);this._attributes=null,this._uniforms=null,this._samplers=null,this.valid=!1}}},SceneJS._webgl.Program.prototype.setUniform=function(e,t){var i=this._uniforms[e];i&&(this.uniformValues[i.index]===t&&i.numberValue||(i.setValue(t),this._profile&&this._profile.uniform++,this.uniformValues[i.index]=t))},SceneJS._webgl.Sampler=function(i,e,t,r,n,s){this.bindTexture=function(e,t){return!!e.bind(t)&&(i.uniform1i(s,t),!0)}},SceneJS._webgl.Shader=function(e,t,i){if(this.handle=e.createShader(t),e.shaderSource(this.handle,i),e.compileShader(this.handle),this.valid=0!=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.valid&&!e.isContextLost()){SceneJS.log.error("Shader program failed to compile: "+e.getShaderInfoLog(this.handle)),SceneJS.log.error("Shader source:");for(var r=i.split("\n"),n=0;n<r.length;n++)SceneJS.log.error(r[n]);throw SceneJS_error.fatalError(SceneJS.errors.SHADER_COMPILATION_FAILURE,"Shader program failed to compile")}},SceneJS._webgl.Texture2D=function(t,e){this.target=e.target||t.TEXTURE_2D,this.minFilter=e.minFilter,this.magFilter=e.magFilter,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.update=e.update,this.texture=e.texture,this.format=t.RGBA,this.isDepth=!1,this.depthMode=0,this.depthCompareMode=0,this.depthCompareFunc=0;try{t.bindTexture(this.target,this.texture),e.minFilter&&t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,e.minFilter),e.magFilter&&t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,e.magFilter),e.wrapS&&t.texParameteri(this.target,t.TEXTURE_WRAP_S,e.wrapS),e.wrapT&&t.texParameteri(this.target,t.TEXTURE_WRAP_T,e.wrapT),e.minFilter!=t.NEAREST_MIPMAP_NEAREST&&e.minFilter!=t.LINEAR_MIPMAP_NEAREST&&e.minFilter!=t.NEAREST_MIPMAP_LINEAR&&e.minFilter!=t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target),t.bindTexture(this.target,null)}catch(e){throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to create texture: "+e.message||e)}this.bind=function(e){return!!this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),this.update&&this.update(t),!0)},this.unbind=function(e){this.texture&&(t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null))},this.destroy=function(){this.texture&&(t.deleteTexture(this.texture),this.texture=null)}},SceneJS._webgl.ensureImageSizePowerOfTwo=function(e){if(!SceneJS._webgl.isPowerOfTwo(e.width)||!SceneJS._webgl.isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=SceneJS._webgl.nextHighestPowerOfTwo(e.width),t.height=SceneJS._webgl.nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e},SceneJS._webgl.isPowerOfTwo=function(e){return 0==(e&e-1)},SceneJS._webgl.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},SceneJS._webgl.Uniform=function(t,e,i,r,n,s,o,a){var c=null;if(this.numberValue=!1,r==t.BOOL)this.numberValue=!0,c=function(e){t.uniform1i(s,e)};else if(r==t.BOOL_VEC2)c=function(e){t.uniform2iv(s,e)};else if(r==t.BOOL_VEC3)c=function(e){t.uniform3iv(s,e)};else if(r==t.BOOL_VEC4)c=function(e){t.uniform4iv(s,e)};else if(r==t.INT)this.numberValue=!0,c=function(e){t.uniform1iv(s,e)};else if(r==t.INT_VEC2)c=function(e){t.uniform2iv(s,e)};else if(r==t.INT_VEC3)c=function(e){t.uniform3iv(s,e)};else if(r==t.INT_VEC4)c=function(e){t.uniform4iv(s,e)};else if(r==t.FLOAT)this.numberValue=!0,c=function(e){t.uniform1f(s,e)};else if(r==t.FLOAT_VEC2)c=function(e){t.uniform2fv(s,e)};else if(r==t.FLOAT_VEC3)c=function(e){t.uniform3fv(s,e)};else if(r==t.FLOAT_VEC4)c=function(e){t.uniform4fv(s,e)};else if(r==t.FLOAT_MAT2)c=function(e){t.uniformMatrix2fv(s,t.FALSE,e)};else if(r==t.FLOAT_MAT3)c=function(e){t.uniformMatrix3fv(s,t.FALSE,e)};else{if(r!=t.FLOAT_MAT4)throw"Unsupported shader uniform type: "+r;c=function(e){t.uniformMatrix4fv(s,t.FALSE,e)}}this.setValue=c,this.getValue=function(){return t.getUniform(e,s)},this.getLocation=function(){return s},this.index=o};var SceneJS_nodeEventsModule=new function(){var c,h=[],l=[],u=0,i={type:"listeners",stateId:SceneJS._baseStateId++,empty:!0,listeners:[]};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(){c=!(u=0)}),SceneJS_events.addListener(SceneJS_events.OBJECT_COMPILING,function(e){if(c){if(0<u){var t={type:"listeners",stateId:h[u-1],listeners:l.slice(0,u)};e.display.renderListeners=t}else e.display.renderListeners=i;c=!1}}),this.preVisitNode=function(t){var i=t._topicSubs.rendered,r=t._topicSubs.worldPos,n=t._topicSubs.viewPos,s=t._topicSubs.cameraPos,o=t._topicSubs.projPos,a=t._topicSubs.canvasPos;(i||r||n||s||o||a)&&(h[u]=t.id,l[u]=function(e){i&&t.publish("rendered",e,!0),r&&t.publish("worldPos",e.getWorldPos()),n&&t.publish("viewPos",e.getViewPos()),s&&t.publish("cameraPos",e.getCameraPos()),o&&t.publish("projPos",e.getProjPos()),a&&t.publish("canvasPos",e.getCanvasPos())},u++,c=!0)},this.postVisitNode=function(e){e.id==h[u-1]&&(u--,c=!0)}},SceneJS_Core=function(e){this.type=e,this.coreId=null,this.stateId=null,this.useCount=0},SceneJS_CoreFactory=function(){this._stateMap=new SceneJS_Map(null,SceneJS._baseStateId),this._cores={}};SceneJS_CoreFactory.coreTypes={},SceneJS_CoreFactory.createCoreType=function(e,t){},SceneJS_CoreFactory.addCoreBuilder=function(e,t){},SceneJS_CoreFactory.coreAliases={rotate:"xform",translate:"xform",scale:"xform",matrix:"xform",xform:"xform"},SceneJS_CoreFactory.prototype.getCore=function(e,t){var i=SceneJS_CoreFactory.coreAliases[e];i&&(e=i);var r,n=this._cores[e];return n||(n=this._cores[e]={}),t&&(r=n[t])?(r.useCount++,r):((r=new SceneJS_Core(e)).useCount=1,r.stateId=this._stateMap.addItem(r),r.coreId=null!=t&&null!=t?t:r.stateId,n[r.coreId]=r)},SceneJS_CoreFactory.prototype.hasCore=function(e,t){var i=SceneJS_CoreFactory.coreAliases[e];i&&(e=i);var r=this._cores[e];return r&&r[t]},SceneJS_CoreFactory.prototype.putCore=function(e){0!=e.useCount&&(--e.useCount<=0&&(this._cores[e.type][e.coreId]=null,this._stateMap.removeItem(e.stateId)))},SceneJS_CoreFactory.prototype.webglRestored=function(){var e,t;for(var i in this._cores)if(this._cores.hasOwnProperty(i)&&(e=this._cores[i]))for(var r in e)e.hasOwnProperty(r)&&(t=e[r]).webglRestored&&t.webglRestored()},SceneJS.Node=function(){},SceneJS.Node.prototype.constructor=SceneJS.Node,SceneJS.Node.prototype._construct=function(e,t,i,r){this._engine=e,this._core=t,this.coreId=t.coreId,this.id=i.id||i.nodeId||r,this.type=i.type||"node",this.data=i.data,this.parent=null,this.nodes=[],this._handleMap=new SceneJS_Map,this._topicSubs={},this._handleTopics={},this._topicPubs={},this._listeners={},this._numListeners=0,this.dirty=!1,this.branchDirty=!1,this._init&&this._init(i)},SceneJS.Node.prototype.taskStarted=function(e){return SceneJS_sceneStatusModule.taskStarted(this,e||"Task")},SceneJS.Node.prototype.taskFinished=function(e){return SceneJS_sceneStatusModule.taskFinished(e)},SceneJS.Node.prototype.taskFailed=function(e){return SceneJS_sceneStatusModule.taskFailed(e)},SceneJS.Node.prototype.log=function(){var e,t;switch(1==arguments.length?(e="info",t=arguments[0]):2==arguments.length&&(e=arguments[0],t=arguments[1]),e){case"warn":t="WARN;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;case"error":t="ERROR; [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t;break;default:t="INFO;  [SceneJS.Node type="+this.type+", id="+this.id+"] : "+t}console[e]?console[e](t):console.log(t)},SceneJS.Node.prototype.publish=function(e,t,i){if(i||(this._topicPubs[e]=t),this._topicSubs[e]){var r=this._topicSubs[e];for(var n in r)r.hasOwnProperty(n)&&r[n].call(this,t)}},SceneJS.Node.prototype.unpublish=function(e){var t=this._topicSubs[e];if(t)for(var i in t)t.hasOwnProperty(i)&&t[i].call(this,null);delete this._topicPubs[e]},SceneJS.Node.prototype.on=function(e,t){var i=this._topicSubs[e];i||(i={},this._topicSubs[e]=i);var r=this._handleMap.addItem();i[r]=t,this._handleTopics[r]=e;var n=this._topicPubs[e];return n&&t.call(this,n),"rendered"==e&&this._engine.branchDirty(this),r},SceneJS.Node.prototype.off=function(e){var t=this._handleTopics[e];if(t){delete this._handleTopics[e];var i=this._topicSubs[t];i&&delete i[e],this._handleMap.removeItem(e),"rendered"==t&&this._engine.branchDirty(this)}},SceneJS.Node.prototype.once=function(e,t){var i=this,r=this.on(e,function(e){i.off(r),t(e)})},SceneJS.Node.prototype.getScene=function(){return this._engine.scene},SceneJS.Node.prototype.getCoreId=function(){return this._core.coreId},SceneJS.Node.prototype.getID=function(){return this.id},SceneJS.Node.prototype.getId=function(){return this.id},SceneJS.Node.prototype.getNodeId=function(){return this.id},SceneJS.Node.prototype.getType=function(){return this.type},SceneJS.Node.prototype.getData=function(){return this.data},SceneJS.Node.prototype.setData=function(e){return this.data=e,this},SceneJS.Node.prototype.getNumNodes=function(){return this.nodes.length},SceneJS.Node.prototype.getNodes=function(){return this.nodes.slice(0)},SceneJS.Node.prototype.getNodeAt=function(e){return e<0||e>=this.nodes.length?null:this.nodes[e]},SceneJS.Node.prototype.getFirstNode=function(){return 0==this.nodes.length?null:this.nodes[0]},SceneJS.Node.prototype.getLastNode=function(){return 0==this.nodes.length?null:this.nodes[this.nodes.length-1]},SceneJS.Node.prototype.getNode=function(e){for(var t=0;t<this.nodes.length;t++)if(this.nodes[t].id==e)return this.nodes[t];return null},SceneJS.Node.prototype.disconnectNodeAt=function(e){var t=this.nodes.splice(e,1);return 0<t.length?(t[0].parent=null,this._engine.display.objectListDirty=!0,t[0]):null},SceneJS.Node.prototype.disconnect=function(){if(this.parent){for(var e=0;e<this.parent.nodes.length;e++)if(this.parent.nodes[e]===this){var t=this.parent.disconnectNodeAt(e);return this.parent=null,t}this.parent=null}return null},SceneJS.Node.prototype.removeNodeAt=function(e){var t=this.disconnectNodeAt(e);t&&(t.destroy(),this._engine.display.objectListDirty=!0)},SceneJS.Node.prototype.removeNode=function(e){if(!e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#removeNode - node argument undefined");if(!e._compile&&"string"==typeof e){var t=this._engine.findNode(e);if(!t)throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - node not found anywhere: '"+e+"'");e=t}if(e._compile)for(var i=0;i<this.nodes.length;i++)if(this.nodes[i]===e){var r=this.removeNodeAt(i);return this._engine.display.objectListDirty=!0,r}throw SceneJS_error.fatalError(SceneJS.errors.NODE_NOT_FOUND,"Node#removeNode - child node not found: "+(e._compile?": "+e.id:e))},SceneJS.Node.prototype.disconnectNodes=function(){for(var e=this.nodes.length,t=0;t<e;t++)this.nodes[t].parent=null;var i=this.nodes;return this.nodes=[],this._engine.display.objectListDirty=!0,i},SceneJS.Node.prototype.removeNodes=function(){for(var e=this.disconnectNodes(),t=0;t<e.length;t++)e[t].destroy(),this._engine.display.objectListDirty=!0},SceneJS.Node.prototype.splice=function(){var e,t;if(null==this.parent)return null;var i=this.parent,r=this.disconnectNodes();for(e=0,t=r.length;e<t;e++)r[e].parent=this.parent;for(e=0,t=i.nodes.length;e<t;e++)if(i.nodes[e]===this)return i.nodes.splice.apply(i.nodes,[e,1].concat(r)),this.nodes=[],this.parent=null,this.destroy(),this._engine.branchDirty(i),i},SceneJS.Node.prototype.addNodes=function(i,r){if(!i)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNodes - nodes argument is undefined");for(var e,n=[],s=i.length,o=i.length-1;0<=o;o--){var a=i[o];if("node"==a.type||this._engine.hasNodeType(a.type)){if(e=this.addNode(a),n[o]=e,0==--s)return r&&r(i),i}else{var c=this;!function(){var t=o;c.addNode(a,function(e){n[t]=e,0==--s&&r&&r(i)})}()}}return null},SceneJS.Node.prototype.addNode=function(e,t){if((e=e||{})._compile){if(null!=e.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(e),(e.parent=this)._engine.branchDirty(e),t&&t(e),e}if("string"==typeof e){var i=this._engine.findNode(e);if(!i)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node not found: '"+e+"'");if(null!=(e=i).parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Node#addNode - node argument is still attached to another parent");return this.nodes.push(e),(e.parent=this)._engine.branchDirty(e),t&&t(e),e}if(e.type=e.type||"node","node"==e.type||this._engine.hasNodeType(e.type))return e=this._engine.createNode(e),this.nodes.push(e),(e.parent=this)._engine.branchDirty(e),t&&t(e),e;var r=this;return this._engine.createNode(e,function(e){r.nodes.push(e),(e.parent=r)._engine.branchDirty(e),t&&t(e)}),null},SceneJS.Node.prototype.insertNode=function(e,t){if(!e)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is undefined");if(e._compile||(e=this._engine.createNode(e)),!e._compile)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is not a SceneJS.Node");if(null!=e.parent)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node argument is still attached to another parent");if(null==t)e.addNodes(this.disconnectNodes()),this.addNode(e);else{if(t<0)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Node#insertNode - node index out of range: -1");t>=this.nodes.length?this.nodes.push(e):this.nodes.splice(t,0,e)}return e.parent=this,e},SceneJS.Node.prototype.mapNodes=function(e){if(e(this))return this;for(var t,i=0;i<this.nodes.length;i++)if(t=this.nodes[i].mapNodes(e))return t;return null},SceneJS.Node.prototype.addListener=function(e,t,i){var r=this._listeners[e];return r||(r=[],this._listeners[e]=r),r.push({eventName:e,fn:t,options:i||{}}),this._numListeners++,this},SceneJS.Node.prototype._fireEvent=function(e,t,i){var r=this._listeners[e];if(r){t||(t={});for(var n,s={name:e,params:t,options:i||{}},o=0,a=r.length;o<a;o++)(n=r[o]).options.scope?n.fn.call(n.options.scope,s):n.fn.call(this,s)}},SceneJS.Node.prototype.removeListener=function(e,t){var i=this._listeners[e];if(!i)return null;for(var r=0;r<i.length;r++)if(i[r].fn==t)return i.splice(r,1),t;return this._numListeners--,null},SceneJS.Node.prototype.hasListener=function(e){return this._listeners[e]},SceneJS.Node.prototype.hasListeners=function(){return 0<this._numListeners},SceneJS.Node.prototype.removeListeners=function(){return this._listeners={},this._numListeners=0,this},SceneJS.Node.prototype.getParent=function(e){return this.parent},SceneJS.Node.prototype.getParentOfType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.eachParent=function(e){if(!e)throw"SceneJS.Node.eachParent param 'fn' is null or undefined";for(var t=0,i=this;i.parent;){if(!0===e.call(i.parent,t++))return i.parent;i=i.parent}return null},SceneJS.Node.prototype.hasNode=function(e){if(null==e)throw"SceneJS.Node.hasNode param 'node' is null or undefined";var t,i=typeof e;if("number"==i)t=this.getNodeAt(e);else{if("string"!=i)throw"SceneJS.Node.hasNode param 'node' should be either an index number or an ID string";t=this.getNode(e)}return null!=t&&null!=t},SceneJS.Node.prototype.node=function(e){if(null==e)throw"SceneJS.Node.node param 'node' is null or undefined";var t,i=typeof e;if("number"==i)t=this.getNodeAt(e);else{if("string"!=i)throw"SceneJS.Node.node param 'node' should be either an index number or an ID string";t=this.getNode(e)}if(!t)throw"SceneJS.Node.node - node not found: '"+e+"'";return t},SceneJS.Node.prototype.eachNode=function(e,t){if(!e)throw"SceneJS.Node.eachNode param 'fn' is null or undefined";if("function"!=typeof e)throw"SceneJS.Node.eachNode param 'fn' should be a function";var i,r=0;return(t=t||{}).andSelf&&!0===e.call(this,r++)?this:(t.depthFirst||t.breadthFirst?t.depthFirst&&(i=this._iterateEachNodeDepthFirst(e,this,r,!1)):i=this._iterateEachNode(e,this,r),i||void 0)},SceneJS.Node.prototype.numNodes=function(){return this.nodes.length},SceneJS.Node.prototype._iterateEachNode=function(e,t,i){for(var r,n=t.nodes.length,s=0;s<n;s++)if(r=t.nodes[s],!0===e.call(r,i++))return r;return null},SceneJS.Node.prototype._iterateEachNodeDepthFirst=function(e,t,i,r){if(r&&!0===e.call(t,i++))return t;r=!0;for(var n,s=t.nodes.length,o=0;o<s;o++)if(n=this._iterateEachNodeDepthFirst(e,t.nodes[o],i,r))return n;return null},SceneJS.Node.prototype.findNodesByType=function(e,t){return this._findNodesByType(e,[],t)},SceneJS.Node.prototype._findNodesByType=function(e,t,i){var r;for(r=0;r<this.nodes;r++){var n=this.nodes[r];n.type==e&&t.add(n)}if(i)for(r=0;r<this.nodes;r++)this.nodes[r]._findNodesByType(e,t,i);return t},SceneJS.Node.prototype.findParentByType=function(e){for(var t=this.parent;t&&t.type!=e;)t=t.parent;return t},SceneJS.Node.prototype.set=function(e,t){if("object"!=typeof e){if(this._set){var i=this._set[e];if(i)return i.call(this,t)}return this._createAccessor("set",e,t)}for(var r in e)e.hasOwnProperty(r)&&this.set(r,e[r])},SceneJS.Node.prototype.get=function(e){if(this._get){var t=this._get[e];if(t)return t.call(this)}return this._createAccessor("get",e)},SceneJS.Node.prototype.add=function(e,t){if("object"!=typeof e){if(this._add){var i=this._add[e];if(i)return i.call(this,t)}return this._createAccessor("add",e,t)}for(var r in e)e.hasOwnProperty(r)&&this.add(r,e[r])},SceneJS.Node.prototype.inc=function(e,t){if("object"!=typeof e){if(this._inc){var i=this._inc[e];if(i)return i.call(this,t)}return this._createAccessor("inc",e,t)}for(var r in e)e.hasOwnProperty(r)&&this.inc(r,e[r])},SceneJS.Node.prototype.insert=function(e,t){if("object"!=typeof e){if(this._set){var i=this._set[e];if(i)return i.call(this,t)}return this._createAccessor("insert",e,t)}for(var r in e)e.hasOwnProperty(r)&&this.insert(r,e[r])},SceneJS.Node.prototype.remove=function(e,t){if("object"!=typeof e){if(this._remove){var i=this._remove[e];if(i)return i.call(this,t)}return this._createAccessor("remove",e,t)}for(var r in e)e.hasOwnProperty(r)&&this.remove(r,e[r])},SceneJS.Node.prototype._createAccessor=function(e,t,i){var r=e+t.substr(0,1).toUpperCase()+t.substr(1),n=this[r];if(!n)throw"Method not found on node: '"+r+"'";var s,o=this.__proto__;switch(e){case"set":s=o._set||(o._set={});break;case"get":s=o._get||(o._get={});break;case"inc":s=o._inc||(o._inc={});break;case"add":s=o._add||(o._add={});break;case"insert":s=o._insert||(o._insert={});break;case"remove":s=o._remove||(o._remove={})}return(s[t]=n).call(this,i)},SceneJS.Node.prototype.bind=function(e,t){if(!e)throw"SceneJS.Node.bind param 'name' null or undefined";if("string"!=typeof e)throw"SceneJS.Node.bind param 'name' should be a string";if(!t)throw"SceneJS.Node.bind param 'handler' null or undefined";if("function"!=typeof t)throw"SceneJS.Node.bind param 'handler' should be a function";return this.addListener(e,t,{scope:this}),this._engine.branchDirty(this),t},SceneJS.Node.prototype.getJSON=function(){return this},SceneJS.Node.prototype._compile=function(e){this.preCompile&&this.preCompile(),this._compileNodes(e),this.postCompile&&this.postCompile()},SceneJS.Node.prototype._compileNodes=function(e){var t,i=this._topicSubs.rendered;i&&SceneJS_nodeEventsModule.preVisitNode(this);for(var r=0,n=this.nodes.length;r<n;r++)(t=this.nodes[r]).branchDirty=t.branchDirty||this.branchDirty,(t.dirty||t.branchDirty||this._engine.sceneDirty)&&(t._compile(e),t.dirty=!1,t.branchDirty=!1);i&&SceneJS_nodeEventsModule.postVisitNode(this)},SceneJS.Node.prototype.destroy=function(){if(!this.destroyed){if(this.parent)for(var e=0;e<this.nodes.length;e++)if(this.parent.nodes[e].id===this.id){this.parent.nodes.splice(e,1);break}this._engine.scene.unpublish("nodes/"+this.id),this._destroyTree(),this._engine.display.objectListDirty=!0}return this},SceneJS.Node.prototype._destroyTree=function(){this.destroyed=!0,this._engine.destroyNode(this);for(var e=0,t=this.nodes.length;e<t;e++)this.nodes[e]._destroyTree()},SceneJS.Node.prototype._doDestroy=function(){return this._destroy&&this._destroy(),this},SceneJS_PubSubProxy=function(e,t){this.scene=e,this.proxy=t};var SceneJS_NodeFactory=function(){this.nodes=new SceneJS_Map({})};SceneJS_NodeFactory.nodeTypes={},SceneJS_NodeFactory._subs={},SceneJS_NodeFactory.createNodeType=function(e,t,i){if(SceneJS_NodeFactory.nodeTypes[e])throw"Node type already defined: "+e;var r=function(){SceneJS.Node.apply(this,arguments),this.type=e};(r.prototype=new SceneJS.Node).constructor=r,SceneJS_NodeFactory.nodeTypes[e]=r;var n=SceneJS_NodeFactory.nodeTypes[e];if(!n)throw"Node type plugin did not install itself correctly";i&&i(r);var s=SceneJS_NodeFactory._subs[e];if(s){for(;0<s.length;)s.pop()(n);delete s[e]}return r},SceneJS_NodeFactory.prototype.getNode=function(t,i,r,n){var e;if(i.type=i.type||"node",e="node"==i.type?SceneJS.Node:SceneJS_NodeFactory.nodeTypes[i.type])return this._createNode(e,t,i,r,n);var s=this;this._getType(t,i.type,function(e){s._createNode(e,t,i,r,n)})},SceneJS_NodeFactory.prototype._createNode=function(e,t,i,r,n){var s=new e,o=i.id||i.nodeId;return o?this.nodes.addItem(o,s):o=this.nodes.addItem(s),s._construct(t,r,i,o),n&&n(s),s},SceneJS_NodeFactory.prototype._getType=function(e,t,i){var r=SceneJS_NodeFactory.nodeTypes[t];if(r)i(r);else{var n=SceneJS_NodeFactory._subs[t]||(SceneJS_NodeFactory._subs[t]=[]);if(n.push(i),!(1<n.length)){var s=SceneJS_sceneStatusModule.taskStarted(e.scene,"Loading plugin");n.push(function(){SceneJS_sceneStatusModule.taskFinished(s)});var o=SceneJS_configsModule.configs.pluginPath;if(!o)throw"no typePath config";this._loadScript(o+"/node/"+t+".js",function(){SceneJS_sceneStatusModule.taskFailed(s)})}}},SceneJS_NodeFactory.prototype._loadScript=function(e,t){var i=document.createElement("script");i.type="text/javascript",i.src=e,i.onerror=t,document.getElementsByTagName("head")[0].appendChild(i)},SceneJS_NodeFactory.prototype.putNode=function(e){this.nodes.removeItem(e.id)},function(){var e=SceneJS_math_perspectiveMatrix4(45,1,.1,1e4),t=new Float32Array(e),i={type:"camera",stateId:SceneJS._baseStateId++,matrix:e,mat:t,optics:{type:"perspective",fovy:45,aspect:1,near:.1,far:1e4}},r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.projTransform=i,n=0}),SceneJS.Camera=SceneJS_NodeFactory.createNodeType("camera"),SceneJS.Camera.prototype._init=function(e){1==this._core.useCount&&this.setOptics(e.optics)},SceneJS.Camera.getDefaultMatrix=function(){return t},SceneJS.Camera.prototype.setOptics=function(e){var t=this._core;if(e){var i=e.type||t.optics.type;if("ortho"==i)t.optics=SceneJS._applyIf(SceneJS_math_ORTHO_OBJ,{type:i,left:e.left,bottom:e.bottom,near:e.near,right:e.right,top:e.top,far:e.far});else if("frustum"==i)t.optics={type:i,left:e.left||-1,bottom:e.bottom||-1,near:e.near||.1,right:e.right||1,top:e.top||1,far:e.far||1e4};else{if("perspective"!=i)throw e.type?SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Camera configuration invalid: optics type not supported - supported types are 'perspective', 'frustum' and 'ortho'"):SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Camera configuration invalid: optics type not specified - supported types are 'perspective', 'frustum' and 'ortho'");t.optics={type:i,fovy:e.fovy||60,aspect:null==e.aspect?1:e.aspect,near:e.near||.1,far:e.far||1e4}}}else t.optics={type:"perspective",fovy:60,aspect:1,near:.1,far:1e4};this._rebuild(),this._engine.display.imageDirty=!0},SceneJS.Camera.prototype._rebuild=function(){var e=this._core.optics;"ortho"==e.type?this._core.matrix=SceneJS_math_orthoMat4c(e.left,e.right,e.bottom,e.top,e.near,e.far):"frustum"==e.type?this._core.matrix=SceneJS_math_frustumMatrix4(e.left,e.right,e.bottom,e.top,e.near,e.far):"perspective"==e.type&&(this._core.matrix=SceneJS_math_perspectiveMatrix4(e.fovy*Math.PI/180,e.aspect,e.near,e.far)),this._core.mat?this._core.mat.set(this._core.matrix):this._core.mat=new Float32Array(this._core.matrix),this.publish("matrix",this._core.matrix)},SceneJS.Camera.prototype.getOptics=function(){var e={};for(var t in this._core.optics)this._core.optics.hasOwnProperty(t)&&(e[t]=this._core.optics[t]);return e},SceneJS.Camera.prototype.getMatrix=function(){return this._core.matrix.slice(0)},SceneJS.Camera.prototype._compile=function(e){this._engine.display.projTransform=r[n++]=this._core,this._compileNodes(e),this._engine.display.projTransform=0<--n?r[n-1]:i},SceneJS.Camera.prototype._destroy=function(){this.getScene().off(this._tick)}}(),function(){var t={type:"clips",stateId:SceneJS._baseStateId++,empty:!0,hash:"",clips:[]},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.clips=t,r=0}),SceneJS.Clips=SceneJS_NodeFactory.createNodeType("clips"),SceneJS.Clips.prototype._init=function(e){if(1==this._core.useCount){var t=e.clips;if(!t)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"clips node attribute missing : 'clips'");this._core.clips=this._core.clips||[];for(var i=0,r=t.length;i<r;i++)this._setClip(i,t[i])}},SceneJS.Clips.prototype.setClips=function(e){var t;for(var i in e)if(e.hasOwnProperty(i)&&(null!=i||null!=i)){if((t=parseInt(i))<0||t>=this._core.clips.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid argument to set 'clips': index out of range ("+this._core.clips.length+" clips defined)");this._setClip(t,e[i]||{})}this._engine.display.imageDirty=!0},SceneJS.Clips.prototype._setClip=function(e,t){var i=this._core.clips[e]||(this._core.clips[e]={});i.normalAndDist=[t.x||0,t.y||0,t.z||0,t.dist||0];var r=t.mode||i.mode||"disabled";if("inside"!=r&&"outside"!=r&&"disabled"!=r)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"clips node invalid value for property 'mode': should be 'inside' or 'outside' or 'disabled'");i.mode=r,this._core.hash=null},SceneJS.Clips.prototype._compile=function(e){this._core.hash||(this._core.hash=this._core.clips.length),this._engine.display.clips=i[r++]=this._core,this._compileNodes(e),this._engine.display.clips=0<--r?i[r-1]:t}}(),function(){var t={stateId:SceneJS._baseStateId++,type:"enable",enabled:!0},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.enable=t,r=0}),SceneJS.Enable=SceneJS_NodeFactory.createNodeType("enable"),SceneJS.Enable.prototype._init=function(e){1==this._core.useCount&&(this._core.enabled=!0,null!=e.enabled&&this.setEnabled(e.enabled))},SceneJS.Enable.prototype.setEnabled=function(e){return e!==this._core.enabled&&(this._core.enabled=e,this._engine.display.drawListDirty=!0,this.publish("enabled",e)),this},SceneJS.Enable.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Enable.prototype._compile=function(e){this._engine.display.enable=i[r++]=this._core,this._compileNodes(e),this._engine.display.enable=0<--r?i[r-1]:t}}(),function(){var t={stateId:SceneJS._baseStateId++,type:"flags",picking:!0,clipping:!0,enabled:!0,transparent:!1,backfaces:!0,frontface:"ccw",backfaceLighting:!0,backfaceTexturing:!0,diffuse:!0,specular:!0,ambient:!0,reflection:!0},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.flags=t,r=0}),SceneJS.Flags=SceneJS_NodeFactory.createNodeType("flags"),SceneJS.Flags.prototype._init=function(e){1==this._core.useCount&&(this._core.picking=!0,this._core.clipping=!0,this._core.enabled=!0,this._core.transparent=!1,this._core.backfaces=!0,this._core.frontface="ccw",this._core.backfaceLighting=!0,this._core.backfaceTexturing=!0,this._core.diffuse=!0,this._core.specular=!0,this._core.ambient=!0,this._core.reflection=!0,e.flags&&this.setFlags(e.flags))},SceneJS.Flags.prototype.setFlags=function(e){var t=this._core;return null!=e.picking&&(t.picking=!!e.picking,this._engine.display.drawListDirty=!0),null!=e.clipping&&(t.clipping=!!e.clipping,this._engine.display.imageDirty=!0),null!=e.enabled&&(t.enabled=!!e.enabled,this._engine.display.drawListDirty=!0),null!=e.transparent&&(t.transparent=!!e.transparent,this._engine.display.stateSortDirty=!0),null!=e.backfaces&&(t.backfaces=!!e.backfaces,this._engine.display.imageDirty=!0),null!=e.frontface&&(t.frontface=e.frontface,this._engine.display.imageDirty=!0),null!=e.backfaceLighting&&(t.backfaceLighting=!!e.backfaceLighting,this._engine.display.imageDirty=!0),null!=e.backfaceTexturing&&(t.backfaceTexturing=!!e.backfaceTexturing,this._engine.display.imageDirty=!0),null!=e.diffuse&&(t.diffuse=!!e.diffuse,this._engine.display.imageDirty=!0),null!=e.specular&&(t.specular=!!e.specular,this._engine.display.imageDirty=!0),null!=e.ambient&&(t.ambient=!!e.ambient,this._engine.display.imageDirty=!0),null!=e.reflection&&(t.reflection=!!e.reflection,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.addFlags=function(e){return this.setFlags(e)},SceneJS.Flags.prototype.getFlags=function(){var e=this._core;return{picking:e.picking,clipping:e.clipping,enabled:e.enabled,transparent:e.transparent,backfaces:e.backfaces,frontface:e.frontface,diffuse:e.diffuse,specular:e.specular,ambient:e.ambient,backfaceLighting:e.backfaceLighting,backfaceTexturing:e.backfaceTexturing,reflection:e.reflection}},SceneJS.Flags.prototype.setPicking=function(e){return e=!!e,this._core.picking!=e&&(this._core.picking=e,this._engine.display.drawListDirty=!0),this},SceneJS.Flags.prototype.getPicking=function(){return this._core.picking},SceneJS.Flags.prototype.setClipping=function(e){return e=!!e,this._core.clipping!=e&&(this._core.clipping=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getClipping=function(){return this._core.clipping},SceneJS.Flags.prototype.setEnabled=function(e){return e=!!e,this._core.enabled!=e&&(this._core.enabled=e,this._engine.display.drawListDirty=!0),this},SceneJS.Flags.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Flags.prototype.setTransparent=function(e){return e=!!e,this._core.transparent!=e&&(this._core.transparent=e,this._engine.display.stateOrderDirty=!0),this},SceneJS.Flags.prototype.getTransparent=function(){return this._core.transparent},SceneJS.Flags.prototype.setBackfaces=function(e){return e=!!e,this._core.backfaces!=e&&(this._core.backfaces=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getBackfaces=function(){return this._core.backfaces},SceneJS.Flags.prototype.setFrontface=function(e){return this._core.frontface!=e&&(this._core.frontface=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getFrontface=function(){return this._core.frontface},SceneJS.Flags.prototype.setBackfaceLighting=function(e){return e=!!e,this._core.backfaceLighting!=e&&(this._core.backfaceLighting=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getBackfaceLighting=function(){return this._core.backfaceLighting},SceneJS.Flags.prototype.setBackfaceTexturing=function(e){return e=!!e,this._core.backfaceTexturing!=e&&(this._core.backfaceTexturing=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getBackfaceTexturing=function(){return this._core.backfaceTexturing},SceneJS.Flags.prototype.setDiffuse=function(e){return e=!!e,this._core.diffuse!=e&&(this._core.diffuse=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getDiffuse=function(){return this._core.diffuse},SceneJS.Flags.prototype.setSpecular=function(e){return e=!!e,this._core.specular!=e&&(this._core.specular=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getSpecular=function(){return this._core.specular},SceneJS.Flags.prototype.setAmbient=function(e){return e=!!e,this._core.ambient!=e&&(this._core.ambient=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getAmbient=function(){return this._core.ambient},SceneJS.Flags.prototype.setReflection=function(e){return e=!!e,this._core.reflection!=e&&(this._core.reflection=e,this._engine.display.imageDirty=!0),this},SceneJS.Flags.prototype.getReflection=function(){return this._core.reflection},SceneJS.Flags.prototype._compile=function(e){this._engine.display.flags=i[r++]=this._core,this._compileNodes(e),this._engine.display.flags=0<--r?i[r-1]:t}}(),new function(){var i={type:"renderTarget",stateId:SceneJS._baseStateId++,targets:null},t={},r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.renderTarget=i,n=0}),SceneJS_events.addListener(SceneJS_events.WEBGL_CONTEXT_RESTORED,function(){for(var e in t)t.hasOwnProperty(e)&&t[e]._buildNodeCore()}),SceneJS.ColorTarget=SceneJS_NodeFactory.createNodeType("colorTarget"),SceneJS.ColorTarget.prototype._init=function(e){(t[this._core.coreId]=this)._core.bufType="color",this._core.renderBuf=new SceneJS._webgl.RenderBuffer({canvas:this._engine.canvas})},SceneJS.ColorTarget.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("renderTarget"));var t=this._engine.display.renderTarget;this._core.empty||(this.__core.targets=t&&t.targets?t.targets.concat([this._core]):[this._core]),r[n++]=this.__core,this._engine.display.renderTarget=this.__core,this._compileNodes(e),this._engine.display.renderTarget=0<--n?r[n-1]:i},SceneJS.ColorTarget.prototype._destroy=function(){this._core&&delete t[this._core.coreId]}},new function(){var i={type:"renderTarget",stateId:SceneJS._baseStateId++,targets:null},t={},r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.renderTarget=i,n=0}),SceneJS_events.addListener(SceneJS_events.WEBGL_CONTEXT_RESTORED,function(){for(var e in t)t.hasOwnProperty(e)&&t[e]._buildNodeCore()}),SceneJS.DepthTarget=SceneJS_NodeFactory.createNodeType("depthTarget"),SceneJS.DepthTarget.prototype._init=function(e){(t[this._core.coreId]=this)._core.bufType="depth",this._core.renderBuf=new SceneJS._webgl.RenderBuffer({canvas:this._engine.canvas})},SceneJS.DepthTarget.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("renderTarget"));var t=this._engine.display.renderTarget;this._core.empty||(this.__core.targets=t&&t.targets?t.targets.concat([this._core]):[this._core]),r[n++]=this.__core,this._engine.display.renderTarget=this.__core,this._compileNodes(e),this._engine.display.renderTarget=0<--n?r[n-1]:i},SceneJS.DepthTarget.prototype._destroy=function(){this._core&&delete t[this._core.coreId]}},new function(){var r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(){n=0}),SceneJS.Geometry=SceneJS_NodeFactory.createNodeType("geometry"),SceneJS.Geometry.prototype._init=function(e){if(1==this._core.useCount){this._initNodeCore(e,{origin:e.origin,scale:e.scale,autoNormals:"auto"==e.normals}),this._buildNodeCore(this._engine.canvas.gl,this._core);var t=this;this._core.webglRestored=function(){t._buildNodeCore(t._engine.canvas.gl,t._core)}}},SceneJS.Geometry.prototype._initNodeCore=function(e,t){t=t||{};var i,r=e.primitive||"triangles";this._core.primitive=this._getPrimitiveType(r),e.normals&&("auto"==e.normals&&"triangles"==r?e.positions&&e.indices&&(i=this._buildNormals(e.positions,e.indices)):i=e.normals),this._core.arrays={positions:e.positions?new Float32Array(t.scale||t.origin?this._applyOptions(e.positions,t):e.positions):void 0,normals:i?new Float32Array(i):void 0,uv:e.uv?new Float32Array(e.uv):void 0,uv2:e.uv2?new Float32Array(e.uv2):void 0,colors:e.colors?new Float32Array(e.colors):void 0,indices:e.indices?new Uint16Array(e.indices):void 0}},SceneJS.Geometry.prototype._getPrimitiveType=function(e){var t=this._engine.canvas.gl;switch(e){case"points":return t.POINTS;case"lines":return t.LINES;case"line-loop":return t.LINE_LOOP;case"line-strip":return t.LINE_STRIP;case"triangles":return t.TRIANGLES;case"triangle-strip":return t.TRIANGLE_STRIP;case"triangle-fan":return t.TRIANGLE_FAN;default:throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"geometry primitive unsupported: '"+e+"' - supported types are: 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'")}},SceneJS.Geometry.prototype._applyOptions=function(e,t){var i=e.slice?e.slice(0):new Float32Array(e);if(t.scale)for(var r=null!=t.scale.x?t.scale.x:1,n=null!=t.scale.y?t.scale.y:1,s=null!=t.scale.z?t.scale.z:1,o=0,a=i.length;o<a;o+=3)i[o]*=r,i[o+1]*=n,i[o+2]*=s;if(t.origin){var c=null!=t.origin.x?t.origin.x:0,h=null!=t.origin.y?t.origin.y:0,l=null!=t.origin.z?t.origin.z:0;for(o=0,a=i.length;o<a;o+=3)i[o]-=c,i[o+1]-=h,i[o+2]-=l}return i};var m=function(e){e.vertexBuf&&(e.vertexBuf.destroy(),e.vertexBuf=null),e.normalBuf&&(e.normalBuf.destroy(),e.normalBuf=null),e.uvBuf&&(e.uvBuf.destroy(),e.uvBuf=null),e.uvBuf2&&(e.uvBuf2.destroy(),e.uvBuf2=null),e.colorBuf&&(e.colorBuf.destroy(),e.colorBuf=null),e.indexBuf&&(e.indexBuf.destroy(),e.indexBuf=null),e.interleavedBuf&&(e.interleavedBuf.destroy(),e.interleavedBuf=null)};SceneJS.Geometry.prototype._buildNodeCore=function(e,t){var i=e.STATIC_DRAW;try{var r=t.arrays,n=!1!==SceneJS.getConfigs("enableInterleaving"),s=0,o=0,a=[],c=[],h=function(e,t){return 0==s?s=e.length/t:e.length/t!=s&&(n=!1),a.push(e),c.push(t),4*((o+=t)-t)};if(r.positions&&(n&&(t.interleavedPositionOffset=h(r.positions,3)),t.vertexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,r.positions,r.positions.length,3,i)),r.normals&&(n&&(t.interleavedNormalOffset=h(r.normals,3)),t.normalBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,r.normals,r.normals.length,3,i)),r.uv&&(n&&(t.interleavedUVOffset=h(r.uv,2)),t.uvBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,r.uv,r.uv.length,2,i)),r.uv2&&(n&&(t.interleavedUV2Offset=h(r.uv2,2)),t.uvBuf2=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,r.uv2,r.uv2.length,2,i)),r.colors&&(n&&(t.interleavedColorOffset=h(r.colors,4)),t.colorBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,r.colors,r.colors.length,4,i)),r.indices&&(t.indexBuf=new SceneJS._webgl.ArrayBuffer(e,e.ELEMENT_ARRAY_BUFFER,r.indices,r.indices.length,1,i)),0<o&&n){for(var l=[],u=a.length,d=0;d<s;++d)for(var p=0;p<u;++p)for(var f=c[p],g=0;g<f;++g)l.push(a[p][d*f+g]);t.interleavedStride=4*o,t.interleavedBuf=new SceneJS._webgl.ArrayBuffer(e,e.ARRAY_BUFFER,new Float32Array(l),l.length,o,i),t.interleavedBuf.dirty=!1}}catch(e){throw m(t),SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate geometry: "+e)}},SceneJS.Geometry.prototype._updateArray=function(e,t,i){var r=e.length,n=t.length;r<n+i&&(n-=n+i-r);for(var s=i,o=0;o<n;s++,o++)e[s]=t[o]},SceneJS.Geometry.prototype._buildNormals=function(e,t){for(var i,r,n,s,o,a,c=new Array(e.length/3),h=0,l=t.length-3;h<l;h+=3){i=t[h+0],r=t[h+1],n=t[h+2],s=[e[3*i+0],e[3*i+1],e[3*i+2]],o=[e[3*r+0],e[3*r+1],e[3*r+2]],a=[e[3*n+0],e[3*n+1],e[3*n+2]],o=SceneJS_math_subVec4(o,s,[0,0,0,0]),a=SceneJS_math_subVec4(a,s,[0,0,0,0]);var u=SceneJS_math_normalizeVec4(SceneJS_math_cross3Vec4(o,a,[0,0,0,0]),[0,0,0,0]);c[i]||(c[i]=[]),c[r]||(c[r]=[]),c[n]||(c[n]=[]),c[i].push(u),c[r].push(u),c[n].push(u)}var d=new Array(e.length);for(h=0,l=c.length;h<l;h++){for(var p=c[h].length,f=0,g=0,m=0,_=0;_<p;_++)f+=c[h][_][0],g+=c[h][_][1],m+=c[h][_][2];d[3*h+0]=f/p,d[3*h+1]=g/p,d[3*h+2]=m/p}return d},SceneJS.Geometry.prototype.setSource=function(e){this._sourceConfigs=e;var t=this._source;t&&t.configure&&t.configure(e)},SceneJS.Geometry.prototype.getSource=function(){return this._sourceConfigs||{}},SceneJS.Geometry.prototype.setPositions=function(e){if(e.positions&&this._core.vertexBuf){this._boundary=null;var t=this._core;t.vertexBuf.bind(),t.vertexBuf.setData(new Float32Array(e.positions),e.positionsOffset||0),t.arrays.positions.set(e.positions,e.positionsOffset||0),this._engine.display.imageDirty=!0,t.interleavedBuf&&(t.interleavedBuf.dirty=!0)}},SceneJS.Geometry.prototype.getPositions=function(){return this._core.arrays?this._core.arrays.positions:null},SceneJS.Geometry.prototype.setNormals=function(e){if(e.normals&&this._core.normalBuf){var t=this._core;t.normalBuf.bind(),t.normalBuf.setData(new Float32Array(e.normals),e.normalsOffset||0),t.arrays.normals.set(e.normals,e.normalsOffset||0),this._engine.display.imageDirty=!0,t.interleavedBuf&&(t.interleavedBuf.dirty=!0)}},SceneJS.Geometry.prototype.getNormals=function(){return this._core.arrays?this._core.arrays.normals:null},SceneJS.Geometry.prototype.setColors=function(e){if(e.colors&&this._core.colorBuf){var t=this._core;t.colorBuf.bind(),t.colorBuf.setData(new Float32Array(e.colors),e.colorsOffset||0),t.arrays.colors.set(e.colors,e.colorsOffset||0),this._engine.display.imageDirty=!0,t.interleavedBuf&&(t.interleavedBuf.dirty=!0)}},SceneJS.Geometry.prototype.getColors=function(){return this._core.arrays?this._core.arrays.colors:null},SceneJS.Geometry.prototype.getIndices=function(){return this._core.arrays?this._core.arrays.indices:null},SceneJS.Geometry.prototype.setUV=function(e){if(e.uv&&this._core.uvBuf){var t=this._core;t.uvBuf.bind(),t.uvBuf.setData(new Float32Array(e.uv),e.uvOffset||0),t.arrays.uv.set(e.uv,e.uvOffset||0),this._engine.display.imageDirty=!0,t.interleavedBuf&&(t.interleavedBuf.dirty=!0)}},SceneJS.Geometry.prototype.getUV=function(){return this._core.arrays?this._core.arrays.uv:null},SceneJS.Geometry.prototype.setUV2=function(e){if(e.uv2&&this._core.uv2Buf){var t=this._core;t.uv2Buf.bind(),t.uv2Buf.setData(new Float32Array(e.uv2),e.uv2Offset||0),t.arrays.uv2.set(e.uv2,e.uv2Offset||0),this._engine.display.imageDirty=!0,t.interleavedBuf&&(t.interleavedBuf.dirty=!0)}},SceneJS.Geometry.prototype.getUV2=function(){return this._core.arrays?this._core.arrays.uv2:null},SceneJS.Geometry.prototype.getPrimitive=function(){return this.primitive},SceneJS.Geometry.prototype.getBoundary=function(){if(this._boundary)return this._boundary;var e=this._core.arrays;if(!e)return null;var t,i,r,n=e.positions;if(!n)return null;this._boundary={xmin:SceneJS_math_MAX_DOUBLE,ymin:SceneJS_math_MAX_DOUBLE,zmin:SceneJS_math_MAX_DOUBLE,xmax:SceneJS_math_MIN_DOUBLE,ymax:SceneJS_math_MIN_DOUBLE,zmax:SceneJS_math_MIN_DOUBLE};for(var s=0,o=n.length-2;s<o;s+=3)t=n[s],i=n[s+1],r=n[s+2],t<this._boundary.xmin&&(this._boundary.xmin=t),i<this._boundary.ymin&&(this._boundary.ymin=i),r<this._boundary.zmin&&(this._boundary.zmin=r),t>this._boundary.xmax&&(this._boundary.xmax=t),i>this._boundary.ymax&&(this._boundary.ymax=i),r>this._boundary.zmax&&(this._boundary.zmax=r);return this._boundary},SceneJS.Geometry.prototype._compile=function(e){if(this._core._loading)this._compileNodes(e);else{var t=this._core;t.vertexBuf||(t=this._inheritVBOs(t)),t.indexBuf?(t.hash=[t.normalBuf?"t":"f",t.uvBuf?"t":"f",t.uvBuf2?"t":"f",t.colorBuf?"t":"f",t.primitive].join(""),t.stateId=this._core.stateId,t.type="geometry",this._engine.display.geometry=r[n++]=t,SceneJS_events.fireEvent(SceneJS_events.OBJECT_COMPILING,{display:this._engine.display}),this._engine.display.buildObject(this.id)):r[n++]=this._core,this._compileNodes(e),n--}},SceneJS.Geometry.prototype._inheritVBOs=function(e){for(var t={primitive:e.primitive,boundary:e.boundary,normalBuf:e.normalBuf,uvBuf:e.uvBuf,uvBuf2:e.uvBuf2,colorBuf:e.colorBuf,interleavedBuf:e.interleavedBuf,indexBuf:e.indexBuf,interleavedStride:e.interleavedStride,interleavedPositionOffset:e.interleavedPositionOffset,interleavedNormalOffset:e.interleavedNormalOffset,interleavedUVOffset:e.interleavedUVOffset,interleavedUV2Offset:e.interleavedUV2Offset,interleavedColorOffset:e.interleavedColorOffset},i=n-1;0<=i;i--)if(r[i].vertexBuf)return t.vertexBuf=r[i].vertexBuf,t.boundary=r[i].boundary,t.normalBuf=r[i].normalBuf,t.uvBuf=r[i].uvBuf,t.uvBuf2=r[i].uvBuf2,t.colorBuf=r[i].colorBuf,t.interleavedBuf=r[i].interleavedBuf,t.interleavedStride=r[i].interleavedStride,t.interleavedPositionOffset=r[i].interleavedPositionOffset,t.interleavedNormalOffset=r[i].interleavedNormalOffset,t.interleavedUVOffset=r[i].interleavedUVOffset,t.interleavedUV2Offset=r[i].interleavedUV2Offset,t.interleavedColorOffset=r[i].interleavedColorOffset,t;return t},SceneJS.Geometry.prototype._destroy=function(){this._engine.display.removeObject(this.id),1==this._core.useCount&&(this._destroyNodeCore(),this._source&&this._source.destroy&&this._source.destroy())},SceneJS.Geometry.prototype._destroyNodeCore=function(){document.getElementById(this._engine.canvas.canvasId)&&m(this._core)}},function(){var t={type:"stage",stateId:SceneJS._baseStateId++,priority:0,pickable:!0,enabled:!0},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.stage=t,r=0}),SceneJS.Stage=SceneJS_NodeFactory.createNodeType("stage"),SceneJS.Stage.prototype._init=function(e){1==this._core.useCount&&(this._core.priority=e.priority||0,this._core.enabled=!1!==e.enabled,this._core.pickable=!!e.pickable)},SceneJS.Stage.prototype.setPriority=function(e){e=e||0,this._core.priority!=e&&(this._core.priority=e,this._engine.display.stateOrderDirty=!0)},SceneJS.Stage.prototype.getPriority=function(){return this._core.priority},SceneJS.Stage.prototype.setEnabled=function(e){e=!!e,this._core.enabled!=e&&(this._core.enabled=e,this._engine.display.drawListDirty=!0)},SceneJS.Stage.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Stage.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Stage.prototype._compile=function(e){this._engine.display.stage=i[r++]=this._core,this._compileNodes(e),this._engine.display.stage=0<--r?i[r-1]:t}}(),function(){var t={type:"layer",stateId:SceneJS._baseStateId++,priority:0,enabled:!0},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.layer=t,r=0}),SceneJS.Layer=SceneJS_NodeFactory.createNodeType("layer"),SceneJS.Layer.prototype._init=function(e){1==this._core.useCount&&(this._core.priority=e.priority||0,this._core.enabled=!1!==e.enabled)},SceneJS.Layer.prototype.setPriority=function(e){e=e||0,this._core.priority!=e&&(this._core.priority=e,this._engine.display.stateOrderDirty=!0)},SceneJS.Layer.prototype.getPriority=function(){return this._core.priority},SceneJS.Layer.prototype.setEnabled=function(e){e=!!e,this._core.enabled!=e&&(this._core.enabled=e,this._engine.display.drawListDirty=!0)},SceneJS.Layer.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Layer.prototype.getEnabled=function(){return this._core.enabled},SceneJS.Layer.prototype.setClearDepth=function(e){e=e||0,this._core.clearDepth!=e&&(this._core.clearDepth=e,this._engine.display.drawListDirty=!0)},SceneJS.Layer.prototype.getClearDepth=function(){return this._core.clearDepth},SceneJS.Layer.prototype._compile=function(e){this._engine.display.layer=i[r++]=this._core,this._compileNodes(e),this._engine.display.layer=0<--r?i[r-1]:t}}(),SceneJS.Library=SceneJS_NodeFactory.createNodeType("library"),SceneJS.Library.prototype._compile=function(e){},function(){var t={type:"lights",stateId:SceneJS._baseStateId++,hash:null,empty:!1,lights:[{mode:"ambient",color:[.7,.7,.8],diffuse:!0,specular:!1},{mode:"dir",color:[1,1,1],diffuse:!0,specular:!0,dir:[-.5,-.5,-1],space:"view"},{mode:"dir",color:[1,1,1],diffuse:!1,specular:!0,dir:[1,-.9,-.7],space:"view"}]};function i(e){if(e.lights&&0<e.lights.length){for(var t,i=e.lights,r=[],n=0,s=i.length;n<s;n++)t=i[n],r.push(t.mode),t.specular&&r.push("s"),t.diffuse&&r.push("d"),r.push("world"==t.space?"w":"v");e.hash=r.join("")}else e.hash=""}i(t);var r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.lights=t,n=0}),SceneJS.Lights=SceneJS_NodeFactory.createNodeType("lights"),SceneJS.Lights.prototype._init=function(e){if(1==this._core.useCount){var t=e.lights;if(!t)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"lights node attribute missing : 'lights'");this._core.lights=this._core.lights||[];for(var i=0,r=t.length;i<r;i++)this._initLight(i,t[i])}},SceneJS.Lights.prototype._initLight=function(e,t){var i=[];this._core.lights[e]=i;var r=t.mode||"dir";if("dir"!=r&&"point"!=r&&"ambient"!=r)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'ambient'");var n=t.pos,s=t.dir,o=t.color;i.color=[null!=o.r?o.r:1,null!=o.g?o.g:1,null!=o.b?o.b:1],i.mode=r,i.diffuse="ambient"==r||(null==t.diffuse||t.diffuse),i.specular="ambient"!=r&&(null==t.specular||t.specular),i.pos=t.pos?[n.x||0,n.y||0,n.z||0]:void 0,i.dir=t.dir?[s.x||0,s.y||0,s.z||0]:void 0,i.attenuation=[null!=t.constantAttenuation?t.constantAttenuation:0,t.linearAttenuation||0,t.quadraticAttenuation||0];var a=t.space;if(a){if("view"!=a&&"world"!=a)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"lights node invalid value for property 'space': '"+a+"' - should be 'view' or 'world'")}else a="world";i.space=a,this._core.hash=null},SceneJS.Lights.prototype.setLights=function(e){var t;for(var i in e)if(e.hasOwnProperty(i)&&(null!=i||null!=i)){if((t=parseInt(i))<0||t>=this._core.lights.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid argument to set 'lights': index out of range ("+this._core.lights.length+" lights defined)");this._setLight(t,e[i]||{})}this._engine.branchDirty(this)},SceneJS.Lights.prototype._setLight=function(e,t){var i=this._core.lights[e],r=!1,n=!1;if(t.mode&&t.mode!=i.mode){var s=t.mode;if("dir"!=s&&"point"!=s&&"ambient"!=s)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Light mode not supported - should be 'dir' or 'point' or 'ambient'");i.mode=s,i.diffuse="ambient"==s||(null==t.diffuse||t.diffuse),i.specular="ambient"!=s&&(null==t.specular||t.specular),n=!0}if(t.color){var o=t.color;i.color=[null!=o.r?o.r:1,null!=o.g?o.g:1,null!=o.b?o.b:1],r=!0}var a=t.pos;a&&(i.pos=[a.x||0,a.y||0,a.z||0],r=!0);var c=t.dir;if(c&&(i.dir=[c.x||0,c.y||0,c.z||0],r=!0),null!=t.constantAttenuation&&(i.attenuation[0]=t.constantAttenuation,r=!0),null!=t.linearAttenuation&&(i.attenuation[1]=t.linearAttenuation,r=!0),null!=t.quadraticAttenuation&&(i.attenuation[2]=t.quadraticAttenuation,r=!0),t.space&&t.space!=i.space){var h=t.space;if("view"!=h&&"world"!=h)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"lights node invalid value for property 'space': '"+h+"' - should be 'view' or 'world'");i.space=h,n=!(this._core.hash=null)}null!=t.specular&&t.specular!=i.specular&&(i.specular=t.specular,n=!0),null!=t.diffuse&&t.diffuse!=i.diffuse&&(i.diffuse=t.diffuse,n=!0),n?this._engine.branchDirty(this):r&&(this._engine.display.imageDirty=!0),this._core.hash=null},SceneJS.Lights.prototype._compile=function(e){this._core.hash||i(this._core),this._engine.display.lights=r[n++]=this._core,this._compileNodes(e),this._engine.display.lights=0<--n?r[n-1]:t}}(),function(){var e=SceneJS_math_lookAtMat4c(0,0,10,0,0,0,0,1,0),t=new Float32Array(e),i=SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t,SceneJS_math_mat4())),r=new Float32Array(i),n={type:"lookAt",stateId:SceneJS._baseStateId++,matrix:e,mat:t,normalMatrix:i,normalMat:r,lookAt:SceneJS_math_LOOKAT_ARRAYS},s=[],o=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.viewTransform=n,o=0}),SceneJS.Lookat=SceneJS_NodeFactory.createNodeType("lookAt"),SceneJS.Lookat.prototype._init=function(e){if(this._mat=null,this._xf={type:"lookat"},1==this._core.useCount){this._core.eyeX=0,this._core.eyeY=0,this._core.eyeZ=10,this._core.lookX=0,this._core.lookY=0,this._core.lookZ=0,this._core.upX=0,this._core.upY=1,this._core.upZ=0,e.eye||e.look||e.up?(this.setEye(e.eye),this.setLook(e.look),this.setUp(e.up)):(this.setEye({x:0,y:0,z:10}),this.setLook({x:0,y:0,z:0}),this.setUp({x:0,y:1,z:0}));var t=this._core,i=this;this._core.rebuild=function(){t.matrix=SceneJS_math_lookAtMat4c(t.eyeX,t.eyeY,t.eyeZ,t.lookX,t.lookY,t.lookZ,t.upX,t.upY,t.upZ),t.lookAt={eye:[t.eyeX,t.eyeY,t.eyeZ],look:[t.lookX,t.lookY,t.lookZ],up:[t.upX,t.upY,t.upZ]},t.mat?(t.mat.set(t.matrix),t.normalMat.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t.matrix,SceneJS_math_mat4())))):(t.mat=new Float32Array(t.matrix),t.normalMat=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t.matrix,SceneJS_math_mat4())))),i.publish("matrix",t.matrix),t.dirty=!1},this._core.dirty=!0,this._tick=this.getScene().on("tick",function(){i._core.dirty&&i._core.rebuild()})}},SceneJS.Lookat.getDefaultMatrix=function(){return t},SceneJS.Lookat.prototype.setEye=function(e){return null!=(e=e||{}).x&&null!=e.x&&(this._core.eyeX=e.x),null!=e.y&&null!=e.y&&(this._core.eyeY=e.y),null!=e.z&&null!=e.z&&(this._core.eyeZ=e.z),this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incEye=function(e){return e=e||{},this._core.eyeX+=null!=e.x&&null!=e.x?e.x:0,this._core.eyeY+=null!=e.y&&null!=e.y?e.y:0,this._core.eyeZ+=null!=e.z&&null!=e.z?e.z:0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setEyeX=function(e){return this._core.eyeX=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setEyeY=function(e){return this._core.eyeY=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setEyeZ=function(e){return this._core.eyeZ=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incEyeX=function(e){return this._core.eyeX+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incEyeY=function(e){return this._core.eyeY+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incEyeZ=function(e){return this._core.eyeZ+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.getEye=function(){return{x:this._core.eyeX,y:this._core.eyeY,z:this._core.eyeZ}},SceneJS.Lookat.prototype.setLook=function(e){return null!=(e=e||{}).x&&null!=e.x&&(this._core.lookX=e.x),null!=e.y&&null!=e.y&&(this._core.lookY=e.y),null!=e.z&&null!=e.z&&(this._core.lookZ=e.z),this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incLook=function(e){return e=e||{},this._core.lookX+=null!=e.x&&null!=e.x?e.x:0,this._core.lookY+=null!=e.y&&null!=e.y?e.y:0,this._core.lookZ+=null!=e.z&&null!=e.z?e.z:0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setLookX=function(e){return this._core.lookX=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setLookY=function(e){return this._core.lookY=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setLookZ=function(e){return this._core.lookZ=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incLookX=function(e){return this._core.lookX+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incLookY=function(e){return this._core.lookY+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incLookZ=function(e){return this._core.lookZ+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.getLook=function(){return{x:this._core.lookX,y:this._core.lookY,z:this._core.lookZ}},SceneJS.Lookat.prototype.setUp=function(e){return null!=(e=e||{}).x&&null!=e.x&&(this._core.upX=e.x),null!=e.y&&null!=e.y&&(this._core.upY=e.y),null!=e.z&&null!=e.z&&(this._core.upZ=e.z),this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incUp=function(e){return e=e||{},this._core.upX+=null!=e.x&&null!=e.x?e.x:0,this._core.upY+=null!=e.y&&null!=e.y?e.y:0,this._core.upZ+=null!=e.z&&null!=e.z?e.z:0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setUpX=function(e){return this._core.upX=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setUpY=function(e){return this._core.upY=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.setUpZ=function(e){return this._core.upZ=e||0,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incUpX=function(e){return this._core.upX+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incUpY=function(e){return this._core.upY+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.incUpZ=function(e){return this._core.upZ+=e,this._core.dirty=!0,this._engine.display.imageDirty=!0,this},SceneJS.Lookat.prototype.getUp=function(){return{x:this._core.upX,y:this._core.upY,z:this._core.upZ}},SceneJS.Lookat.prototype.getMatrix=function(){return this._core.dirty&&this._core.rebuild(),this._core.matrix.slice(0)},SceneJS.Lookat.prototype.getAttributes=function(){return{look:{x:this._core.lookX,y:this._core.lookY,z:this._core.lookZ},eye:{x:this._core.eyeX,y:this._core.eyeY,z:this._core.eyeZ},up:{x:this._core.upX,y:this._core.upY,z:this._core.upZ}}},SceneJS.Lookat.prototype._compile=function(e){this._engine.display.viewTransform=s[o++]=this._core,this._compileNodes(e),this._engine.display.viewTransform=0<--o?s[o-1]:n},SceneJS.Lookat.prototype._destroy=function(){this.getScene().off(this._tick)}}(),new function(){var i={type:"material",stateId:SceneJS._baseStateId++,baseColor:[1,1,1],specularColor:[1,1,1],specular:1,shine:70,alpha:1,emit:0},t=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.material=i,r=0}),SceneJS.Material=SceneJS_NodeFactory.createNodeType("material"),SceneJS.Material.prototype._init=function(e){1==this._core.useCount&&(this.setBaseColor(e.color||e.baseColor),this.setSpecularColor(e.specularColor),this.setSpecular(e.specular),this.setShine(e.shine),this.setEmit(e.emit),this.setAlpha(e.alpha))},SceneJS.Material.prototype.setBaseColor=function(e){var t=i.baseColor;return this._core.baseColor=e?[null!=e.r&&null!=e.r?e.r:t[0],null!=e.g&&null!=e.g?e.g:t[1],null!=e.b&&null!=e.b?e.b:t[2]]:i.baseColor,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.setColor=SceneJS.Material.prototype.setBaseColor,SceneJS.Material.prototype.getBaseColor=function(){return{r:this._core.baseColor[0],g:this._core.baseColor[1],b:this._core.baseColor[2]}},SceneJS.Material.prototype.getColor=SceneJS.Material.prototype.getBaseColor,SceneJS.Material.prototype.setSpecularColor=function(e){var t=i.specularColor;return this._core.specularColor=e?[null!=e.r&&null!=e.r?e.r:t[0],null!=e.g&&null!=e.g?e.g:t[1],null!=e.b&&null!=e.b?e.b:t[2]]:i.specularColor,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecularColor=function(){return{r:this._core.specularColor[0],g:this._core.specularColor[1],b:this._core.specularColor[2]}},SceneJS.Material.prototype.setSpecular=function(e){return this._core.specular=null!=e&&null!=e?e:i.specular,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getSpecular=function(){return this._core.specular},SceneJS.Material.prototype.setShine=function(e){return this._core.shine=null!=e&&null!=e?e:i.shine,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getShine=function(){return this._core.shine},SceneJS.Material.prototype.setEmit=function(e){return this._core.emit=null!=e&&null!=e?e:i.emit,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getEmit=function(){return this._core.emit},SceneJS.Material.prototype.setAlpha=function(e){return this._core.alpha=null!=e&&null!=e?e:i.alpha,this._engine.display.imageDirty=!0,this},SceneJS.Material.prototype.getAlpha=function(){return this._core.alpha},SceneJS.Material.prototype._compile=function(e){this._engine.display.material=t[r++]=this._core,this._compileNodes(e),this._engine.display.material=0<--r?t[r-1]:i}},new function(){var t={type:"morphGeometry",stateId:SceneJS._baseStateId++,hash:"",morph:null},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.morphGeometry=t,r=0}),SceneJS.MorphGeometry=SceneJS_NodeFactory.createNodeType("morphGeometry"),SceneJS.MorphGeometry.prototype._init=function(t){if(1==this._core.useCount){if(this._sourceConfigs=t.source,this._source=null,t.source){if(!t.source.type)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry config expected: source.type");var c=this;SceneJS.Plugins.getPlugin("morphGeometry",this._sourceConfigs.type,function(e){if(!e)throw SceneJS_error.fatalError(SceneJS.errors.PLUGIN_INVALID,"morphGeometry: no support for source type '"+c._sourceConfigs.type+"' - need to include plugin for self source type, or install a custom source service with SceneJS.Plugins.addPlugin(SceneJS.Plugins.MORPH_GEO_SOURCE_PLUGIN, '"+c._sourceConfigs.type+"', <your service>).");if(!e.getSource)throw SceneJS_error.fatalError(SceneJS.errors.PLUGIN_INVALID,"morphGeometry: 'getSource' method not found on MorphGeoFactoryService (SceneJS.Plugins.MORPH_GEO_SOURCE_PLUGIN)");if(c._source=e.getSource(),!c._source.subscribe)throw SceneJS_error.fatalError(SceneJS.errors.PLUGIN_INVALID,"morphGeometry: 'subscribe' method not found on source provided by plugin type '"+t.source.type+"'");var a=!1;c._source.subscribe(function(e){if(a){if(e.targets)for(var t,i,r=e.targets,n=c._core.targets,s=0,o=r.length;s<o;s++)i=n[(t=r[s]).targetIndex],t.positions&&i.vertexBuf&&(i.vertexBuf.bind(),i.vertexBuf.setData(t.positions,0));c._display.imageDirty=!0}else c._buildNodeCore(e),c._core._loading=!1,c._fireEvent("loaded"),c._engine.branchDirty(c),a=!0}),c._core._loading=!0,c._fireEvent("loading"),c._source.configure(c._sourceConfigs)})}else t.create instanceof Function?this._buildNodeCore(t.create()):this._buildNodeCore(t);this._core.webglRestored=function(){},this.setFactor(t.factor)}this._core.factor=t.factor||0,this._core.clamp=!!t.clamp},SceneJS.MorphGeometry.prototype._buildNodeCore=function(e){var t=e.targets||[];if(t.length<2)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node should have at least two targets");var i=e.keys||[];if(i.length!=t.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"morphGeometry node mismatch in number of keys and targets");var r,n,s,o,a,c=this._core,h=this._engine.canvas.gl,l=h.STATIC_DRAW;c.keys=i,c.targets=[],c.key1=0,c.key2=1;for(var u=0,d=t.length;u<d;u++)a=t[u],!r&&a.positions&&(r=a.positions),!n&&a.normals&&(n=a.normals),!s&&a.uv&&(s=a.uv),!o&&a.uv2&&(o=a.uv2);try{var p,f;for(u=0,d=t.length;u<d;u++)a=t[u],p={},(f=a.positions||r)&&(p.positions="Float32Array"==typeof f?f:new Float32Array(f),p.vertexBuf=new SceneJS._webgl.ArrayBuffer(h,h.ARRAY_BUFFER,p.positions,f.length,3,l),r=f),(f=a.normals||n)&&(p.normals="Float32Array"==typeof f?f:new Float32Array(f),p.normalBuf=new SceneJS._webgl.ArrayBuffer(h,h.ARRAY_BUFFER,p.normals,f.length,3,l),n=f),(f=a.uv||s)&&(p.uv="Float32Array"==typeof f?f:new Float32Array(f),p.uvBuf=new SceneJS._webgl.ArrayBuffer(h,h.ARRAY_BUFFER,p.uv,f.length,2,l),s=f),(f=a.uv2||o)&&(p.uv2="Float32Array"==typeof f?f:new Float32Array(f),p.uvBuf2=new SceneJS._webgl.ArrayBuffer(h,h.ARRAY_BUFFER,p.uv2,f.length,2,l),o=f),c.targets.push(p)}catch(e){for(u=0,d=c.targets.length;u<d;u++)(p=c.targets[u]).vertexBuf&&p.vertexBuf.destroy(),p.normalBuf&&p.normalBuf.destroy(),p.uvBuf&&p.uvBuf.destroy(),p.uvBuf2&&p.uvBuf2.destroy();throw SceneJS_error.fatalError(SceneJS.errors.ERROR,"Failed to allocate VBO(s) for morphGeometry: "+e)}},SceneJS.MorphGeometry.prototype.setSource=function(e){this._sourceConfigs=e;var t=this._source;t&&t.configure(e)},SceneJS.MorphGeometry.prototype.getSource=function(){return this._sourceConfigs},SceneJS.MorphGeometry.prototype.setFactor=function(e){e=e||0;var t=this._core,i=t.keys,r=t.key1,n=t.key2;if(e<i[0])r=0,n=1;else if(e>i[i.length-1])n=(r=i.length-2)+1;else{for(;i[r]>e;)r--,n--;for(;i[n]<e;)r++,n++}t.factor=(e-i[r])/(i[n]-i[r]),t.key1=r,t.key2=n,this._engine.display.imageDirty=!0},SceneJS.MorphGeometry.prototype.getFactor=function(){return this._core.factor},SceneJS.MorphGeometry.prototype.getKeys=function(){return this._core.keys},SceneJS.MorphGeometry.prototype.getTargets=function(){return this._core.targets},SceneJS.MorphGeometry.prototype._compile=function(e){this._core.hash||this._makeHash(),this._engine.display.morphGeometry=i[r++]=this._core,this._compileNodes(e),this._engine.display.morphGeometry=0<--r?i[r-1]:t},SceneJS.MorphGeometry.prototype._makeHash=function(){var e=this._core;if(0<e.targets.length){var t=e.targets[0];e.hash=[t.vertexBuf?"t":"f",t.normalBuf?"t":"f",t.uvBuf?"t":"f",t.uvBuf2?"t":"f"].join("")}else e.hash=""},SceneJS.MorphGeometry.prototype._destroy=function(){if(1==this._core.useCount){if(document.getElementById(this._engine.canvas.canvasId))for(var e,t=this._core,i=0,r=t.targets.length;i<r;i++)(e=t.targets[i]).vertexBuf&&e.vertexBuf.destroy(),e.normalBuf&&e.normalBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.uvBuf2&&e.uvBuf2.destroy();this._source&&this._source.destroy&&this._source.destroy()}}},function(){var n={type:"name",stateId:SceneJS._baseStateId++,name:null},s=[],o=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.name=n,o=0}),SceneJS.Name=SceneJS_NodeFactory.createNodeType("name"),SceneJS.Name.prototype._init=function(e){this.setName(e.name),this._core.nodeId=this.id},SceneJS.Name.prototype.setName=function(e){this._core.name=e||"unnamed",this._engine.branchDirty(this)},SceneJS.Name.prototype.getName=function(){return this._core.name},SceneJS.Name.prototype._compile=function(e){this._engine.display.name=s[o++]=this._core;for(var t,i=[],r=0;r<o;r++)(t=s[r].name)&&i.push(t);this._core.path=i.join("."),this._compileNodes(e),this._engine.display.name=0<--o?s[o-1]:n}}(),new function(){var i,t={type:"renderer",stateId:SceneJS._baseStateId++,props:null},n=[],s=0;function r(t){var i;if(0<s)for(var e in i={},t)t.hasOwnProperty(e)&&null!=t[e]&&(i[e]=o(e));return function(e){var t;for(var i in e)e.hasOwnProperty(i)&&null!=(t=e[i])&&null!=t&&(l[i]?e[i]=l[i](null,t):u[i]&&(e[i]=u[i](null,t)))}(t.props),{props:t,setProps:function(e){a(e,t)},restoreProps:function(e){i&&c(e,i)}}}SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){i=e.engine.canvas,s=0,e.engine.display.renderer=n[s++]=t});var o=function(e){for(var t,i,r=s-1;0<=r;r--)if((t=n[r].props)&&null!=(i=t[e])&&null!=i)return t[e];return null};var a=function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=l[i];r&&r(e,t[i])}t.viewport&&u.viewport(e,t.viewport),t.scissor&&u.clear(e,t.scissor),t.clear&&u.clear(e,t.clear)},c=function(e,t){var i;for(var r in t)if(t.hasOwnProperty(r)&&null!=(i=t[r])&&null!=i){var n=l[r];n&&n(e,i)}t.viewport&&u.viewport(e,t.viewport),t.scissor&&u.clear(e,t.scissor)},h=function(e,t){if(!t)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Null SceneJS.State node config: "'+t+'"');var i=SceneJS._webgl.enumMap[t];if(!i)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,'Unrecognised SceneJS.State node config value: "'+t+'"');var r=e[i];if(!r)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"This browser's WebGL does not support renderer node config value: \""+t+'"');return r},l={enableBlend:function(e,t){if(!e)return null!=t&&null!=t||(t=!1),t;t?e.enable(e.BLEND):e.disable(e.BLEND)},blendColor:function(e,t){if(!e)return{r:(t=t||{}).r||0,g:t.g||0,b:t.b||0,a:null==t.a||null==t.a?1:t.a};e.blendColor(t.r,t.g,t.b,t.a)},blendEquation:function(e,t){if(!e)return t||"funcAdd";e.blendEquation(e,h(e,t))},blendEquationSeparate:function(e,t){if(!e)return{rgb:(t=t||{}).rgb||"funcAdd",alpha:t.alpha||"funcAdd"};e.blendEquation(h(e,t.rgb),h(e,t.alpha))},blendFunc:function(e,t){if(!e)return{sfactor:(t=t||{}).sfactor||"srcAlpha",dfactor:t.dfactor||"oneMinusSrcAlpha"};e.blendFunc(h(e,t.sfactor||"srcAlpha"),h(e,t.dfactor||"oneMinusSrcAlpha"))},blendFuncSeparate:function(e,t){if(!e)return{srcRGB:(t=t||{}).srcRGB||"zero",dstRGB:t.dstRGB||"zero",srcAlpha:t.srcAlpha||"zero",dstAlpha:t.dstAlpha||"zero"};e.blendFuncSeparate(h(e,t.srcRGB||"zero"),h(e,t.dstRGB||"zero"),h(e,t.srcAlpha||"zero"),h(e,t.dstAlpha||"zero"))},clearColor:function(e,t){if(!e)return{r:(t=t||{}).r||0,g:t.g||0,b:t.b||0,a:null==t.a||null==t.a?1:t.a};e.clearColor(t.r,t.g,t.b,t.a)},clearDepth:function(e,t){if(!e)return null==t||null==t?1:t;e.clearDepth(t)},clearStencil:function(e,t){if(!e)return t||0;e.clearStencil(t)},colorMask:function(e,t){if(!e)return{r:(t=t||{}).r||0,g:t.g||0,b:t.b||0,a:null==t.a||null==t.a?1:t.a};e.colorMask(t.r,t.g,t.b,t.a)},enableCullFace:function(e,t){if(!e)return t;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE)},cullFace:function(e,t){if(!e)return t||"back";e.cullFace(h(e,t))},enableDepthTest:function(e,t){if(!e)return null!=t&&null!=t||(t=!0),t;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)},depthFunc:function(e,t){if(!e)return t||"less";e.depthFunc(h(e,t))},enableDepthMask:function(e,t){if(!e)return null!=t&&null!=t||(t=!0),t;e.depthMask(t)},depthRange:function(e,t){if(!e)return{zNear:null==(t=t||{}).zNear||null==t.zNear?0:t.zNear,zFar:null==t.zFar||null==t.zFar?1:t.zFar};e.depthRange(t.zNear,t.zFar)},frontFace:function(e,t){if(!e)return t||"ccw";e.frontFace(h(e,t))},lineWidth:function(e,t){if(!e)return t||1;e.lineWidth(t)},enableScissorTest:function(e,t){if(!e)return t;t?e.enable(e.SCISSOR_TEST):(t=!1,e.disable(e.SCISSOR_TEST))}},u={viewport:function(e,t){if(!e)return{x:(t=t||{}).x||1,y:t.y||1,width:t.width||i.canvas.width,height:t.height||i.canvas.height};e.viewport(t.x,t.y,t.width,t.height)},scissor:function(e,t){if(!e)return{x:(t=t||{}).x||0,y:t.y||0,width:t.width||1,height:t.height||1};e.scissor(t.x,t.y,t.width,t.height)},clear:function(e,t){if(!e)return t=t||{};t.color&&e.COLOR_BUFFER_BIT,t.depth&&e.DEPTH_BUFFER_BIT,t.stencil&&e.STENCIL_BUFFER_BIT}};SceneJS.Renderer=SceneJS_NodeFactory.createNodeType("renderer"),SceneJS.Renderer.prototype._init=function(e){if(1==this._core.useCount){for(var t in e)e.hasOwnProperty(t)&&(this._core[t]=e[t]);this._core.dirty=!0}},SceneJS.Renderer.prototype.setViewport=function(e){this._core.viewport=e?{x:e.x||1,y:e.y||1,width:e.width||1e3,height:e.height||1e3}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getViewport=function(){return this._core.viewport?{x:this._core.viewport.x,y:this._core.viewport.y,width:this._core.viewport.width,height:this._core.viewport.height}:void 0},SceneJS.Renderer.prototype.setScissor=function(e){this._core.scissor=e?{x:e.x||1,y:e.y||1,width:e.width||1e3,height:e.height||1e3}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getScissor=function(){return this._core.scissor?{x:this._core.scissor.x,y:this._core.scissor.y,width:this._core.scissor.width,height:this._core.scissor.height}:void 0},SceneJS.Renderer.prototype.setClear=function(e){this._core.clear=e?{r:e.r||0,g:e.g||0,b:e.b||0}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getClear=function(){return this._core.clear?{r:this._core.clear.r,g:this._core.clear.g,b:this._core.clear.b}:null},SceneJS.Renderer.prototype.setEnableBlend=function(e){this._core.enableBlend=e,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getEnableBlend=function(){return this._core.enableBlend},SceneJS.Renderer.prototype.setBlendColor=function(e){this._core.blendColor=e?{r:e.r||0,g:e.g||0,b:e.b||0,a:null==e.a||null==e.a?1:e.a}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getBlendColor=function(){return this._core.blendColor?{r:this._core.blendColor.r,g:this._core.blendColor.g,b:this._core.blendColor.b,a:this._core.blendColor.a}:void 0},SceneJS.Renderer.prototype.setBlendEquation=function(e){this._core.blendEquation=e,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getBlendEquation=function(){return this._core.blendEquation},SceneJS.Renderer.prototype.setBlendEquationSeparate=function(e){this._core.blendEquationSeparate=e?{rgb:e.rgb||"funcAdd",alpha:e.alpha||"funcAdd"}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getBlendEquationSeparate=function(){return this._core.blendEquationSeparate?{rgb:this._core.rgb,alpha:this._core.alpha}:void 0},SceneJS.Renderer.prototype.setBlendFunc=function(e){this._core.blendFunc=e?{sfactor:e.sfactor||"srcAlpha",dfactor:e.dfactor||"one"}:void 0,this._core.dirty=!0,this._engine.display.imageDirty=!0},SceneJS.Renderer.prototype.getBlendFunc=function(){return this._core.blendFunc?{sfactor:this._core.sfactor,dfactor:this._core.dfactor}:void 0},SceneJS.Renderer.prototype.setBlendFuncSeparate=function(e){this._core.blendFuncSeparate=e?{srcRGB:e.srcRGB||"zero",dstRGB:e.dstRGB||"zero",srcAlpha:e.srcAlpha||"zero",dstAlpha:e.dstAlpha||"zero"}:void 0,this._core.dirty=!0},SceneJS.Renderer.prototype.getBlendFuncSeparate=function(){return this._core.blendFuncSeparate?{srcRGB:this._core.blendFuncSeparate.srcRGB,dstRGB:this._core.blendFuncSeparate.dstRGB,srcAlpha:this._core.blendFuncSeparate.srcAlpha,dstAlpha:this._core.blendFuncSeparate.dstAlpha}:void 0},SceneJS.Renderer.prototype.setEnableCullFace=function(e){this._core.enableCullFace=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getEnableCullFace=function(){return this._core.enableCullFace},SceneJS.Renderer.prototype.setCullFace=function(e){this._core.cullFace=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getCullFace=function(){return this._core.cullFace},SceneJS.Renderer.prototype.setEnableDepthTest=function(e){this._core.enableDepthTest=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getEnableDepthTest=function(){return this._core.enableDepthTest},SceneJS.Renderer.prototype.setDepthFunc=function(e){this._core.depthFunc=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getDepthFunc=function(){return this._core.depthFunc},SceneJS.Renderer.prototype.setEnableDepthMask=function(e){this._core.enableDepthMask=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getEnableDepthMask=function(){return this._core.enableDepthMask},SceneJS.Renderer.prototype.setClearDepth=function(e){this._core.clearDepth=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getClearDepth=function(){return this._core.clearDepth},SceneJS.Renderer.prototype.setDepthRange=function(e){this._core.depthRange=e?{zNear:null==e.zNear||null==e.zNear?0:e.zNear,zFar:null==e.zFar||null==e.zFar?1:e.zFar}:void 0,this._core.dirty=!0},SceneJS.Renderer.prototype.getDepthRange=function(){return this._core.depthRange?{zNear:this._core.depthRange.zNear,zFar:this._core.depthRange.zFar}:void 0},SceneJS.Renderer.prototype.setFrontFace=function(e){this._core.frontFace=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getFrontFace=function(){return this._core.frontFace},SceneJS.Renderer.prototype.setLineWidth=function(e){this._core.lineWidth=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getLineWidth=function(){return this._core.lineWidth},SceneJS.Renderer.prototype.setEnableScissorTest=function(e){this._core.enableScissorTest=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getEnableScissorTest=function(){return this._core.enableScissorTest},SceneJS.Renderer.prototype.setClearStencil=function(e){this._core.clearStencil=e,this._core.dirty=!0},SceneJS.Renderer.prototype.getClearStencil=function(){return this._core.clearStencil},SceneJS.Renderer.prototype.setColorMask=function(e){this._core.colorMask=e?{r:e.r||0,g:e.g||0,b:e.b||0,a:null==e.a||null==e.a?1:e.a}:void 0,this._core.dirty=!0},SceneJS.Renderer.prototype.getColorMask=function(){return this._core.colorMask?{r:this._core.colorMask.r,g:this._core.colorMask.g,b:this._core.colorMask.b,a:this._core.colorMask.a}:void 0},SceneJS.Renderer.prototype._compile=function(e){this._core.dirty&&(this._core.props=r(this._core),this._core.dirty=!1),this._engine.display.renderer=n[s++]=this._core,this._compileNodes(e),this._engine.display.renderer=0<--s?n[s-1]:t}},function(){var i={less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL"},t={type:"depthBuffer",stateId:SceneJS._baseStateId++,enabled:!0,clearDepth:1,depthFunc:null,_depthFuncName:"less"},r=[],n=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){null===t.depthFunc&&(t.depthFunc=e.engine.canvas.gl.LESS),e.engine.display.depthBuffer=t,n=0}),SceneJS.DepthBuf=SceneJS_NodeFactory.createNodeType("depthBuffer"),SceneJS.DepthBuf.prototype._init=function(e){null!=e.enabled?this.setEnabled(e.enabled):1==this._core.useCount&&this.setEnabled(!0),null!=e.clearDepth?this.setClearDepth(e.clearDepth):1==this._core.useCount&&this.setClearDepth(1),null!=e.depthFunc?this.setDepthFunc(e.depthFunc):1==this._core.useCount&&this.setDepthFunc("less"),null!=e.clear?this.setClear(e.clear):1==this._core.useCount&&this.setClear(!0)},SceneJS.DepthBuf.prototype.setEnabled=function(e){return this._core.enabled!=e&&(this._core.enabled=e,this._engine.display.imageDirty=!0),this},SceneJS.DepthBuf.prototype.getEnabled=function(){return this._core.enabled},SceneJS.DepthBuf.prototype.setClear=function(e){return this._core.clear!=e&&(this._core.clear=e,this._engine.display.imageDirty=!0),this},SceneJS.DepthBuf.prototype.getClear=function(){return this._core.clear},SceneJS.DepthBuf.prototype.setClearDepth=function(e){return this._core.clearDepth!=e&&(this._core.clearDepth=e,this._engine.display.imageDirty=!0),this},SceneJS.DepthBuf.prototype.getClearDepth=function(){return this._core.clearDepth},SceneJS.DepthBuf.prototype.setDepthFunc=function(e){if(this._core._depthFuncName!=e){var t=i[e];if(null==t)throw"unsupported value for 'clearFunc' attribute on depthBuffer node: '"+e+"' - supported values are 'less', 'equal', 'lequal', 'greater', 'notequal' and 'gequal'";this._core.depthFunc=this._engine.canvas.gl[t],this._core._depthFuncName=e,this._engine.display.imageDirty=!0}return this},SceneJS.DepthBuf.prototype.getDepthFunc=function(){return this._core._depthFuncName},SceneJS.DepthBuf.prototype._compile=function(e){this._engine.display.depthBuffer=r[n++]=this._core,this._compileNodes(e),this._engine.display.depthBuffer=0<--n?r[n-1]:t}}(),function(){var t={type:"colorBuffer",stateId:SceneJS._baseStateId++,blendEnabled:!1,colorMask:{r:!0,g:!0,b:!0,a:!0}},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.colorBuffer=t,r=0}),SceneJS.ColorBuffer=SceneJS_NodeFactory.createNodeType("colorBuffer"),SceneJS.ColorBuffer.prototype._init=function(e){null!=e.blendEnabled?this.setBlendEnabled(e.blendEnabled):1==this._core.useCount&&this.setBlendEnabled(!1),this.setColorMask(e)},SceneJS.ColorBuffer.prototype.setBlendEnabled=function(e){this._core.blendEnabled!=e&&(this._core.blendEnabled=e,this._engine.display.imageDirty=!0),this._engine.display.imageDirty=!0},SceneJS.ColorBuffer.prototype.getBlendEnabled=function(){return this._core.blendEnabled},SceneJS.ColorBuffer.prototype.setColorMask=function(e){this._core.colorMask={r:null==e.r||null==e.r||e.r,g:null==e.g||null==e.g||e.g,b:null==e.b||null==e.b||e.b,a:null==e.a||null==e.a||e.a},this._engine.display.imageDirty=!0},SceneJS.ColorBuffer.prototype.getColorMask=function(){return this._core.colorMask},SceneJS.ColorBuffer.prototype._compile=function(e){this._engine.display.colorBuffer=i[r++]=this._core,this._compileNodes(e),this._engine.display.colorBuffer=0<--r?i[r-1]:t,this._engine.display.imageDirty=!0}}(),function(){var t={type:"view",stateId:SceneJS._baseStateId++,scissorTestEnabled:!1},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.view=t,r=0}),SceneJS.View=SceneJS_NodeFactory.createNodeType("view"),SceneJS.View.prototype._init=function(e){null!=e.scissorTestEnabled?this.setScissorTestEnabled(e.scissorTestEnabled):1==this._core.useCount&&this.setScissorTestEnabled(!1)},SceneJS.View.prototype.setScissorTestEnabled=function(e){return this._core.scissorTestEnabled!=e&&(this._core.scissorTestEnabled=e,this._engine.display.imageDirty=!0),this},SceneJS.View.prototype.getScissorTestEnabled=function(){return this._core.scissorTestEnabled},SceneJS.View.prototype._compile=function(e){this._engine.display.view=i[r++]=this._core,this._compileNodes(e),this._engine.display.view=0<--r?i[r-1]:t}}(),SceneJS.Scene=SceneJS_NodeFactory.createNodeType("scene"),SceneJS.Scene.prototype._init=function(e){e.tagMask&&this.setTagMask(e.tagMask),this._tagSelector=null,this.transparent=!0===e.transparent},SceneJS.Scene.prototype.loseWebGLContext=function(){this._engine.loseWebGLContext()},SceneJS.Scene.prototype.getCanvas=function(){return this._engine.canvas.canvas},SceneJS.Scene.prototype.getGL=function(){return this._engine.canvas.gl},SceneJS.Scene.prototype.getZBufferDepth=function(){var e=this._engine.canvas.gl;return e.getParameter(e.DEPTH_BITS)},SceneJS.Scene.prototype.setTagMask=function(e){e=e||"XXXXXXXXXXXXXXXXXXXXXXXXXX",this._tagSelector||(this._tagSelector={}),this._tagSelector.mask=e,this._tagSelector.regex=e?new RegExp(e):null,this._engine.display.selectTags(this._tagSelector)},SceneJS.Scene.prototype.getTagMask=function(){return this._tagSelector?this._tagSelector.mask:null},SceneJS.Scene.prototype.setNumPasses=function(e){this._engine.setNumPasses(e)},SceneJS.Scene.prototype.renderFrame=function(e){return this._engine.renderFrame(e)},SceneJS.Scene.prototype.needFrame=function(){this._engine.display.imageDirty=!0},SceneJS.Scene.prototype.start=function(e){this._engine.start(e)},SceneJS.Scene.prototype.pause=function(e){this._engine.pause(e)},SceneJS.Scene.prototype.isRunning=function(){return this._engine.running},SceneJS.Scene.prototype.pick=function(e,t,i){var r=this._engine.pick(e,t,i);if(this.renderFrame({force:!0}),r)return this.publish("pick",r),r;this.publish("nopick")},SceneJS.Scene.prototype._destroy=function(){this.destroyed||(delete SceneJS._engines[this.id],SceneJS._engineIds.removeItem(this.id),this.destroyed=!0)},SceneJS.Scene.prototype.isActive=function(){return!this._engine.destroyed},SceneJS.Scene.prototype.stop=function(){this._engine.stop()},SceneJS.Scene.prototype.containsNode=function(e){return!!this._engine.findNode(e)},SceneJS.Scene.prototype.findNodes=function(e){return this._engine.findNodes(e)},SceneJS.Scene.prototype.findNode=function(e,t){return this.getNode(e,t)},SceneJS.Scene.prototype.getNode=function(e,t){var i=this._engine.findNode(e);return i?(t&&t(i),i):t?void this.once("nodes/"+e,t):null},SceneJS.Scene.prototype.hasCore=function(e,t){return this._engine.hasCore(e,t)},SceneJS.Scene.prototype.getStatus=function(){var e=SceneJS_sceneStatusModule.sceneStatus[this.id];return e?SceneJS._shallowClone(e):{destroyed:!0}},new function(){var i={type:"shader",stateId:SceneJS._baseStateId++,hash:"",empty:!0,shader:{}},n=[],s=[],o=[],a=[],c=[],h=[],l=0,u=!0;function r(e){for(var t,i,r={},n=0;n<l;n++)for(i in t=e[n])t.hasOwnProperty(i)&&(r[i]=t[i]);return r}SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.shader=i,u=!(l=0)}),SceneJS_events.addListener(SceneJS_events.OBJECT_COMPILING,function(e){if(u){if(0<l){var t={type:"shader",stateId:n[l-1],hash:n.slice(0,l).join("."),shaders:{fragment:{code:a.slice(0,l).join(""),hooks:r(c)},vertex:{code:s.slice(0,l).join(""),hooks:r(o)}},paramsStack:h.slice(0,l)};e.display.shader=t}else e.display.shader=i;u=!1}}),SceneJS.Shader=SceneJS_NodeFactory.createNodeType("shader"),SceneJS.Shader.prototype._init=function(e){1==this._core.useCount&&(this._setShaders(e.shaders),this.setParams(e.params))},SceneJS.Shader.prototype._setShaders=function(e){var t;e=e||[],this._core.shaders={};for(var i=0,r=e.length;i<r;i++){if(!(t=e[i]).stage)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"shader 'stage' attribute expected");var n;t.code&&(n=SceneJS._isArray(t.code)?t.code.join(""):t.code),this._core.shaders[t.stage]={code:n,hooks:t.hooks}}},SceneJS.Shader.prototype.setParams=function(e){e=e||{};var t=this._core.params;for(var i in t||(t=this._core.params={}),e)e.hasOwnProperty(i)&&(t[i]=e[i]);this._engine.display.imageDirty=!0},SceneJS.Shader.prototype.getParams=function(){var e=this._core.params;if(!e)return{};var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},SceneJS.Shader.prototype._compile=function(e){n[l]=this._core.coreId;var t=this._core.shaders,i=t.fragment||{},r=t.vertex||{};a[l]=i.code||"",c[l]=i.hooks||{},s[l]=r.code||"",o[l]=r.hooks||{},h[l]=this._core.params||{},l++,u=!0,this._compileNodes(e),l--,u=!0}},new function(){var i,r={type:"shaderParams",stateId:SceneJS._baseStateId++,empty:!0},n=[],s=[],o=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.shaderParams=r,i=!(o=0)}),SceneJS_events.addListener(SceneJS_events.OBJECT_COMPILING,function(e){if(i){if(0<o){var t={type:"shaderParams",stateId:n[o-1],paramsStack:s.slice(0,o)};e.display.shaderParams=t}else e.display.shaderParams=r;i=!1}}),SceneJS.ShaderParams=SceneJS_NodeFactory.createNodeType("shaderParams"),SceneJS.ShaderParams.prototype._init=function(e){1==this._core.useCount&&this.setParams(e.params)},SceneJS.ShaderParams.prototype.setParams=function(e){e=e||{};var t=this._core;for(var i in t.params||(t.params={}),e)e.hasOwnProperty(i)&&(t.params[i]=e[i]);this._engine.display.imageDirty=!0},SceneJS.ShaderParams.prototype.getParams=function(){var e=this._core.params;if(!e)return{};var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},SceneJS.ShaderParams.prototype._compile=function(e){n[o]=this._core.coreId,s[o]=this._core.params,o++,i=!0,this._compileNodes(e),o--,i=!0}},function(){var t={type:"style",stateId:SceneJS._baseStateId++,lineWidth:1},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.style=t,r=0}),SceneJS.Style=SceneJS_NodeFactory.createNodeType("style"),SceneJS.Style.prototype._init=function(e){null!=e.lineWidth&&this.setLineWidth(e.lineWidth)},SceneJS.Style.prototype.setLineWidth=function(e){return this._core.lineWidth!=e&&(this._core.lineWidth=e,this._engine.display.imageDirty=!0),this},SceneJS.Style.prototype.getLineWidth=function(){return this._core.lineWidth},SceneJS.Style.prototype._compile=function(e){this._engine.display.style=i[r++]=this._core,this._compileNodes(e),this._engine.display.style=0<--r?i[r-1]:t}}(),function(){var t={type:"tag",stateId:SceneJS._baseStateId++,tag:null},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.tag=t,r=0}),SceneJS.Tag=SceneJS_NodeFactory.createNodeType("tag"),SceneJS.Tag.prototype._init=function(e){if(1==this._core.useCount){if(!e.tag)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"tag node attribute missing : 'tag'");this.setTag(e.tag)}},SceneJS.Tag.prototype.setTag=function(e){var t=this._core;t.tag=e,t.pattern=null,t.matched=!1,this._engine.display.drawListDirty=!0},SceneJS.Tag.prototype.getTag=function(){return this._core.tag},SceneJS.Tag.prototype._compile=function(e){this._engine.display.tag=i[r++]=this._core,this._compileNodes(e),this._engine.display.tag=0<--r?i[r-1]:t}}(),new function(){var t={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""},i=[],r=0;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.texture=t,r=0}),SceneJS.Texture=SceneJS_NodeFactory.createNodeType("_texture"),SceneJS.Texture.prototype._init=function(e){if(1==this._core.useCount){this._core.layers=[],this._core.params={};var t,i=null==e.waitForLoad||e.waitForLoad;if(!e.layers)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers missing");if(!SceneJS._isArray(e.layers))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layers should be an array");for(var r=this._engine.canvas.gl,n=0;n<e.layers.length;n++){if(!((t=e.layers[n]).source||t.uri||t.src||t.colorTarget||t.video))throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+n+"  has no uri, src, source, colorTarget, video or canvasId specified");if(t.applyFrom&&"uv"!=t.applyFrom&&"uv2"!=t.applyFrom&&"normal"!=t.applyFrom&&"geometry"!=t.applyFrom)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+n+"  applyFrom value is unsupported - should be either 'uv', 'uv2', 'normal' or 'geometry'");if(t.applyTo&&"baseColor"!=t.applyTo&&"color"!=t.applyTo&&"specular"!=t.applyTo&&"emit"!=t.applyTo&&"alpha"!=t.applyTo&&"normals"!=t.applyTo&&"shine"!=t.applyTo)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+n+" applyTo value is unsupported - should be either 'color', 'baseColor', 'specular' or 'normals'");if(t.blendMode&&"add"!=t.blendMode&&"multiply"!=t.blendMode&&"mix"!=t.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer "+n+" blendMode value is unsupported - should be either 'add', 'multiply' or 'mix'");"color"==t.applyTo&&(t.applyTo="baseColor");var s=SceneJS._apply(t,{waitForLoad:i,texture:null,applyFrom:t.applyFrom||"uv",applyTo:t.applyTo||"baseColor",blendMode:t.blendMode||"multiply",blendFactor:null!=t.blendFactor&&null!=t.blendFactor?t.blendFactor:1,translate:{x:0,y:0},scale:{x:1,y:1},rotate:{z:0}});if(this._core.layers.push(s),this._setLayerTransform(t,s),s.colorTarget){var o=this._engine.findNode(s.colorTarget);o&&"colorTarget"==o.type&&(s.texture=o._core.colorTarget.getTexture())}else this._loadLayerTexture(r,s)}var a=this;this._core.webglRestored=function(){for(var e=a._core.layers,t=a._engine.canvas.gl,i=0,r=e.length;i<r;i++)a._loadLayerTexture(t,e[i])}}},SceneJS.Texture.prototype._loadLayerTexture=function(n,s){var o=this,a=s.source;if(a){if(!a.type)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"texture layer config expected: source.type");SceneJS.Plugins.getPlugin("texture",a.type,function(e){if(!e.getSource)throw SceneJS_error.fatalError(SceneJS.errors.PLUGIN_INVALID,"texture: 'getSource' method missing on plugin for texture source type '"+a.type+"'.");var t=e.getSource({gl:n});if(!t.subscribe)throw SceneJS_error.fatalError(SceneJS.errors.PLUGIN_INVALID,"texture: 'subscribe' method missing on plugin for texture source type '"+a.type+"'");var i,r=SceneJS_sceneStatusModule.taskStarted(o,"Loading texture");t.subscribe((i=!1,function(e){i?o._engine.display.imageDirty=!0:(i=!0,o._setLayerTexture(n,s,e),SceneJS_sceneStatusModule.taskFinished(r))})),t.configure&&t.configure(a),s._source=t})}else{var e=s.uri||s.src,t=SceneJS_sceneStatusModule.taskStarted(this,"Loading texture"),i=new Image;i.onload=function(){var e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,o._ensureImageSizePowerOfTwo(i)),o._setLayerTexture(n,s,e),SceneJS_sceneStatusModule.taskFinished(t),o._engine.display.imageDirty=!0},i.onerror=function(){SceneJS_sceneStatusModule.taskFailed(t)},0==e.indexOf("data")||(i.crossOrigin="Anonymous"),i.src=e}},SceneJS.Texture.prototype._ensureImageSizePowerOfTwo=function(e){if(!this._isPowerOfTwo(e.width)||!this._isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=this._nextHighestPowerOfTwo(e.width),t.height=this._nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),(e=t).crossOrigin=""}return e},SceneJS.Texture.prototype._isPowerOfTwo=function(e){return 0==(e&e-1)},SceneJS.Texture.prototype._nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},SceneJS.Texture.prototype._setLayerTexture=function(e,t,i){t.texture=new SceneJS._webgl.Texture2D(e,{texture:i,minFilter:this._getGLOption("minFilter",e,t,e.LINEAR_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",e,t,e.LINEAR),wrapS:this._getGLOption("wrapS",e,t,e.REPEAT),wrapT:this._getGLOption("wrapT",e,t,e.REPEAT),isDepth:this._getOption(t.isDepth,!1),depthMode:this._getGLOption("depthMode",e,t,e.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",e,t,e.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",e,t,e.LEQUAL),flipY:this._getOption(t.flipY,!0),width:this._getOption(t.width,1),height:this._getOption(t.height,1),internalFormat:this._getGLOption("internalFormat",e,t,e.LEQUAL),sourceFormat:this._getGLOption("sourceType",e,t,e.ALPHA),sourceType:this._getGLOption("sourceType",e,t,e.UNSIGNED_BYTE),update:null}),this.destroyed&&t.texture.destroy(),this._engine.display.imageDirty=!0},SceneJS.Texture.prototype._getGLOption=function(e,t,i,r){var n=i[e];if(null==n)return r;var s=SceneJS._webgl.enumMap[n];if(null==s)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+n+"'");return t[s]},SceneJS.Texture.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.Texture.prototype.setLayer=function(e){if(null==e.index||null==e.index)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index null or undefined");if(e.index<0||e.index>=this._core.layers.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this._core.layers.length+" layers defined)");this._setLayer(parseInt(e.index),e),this._engine.display.imageDirty=!0},SceneJS.Texture.prototype.setLayers=function(e){var t;for(var i in e)if(e.hasOwnProperty(i)&&(null!=i||null!=i)){if((t=parseInt(i))<0||t>=this._core.layers.length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Invalid texture set layer argument: index out of range ("+this._core.layers.length+" layers defined)");this._setLayer(t,e[i]||{})}this._engine.display.imageDirty=!0},SceneJS.Texture.prototype._setLayer=function(e,t){t=t||{};var i=this._core.layers[e];if(null!=t.blendFactor&&null!=t.blendFactor&&(i.blendFactor=t.blendFactor),t.source){var r=i._source;r&&r.configure&&r.configure(t.source)}(t.translate||t.rotate||t.scale)&&this._setLayerTransform(t,i)},SceneJS.Texture.prototype._setLayerTransform=function(e,t){var i,r;if(e.translate){var n=e.translate;null!=n.x&&(t.translate.x=n.x),null!=n.y&&(t.translate.y=n.y),i=SceneJS_math_translationMat4v([n.x||0,n.y||0,0])}if(e.scale){var s=e.scale;null!=s.x&&(t.scale.x=s.x),null!=s.y&&(t.scale.y=s.y),r=SceneJS_math_scalingMat4v([s.x||1,s.y||1,1]),i=i?SceneJS_math_mulMat4(i,r):r}if(e.rotate){var o=e.rotate;null!=o.z&&(t.rotate.z=o.z||0),r=SceneJS_math_rotationMat4v(.0174532925*o.z,[0,0,1]),i=i?SceneJS_math_mulMat4(i,r):r}i&&(t.matrix=i,t.matrixAsArray?t.matrixAsArray.set(t.matrix):t.matrixAsArray=new Float32Array(t.matrix),t.matrixAsArray=new Float32Array(t.matrix))},SceneJS.Texture.prototype._compile=function(e){this._core.hash||this._makeHash(),this._engine.display.texture=i[r++]=this._core,this._compileNodes(e),this._engine.display.texture=0<--r?i[r-1]:t},SceneJS.Texture.prototype._makeHash=function(){var e,t=this._core;if(t.layers&&0<t.layers.length){for(var i,r=t.layers,n=[],s=0,o=r.length;s<o;s++)i=r[s],n.push("/"),n.push(i.applyFrom),n.push("/"),n.push(i.applyTo),n.push("/"),n.push(i.blendMode),i.matrix&&n.push("/anim");e=n.join("")}else e="";t.hash!=e&&(t.hash=e)},SceneJS.Texture.prototype._destroy=function(){if(1==this._core.useCount)for(var e,t,i=this._core.layers,r=0,n=i.length;r<n;r++)(e=i[r]).texture&&e.texture.destroy(),(t=e._source)&&t.destroy&&t.destroy()}},new function(){var i={type:"texture",stateId:SceneJS._baseStateId++,empty:!0,hash:""};SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.texture=i,n=0});var r=[],n=0;function s(){var e,t;0==this.translate.x&&0==this.translate.y||(e=SceneJS_math_translationMat4v([this.translate.x||0,this.translate.y||0,0])),1==this.scale.x&&1==this.scale.y||(t=SceneJS_math_scalingMat4v([this.scale.x||1,this.scale.y||1,1]),e=e?SceneJS_math_mulMat4(e,t):t),0!=this.rotate&&(t=SceneJS_math_rotationMat4v(.0174532925*this.rotate,[0,0,1]),e=e?SceneJS_math_mulMat4(e,t):t),e&&(this.matrix=e,this.matrixAsArray?this.matrixAsArray.set(this.matrix):this.matrixAsArray=new Float32Array(this.matrix)),this._matrixDirty=!1}SceneJS.TextureMap=SceneJS_NodeFactory.createNodeType("texture"),SceneJS.TextureMap.prototype._init=function(e){var t=this;if(1==this._core.useCount){if(e.applyFrom&&"uv"!=e.applyFrom&&"uv2"!=e.applyFrom&&"normal"!=e.applyFrom&&"geometry"!=e.applyFrom)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyFrom value is unsupported - should be either 'uv', 'uv2', 'normal' or 'geometry'");if(e.applyTo&&"baseColor"!=e.applyTo&&"color"!=e.applyTo&&"specular"!=e.applyTo&&"emit"!=e.applyTo&&"alpha"!=e.applyTo&&"normals"!=e.applyTo&&"shine"!=e.applyTo)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture applyTo value is unsupported - should be either 'color', 'baseColor', 'specular' or 'normals'");if(e.blendMode&&"add"!=e.blendMode&&"multiply"!=e.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"texture layer blendMode value is unsupported - should be either 'add' or 'multiply'");"color"==e.applyTo&&(e.applyTo="baseColor"),this._core=SceneJS._apply(e,{waitForLoad:null==e.waitForLoad||e.waitForLoad,texture:null,applyFrom:e.applyFrom?e.applyFrom:"uv",applyTo:e.applyTo?e.applyTo:"baseColor",blendMode:e.blendMode?e.blendMode:"multiply",blendFactor:null!=e.blendFactor&&null!=e.blendFactor?e.blendFactor:1,translate:e.translate?SceneJS._apply(e.translate,{x:0,y:0}):{x:0,y:0},scale:e.scale?SceneJS._apply(e.scale,{x:1,y:1}):{x:1,y:1},rotate:e.rotate||0,matrix:null,_matrixDirty:!0,buildMatrix:s}),this._core.buildMatrix.call(this._core),e.src?(this._core.src=e.src,this._loadTexture(e.src)):e.image?(this._core.image=e.image,this._initTexture(e.image)):e.target&&this.getScene().getNode(e.target,function(e){t.setTarget(e)}),this._core.webglRestored=function(){t._core.src?t._loadTexture(t._core.src):t._core.image?t._initTexture(t._core.image):t._core.target}}},SceneJS.TextureMap.prototype._loadTexture=function(e){var t=this,i=SceneJS_sceneStatusModule.taskStarted(this,"Loading texture"),r=new Image;r.onload=function(){t._initTexture(r),SceneJS_sceneStatusModule.taskFinished(i),t._engine.display.imageDirty=!0},r.onerror=function(){SceneJS_sceneStatusModule.taskFailed(i)},0==e.indexOf("data")||(r.crossOrigin="Anonymous"),r.src=e},SceneJS.TextureMap.prototype._initTexture=function(e){var t=!!this._core.texture,i=this._engine.canvas.gl,r=t?this._core.texture.texture:i.createTexture();i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._ensureImageSizePowerOfTwo(e)),t||(this._core.texture=new SceneJS._webgl.Texture2D(i,{texture:r,minFilter:this._getGLOption("minFilter",i.LINEAR_MIPMAP_NEAREST),magFilter:this._getGLOption("magFilter",i.LINEAR),wrapS:this._getGLOption("wrapS",i.REPEAT),wrapT:this._getGLOption("wrapT",i.REPEAT),isDepth:this._getOption(this._core.isDepth,!1),depthMode:this._getGLOption("depthMode",i.LUMINANCE),depthCompareMode:this._getGLOption("depthCompareMode",i.COMPARE_R_TO_TEXTURE),depthCompareFunc:this._getGLOption("depthCompareFunc",i.LEQUAL),flipY:this._getOption(this._core.flipY,!0),width:this._getOption(this._core.width,1),height:this._getOption(this._core.height,1),internalFormat:this._getGLOption("internalFormat",i.LEQUAL),sourceFormat:this._getGLOption("sourceType",i.ALPHA),sourceType:this._getGLOption("sourceType",i.UNSIGNED_BYTE),update:null}),this.destroyed&&this._core.texture.destroy()),this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype._ensureImageSizePowerOfTwo=function(e){if(!this._isPowerOfTwo(e.width)||!this._isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=this._nextHighestPowerOfTwo(e.width),t.height=this._nextHighestPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),(e=t).crossOrigin=""}return e},SceneJS.TextureMap.prototype._isPowerOfTwo=function(e){return 0==(e&e-1)},SceneJS.TextureMap.prototype._nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},SceneJS.TextureMap.prototype._getGLOption=function(e,t){var i=this._engine.canvas.gl,r=this._core[e];if(null==r)return t;var n=SceneJS._webgl.enumMap[r];if(null==n)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"Unrecognised value for texture node property '"+e+"' value: '"+r+"'");return i[n]},SceneJS.TextureMap.prototype._getOption=function(e,t){return null==e?t:e},SceneJS.TextureMap.prototype.setSrc=function(e){this._core.image=null,this._core.src=e,this._core.target=null,this._loadTexture(e)},SceneJS.TextureMap.prototype.setImage=function(e){this._core.image=e,this._core.src=null,this._core.target=null,this._initTexture(e)},SceneJS.TextureMap.prototype.setTarget=function(e){"colorTarget"==e.type||"depthTarget"==e.type?(delete this._core.src,this._core.target=e,this._core.src=null,this._core.image=null,this._core.texture=e._core.renderBuf.getTexture(),this._core.texture.bufType=e._core.bufType,this._engine.display.imageDirty=!0):console.log("Target node type not compatible: "+e.type)},SceneJS.TextureMap.prototype.setBlendFactor=function(e){this._core.blendFactor=e,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getBlendFactor=function(){return this._core.blendFactor},SceneJS.TextureMap.prototype.setTranslate=function(e){this._core.translate||(this._core.translate={x:0,y:0}),this._core.translate.x=e.x,this._core.translate.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getTranslate=function(){return this._core.translate},SceneJS.TextureMap.prototype.setScale=function(e){this._core.scale||(this._core.scale={x:0,y:0}),this._core.scale.x=e.x,this._core.scale.y=e.y,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getScale=function(){return this._core.scale},SceneJS.TextureMap.prototype.setRotate=function(e){this._core.rotate=e,this._core._matrixDirty=!0,this._engine.display.imageDirty=!0},SceneJS.TextureMap.prototype.getRotate=function(){return this._core.rotate},SceneJS.TextureMap.prototype.getMatrix=function(){return this._core._matrixDirty&&this._core.buildMatrix.call(this.core)(),this.core.matrix},SceneJS.TextureMap.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("texture"));var t=this._engine.display.texture;this._core.empty||(this.__core.layers=t&&t.layers?t.layers.concat([this._core]):[this._core]),this._makeHash(this.__core),r[n++]=this.__core,this._engine.display.texture=this.__core,this._compileNodes(e),this._engine.display.texture=0<--n?r[n-1]:i},SceneJS.TextureMap.prototype._makeHash=function(e){var t;if(e.layers&&0<e.layers.length){for(var i,r=e.layers,n=[],s=0,o=r.length;s<o;s++)i=r[s],n.push("/"),n.push(i.applyFrom),n.push("/"),n.push(i.applyTo),n.push("/"),n.push(i.blendMode),i.matrix&&n.push("/anim");t=n.join("")}else t="";e.hash!=t&&(e.hash=t)},SceneJS.TextureMap.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&!this._core.target&&(this._core.texture.destroy(),this._core.texture=null),this._core&&this._engine._coreFactory.putCore(this._core)}},function(){var i={type:"cubemap",stateId:SceneJS._baseStateId++,empty:!0,texture:null,hash:""},r=[],n=0;function u(e){if(!s(e.width)||!s(e.height)){var t=document.createElement("canvas");t.width=o(e.width),t.height=o(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),(e=t).crossOrigin=""}return e}function s(e){return 0==(e&e-1)}function o(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(e){e.engine.display.cubemap=i,n=0}),SceneJS.Reflect=SceneJS_NodeFactory.createNodeType("reflect"),SceneJS.Reflect.prototype._init=function(e){if(1==this._core.useCount){if(this._core.hash="y",e.blendMode&&"add"!=e.blendMode&&"multiply"!=e.blendMode)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"reflection blendMode value is unsupported - should be either 'add' or 'multiply'");this._core.blendMode=e.blendMode||"multiply",this._core.intensity=null!=e.intensity&&null!=e.intensity?e.intensity:1,this._core.applyTo="reflect";for(var i=this,r=this._engine.canvas.gl,n=r.createTexture(),s=[r.TEXTURE_CUBE_MAP_POSITIVE_X,r.TEXTURE_CUBE_MAP_NEGATIVE_X,r.TEXTURE_CUBE_MAP_POSITIVE_Y,r.TEXTURE_CUBE_MAP_NEGATIVE_Y,r.TEXTURE_CUBE_MAP_POSITIVE_Z,r.TEXTURE_CUBE_MAP_NEGATIVE_Z],o=SceneJS_sceneStatusModule.taskStarted(this,"Loading reflection texture"),a=0,c=!1,t=0;t<s.length;t++){var h=s[t],l=new Image;l.onload=function(e,t){return function(){c||(r.bindTexture(r.TEXTURE_CUBE_MAP,n),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.texImage2D(e,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,u(t)),++a==s.length&&(i._core.texture=new SceneJS._webgl.Texture2D(r,{texture:n,target:r.TEXTURE_CUBE_MAP,minFilter:r.LINEAR,magFilter:r.LINEAR,wrapS:r.CLAMP_TO_EDGE,wrapT:r.CLAMP_TO_EDGE}),SceneJS_sceneStatusModule.taskFinished(o),i._engine.display.imageDirty=!0))}}(h,l),l.onerror=function(){c=!0,SceneJS_sceneStatusModule.taskFailed(o)},l.src=e.src[t]}}},SceneJS.Reflect.prototype._compile=function(e){this.__core||(this.__core=this._engine._coreFactory.getCore("cubemap"));var t=this._engine.display.cubemap;this._core.empty||(this.__core.layers=t&&t.layers?t.layers.concat([this._core]):[this._core]),this._makeHash(this.__core),r[n++]=this.__core,this._engine.display.cubemap=this.__core,this._compileNodes(e),this._engine.display.cubemap=0<--n?r[n-1]:i},SceneJS.Reflect.prototype._makeHash=function(e){var t;if(e.layers&&0<e.layers.length){for(var i,r=e.layers,n=[],s=0,o=r.length;s<o;s++)i=r[s],n.push("/"),n.push(i.applyTo),n.push("/"),n.push(i.blendMode);t=n.join("")}else t="";e.hash!=t&&(e.hash=t)},SceneJS.Reflect.prototype._destroy=function(){1==this._core.useCount&&this._core.texture&&(this._core.texture.destroy(),this._core.texture=null),this._core&&this._coreFactory.putCore(this._core)}}(),SceneJS.XForm=SceneJS_NodeFactory.createNodeType("xform"),SceneJS.XForm.prototype._init=function(e){1==this._core.useCount&&(SceneJS_modelXFormStack.buildCore(this._core),this.setElements(e.elements))},SceneJS.XForm.prototype.getModelMatrix=function(){return this._core.dirty&&this._core.build(),this._core.matrix},SceneJS.XForm.prototype.getWorldMatrix=function(){return this._core.dirty&&this._core.build(),Array.apply([],this._core.mat)},SceneJS.XForm.prototype.setElements=function(e){if(16!=(e=e||SceneJS_math_identityMat4()).length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.XForm elements should number 16");var t=this._core;if(t.matrix)for(var i=0;i<16;i++)t.matrix[i]=e[i];else t.matrix=e;return t.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.XForm.prototype._compile=function(e){SceneJS_modelXFormStack.push(this._core),this._compileNodes(e),SceneJS_modelXFormStack.pop()},SceneJS.Matrix=SceneJS_NodeFactory.createNodeType("matrix"),SceneJS.Matrix.prototype._init=function(e){1==this._core.useCount&&(SceneJS_modelXFormStack.buildCore(this._core),this.setElements(e.elements))},SceneJS.Matrix.prototype.getModelMatrix=function(){return this._core.dirty&&this._core.build(),this._core.matrix},SceneJS.Matrix.prototype.getWorldMatrix=function(){return this._core.dirty&&this._core.build(),Array.apply([],this._core.mat)},SceneJS.Matrix.prototype.setMatrix=function(e){if(16!=(e=e||SceneJS_math_identityMat4()).length)throw SceneJS_error.fatalError(SceneJS.errors.ILLEGAL_NODE_CONFIG,"SceneJS.Matrix elements should number 16");var t=this._core;if(t.matrix)for(var i=0;i<16;i++)t.matrix[i]=e[i];else t.matrix=e;return t.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Matrix.prototype.setElements=SceneJS.Matrix.prototype.setMatrix,SceneJS.Matrix.prototype._compile=function(e){SceneJS_modelXFormStack.push(this._core),this._compileNodes(e),SceneJS_modelXFormStack.pop()},SceneJS.Rotate=SceneJS_NodeFactory.createNodeType("rotate"),SceneJS.Rotate.prototype._init=function(e){if(1==this._core.useCount){SceneJS_modelXFormStack.buildCore(this._core),this.setMultOrder(e.multOrder),this.setAngle(e.angle),this.setXYZ({x:e.x,y:e.y,z:e.z});var t=this._core;this._core.buildMatrix=function(){t.matrix=SceneJS_math_rotationMat4v(t.angle*Math.PI/180,[t.x,t.y,t.z])}}},SceneJS.Rotate.prototype.getModelMatrix=function(){return this._core.dirty&&this._core.build(),this._core.matrix},SceneJS.Rotate.prototype.getWorldMatrix=function(){return this._core.dirty&&this._core.build(),Array.apply([],this._core.mat)},SceneJS.Rotate.prototype.setMultOrder=function(e){if("post"!=(e=e||"post")&&"pre"!=e)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Illegal multOrder for rotate node - '"+e+"' should be 'pre' or 'post'");this._core.multOrder=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.setAngle=function(e){this._core.angle=e||0,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.getAngle=function(){return this._core.angle},SceneJS.Rotate.prototype.setXYZ=function(e){e=e||{},this._core.x=e.x||0,this._core.y=e.y||0,this._core.z=e.z||0,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.getXYZ=function(){return{x:this._core.x,y:this._core.y,z:this._core.z}},SceneJS.Rotate.prototype.setX=function(e){this._core.x=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.getX=function(){return this._core.x},SceneJS.Rotate.prototype.setY=function(e){this._core.y=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.getY=function(){return this._core.y},SceneJS.Rotate.prototype.setZ=function(e){this._core.z=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype.getZ=function(){return this._core.z},SceneJS.Rotate.prototype.incAngle=function(e){this._core.angle+=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Rotate.prototype._compile=function(e){SceneJS_modelXFormStack.push(this._core),this._compileNodes(e),SceneJS_modelXFormStack.pop()},SceneJS.Translate=SceneJS_NodeFactory.createNodeType("translate"),SceneJS.Translate.prototype._init=function(e){if(1==this._core.useCount){SceneJS_modelXFormStack.buildCore(this._core),this.setMultOrder(e.multOrder),this.setXYZ({x:e.x,y:e.y,z:e.z});var t=this._core;this._core.buildMatrix=function(){t.matrix=SceneJS_math_translationMat4v([t.x,t.y,t.z],t.matrix)}}},SceneJS.Translate.prototype.getModelMatrix=function(){return this._core.dirty&&this._core.build(),this._core.matrix},SceneJS.Translate.prototype.getWorldMatrix=function(){return this._core.dirty&&this._core.build(),Array.apply([],this._core.mat)},SceneJS.Translate.prototype.setMultOrder=function(e){if("post"!=(e=e||"post")&&"pre"!=e)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Illegal multOrder for translate node - '"+e+"' should be 'pre' or 'post'");this._core.multOrder=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Translate.prototype.setXYZ=function(e){return e=e||{},this._core.x=e.x||0,this._core.y=e.y||0,this._core.z=e.z||0,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.getXYZ=function(){return{x:this._core.x,y:this._core.y,z:this._core.z}},SceneJS.Translate.prototype.setX=function(e){return this._core.x=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.setY=function(e){return this._core.y=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.setZ=function(e){return this._core.z=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.incX=function(e){return this._core.x+=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.incY=function(e){return this._core.y+=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.incZ=function(e){return this._core.z+=e,this._core.setDirty(),this._engine.display.imageDirty=!0,this},SceneJS.Translate.prototype.getX=function(){return this._core.x},SceneJS.Translate.prototype.getY=function(){return this._core.y},SceneJS.Translate.prototype.getZ=function(){return this._core.z},SceneJS.Translate.prototype._compile=function(e){SceneJS_modelXFormStack.push(this._core),this._compileNodes(e),SceneJS_modelXFormStack.pop()},SceneJS.Scale=SceneJS_NodeFactory.createNodeType("scale"),SceneJS.Scale.prototype._init=function(e){if(1==this._core.useCount){SceneJS_modelXFormStack.buildCore(this._core),this.setMultOrder(e.multOrder),this.setXYZ({x:e.x,y:e.y,z:e.z});var t=this._core;this._core.buildMatrix=function(){t.matrix=SceneJS_math_scalingMat4v([t.x,t.y,t.z])}}},SceneJS.Scale.prototype.getModelMatrix=function(){return this._core.dirty&&this._core.build(),this._core.matrix},SceneJS.Scale.prototype.getWorldMatrix=function(){return this._core.dirty&&this._core.build(),Array.apply([],this._core.mat)},SceneJS.Scale.prototype.setMultOrder=function(e){if("post"!=(e=e||"post")&&"pre"!=e)throw SceneJS_error.fatalError(SceneJS.errors.NODE_CONFIG_EXPECTED,"Illegal multOrder for scale node - '"+e+"' should be 'pre' or 'post'");this._core.multOrder=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.setXYZ=function(e){e=e||{},this._core.x=null==e.x?1:e.x,this._core.y=null==e.y?1:e.y,this._core.z=null==e.z?1:e.z,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.getXYZ=function(){return{x:this._core.x,y:this._core.y,z:this._core.z}},SceneJS.Scale.prototype.setX=function(e){this._core.x=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.setY=function(e){this._core.y=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.setZ=function(e){this._core.z=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.getX=function(){return this._core.x},SceneJS.Scale.prototype.getY=function(){return this._core.y},SceneJS.Scale.prototype.getZ=function(){return this._core.z},SceneJS.Scale.prototype.incX=function(e){this._core.x+=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype.incY=function(e){this._core.y+=e,this._core.matrixDirty=!0},SceneJS.Scale.prototype.incZ=function(e){this._core.z+=e,this._core.setDirty(),this._engine.display.imageDirty=!0},SceneJS.Scale.prototype._compile=function(e){SceneJS_modelXFormStack.push(this._core),this._compileNodes(e),SceneJS_modelXFormStack.pop()};var SceneJS_modelXFormStack=new function(){var t,e=SceneJS_math_identityMat4(),i=new Float32Array(e),r=SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(SceneJS_math_identityMat4(),SceneJS_math_mat4())),n=new Float32Array(r),s={type:"xform",stateId:SceneJS._baseStateId++,matrix:e,mat:i,normalMatrix:r,normalMat:n,parent:null,cores:[],numCores:0,dirty:!1,matrixDirty:!1},o=[],a=0;this.top=s;var c=this;SceneJS_events.addListener(SceneJS_events.SCENE_COMPILING,function(){a=0,c.top=s,t=!0}),SceneJS_events.addListener(SceneJS_events.OBJECT_COMPILING,function(e){t&&(e.display.modelTransform=0<a?o[a-1]:s,t=!1)}),this.buildCore=function(i){i.parent=null,i.cores=[],i.numCores=0,i.matrixDirty=!1,i.matrix=SceneJS_math_identityMat4(),i.mat=new Float32Array(i.matrix),i.normalMat=new Float32Array(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(i.matrix,SceneJS_math_mat4()))),i.dirty=!1,i.setDirty=function(){i.matrixDirty=!0,i.dirty,function e(t){t.dirty=!0;t.matrixDirty=!0;for(var i=0,r=t.numCores;i<r;i++)e(t.cores[i])}(i)},i.build=function(){i.matrixDirty&&(i.buildMatrix&&i.buildMatrix(),i.matrixDirty=!1);var e,t=i.parent;if(t)for(e=i.matrix.slice(0);t;)t.matrixDirty&&(t.buildMatrix&&t.buildMatrix(),t.mat.set(t.matrix),t.normalMat.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(t.matrix,SceneJS_math_mat4()))),t.matrixDirty=!1),SceneJS_math_mulMat4(t.matrix,e,e),t.dirty,t=t.parent;else e=i.matrix;i.mat.set(e),i.normalMat.set(SceneJS_math_transposeMat4(SceneJS_math_inverseMat4(e,SceneJS_math_mat4()))),i.dirty=!1}},this.push=function(e){(o[a++]=e).parent=this.top,e.dirty=!0,this.top&&(this.top.cores[this.top.numCores++]=e),e.numCores=0,this.top=e,t=!0},this.pop=function(){this.top=0<--a?o[a-1]:s,t=!0}};SceneJS.Types=new function(){this.addType=function(e,r){SceneJS_NodeFactory.createNodeType(e,r,function(e){var t;for(var i in r)if(r.hasOwnProperty(i))switch(t=r[i],i){case"init":case"construct":!function(){var t=r[i];e.prototype._init=function(e){t.call(this,e)},e.prototype._fromPlugin=!0}();break;case"destroy":case"destruct":e.prototype._destroy=t;break;default:e.prototype[i]=t}})},this.hasType=function(e){return!!SceneJS_NodeFactory.nodeTypes[e]}};var SceneJS_Display=function(e){this._canvas=e.canvas,this._programFactory=new SceneJS_ProgramFactory({canvas:e.canvas}),this._chunkFactory=new SceneJS_ChunkFactory,this.transparent=!0===e.transparent,this.enable=null,this.flags=null,this.layer=null,this.stage=null,this.renderer=null,this.depthBuffer=null,this.colorBuffer=null,this.view=null,this.lights=null,this.material=null,this.texture=null,this.cubemap=null,this.modelTransform=null,this.viewTransform=null,this.projTransform=null,this.renderTarget=null,this.clips=null,this.morphGeometry=null,this.name=null,this.tag=null,this.renderListeners=null,this.shader=null,this.shaderParams=null,this.style=null,this.geometry=null,this._objectFactory=new SceneJS_ObjectFactory,this._objects={},this._ambientColor=[0,0,0,1],this._objectList=[],this._objectListLen=0,this._drawList=[],this._drawListLen=0,this._pickDrawList=[],this._pickDrawListLen=0,this._targetList=[],this._targetListLen=0,this._frameCtx={pickNames:[],canvas:this._canvas,VAO:null},this._frameCtx.renderListenerCtx=new SceneJS.RenderContext(this._frameCtx),this.objectListDirty=!0,this.stateOrderDirty=!0,this.stateSortDirty=!0,this.drawListDirty=!0,this.imageDirty=!0,this.pickBufDirty=!0,this.rayPickBufDirty=!0};SceneJS_Display.prototype.webglRestored=function(){this._programFactory.webglRestored(),this._chunkFactory.webglRestored();var e=this._canvas.gl;this.pickBuf&&this.pickBuf.webglRestored(e),this.rayPickBuf&&this.rayPickBuf.webglRestored(e),this.imageDirty=!0},SceneJS_Display.prototype.buildObject=function(e){var t=this._objects[e];t||(t=this._objects[e]=this._objectFactory.getObject(e),this.objectListDirty=!0),t.stage=this.stage,t.layer=this.layer,t.renderTarget=this.renderTarget,t.texture=this.texture,t.cubemap=this.cubemap,t.geometry=this.geometry,t.enable=this.enable,t.flags=this.flags,t.tag=this.tag;var i=[this.geometry.hash,this.shader.hash,this.clips.hash,this.morphGeometry.hash,this.texture.hash,this.cubemap.hash,this.lights.hash].join(";");t.program&&i==t.hash||(t.program&&this._programFactory.putProgram(t.program),t.program=this._programFactory.getProgram(i,this),t.hash=i),this._setChunk(t,0,"program"),this._setChunk(t,1,"xform",this.modelTransform),this._setChunk(t,2,"lookAt",this.viewTransform),this._setChunk(t,3,"camera",this.projTransform),this._setChunk(t,4,"flags",this.flags),this._setChunk(t,5,"shader",this.shader),this._setChunk(t,6,"shaderParams",this.shaderParams),this._setChunk(t,7,"style",this.style),this._setChunk(t,8,"depthBuffer",this.depthBuffer),this._setChunk(t,9,"colorBuffer",this.colorBuffer),this._setChunk(t,10,"view",this.view),this._setChunk(t,11,"name",this.name),this._setChunk(t,12,"lights",this.lights),this._setChunk(t,13,"material",this.material),this._setChunk(t,14,"texture",this.texture),this._setChunk(t,15,"cubemap",this.cubemap),this._setChunk(t,16,"clips",this.clips),this._setChunk(t,17,"renderer",this.renderer),this._setChunk(t,18,"geometry",this.morphGeometry,this.geometry),this._setChunk(t,19,"listeners",this.renderListeners),this._setChunk(t,20,"draw",this.geometry)},SceneJS_Display.prototype._setChunk=function(e,t,i,r,n){var s,o=this._chunkFactory.chunkTypes[i];if(r){var a;if(r.empty)return(a=e.chunks[t])&&this._chunkFactory.putChunk(a),void(e.chunks[t]=null);s=o.prototype.programGlobal?"_"+r.stateId:"p"+e.program.id+"_"+r.stateId,n&&(s+="__"+n.stateId)}else s="p"+e.program.id;if(s=t+"__"+s,a=e.chunks[t]){if(a.id==s)return;this._chunkFactory.putChunk(a)}e.chunks[t]=this._chunkFactory.getChunk(s,i,e.program,r,n),"lights"==i&&this._setAmbient(r)},SceneJS_Display.prototype._setAmbient=function(e){for(var t,i=e.lights,r=0,n=i.length;r<n;r++)"ambient"==(t=i[r]).mode&&(this._ambientColor[0]=t.color[0],this._ambientColor[1]=t.color[1],this._ambientColor[2]=t.color[2])},SceneJS_Display.prototype.removeObject=function(e){var t=this._objects[e];t&&(this._programFactory.putProgram(t.program),t.program=null,t.hash=null,this._objectFactory.putObject(t),delete this._objects[e],this.objectListDirty=!0)},SceneJS_Display.prototype.selectTags=function(e){this._tagSelector=e,this.drawListDirty=!0},SceneJS_Display.prototype.render=function(e){e=e||{},this.objectListDirty&&(this._buildObjectList(),this.objectListDirty=!1,this.stateOrderDirty=!0),this.stateOrderDirty&&(this._makeStateSortKeys(),this.stateOrderDirty=!1,this.stateSortDirty=!0),this.stateSortDirty&&(this._stateSort(),this.stateSortDirty=!1,this.drawListDirty=!0),this.drawListDirty&&(this._buildDrawList(),this.imageDirty=!0),(this.imageDirty||e.force)&&(this._doDrawList({clear:!1!==e.clear}),this.imageDirty=!1,this.pickBufDirty=!0)},SceneJS_Display.prototype._buildObjectList=function(){for(var e in this._objectListLen=0,this._objects)this._objects.hasOwnProperty(e)&&(this._objectList[this._objectListLen++]=this._objects[e])},SceneJS_Display.prototype._makeStateSortKeys=function(){for(var e,t=0,i=this._objectListLen;t<i;t++)(e=this._objectList[t]).program?e.sortKey=1e12*(e.stage.priority+1)+1e9*(e.flags.transparent?2:1)+1e6*(e.layer.priority+1)+1e3*(e.program.id+1)+e.texture.stateId:e.sortKey=-1},SceneJS_Display.prototype._stateSort=function(){this._objectList.length=this._objectListLen,this._objectList.sort(this._stateSortObjects)},SceneJS_Display.prototype._stateSortObjects=function(e,t){return e.sortKey-t.sortKey},SceneJS_Display.prototype._logObjectList=function(){console.log("--------------------------------------------------------------------------------------------------"),console.log(this._objectListLen+" objects");for(var e=0,t=this._objectListLen;e<t;e++){var i=this._objectList[e];console.log("SceneJS_Display : object["+e+"] sortKey = "+i.sortKey)}console.log("--------------------------------------------------------------------------------------------------")},SceneJS_Display.prototype._buildDrawList=function(){this._lastStateId=this._lastStateId||[],this._lastPickStateId=this._lastPickStateId||[];for(var e=0;e<23;e++)this._lastStateId[e]=null,this._lastPickStateId[e]=null;this._drawListLen=0,this._pickDrawListLen=0;var t,i,r,n,s,o={},a=[],c=[];this._tagSelector&&(t=this._tagSelector.mask,i=this._tagSelector.regex),this._objectDrawList=this._objectDrawList||[];e=this._objectDrawListLen=0;for(var h=this._objectListLen;e<h;e++)if(!1!==(n=this._objectList[e]).enable.enabled&&!1!==n.flags.enabled&&n.layer.enabled&&(!t||!(r=n.tag).tag||(r.mask!=t&&(r.mask=t,r.matches=i.test(r.tag)),r.matches)))if(n.renderTarget.targets)for(var l,u,d,p=n.renderTarget.targets,f=0,g=p.length;f<g;f++)(d=o[u=(l=p[f]).coreId])||(d=[],o[u]=d,a.push(d),c.push(this._chunkFactory.getChunk(l.stateId,"renderTarget",n.program,l))),d.push(n);else this._objectDrawList[this._objectDrawListLen++]=n;for(e=0,h=a.length;e<h;e++){d=a[e],l=c[e],this._appendRenderTargetChunk(l);for(f=0,g=d.length;f<g;f++)s=(n=d[f]).stage&&n.stage.pickable,this._appendObjectToDrawLists(n,s)}n&&this._appendRenderTargetChunk(this._chunkFactory.getChunk(-1,"renderTarget",n.program,{}));for(e=0,h=this._objectDrawListLen;e<h;e++)s=!(n=this._objectDrawList[e]).stage||n.stage&&n.stage.pickable,this._appendObjectToDrawLists(n,s);this.drawListDirty=!1},SceneJS_Display.prototype._appendRenderTargetChunk=function(e){this._drawList[this._drawListLen++]=e},SceneJS_Display.prototype._appendObjectToDrawLists=function(e,t){for(var i,r=e.chunks,n=e.flags.picking,s=0,o=r.length;s<o;s++)(i=r[s])&&(i.draw&&(i.unique||this._lastStateId[s]!=i.id)&&(this._drawList[this._drawListLen++]=i,this._lastStateId[s]=i.id),i.pick&&!1!==t&&n&&(i.unique||this._lastPickStateId[s]!=i.id)&&(this._pickDrawList[this._pickDrawListLen++]=i,this._lastPickStateId[s]=i.id))},SceneJS_Display.prototype._logDrawList=function(){console.log("--------------------------------------------------------------------------------------------------"),console.log(this._drawListLen+" draw list chunks");for(var e=0,t=this._drawListLen;e<t;e++){var i=this._drawList[e];switch(console.log("[chunk "+e+"] type = "+i.type),i.type){case"draw":console.log("\n");break;case"renderTarget":console.log(" bufType = "+i.core.bufType)}}console.log("--------------------------------------------------------------------------------------------------")},SceneJS_Display.prototype._logPickList=function(){console.log("--------------------------------------------------------------------------------------------------"),console.log(this._pickDrawListLen+" pick list chunks");for(var e=0,t=this._pickDrawListLen;e<t;e++){var i=this._pickDrawList[e];switch(console.log("[chunk "+e+"] type = "+i.type),i.type){case"draw":console.log("\n");break;case"renderTarget":console.log(" bufType = "+i.core.bufType)}}console.log("--------------------------------------------------------------------------------------------------")},SceneJS_Display.prototype.pick=function(e){var t=this._canvas.canvas,i=null,r=e.canvasX,n=e.canvasY,s=this.pickBuf;s||(s=this.pickBuf=new SceneJS._webgl.RenderBuffer({canvas:this._canvas}),this.pickBufDirty=!0),this.render(),s.bind(),this.pickBufDirty&&(s.clear(),this._doDrawList({pick:!0,clear:!0}),this._canvas.gl.finish(),this.pickBufDirty=!1,this.rayPickBufDirty=!0);var o=s.read(r,n),a=o[0]+256*o[1]+65536*o[2],c=1<=a?a-1:-1;s.unbind();var h=this._frameCtx.pickNames[c];if(h&&(i={name:h.name,path:h.path,nodeId:h.nodeId,canvasPos:[r,n]},e.rayPick)){var l=this.rayPickBuf;l||(l=this.rayPickBuf=new SceneJS._webgl.RenderBuffer({canvas:this._canvas})),l.bind(),this.rayPickBufDirty&&(l.clear(),this._doDrawList({pick:!0,rayPick:!0,clear:!0}),this.rayPickBufDirty=!1),o=l.read(r,n),l.unbind();var u=this._unpackDepth(o),d=t.width,p=t.height,f=(r-d/2)/(d/2),g=-(n-p/2)/(p/2),m=this._frameCtx.cameraMat,_=this._frameCtx.viewMat,S=SceneJS_math_mulMat4(m,_,[]),v=SceneJS_math_inverseMat4(S,[]),y=SceneJS_math_transformVector4(v,[f,g,-1,1]);y=SceneJS_math_mulVec4Scalar(y,1/y[3]);var b=SceneJS_math_transformVector4(v,[f,g,1,1]);b=SceneJS_math_mulVec4Scalar(b,1/b[3]);var E=SceneJS_math_subVec3(b,y,[]),x=SceneJS_math_addVec3(y,SceneJS_math_mulVec4Scalar(E,u,[]),[]);i.worldPos=x}return i},SceneJS_Display.prototype._unpackDepth=function(e){var t=[e[0]/256,e[1]/256,e[2]/256,e[3]/256];return SceneJS_math_dotVector4(t,[1/16777216,1/65536,1/256,1])},SceneJS_Display.prototype._doDrawList=function(e){var t=this._canvas.gl,i=this._frameCtx;i.renderTarget=null,i.targetIndex=0,i.renderBuf=null,i.viewMat=null,i.modelMat=null,i.cameraMat=null,i.renderer=null,i.depthbufEnabled=null,i.clearDepth=null,i.depthFunc=t.LESS,i.scissorTestEnabled=!1,i.blendEnabled=!1,i.backfaces=!0,i.frontface="ccw",i.pick=!!e.pick,i.rayPick=!!e.rayPick,i.pickIndex=0,i.textureUnit=0,i.lineWidth=1,i.transparent=!1,i.ambientColor=this._ambientColor;var r=t.getExtension("OES_vertex_array_object");if(i.VAO=r||null,t.viewport(0,0,this._canvas.canvas.width,this._canvas.canvas.height),this.transparent?t.clearColor(0,0,0,0):t.clearColor(this._ambientColor[0],this._ambientColor[1],this._ambientColor[2],0),e.clear&&t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.frontFace(t.CCW),t.disable(t.CULL_FACE),t.disable(t.BLEND),e.pick)for(var n=0,s=this._pickDrawListLen;n<s;n++)this._pickDrawList[n].pick(i);else for(n=0,s=this._drawListLen;n<s;n++)this._drawList[n].draw(i);if(t.flush(),i.renderBuf&&(t.finish(),i.renderBuf.unbind()),i.VAO){i.VAO.bindVertexArrayOES(null);for(n=0;n<10;n++)t.disableVertexAttribArray(n)}},SceneJS_Display.prototype.destroy=function(){this._programFactory.destroy()};var SceneJS_ProgramSourceFactory=new function(){this._sourceCache={},this.getSource=function(e,t){var i=this._sourceCache[e];return i?(i.useCount++,i):this._sourceCache[e]=new SceneJS_ProgramSource(e,this._composePickingVertexShader(t),this._composePickingFragmentShader(t),this._composeRenderingVertexShader(t),this._composeRenderingFragmentShader(t))},this.putSource=function(e){var t=this._sourceCache[e];t&&0==--t.useCount&&(this._sourceCache[t.hash]=null)},this._composePickingVertexShader=function(e){var t=e.shader.shaders||{},i=t.vertex||{},r=i.hooks||{},n=(t.fragment||{}).hooks||{};if(t.vertex&&t.vertex.code&&""!=t.vertex.code&&SceneJS._isEmpty(t.vertex.hooks))return[t.vertex.code];e.clips.clips.length;var s=!!e.morphGeometry.targets,o=this._hasNormals(e),a=["precision mediump float;","attribute vec3 SCENEJS_aVertex;","uniform mat4 SCENEJS_uMMatrix;","uniform mat4 SCENEJS_uMNMatrix;","uniform mat4 SCENEJS_uVMatrix;","uniform mat4 SCENEJS_uVNMatrix;","uniform mat4 SCENEJS_uPMatrix;"];return o&&a.push("attribute vec3 SCENEJS_aNormal;"),o&&(n.worldNormal||n.viewNormal)&&(a.push("varying vec3 SCENEJS_vWorldNormal;"),a.push("varying vec3 SCENEJS_vViewNormal;")),a.push("varying vec4 SCENEJS_vWorldVertex;"),a.push("varying vec4 SCENEJS_vViewVertex;"),a.push("varying vec4 SCENEJS_vProjVertex;"),a.push("uniform vec3 SCENEJS_uWorldEye;"),a.push("varying vec3 SCENEJS_vWorldEyeVec;"),i.code&&a.push("\n"+i.code+"\n"),s&&(a.push("uniform float SCENEJS_uMorphFactor;"),e.morphGeometry.targets[0].vertexBuf&&a.push("attribute vec3 SCENEJS_aMorphVertex;")),a.push("void main(void) {"),a.push("   vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); "),o&&a.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),r.modelPos&&a.push("tmpVertex="+r.modelPos+"(tmpVertex);"),s&&e.morphGeometry.targets[0].vertexBuf&&(a.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); "),r.modelPos&&a.push("vMorphVertex="+r.modelPos+"(vMorphVertex);"),a.push("  tmpVertex = vec4(mix(tmpVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")),a.push("  tmpVertex = SCENEJS_uMMatrix * tmpVertex; "),r.worldPos&&a.push("tmpVertex="+r.worldPos+"(tmpVertex);"),a.push("  SCENEJS_vWorldVertex = tmpVertex; "),a.push("SCENEJS_vWorldEyeVec = normalize(SCENEJS_uWorldEye - tmpVertex.xyz);"),a.push("  tmpVertex = SCENEJS_uVMatrix * tmpVertex; "),r.viewPos&&a.push("tmpVertex="+r.viewPos+"(tmpVertex);"),a.push("  SCENEJS_vViewVertex = tmpVertex;"),o&&(n.worldNormal||n.viewNormal)&&(a.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); "),a.push("  SCENEJS_vWorldNormal = worldNormal;"),a.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")),a.push("  SCENEJS_vProjVertex = SCENEJS_uPMatrix * tmpVertex;"),a.push("  gl_Position = SCENEJS_vProjVertex;"),a.push("}"),a},this._composePickingFragmentShader=function(e){var t=e.shader.shaders||{},i=t.fragment||{},r=i.hooks||{};if(t.fragment&&t.fragment.code&&""!=t.fragment.code&&SceneJS._isEmpty(t.fragment.hooks))return[t.fragment.code];var n=0<e.clips.clips.length,s=this._hasNormals(e),o=["precision mediump float;"];if(o.push("vec4 packDepth(const in float depth) {"),o.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),o.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),o.push("  vec4 res = fract(depth * bitShift);"),o.push("  res -= res.xxyz * bitMask;"),o.push("  return res;"),o.push("}"),o.push("varying vec4 SCENEJS_vWorldVertex;"),o.push("varying vec4 SCENEJS_vViewVertex;"),o.push("varying vec4 SCENEJS_vProjVertex;"),o.push("uniform bool SCENEJS_uRayPickMode;"),o.push("uniform vec3 SCENEJS_uPickColor;"),o.push("uniform float SCENEJS_uZNear;"),o.push("uniform float SCENEJS_uZFar;"),o.push("varying vec3 SCENEJS_vWorldEyeVec;"),o.push("uniform bool  SCENEJS_uClipping;"),s&&(r.worldNormal||r.viewNormal)&&(o.push("varying vec3 SCENEJS_vWorldNormal;"),o.push("varying vec3 SCENEJS_vViewNormal;")),n)for(var a=0;a<e.clips.clips.length;a++)o.push("uniform float SCENEJS_uClipMode"+a+";"),o.push("uniform vec4  SCENEJS_uClipNormalAndDist"+a+";");if(i.code&&o.push("\n"+i.code+"\n"),o.push("void main(void) {"),r.worldPosClip&&o.push("if ("+r.worldPosClip+"(SCENEJS_vWorldVertex) == false) { discard; };"),r.viewPosClip&&o.push("if (!"+r.viewPosClip+"(SCENEJS_vViewVertex) == false) { discard; };"),n){o.push("if (SCENEJS_uClipping) {"),o.push("  float   dist;");for(a=0;a<e.clips.clips.length;a++)o.push("    if (SCENEJS_uClipMode"+a+" != 0.0) {"),o.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+a+".xyz) - SCENEJS_uClipNormalAndDist"+a+".w;"),o.push("        if (SCENEJS_uClipMode"+a+" == 1.0) {"),o.push("            if (dist > 0.0) { discard; }"),o.push("        }"),o.push("        if (SCENEJS_uClipMode"+a+" == 2.0) {"),o.push("            if (dist > 0.0) { discard; }"),o.push("        }"),o.push("    }");o.push("}")}return r.worldPos&&o.push(r.worldPos+"(SCENEJS_vWorldVertex);"),r.viewPos&&o.push(r.viewPos+"(SCENEJS_vViewVertex);"),r.worldEyeVec&&o.push(r.worldEyeVec+"(SCENEJS_vWorldEyeVec);"),s&&r.worldNormal&&o.push(r.worldNormal+"(SCENEJS_vWorldNormal);"),s&&r.viewNormal&&o.push(r.viewNormal+"(SCENEJS_vViewNormal);"),o.push("    if (SCENEJS_uRayPickMode) {"),o.push("          float zNormalizedDepth = abs((SCENEJS_uZNear + SCENEJS_vViewVertex.z) / (SCENEJS_uZFar - SCENEJS_uZNear));"),o.push("          gl_FragColor = packDepth(zNormalizedDepth); "),o.push("    } else {"),o.push("          gl_FragColor = vec4(SCENEJS_uPickColor.rgb, 1.0);  "),o.push("    }"),o.push("}"),o},this._isTexturing=function(e){if(e.texture.layers&&0<e.texture.layers.length){if(e.geometry.uvBuf||e.geometry.uvBuf2)return!0;if(e.morphGeometry.targets&&(e.morphGeometry.targets[0].uvBuf||e.morphGeometry.targets[0].uvBuf2))return!0}return!1},this._isCubeMapping=function(e){return e.cubemap.layers&&0<e.cubemap.layers.length&&e.geometry.normalBuf},this._hasNormals=function(e){return!!e.geometry.normalBuf||!(!e.morphGeometry.targets||!e.morphGeometry.targets[0].normalBuf)},this._composeRenderingVertexShader=function(e){var t=e.shader.shaders||{};if(t.vertex&&t.vertex.code&&""!=t.vertex.code&&SceneJS._isEmpty(t.vertex.hooks))return[t.vertex.code];var i=t.vertex||{},r=i.hooks||{},n=(t.fragment||{}).hooks||{},s=this._isTexturing(e),o=this._hasNormals(e),a=0<e.clips.clips.length,c=!!e.morphGeometry.targets,h=["precision mediump float;"];if(h.push("attribute vec3 SCENEJS_aVertex;"),h.push("uniform vec3 SCENEJS_uWorldEye;"),h.push("varying vec3 SCENEJS_vWorldEyeVec;"),o){h.push("attribute vec3 SCENEJS_aNormal;"),h.push("uniform   mat4 SCENEJS_uMNMatrix;"),h.push("uniform   mat4 SCENEJS_uVNMatrix;"),h.push("varying   vec3 SCENEJS_vWorldNormal;"),h.push("varying   vec3 SCENEJS_vViewNormal;");for(var l=0;l<e.lights.lights.length;l++){var u=e.lights.lights[l];"ambient"!=u.mode&&("dir"==u.mode&&h.push("uniform vec3 SCENEJS_uLightDir"+l+";"),"point"==u.mode&&h.push("uniform vec3 SCENEJS_uLightPos"+l+";"),"spot"==u.mode&&h.push("uniform vec3 SCENEJS_uLightPos"+l+";"),h.push("varying vec4 SCENEJS_vViewLightVecAndDist"+l+";"))}}if(s&&(e.geometry.uvBuf&&h.push("attribute vec2 SCENEJS_aUVCoord;"),e.geometry.uvBuf2&&h.push("attribute vec2 SCENEJS_aUVCoord2;")),e.geometry.colorBuf&&(h.push("attribute vec4 SCENEJS_aVertexColor;"),h.push("varying vec4 SCENEJS_vColor;")),h.push("uniform mat4 SCENEJS_uMMatrix;"),h.push("uniform mat4 SCENEJS_uVMatrix;"),h.push("uniform mat4 SCENEJS_uPMatrix;"),(a||n.worldPos)&&h.push("varying vec4 SCENEJS_vWorldVertex;"),h.push("varying vec4 SCENEJS_vViewVertex;"),s&&(e.geometry.uvBuf&&h.push("varying vec2 SCENEJS_vUVCoord;"),e.geometry.uvBuf2&&h.push("varying vec2 SCENEJS_vUVCoord2;")),c&&(h.push("uniform float SCENEJS_uMorphFactor;"),e.morphGeometry.targets[0].vertexBuf&&h.push("attribute vec3 SCENEJS_aMorphVertex;"),o&&e.morphGeometry.targets[0].normalBuf&&h.push("attribute vec3 SCENEJS_aMorphNormal;")),i.code&&h.push("\n"+i.code+"\n"),h.push("void main(void) {"),h.push("vec4 tmpVertex=vec4(SCENEJS_aVertex, 1.0); "),r.modelPos&&h.push("tmpVertex="+r.modelPos+"(tmpVertex);"),h.push("  vec4 modelVertex = tmpVertex; "),o&&h.push("  vec4 modelNormal = vec4(SCENEJS_aNormal, 0.0); "),c&&(e.morphGeometry.targets[0].vertexBuf&&(h.push("  vec4 vMorphVertex = vec4(SCENEJS_aMorphVertex, 1.0); "),h.push("  modelVertex = vec4(mix(modelVertex.xyz, vMorphVertex.xyz, SCENEJS_uMorphFactor), 1.0); ")),o&&e.morphGeometry.targets[0].normalBuf&&(h.push("  vec4 vMorphNormal = vec4(SCENEJS_aMorphNormal, 1.0); "),h.push("  modelNormal = vec4( mix(modelNormal.xyz, vMorphNormal.xyz, SCENEJS_uMorphFactor), 1.0); "))),h.push("  vec4 worldVertex = SCENEJS_uMMatrix * modelVertex; "),r.worldPos&&h.push("worldVertex="+r.worldPos+"(worldVertex);"),r.viewMatrix?h.push("vec4 viewVertex = "+r.viewMatrix+"(SCENEJS_uVMatrix) * worldVertex;"):h.push("vec4 viewVertex  = SCENEJS_uVMatrix * worldVertex; "),r.viewPos&&h.push("viewVertex="+r.viewPos+"(viewVertex);"),o&&(h.push("  vec3 worldNormal = normalize((SCENEJS_uMNMatrix * modelNormal).xyz); "),h.push("  SCENEJS_vWorldNormal = worldNormal;"),h.push("  SCENEJS_vViewNormal = (SCENEJS_uVNMatrix * vec4(worldNormal, 1.0)).xyz;")),(a||n.worldPos)&&h.push("  SCENEJS_vWorldVertex = worldVertex;"),h.push("  SCENEJS_vViewVertex = viewVertex;"),r.projMatrix?h.push("gl_Position = "+r.projMatrix+"(SCENEJS_uPMatrix) * viewVertex;"):h.push("  gl_Position = SCENEJS_uPMatrix * viewVertex;"),h.push("  vec3 tmpVec3;"),o)for(l=0;l<e.lights.lights.length;l++)"ambient"!=(u=e.lights.lights[l]).mode&&("dir"==u.mode&&("world"==u.space?h.push("SCENEJS_vViewLightVecAndDist"+l+" = vec4(-normalize((SCENEJS_uVMatrix * vec4(SCENEJS_uLightDir"+l+", 0.0)).xyz), 0.0);"):h.push("SCENEJS_vViewLightVecAndDist"+l+" = vec4(-normalize(SCENEJS_uLightDir"+l+"), 0.0);")),"point"==u.mode&&("world"==u.space?h.push("tmpVec3 = ((SCENEJS_uVMatrix * vec4(SCENEJS_uLightPos"+l+", 1.0)).xyz - worldVertex.xyz);"):h.push("tmpVec3 = (SCENEJS_uLightPos"+l+".xyz - worldVertex.xyz);"),h.push("SCENEJS_vViewLightVecAndDist"+l+" = vec4(normalize(tmpVec3), length(tmpVec3));")));return h.push("SCENEJS_vWorldEyeVec = normalize(SCENEJS_uWorldEye - worldVertex.xyz);"),s&&(e.geometry.uvBuf&&h.push("SCENEJS_vUVCoord = SCENEJS_aUVCoord;"),e.geometry.uvBuf2&&h.push("SCENEJS_vUVCoord2 = SCENEJS_aUVCoord2;")),e.geometry.colorBuf&&h.push("SCENEJS_vColor = SCENEJS_aVertexColor;"),h.push("}"),h},this._composeRenderingFragmentShader=function(e){var t=e.shader.shaders||{};if(t.fragment&&t.fragment.code&&""!=t.fragment.code&&SceneJS._isEmpty(t.fragment.hooks))return[t.fragment.code];var i=t.fragment||{},r=i.hooks||{},n=this._isTexturing(e),s=this._isCubeMapping(e),o=this._hasNormals(e),a=0<e.clips.clips.length,c=["\n"];if(c.push("precision mediump float;"),(a||r.worldPos)&&c.push("varying vec4 SCENEJS_vWorldVertex;"),c.push("varying vec4 SCENEJS_vViewVertex;"),c.push("uniform float SCENEJS_uZNear;"),c.push("uniform float SCENEJS_uZFar;"),a)for(var h=0;h<e.clips.clips.length;h++)c.push("uniform float SCENEJS_uClipMode"+h+";"),c.push("uniform vec4  SCENEJS_uClipNormalAndDist"+h+";");if(n){e.geometry.uvBuf&&c.push("varying vec2 SCENEJS_vUVCoord;"),e.geometry.uvBuf2&&c.push("varying vec2 SCENEJS_vUVCoord2;");h=0;for(var l=e.texture.layers.length;h<l;h++)u=e.texture.layers[h],c.push("uniform sampler2D SCENEJS_uSampler"+h+";"),u.matrix&&c.push("uniform mat4 SCENEJS_uLayer"+h+"Matrix;"),c.push("uniform float SCENEJS_uLayer"+h+"BlendFactor;")}if(o&&s){var u;for(h=0,l=e.cubemap.layers.length;h<l;h++)u=e.cubemap.layers[h],c.push("uniform samplerCube SCENEJS_uCubeMapSampler"+h+";"),c.push("uniform float SCENEJS_uCubeMapIntensity"+h+";")}if(c.push("uniform bool  SCENEJS_uBackfaceTexturing;"),c.push("uniform bool  SCENEJS_uBackfaceLighting;"),c.push("uniform bool  SCENEJS_uSpecularLighting;"),c.push("uniform bool  SCENEJS_uClipping;"),c.push("uniform bool  SCENEJS_uAmbient;"),c.push("uniform bool  SCENEJS_uDiffuse;"),c.push("uniform bool  SCENEJS_uReflection;"),c.push("uniform bool  SCENEJS_uDepthMode;"),c.push("uniform bool  SCENEJS_uTransparent;"),e.geometry.colorBuf&&c.push("varying vec4 SCENEJS_vColor;"),c.push("uniform vec3  SCENEJS_uAmbientColor;"),c.push("uniform vec3  SCENEJS_uMaterialColor;"),c.push("uniform float SCENEJS_uMaterialAlpha;"),c.push("uniform float SCENEJS_uMaterialEmit;"),c.push("uniform vec3  SCENEJS_uMaterialSpecularColor;"),c.push("uniform float SCENEJS_uMaterialSpecular;"),c.push("uniform float SCENEJS_uMaterialShine;"),c.push("varying vec3 SCENEJS_vWorldEyeVec;"),o){c.push("varying vec3 SCENEJS_vWorldNormal;"),c.push("varying vec3 SCENEJS_vViewNormal;");for(h=0;h<e.lights.lights.length;h++)"ambient"!=(d=e.lights.lights[h]).mode&&(c.push("uniform vec3  SCENEJS_uLightColor"+h+";"),"point"==d.mode&&c.push("uniform vec3  SCENEJS_uLightAttenuation"+h+";"),c.push("varying vec4  SCENEJS_vViewLightVecAndDist"+h+";"))}if(i.code&&c.push("\n"+i.code+"\n"),c.push("void main(void) {"),c.push("  vec3    ambient= SCENEJS_uAmbient ? SCENEJS_uAmbientColor : vec3(0.0, 0.0, 0.0);"),a){c.push("if (SCENEJS_uClipping) {"),c.push("  float   dist;");for(h=0;h<e.clips.clips.length;h++)c.push("    if (SCENEJS_uClipMode"+h+" != 0.0) {"),c.push("        dist = dot(SCENEJS_vWorldVertex.xyz, SCENEJS_uClipNormalAndDist"+h+".xyz) - SCENEJS_uClipNormalAndDist"+h+".w;"),c.push("        if (SCENEJS_uClipMode"+h+" == 1.0) {"),c.push("            if (dist > 0.0) { discard; }"),c.push("        }"),c.push("        if (SCENEJS_uClipMode"+h+" == 2.0) {"),c.push("            if (dist > 0.0) { discard; }"),c.push("        }"),c.push("    }");c.push("}")}if(n&&e.geometry.uvBuf&&r.texturePos&&c.push(r.texturePos+"(SCENEJS_vUVCoord);"),r.worldPos&&c.push(r.worldPos+"(SCENEJS_vWorldVertex);"),r.viewPos&&c.push(r.viewPos+"(SCENEJS_vViewVertex);"),r.worldEyeVec&&c.push(r.worldEyeVec+"(SCENEJS_vWorldEyeVec);"),o&&r.worldNormal&&c.push(r.worldNormal+"(SCENEJS_vWorldNormal);"),o&&r.viewNormal&&c.push(r.viewNormal+"(SCENEJS_vViewNormal);"),e.geometry.colorBuf?c.push("  vec3    color   = SCENEJS_vColor.rgb;"):c.push("  vec3    color   = SCENEJS_uMaterialColor;"),c.push("  float alpha         = SCENEJS_uMaterialAlpha;"),c.push("  float emit          = SCENEJS_uMaterialEmit;"),c.push("  float specular      = SCENEJS_uMaterialSpecular;"),c.push("  vec3  specularColor = SCENEJS_uMaterialSpecularColor;"),c.push("  float shine         = SCENEJS_uMaterialShine;"),r.materialBaseColor&&c.push("color="+r.materialBaseColor+"(color);"),r.materialAlpha&&c.push("alpha="+r.materialAlpha+"(alpha);"),r.materialEmit&&c.push("emit="+r.materialEmit+"(emit);"),r.materialSpecular&&c.push("specular="+r.materialSpecular+"(specular);"),r.materialSpecularColor&&c.push("specularColor="+r.materialSpecularColor+"(specularColor);"),r.materialShine&&c.push("shine="+r.materialShine+"(shine);"),o&&(c.push("  float   attenuation = 1.0;"),c.push("  vec3    viewNormalVec = SCENEJS_vViewNormal;"),c.push("  vec3    worldNormalVec = SCENEJS_vWorldNormal;")),n){o&&c.push("if (SCENEJS_uBackfaceTexturing || dot(SCENEJS_vWorldNormal, SCENEJS_vWorldEyeVec) > 0.0) {"),c.push("  vec4    texturePos;"),c.push("  vec2    textureCoord=vec2(0.0,0.0);");for(h=0,l=e.texture.layers.length;h<l;h++){if("normal"==(u=e.texture.layers[h]).applyFrom&&o){if(!e.geometry.normalBuf){SceneJS.log.warn("Texture layer applyFrom='normal' but geo has no normal vectors");continue}c.push("texturePos=vec4(viewNormalVec.xyz, 1.0);")}if("uv"==u.applyFrom){if(!e.geometry.uvBuf){SceneJS.log.warn("Texture layer applyTo='uv' but geometry has no UV coordinates");continue}c.push("texturePos = vec4(SCENEJS_vUVCoord.s, SCENEJS_vUVCoord.t, 1.0, 1.0);")}if("uv2"==u.applyFrom){if(!e.geometry.uvBuf2){SceneJS.log.warn("Texture layer applyTo='uv2' but geometry has no UV2 coordinates");continue}c.push("texturePos = vec4(SCENEJS_vUVCoord2.s, SCENEJS_vUVCoord2.t, 1.0, 1.0);")}u.matrix?c.push("textureCoord=(SCENEJS_uLayer"+h+"Matrix * texturePos).xy;"):c.push("textureCoord=texturePos.xy;"),"alpha"==u.applyTo&&("multiply"==u.blendMode?c.push("alpha = alpha * (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);"):"add"==u.blendMode&&c.push("alpha = ((1.0 - SCENEJS_uLayer"+h+"BlendFactor) * alpha) + (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).b);")),"baseColor"==u.applyTo&&("multiply"==u.blendMode?c.push("color = color * (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);"):c.push("color = ((1.0 - SCENEJS_uLayer"+h+"BlendFactor) * color) + (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).rgb);")),"emit"==u.applyTo&&("multiply"==u.blendMode?c.push("emit  = emit * (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);"):c.push("emit = ((1.0 - SCENEJS_uLayer"+h+"BlendFactor) * emit) + (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")),"specular"==u.applyTo&&o&&("multiply"==u.blendMode?c.push("specular  = specular * (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);"):c.push("specular = ((1.0 - SCENEJS_uLayer"+h+"BlendFactor) * specular) + (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")),"shine"==u.applyTo&&("multiply"==u.blendMode?c.push("shine  = shine * (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);"):c.push("shine = ((1.0 - SCENEJS_uLayer"+h+"BlendFactor) * shine) + (SCENEJS_uLayer"+h+"BlendFactor * texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, 1.0 - textureCoord.y)).r);")),"normals"==u.applyTo&&o&&(c.push("vec3 bump = normalize(texture2D(SCENEJS_uSampler"+h+", vec2(textureCoord.x, -textureCoord.y)).xyz * 2.0 - 1.0);"),c.push("worldNormalVec = bump;"))}o&&c.push("}")}if(o&&s){c.push("if (SCENEJS_uReflection) {"),c.push("vec3 envLookup = reflect(normalize(SCENEJS_vWorldEyeVec), normalize(worldNormalVec));"),c.push("envLookup.y = envLookup.y * -1.0;"),c.push("vec4 envColor;");for(h=0,l=e.cubemap.layers.length;h<l;h++)u=e.cubemap.layers[h],c.push("envColor = textureCube(SCENEJS_uCubeMapSampler"+h+", envLookup);"),c.push("color = mix(color, envColor.rgb, specular * SCENEJS_uCubeMapIntensity"+h+");");c.push("}")}if(c.push("  vec4    fragColor;"),o){var d;c.push("if (SCENEJS_uBackfaceLighting || dot(SCENEJS_vWorldNormal, SCENEJS_vWorldEyeVec) > 0.0) {"),c.push("  vec3    lightValue      = vec3(0.0, 0.0, 0.0);"),c.push("  vec3    specularValue   = vec3(0.0, 0.0, 0.0);"),c.push("  vec3    viewLightVec;"),c.push("  float   dotN;"),c.push("  float   lightDist;");for(h=0,l=e.lights.lights.length;h<l;h++)"ambient"!=(d=e.lights.lights[h]).mode&&(c.push("viewLightVec = SCENEJS_vViewLightVecAndDist"+h+".xyz;"),"point"==d.mode&&(c.push("dotN = max(dot(viewNormalVec, viewLightVec), 0.0);"),c.push("lightDist = SCENEJS_vViewLightVecAndDist"+h+".w;"),c.push("attenuation = 1.0 - (  SCENEJS_uLightAttenuation"+h+"[0] +   SCENEJS_uLightAttenuation"+h+"[1] * lightDist +   SCENEJS_uLightAttenuation"+h+"[2] * lightDist * lightDist);"),d.diffuse&&(c.push("if (SCENEJS_uDiffuse) {"),c.push("      lightValue += dotN * SCENEJS_uLightColor"+h+" * attenuation;"),c.push("}")),d.specular&&(c.push("if (SCENEJS_uSpecularLighting) {"),c.push("    specularValue += specularColor * SCENEJS_uLightColor"+h+" * specular * pow(max(dot(reflect(-viewLightVec, -viewNormalVec), vec3(0.0,0.0,1.0)), 0.0), shine) * attenuation;"),c.push("}"))),"dir"==d.mode&&(c.push("dotN = max(dot(viewNormalVec, viewLightVec), 0.0);"),d.diffuse&&(c.push("if (SCENEJS_uDiffuse) {"),c.push("      lightValue += dotN * SCENEJS_uLightColor"+h+";"),c.push("}")),d.specular&&(c.push("if (SCENEJS_uSpecularLighting) {"),c.push("    specularValue += specularColor * SCENEJS_uLightColor"+h+" * specular * pow(max(dot(reflect(-viewLightVec, -viewNormalVec), vec3(0.0,0.0,1.0)), 0.0), shine);"),c.push("}"))));c.push("      fragColor = vec4((specularValue.rgb + color.rgb * (lightValue.rgb + ambient.rgb)) + (emit * color.rgb), alpha);"),c.push("   } else {"),c.push("      fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambient.rgb), alpha);"),c.push("   }")}else c.push("fragColor = vec4((color.rgb + (emit * color.rgb)) *  (vec3(1.0, 1.0, 1.0) + ambient.rgb), alpha);");return r.pixelColor&&c.push("fragColor="+r.pixelColor+"(fragColor);"),c.push("    if (SCENEJS_uDepthMode) {"),c.push("          float depth = length(SCENEJS_vViewVertex) / (SCENEJS_uZFar - SCENEJS_uZNear);"),c.push("          const vec4 bias = vec4(1.0 / 255.0,"),c.push("          1.0 / 255.0,"),c.push("          1.0 / 255.0,"),c.push("          0.0);"),c.push("          float r = depth;"),c.push("          float g = fract(r * 255.0);"),c.push("          float b = fract(g * 255.0);"),c.push("          float a = fract(b * 255.0);"),c.push("          vec4 colour = vec4(r, g, b, a);"),c.push("          gl_FragColor = colour - (colour.yzww * bias);"),c.push("    } else {"),c.push("          gl_FragColor = fragColor;"),c.push("    };"),c.push("}"),c}},SceneJS_ProgramSource=function(e,t,i,r,n){this.hash=e,this.pickVertexSrc=t,this.pickFragmentSrc=i,this.drawVertexSrc=r,this.drawFragmentSrc=n,this.useCount=0},SceneJS_ProgramFactory=function(e){this._canvas=e.canvas,this._programs={},this._nextProgramId=0};SceneJS_ProgramFactory.prototype.getProgram=function(e,t){var i=this._programs[e];if(!i){var r=SceneJS_ProgramSourceFactory.getSource(e,t);i=new SceneJS_Program(this._nextProgramId++,e,r,this._canvas.gl),this._programs[e]=i}return i.useCount++,i},SceneJS_ProgramFactory.prototype.putProgram=function(e){--e.useCount<=0&&(e.draw.destroy(),e.pick.destroy(),SceneJS_ProgramSourceFactory.putSource(e.hash),this._programs[e.hash]=null)},SceneJS_ProgramFactory.prototype.webglRestored=function(){var e=this._canvas.gl;for(var t in this._programs)this._programs.hasOwnProperty(t)&&this._programs[t].build(e)},SceneJS_ProgramFactory.prototype.destroy=function(){};var SceneJS_Program=function(e,t,i,r){this.id=e,this.hash=i.hash,this.source=i,this.gl=r,this.draw=null,this.pick=null,this.useCount=0,this.build(r)};SceneJS_Program.prototype.build=function(e){this.drawUniformFlags=0,this.gl=e,this.draw=new SceneJS._webgl.Program(e,[this.source.drawVertexSrc.join("\n")],[this.source.drawFragmentSrc.join("\n")]),this.pick=new SceneJS._webgl.Program(e,[this.source.pickVertexSrc.join("\n")],[this.source.pickFragmentSrc.join("\n")])};var SceneJS_ObjectFactory=function(){};SceneJS_ObjectFactory.prototype._freeObjects=[],SceneJS_ObjectFactory.prototype._numFreeObjects=0,SceneJS_ObjectFactory.prototype.getObject=function(e){var t;return 0<this._numFreeObjects?((t=this._freeObjects[--this._numFreeObjects]).id=e,t):new SceneJS_Object(e)},SceneJS_ObjectFactory.prototype.putObject=function(e){this._freeObjects[this._numFreeObjects++]=e};var SceneJS_Object=function(e){this.id=e,this.hash=null,this.sortKey=null,this.chunks=[],this.chunksLen=0,this.program=null,this.layer=null,this.texture=null,this.flags=null,this.tag=null};SceneJS.RenderContext=function(e){this._frameCtx=e},SceneJS.RenderContext.prototype.getCameraMatrix=function(){return this._frameCtx.cameraMat},SceneJS.RenderContext.prototype.getViewMatrix=function(){return this._frameCtx.viewMat},SceneJS.RenderContext.prototype.getModelMatrix=function(){return this._frameCtx.modelMat},SceneJS.RenderContext.prototype.getCanvasPos=function(e){this.getProjPos(e);var t=this._frameCtx.canvas.canvas,i=t.width,r=t.height,n=this._pc;return{x:n[0]/n[3]*i*.5+.5*i,y:r-n[1]/n[3]*r*.5-.5*r}},SceneJS.RenderContext.prototype.getCameraPos=function(e){return this.getProjPos(e),this._camPos=SceneJS_math_normalizeVec3(this._pc,[0,0,0]),{x:this._camPos[0],y:this._camPos[1],z:this._camPos[2]}},SceneJS.RenderContext.prototype.getProjPos=function(e){return this.getViewPos(e),this._pc=SceneJS_math_transformPoint3(this._frameCtx.cameraMat,this._vc),{x:this._pc[0],y:this._pc[1],z:this._pc[2],w:this._pc[3]}},SceneJS.RenderContext.prototype.getViewPos=function(e){return this.getWorldPos(e),this._vc=SceneJS_math_transformPoint3(this._frameCtx.viewMat,this._wc),{x:this._vc[0],y:this._vc[1],z:this._vc[2],w:this._vc[3]}},SceneJS.RenderContext.prototype.getWorldPos=function(e){return this._wc=SceneJS_math_transformPoint3(this._frameCtx.modelMat,e||[0,0,0]),{x:this._wc[0],y:this._wc[1],z:this._wc[2],w:this._wc[3]}};var SceneJS_Chunk=function(){};SceneJS_Chunk.prototype.init=function(e,t,i,r){this.id=e,this.program=t,this.core=i,this.core2=r,this.build&&this.build()};var SceneJS_ChunkFactory=function(){this._chunks={},this.chunkTypes=SceneJS_ChunkFactory.chunkTypes};function ReadUTF8(t,i){this.state=0,this.length=-1,this.process=function(){if(0==this.state&&2<=t.available()&&(length=t.dataView.getInt16(t.pos),t.pos+=2,this.state=1),1==this.state&&t.available()>=length){var e=new StringView(t.arrayBuffer.slice(t.pos,t.pos+length)).toString();return t.pos+=length,t.pop(),0==i(e)&&console.log("error"),!0}}}function ReadByte(t,i){this.process=function(){if(0<t.available()){var e=t.dataView.getInt8(t.pos);return t.pos+=1,t.pop(),0==i(e)&&console.log("error"),!0}}}function ReadFloatArray(t,i,r){this.process=function(){if(t.align4(),t.available()>=4*i){var e=new Float32Array(t.arrayBuffer,t.pos,i);return t.pos+=4*i,t.pop(),0==r(e)&&console.log("error"),!0}}}function ReadIntArray(t,i,r){this.process=function(){if(t.align4(),t.available()>=4*i){var e=new Int32Array(t.arrayBuffer,t.pos,i);return t.pos+=4*i,t.pop(),0==r(e)&&console.log("error"),!0}}}function ReadInt(t,i){this.process=function(){if(4<=t.available()){var e=t.dataView.getInt32(t.pos);return t.pos+=4,t.pop(),0==i(e)&&console.log("error"),!0}}}function ReadFloats(r,n,s){this.process=function(){if(r.available()>=4*n){for(var e=[],t=0;t<n;t++){var i=r.dataView.getFloat32(r.pos);r.pos+=4,e.push(i)}return r.pop(),0==s(e)&&console.log("error"),!0}}}function ReadLong(t,i){this.process=function(){if(4<=t.available()){var e=t.dataView.getInt32(t.pos+4);return t.pos+=8,t.pop(),0==i(e)&&console.log("error"),!0}}}function AsyncStream(){var s=this;(window.lastStream=s).arrayBuffer=null,s.dataView=null,s.pos=4,s.todolist=[],s.data=[],s.totalReceived=0,s.lastTotalReceived=-1,s.stoppedOnMax=!1,s.pop=function(){s.todolist.splice(0,1)},s.available=function(){return s.arrayBuffer.byteLength-s.pos},s.addReadUTF8=function(e){s.todolist.push(new ReadUTF8(s,e))},s.addReadByte=function(e){s.todolist.push(new ReadByte(s,e))},s.addReadFloatArray=function(e,t){0==e?t():s.todolist.push(new ReadFloatArray(s,e,t))},s.addReadIntArray=function(e,t){0==e?t():s.todolist.push(new ReadIntArray(s,e,t))},s.addReadFloats=function(e,t){0==e?t():s.todolist.push(new ReadFloats(s,e,t))},s.addReadInt=function(e){s.todolist.push(new ReadInt(s,e))},s.addReadLong=function(e){s.todolist.push(new ReadLong(s,e))},s.align4=function(){var e=4-s.pos%4;0<e&&4!=e&&(s.pos+=e)},s.process=function(e){var t=0;if(s.totalReceived!=s.lastTotalReceived||s.stoppedOnMax)for(s.lastTotalReceived=s.totalReceived,s.stoppedOnMax=!1;0<s.todolist.length&&0<s.data.length;){var i=s.todolist[0],r=s.data[0];s.arrayBuffer=r,s.dataView=new DataView(s.arrayBuffer);var n=i.process();if(r.byteLength==s.pos&&(s.data.splice(0,1),s.pos=4),!n)break;if(e<++t){s.stoppedOnMax=!0;break}}},s.newData=function(e){s.data.push(e),s.totalReceived+=e.byteLength-4}}SceneJS_ChunkFactory.chunkTypes={},SceneJS_ChunkFactory._freeChunks={},SceneJS_ChunkFactory.createChunkType=function(e){if(!e.type)throw"'type' expected in params";var t=function(){this.useCount=0,this.init.apply(this,arguments)};return(t.prototype=new SceneJS_Chunk).constructor=t,e.drawAndPick&&(e.draw=e.pick=e.drawAndPick),SceneJS_ChunkFactory.chunkTypes[e.type]=t,SceneJS._apply(e,t.prototype),SceneJS_ChunkFactory._freeChunks[e.type]={chunks:[],chunksLen:0},t},SceneJS_ChunkFactory.prototype.getChunk=function(e,t,i,r,n){var s=SceneJS_ChunkFactory.chunkTypes[t];if(!s)throw"chunk type not supported: '"+t+"'";var o=this._chunks[e];if(o)return o.useCount++,o;var a=SceneJS_ChunkFactory._freeChunks[t];return 0<a.chunksLen&&(o=a.chunks[--a.chunksLen]),o?o.init(e,i,r,n):o=new s(e,i,r,n),o.type=t,o.useCount=1,this._chunks[e]=o},SceneJS_ChunkFactory.prototype.putChunk=function(e){if(0!=e.useCount&&--e.useCount<=0){e.recycle&&e.recycle(),this._chunks[e.id]=null;var t=SceneJS_ChunkFactory._freeChunks[e.type];t.chunks[t.chunksLen++]=e}},SceneJS_ChunkFactory.prototype.webglRestored=function(){var e;for(var t in this._chunks)this._chunks.hasOwnProperty(t)&&(e=this._chunks[t]).build&&e.build()},SceneJS_ChunkFactory.createChunkType({type:"camera",build:function(){this._uPMatrixDraw=this.program.draw.getUniformLocation("SCENEJS_uPMatrix"),this._uZNearDraw=this.program.draw.getUniformLocation("SCENEJS_uZNear"),this._uZFarDraw=this.program.draw.getUniformLocation("SCENEJS_uZFar"),this._uPMatrixPick=this.program.pick.getUniformLocation("SCENEJS_uPMatrix"),this._uZNearPick=this.program.pick.getUniformLocation("SCENEJS_uZNear"),this._uZFarPick=this.program.pick.getUniformLocation("SCENEJS_uZFar")},draw:function(e){this.core.dirty&&this.core.rebuild();var t=this.program.gl;this._uPMatrixDraw&&t.uniformMatrix4fv(this._uPMatrixDraw,t.FALSE,this.core.mat),this._uZNearDraw&&t.uniform1f(this._uZNearDraw,this.core.optics.near),this._uZFarDraw&&t.uniform1f(this._uZFarDraw,this.core.optics.far),e.cameraMat=this.core.mat},pick:function(e){var t=this.program.gl;this._uPMatrixPick&&t.uniformMatrix4fv(this._uPMatrixPick,t.FALSE,this.core.mat),e.rayPick&&(this._uZNearPick&&t.uniform1f(this._uZNearPick,this.core.optics.near),this._uZFarPick&&t.uniform1f(this._uZFarPick,this.core.optics.far)),e.cameraMat=this.core.mat}}),SceneJS_ChunkFactory.createChunkType({type:"clips",build:function(){this._draw=this._draw||[];for(var e=this.program.draw,t=0,i=this.core.clips.length;t<i;t++)this._draw[t]={uClipMode:e.getUniformLocation("SCENEJS_uClipMode"+t),uClipNormalAndDist:e.getUniformLocation("SCENEJS_uClipNormalAndDist"+t)};this._pick=this._pick||[];var r=this.program.pick;for(t=0,i=this.core.clips.length;t<i;t++)this._pick[t]={uClipMode:r.getUniformLocation("SCENEJS_uClipMode"+t),uClipNormalAndDist:r.getUniformLocation("SCENEJS_uClipNormalAndDist"+t)}},drawAndPick:function(e){for(var t,i,r,n=e.pick?this._pick:this._draw,s=this.core.clips,o=this.program.gl,a=0,c=s.length;a<c;a++)e.pick,t=n[a].uClipMode,i=n[a].uClipNormalAndDist,t&&i&&("inside"==(r=s[a]).mode?(o.uniform1f(t,2),o.uniform4fv(i,r.normalAndDist)):"outside"==r.mode?(o.uniform1f(t,1),o.uniform4fv(i,r.normalAndDist)):o.uniform1f(t,0))}}),SceneJS_ChunkFactory.createChunkType({type:"draw",unique:!0,build:function(){this._depthModeDraw=this.program.draw.getUniformLocation("SCENEJS_uDepthMode"),this._depthModePick=this.program.pick.getUniformLocation("SCENEJS_uDepthMode")},drawAndPick:function(e){var t=this.program.gl;t.uniform1i(e.pick?this._depthModePick:this._depthModeDraw,e.depthMode),t.drawElements(this.core.primitive,this.core.indexBuf.numItems,t.UNSIGNED_SHORT,0)}}),SceneJS_ChunkFactory.createChunkType({type:"flags",build:function(){var e=this.program.draw;this._uBackfaceTexturingDraw=e.getUniformLocation("SCENEJS_uBackfaceTexturing"),this._uBackfaceLightingDraw=e.getUniformLocation("SCENEJS_uBackfaceLighting"),this._uSpecularLightingDraw=e.getUniformLocation("SCENEJS_uSpecularLighting"),this._uClippingDraw=e.getUniformLocation("SCENEJS_uClipping"),this._uAmbientDraw=e.getUniformLocation("SCENEJS_uAmbient"),this._uDiffuseDraw=e.getUniformLocation("SCENEJS_uDiffuse"),this._uReflectionDraw=e.getUniformLocation("SCENEJS_uReflection");var t=this.program.pick;this._uClippingPick=t.getUniformLocation("SCENEJS_uClipping")},drawAndPick:function(e){var t=this.program.gl,i=this.core.backfaces;e.backfaces!=i&&(i?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),e.backfaces=i);var r=this.core.frontface;e.frontface!=r&&("ccw"==r?t.frontFace(t.CCW):t.frontFace(t.CW),e.frontface=r);var n=this.core.transparent;if(e.transparent!=n&&(n?(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),e.blendEnabled=!0):(t.disable(t.BLEND),e.blendEnabled=!1),e.transparent=n),e.pick)t.uniform1i(this._uClippingPick,this.core.clipping);else{var s=(this.core.backfaceTexturing?1:0)+(this.core.backfaceLighting?2:0)+(this.core.specular?4:0)+(this.core.clipping?8:0)+(this.core.ambient?16:0)+(this.core.diffuse?32:0)+(this.core.reflection?64:0);this.program.drawUniformFlags!=s&&(t.uniform1i(this._uBackfaceTexturingDraw,this.core.backfaceTexturing),t.uniform1i(this._uBackfaceLightingDraw,this.core.backfaceLighting),t.uniform1i(this._uSpecularLightingDraw,this.core.specular),t.uniform1i(this._uClippingDraw,this.core.clipping),t.uniform1i(this._uAmbientDraw,this.core.ambient),t.uniform1i(this._uDiffuseDraw,this.core.diffuse),t.uniform1i(this._uReflectionDraw,this.core.reflection),this.program.drawUniformFlags=s)}}}),SceneJS_ChunkFactory.createChunkType({type:"renderTarget",programGlobal:!0,draw:function(e){var t=this.program.gl;e.renderBuf&&(t.finish(),e.renderBuf.unbind(),e.renderBuf=null);var i=this.core.renderBuf;if(i){i.bind(),e.depthMode="depth"===this.core.bufType,e.depthMode||e.blendEnabled&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA));var r=e.canvas.canvas;t.viewport(0,0,r.width,r.height),t.clearColor(e.ambientColor[0],e.ambientColor[1],e.ambientColor[2],1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e.renderBuf=i}else e.depthMode=!1}}),SceneJS_ChunkFactory.createChunkType({type:"geometry",build:function(){var e=this.program.draw;this._aVertexDraw=e.getAttribute("SCENEJS_aVertex"),this._aNormalDraw=e.getAttribute("SCENEJS_aNormal"),this._aUVDraw=e.getAttribute("SCENEJS_aUVCoord"),this._aUV2Draw=e.getAttribute("SCENEJS_aUVCoord2"),this._aColorDraw=e.getAttribute("SCENEJS_aVertexColor"),this._aMorphVertexDraw=e.getAttribute("SCENEJS_aMorphVertex"),this._aMorphNormalDraw=e.getAttribute("SCENEJS_aMorphNormal"),this._uMorphFactorDraw=e.getUniformLocation("SCENEJS_uMorphFactor");var t=this.program.pick;this._aVertexPick=t.getAttribute("SCENEJS_aVertex"),this._aNormalPick=t.getAttribute("SCENEJS_aNormal"),this._aUVPick=t.getAttribute("SCENEJS_aUVCoord"),this._aUV2Pick=t.getAttribute("SCENEJS_aUVCoord2"),this._aMorphVertexPick=t.getAttribute("SCENEJS_aMorphVertex"),this._aMorphNormalPick=t.getAttribute("SCENEJS_aMorphNormal"),this._uMorphFactorPick=t.getUniformLocation("SCENEJS_uMorphFactor"),this.VAO=null,this.VAOMorphKey1=0,this.VAOMorphKey2=0,this.VAOHasInterleavedBuf=!1},recycle:function(){this.VAO&&(this.program.gl.getExtension("OES_vertex_array_object").deleteVertexArrayOES(this.VAO),this.VAO=null)},morphDraw:function(){this.VAOMorphKey1=this.core.key1,this.VAOMorphKey2=this.core.key2;var e=this.core.targets[this.core.key1],t=this.core.targets[this.core.key2];this._aMorphVertexDraw?(this._aVertexDraw.bindFloatArrayBuffer(e.vertexBuf),this._aMorphVertexDraw.bindFloatArrayBuffer(t.vertexBuf)):this._aVertexDraw&&this._aVertexDraw.bindFloatArrayBuffer(this.core2.vertexBuf),this._aMorphNormalDraw?(this._aNormalDraw.bindFloatArrayBuffer(e.normalBuf),this._aMorphNormalDraw.bindFloatArrayBuffer(t.normalBuf)):this._aNormalDraw&&this._aNormalDraw.bindFloatArrayBuffer(this.core2.normalBuf),this._aUVDraw&&this._aUVDraw.bindFloatArrayBuffer(this.core2.uvBuf),this._aUV2Draw&&this._aUV2Draw.bindFloatArrayBuffer(this.core2.uvBuf2),this._aColorDraw&&this._aColorDraw.bindFloatArrayBuffer(this.core2.colorBuf),this.setDrawMorphFactor()},setDrawMorphFactor:function(){this._uMorphFactorDraw&&this.program.gl.uniform1f(this._uMorphFactorDraw,this.core.factor)},draw:function(e){var t=this.core.targets&&this.core.targets.length,i=this.core2.interleavedBuf&&!this.core2.interleavedBuf.dirty;if(this.VAO){if(e.VAO.bindVertexArrayOES(this.VAO),t){if(this.VAOMorphKey1==this.core.key1&&this.VAOMorphKey2==this.core.key2)return void this.setDrawMorphFactor()}else if(i||!this.VAOHasInterleavedBuf)return}else if(e.VAO){e.VAO.bindVertexArrayOES(null),this.VAO=e.VAO.createVertexArrayOES(),e.VAO.bindVertexArrayOES(this.VAO);this.program.gl}t?this.morphDraw():i?(this.VAOHasInterleavedBuf=!0,this.core2.interleavedBuf.bind(),this._aVertexDraw&&this._aVertexDraw.bindInterleavedFloatArrayBuffer(3,this.core2.interleavedStride,this.core2.interleavedPositionOffset),this._aNormalDraw&&this._aNormalDraw.bindInterleavedFloatArrayBuffer(3,this.core2.interleavedStride,this.core2.interleavedNormalOffset),this._aUVDraw&&this._aUVDraw.bindInterleavedFloatArrayBuffer(2,this.core2.interleavedStride,this.core2.interleavedUVOffset),this._aUV2Draw&&this._aUV2Draw.bindInterleavedFloatArrayBuffer(2,this.core2.interleavedStride,this.core2.interleavedUV2Offset),this._aColorDraw&&this._aColorDraw.bindInterleavedFloatArrayBuffer(4,this.core2.interleavedStride,this.core2.interleavedColorOffset)):(this.VAOHasInterleavedBuf=!1,this._aVertexDraw&&this._aVertexDraw.bindFloatArrayBuffer(this.core2.vertexBuf),this._aNormalDraw&&this._aNormalDraw.bindFloatArrayBuffer(this.core2.normalBuf),this._aUVDraw&&this._aUVDraw.bindFloatArrayBuffer(this.core2.uvBuf),this._aUV2Draw&&this._aUV2Draw.bindFloatArrayBuffer(this.core2.uvBuf2),this._aColorDraw&&this._aColorDraw.bindFloatArrayBuffer(this.core2.colorBuf)),this.core2.indexBuf.bind()},morphPick:function(){var e=this.core.targets[this.core.key1],t=this.core.targets[this.core.key2];this._aMorphVertexPick?(this._aVertexPick.bindFloatArrayBuffer(e.vertexBuf),this._aMorphVertexPick.bindFloatArrayBuffer(t.vertexBuf)):this._aVertexPick&&this._aVertexPick.bindFloatArrayBuffer(this.core2.vertexBuf),this._aMorphNormalPick?(this._aNormalPick.bindFloatArrayBuffer(e.normalBuf),this._aMorphNormalPick.bindFloatArrayBuffer(t.normalBuf)):this._aNormalPick&&this._aNormalPick.bindFloatArrayBuffer(this.core2.normalBuf),this._aUVPick&&this._aUVPick.bindFloatArrayBuffer(this.core2.uvBuf),this._aUV2Pick&&this._aUV2Pick.bindFloatArrayBuffer(this.core2.uvBuf2),this._uMorphFactorPick&&this.program.gl.uniform1f(this._uMorphFactorPick,this.core.factor)},pick:function(e){this.core.targets&&this.core.targets.length?this.morphPick():(this._aVertexPick&&this._aVertexPick.bindFloatArrayBuffer(this.core2.vertexBuf),this._aNormalPick&&this._aNormalPick.bindFloatArrayBuffer(this.core2.normalBuf),this._aUVPick&&this._aUVPick.bindFloatArrayBuffer(this.core2.uvBuf),this._aUV2Pick&&this._aUV2Pick.bindFloatArrayBuffer(this.core2.uvBuf2)),this.core2.indexBuf.bind()}}),SceneJS_ChunkFactory.createChunkType({type:"lights",build:function(){this._uAmbientColor=this._uAmbientColor||[],this._uLightColor=this._uLightColor||[],this._uLightDir=this._uLightDir||[],this._uLightPos=this._uLightPos||[],this._uLightCutOff=this._uLightCutOff||[],this._uLightSpotExp=this._uLightSpotExp||[],this._uLightAttenuation=this._uLightAttenuation||[];for(var e=this.core.lights,t=this.program,i=0,r=e.length;i<r;i++)switch(e[i].mode){case"ambient":this._uAmbientColor[i]=t.draw.getUniformLocation("SCENEJS_uAmbientColor");break;case"dir":this._uLightColor[i]=t.draw.getUniformLocation("SCENEJS_uLightColor"+i),this._uLightPos[i]=null,this._uLightDir[i]=t.draw.getUniformLocation("SCENEJS_uLightDir"+i);break;case"point":this._uLightColor[i]=t.draw.getUniformLocation("SCENEJS_uLightColor"+i),this._uLightPos[i]=t.draw.getUniformLocation("SCENEJS_uLightPos"+i),this._uLightDir[i]=null,this._uLightAttenuation[i]=t.draw.getUniformLocation("SCENEJS_uLightAttenuation"+i)}},draw:function(e){e.dirty&&this.build();for(var t,i=this.core.lights,r=this.program.gl,n=0,s=i.length;n<s;n++)t=i[n],this._uAmbientColor[n]?r.uniform3fv(this._uAmbientColor[n],t.color):(this._uLightColor[n]&&r.uniform3fv(this._uLightColor[n],t.color),this._uLightPos[n]&&(r.uniform3fv(this._uLightPos[n],t.pos),this._uLightAttenuation[n]&&r.uniform3fv(this._uLightAttenuation[n],t.attenuation)),this._uLightDir[n]&&r.uniform3fv(this._uLightDir[n],t.dir))}}),SceneJS_ChunkFactory.createChunkType({type:"listeners",programGlobal:!0,build:function(){},draw:function(e){for(var t=this.core.listeners,i=e.renderListenerCtx,r=t.length-1;0<=r;r--)if(!0===t[r](i))return!0}}),SceneJS_ChunkFactory.createChunkType({type:"lookAt",build:function(){this._uvMatrixDraw=this.program.draw.getUniformLocation("SCENEJS_uVMatrix"),this._uVNMatrixDraw=this.program.draw.getUniformLocation("SCENEJS_uVNMatrix"),this._uWorldEyeDraw=this.program.draw.getUniformLocation("SCENEJS_uWorldEye"),this._uvMatrixPick=this.program.pick.getUniformLocation("SCENEJS_uVMatrix")},draw:function(e){this.core.dirty&&this.core.rebuild();var t=this.program.gl;this._uvMatrixDraw&&t.uniformMatrix4fv(this._uvMatrixDraw,t.FALSE,this.core.mat),this._uVNMatrixDraw&&t.uniformMatrix4fv(this._uVNMatrixDraw,t.FALSE,this.core.normalMat),this._uWorldEyeDraw&&t.uniform3fv(this._uWorldEyeDraw,this.core.lookAt.eye),e.viewMat=this.core.mat},pick:function(e){var t=this.program.gl;this._uvMatrixPick&&t.uniformMatrix4fv(this._uvMatrixPick,t.FALSE,this.core.mat),e.viewMat=this.core.mat}}),SceneJS_ChunkFactory.createChunkType({type:"material",build:function(){var e=this.program.draw;this._uMaterialBaseColor=e.getUniformLocation("SCENEJS_uMaterialColor"),this._uMaterialSpecularColor=e.getUniformLocation("SCENEJS_uMaterialSpecularColor"),this._uMaterialSpecular=e.getUniformLocation("SCENEJS_uMaterialSpecular"),this._uMaterialShine=e.getUniformLocation("SCENEJS_uMaterialShine"),this._uMaterialEmit=e.getUniformLocation("SCENEJS_uMaterialEmit"),this._uMaterialAlpha=e.getUniformLocation("SCENEJS_uMaterialAlpha")},draw:function(){var e=this.program.gl,t=this.program.draw.materialSettings;this._uMaterialBaseColor&&e.uniform3fv(this._uMaterialBaseColor,this.core.baseColor),!this._uMaterialSpecularColor||t.specularColor[0]==this.core.specularColor[0]&&t.specularColor[1]==this.core.specularColor[1]&&t.specularColor[2]==this.core.specularColor[2]||(e.uniform3fv(this._uMaterialSpecularColor,this.core.specularColor),t.specularColor[0]=this.core.specularColor[0],t.specularColor[1]=this.core.specularColor[1],t.specularColor[2]=this.core.specularColor[2]),this._uMaterialSpecular&&t.specular!=this.core.specular&&(e.uniform1f(this._uMaterialSpecular,this.core.specular),t.specular=this.core.specular),this._uMaterialShine&&t.shine!=this.core.shine&&(e.uniform1f(this._uMaterialShine,this.core.shine),t.shine=this.core.shine),this._uMaterialEmit&&t.emit!=this.core.emit&&(e.uniform1f(this._uMaterialEmit,this.core.emit),t.emit=this.core.emit),this._uMaterialAlpha&&t.alpha!=this.core.alpha&&(e.uniform1f(this._uMaterialAlpha,this.core.alpha),t.alpha=this.core.alpha)}}),SceneJS_ChunkFactory.createChunkType({type:"name",build:function(){this._uPickColor=this.program.pick.getUniformLocation("SCENEJS_uPickColor")},pick:function(e){if(this._uPickColor&&this.core.name){e.pickNames[e.pickIndex++]=this.core;var t=e.pickIndex>>16&255,i=e.pickIndex>>8&255,r=255&e.pickIndex;this.program.gl.uniform3fv(this._uPickColor,[r/255,i/255,t/255])}}}),SceneJS_ChunkFactory.createChunkType({type:"program",build:function(){this._depthModeDraw=this.program.draw.getUniformLocation("SCENEJS_uDepthMode"),this._depthModePick=this.program.pick.getUniformLocation("SCENEJS_uDepthMode"),this._rayPickMode=this.program.pick.getUniformLocation("SCENEJS_uRayPickMode")},draw:function(e){this.program.draw.bind(),e.textureUnit=0;var t=this.program.gl;if(t.uniform1i(this._depthModeDraw,e.depthMode),!e.VAO)for(var i=0;i<10;i++)t.disableVertexAttribArray(i);e.drawProgram=this.program.draw},pick:function(e){this.program.pick.bind();var t=this.program.gl;t.uniform1i(this._rayPickMode,e.rayPick),t.uniform1i(this._depthModePick,e.depthMode);for(var i=e.textureUnit=0;i<10;i++)t.disableVertexAttribArray(i)}}),SceneJS_ChunkFactory.createChunkType({type:"renderer",build:function(){},drawAndPick:function(e){if(this.core.props){var t=this.program.gl;e.renderer&&(e.renderer.props.restoreProps(t),e.renderer=this.core),this.core.props.setProps(t)}}}),SceneJS_ChunkFactory.createChunkType({type:"depthBuffer",programGlobal:!0,drawAndPick:function(e){var t=this.core.enabled;if(e.depthbufEnabled!=t){var i=this.program.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),e.depthbufEnabled=t}var r=this.core.clearDepth;e.clearDepth!=r&&(i.clearDepth(r),e.clearDepth=r);var n=this.core.depthFunc;e.depthFunc!=n&&(i.depthFunc(n),e.depthFunc=n),this.core.clear&&i.clear(i.DEPTH_BUFFER_BIT)}}),SceneJS_ChunkFactory.createChunkType({type:"colorBuffer",programGlobal:!0,build:function(){},drawAndPick:function(e){if(!e.transparent){var t=this.core.blendEnabled,i=this.program.gl;e.blendEnabled!=t&&(t?i.enable(i.BLEND):i.disable(i.BLEND),e.blendEnabled=t);var r=this.core.colorMask;i.colorMask(r.r,r.g,r.b,r.a)}}}),SceneJS_ChunkFactory.createChunkType({type:"view",programGlobal:!0,build:function(){},drawAndPick:function(e){var t=this.core.scissorTestEnabled;if(e.scissorTestEnabled!=t){var i=this.program.gl;t?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),e.scissorTestEnabled=t}}}),SceneJS_ChunkFactory.createChunkType({type:"shader",build:function(){},drawAndPick:function(e){var t=this.core.paramsStack;if(t)for(var i,r,n=e.pick?this.program.pick:this.program.draw,s=0,o=t.length;s<o;s++)for(r in i=t[s])i.hasOwnProperty(r)&&n.setUniform(r,i[r])}}),SceneJS_ChunkFactory.createChunkType({type:"shaderParams",build:function(){},drawAndPick:function(e){var t=this.core.paramsStack;if(t)for(var i,r,n=e.pick?this.program.pick:this.program.draw,s=0,o=t.length;s<o;s++)for(r in i=t[s])i.hasOwnProperty(r)&&n.setUniform(r,i[r])}}),SceneJS_ChunkFactory.createChunkType({type:"style",programGlobal:!0,drawAndPick:function(e){var t=this.core.lineWidth;e.lineWidth!=t&&(this.program.gl.lineWidth(t),e.lineWidth=t)}}),SceneJS_ChunkFactory.createChunkType({type:"texture",build:function(){this._uTexSampler=this._uTexSampler||[],this._uTexMatrix=this._uTexMatrix||[],this._uTexBlendFactor=this._uTexBlendFactor||[];var e=this.core.layers;if(e)for(var t=this.program.draw,i=0,r=e.length;i<r;i++)e[i],this._uTexSampler[i]="SCENEJS_uSampler"+i,this._uTexMatrix[i]=t.getUniform("SCENEJS_uLayer"+i+"Matrix"),this._uTexBlendFactor[i]=t.getUniform("SCENEJS_uLayer"+i+"BlendFactor")},draw:function(e){e.textureUnit=0;var t=this.core.layers;if(t)for(var i,r=this.program.draw,n=0,s=t.length;n<s;n++)i=t[n],this._uTexSampler[n]&&i.texture&&(r.bindTexture(this._uTexSampler[n],i.texture,e.textureUnit++),i._matrixDirty&&i.buildMatrix&&i.buildMatrix.call(i),this._uTexMatrix[n]&&this._uTexMatrix[n].setValue(i.matrixAsArray),this._uTexBlendFactor[n]&&this._uTexBlendFactor[n].setValue(i.blendFactor));10<e.textureUnit&&(e.textureUnit=0)}}),SceneJS_ChunkFactory.createChunkType({type:"cubemap",build:function(){this._uCubeMapSampler=this._uCubeMapSampler||[],this._uCubeMapIntensity=this._uCubeMapIntensity||[];var e=this.core.layers;if(e)for(var t=this.program.draw,i=0,r=e.length;i<r;i++)e[i],this._uCubeMapSampler[i]="SCENEJS_uCubeMapSampler"+i,this._uCubeMapIntensity[i]=t.getUniform("SCENEJS_uCubeMapIntensity"+i)},draw:function(e){var t=this.core.layers;if(t)for(var i,r=this.program.draw,n=0,s=t.length;n<s;n++)i=t[n],this._uCubeMapSampler[n]&&i.texture&&(r.bindTexture(this._uCubeMapSampler[n],i.texture,e.textureUnit++),this._uCubeMapIntensity[n]&&this._uCubeMapIntensity[n].setValue(i.intensity));10<e.textureUnit&&(e.textureUnit=0)}}),SceneJS_ChunkFactory.createChunkType({type:"xform",build:function(){var e=this.program.draw;this._uMatLocationDraw=e.getUniformLocation("SCENEJS_uMMatrix"),this._uNormalMatLocationDraw=e.getUniformLocation("SCENEJS_uMNMatrix");var t=this.program.pick;this._uMatLocationPick=t.getUniformLocation("SCENEJS_uMMatrix"),this._uNormalMatLocationPick=t.getUniformLocation("SCENEJS_uMNMatrix")},draw:function(e){(!0===SceneJS_configsModule.configs.forceXFormCoreRebuild||this.core.dirty&&this.core.build)&&this.core.build();var t=this.program.gl;this._uMatLocationDraw&&t.uniformMatrix4fv(this._uMatLocationDraw,t.FALSE,this.core.mat),this._uNormalMatLocationDraw&&t.uniformMatrix4fv(this._uNormalMatLocationDraw,t.FALSE,this.core.normalMat),e.modelMat=this.core.mat},pick:function(e){this.core.dirty&&this.core.build();var t=this.program.gl;this._uMatLocationPick&&t.uniformMatrix4fv(this._uMatLocationPick,t.FALSE,this.core.mat),this._uNormalMatLocationPick&&t.uniformMatrix4fv(this._uNormalMatLocationPick,t.FALSE,this.core.normalMat),e.modelMat=this.core.mat}}),SceneJS.configure({pluginPath:"http://xeolabs.github.com/scenejs/api/latest/plugins"});var BIMSURFER={CLASS:"BIMSURFER",VERSION_NUMBER:"2.0 Dev"};function GeometryLoader(e,t,i,r){var b=this;b.models=t,b.bimServerApi=e,b.viewer=i,b.state={},b.progressListeners=[],b.objectAddedListeners=[],b.prepareReceived=!1,b.todo=[],b.type=r,null==b.type&&(b.type="triangles"),b.stats={nrPrimitives:0,nrVertices:0,nrNormals:0,nrColors:0},b.dataToInfo={},b.loadedGeometry={},b.infoToOid={},this.addProgressListener=function(e){b.progressListeners.push(e)},this.readObject=function(e,t){if(e.align8(),5==t){var i=e.readLong(),a=e.readLong(),c=(e.readLong(),e.readDoubleArray(6),e.readDoubleArray(16)),r=[l=e.readLong()];if(0==b.state.mode)return void console.log("Mode is still 0, should be 1");var h=b.infoToOid[a];null==h?console.log("Not found",a):b.models[i].get(h,function(e){if(e.gid=a,null==b.viewer.scene.findNode(a)){var t=BIMSURFER.Constants.materials[e.getType()],i=!1;null==t&&(console.log("material not found",e.getType()),t=BIMSURFER.Constants.materials.DEFAULT),t.a<1&&(i=!0);var r=0==e.trans.mode,n=null,s=b.loadedGeometry[l];null!=s?Array.isArray(s)?(n=[],s.forEach(function(e){n.push({type:"geometry",coreId:e})})):n=[{type:"geometry",coreId:l}]:null==b.dataToInfo[l]?b.dataToInfo[l]=[a]:b.dataToInfo[l].push(a);var o={type:"flags",flags:{transparent:i},nodes:[{type:"enable",enabled:r,nodes:[{type:"material",baseColor:t,alpha:t.a,nodes:[{type:"name",id:a,data:{object:e},nodes:[{type:"matrix",elements:c,nodes:n}]}]}]}]};b.modelNode.addNode(o),b.objectAddedListeners.forEach(function(e){e(h)})}else console.log("Node with id "+a+" already existed")})}else if(3==t){e.readLong(),r=[];for(var l=e.readLong(),n=e.readInt(),s=0;s<n;s++){e.readLong();var o=l+"_"+s;r.push(o);var u=e.readInt();b.stats.nrPrimitives+=u/3;var d=e.readShortArray(u);if(11<=b.state.version)if(1==e.readInt())var p={r:e.readFloat(),g:e.readFloat(),b:e.readFloat(),a:e.readFloat()};e.align4();var f=e.readInt();b.stats.nrVertices+=f;var g=e.readFloatArray(f),m=e.readInt();b.stats.nrNormals+=m;var _=e.readFloatArray(m),S=e.readInt();b.stats.nrColors+=S;var v=e.readFloatArray(S),y={type:"geometry",primitive:b.type};if(null!=p){y.colors=new Array(4*f);for(s=0;s<f;s++)y.colors[4*s+0]=p.r,y.colors[4*s+1]=p.g,y.colors[4*s+2]=p.b,y.colors[4*s+3]=p.a}y.coreId=o,"lines"==b.type?y.indices=b.convertToLines(d):y.indices=d,y.positions=g,y.normals=_,null!=v&&0<v.length&&(y.colors=v),b.library.add("node",y)}b.loadedGeometry[l]=r,null!=b.dataToInfo[l]&&(b.dataToInfo[l].forEach(function(e){var t=b.viewer.scene.findNode(e);null!=t&&null!=t.nodes[0]&&r.forEach(function(e){t.nodes[0].addNode({type:"geometry",coreId:e})})}),delete b.dataToInfo[l])}else if(1==t){e.readLong(),l=e.readLong(),u=e.readInt(),d=e.readShortArray(u);if(b.stats.nrPrimitives+=u/3,11<=b.state.version)if(1==e.readInt())p={r:e.readFloat(),g:e.readFloat(),b:e.readFloat(),a:e.readFloat()};e.align4();f=e.readInt(),g=e.readFloatArray(f);b.stats.nrVertices+=f;m=e.readInt();b.stats.nrNormals+=m;_=e.readFloatArray(m),S=e.readInt();b.stats.nrColors+=S;v=e.readFloatArray(S),y={type:"geometry",primitive:b.type};if(null!=p){y.colors=new Array(4*f);for(s=0;s<f;s++)y.colors[4*s+0]=p.r,y.colors[4*s+1]=p.g,y.colors[4*s+2]=p.b,y.colors[4*s+3]=p.a}y.coreId=l,"lines"==b.type?y.indices=b.convertToLines(d):y.indices=d,y.positions=g,y.normals=_,null!=v&&0<v.length&&(y.colors=v),b.library.add("node",y),b.loadedGeometry[l]=!0,null!=b.dataToInfo[l]&&(b.dataToInfo[l].forEach(function(e){var t=b.viewer.scene.findNode(e);null!=t&&null!=t.nodes[0]&&t.nodes[0].addNode({type:"geometry",coreId:l})}),delete b.dataToInfo[l])}b.state.nrObjectsRead++},this.convertToLines=function(e){for(var t=[],i=0;i<e.length;i+=3){var r=e[i],n=e[i+1],s=e[i+2];t.push(r,n),t.push(n,s),t.push(s,r)}return t},this.updateProgress=function(){b.progressListeners.forEach(function(e){e("Loading",-1)})},this.downloadInitiated=function(){b.state={mode:0,nrObjectsRead:0,nrObjects:0},b.library=b.viewer.scene.findNode("library-"+b.groupId),null==b.library&&(b.library=b.viewer.scene.addNode({id:"library-"+b.groupId,type:"library"}));var e={topicId:b.topicId};b.bimServerApi.setBinaryDataListener(b.topicId,b.binaryDataListener),b.bimServerApi.downloadViaWebsocket(e)},this.binaryDataListener=function(e){b.todo.push(e)},this.readEnd=function(e){if(0<Object.keys(b.dataToInfo).length)for(var t in console.error("Unsolved links"),b.dataToInfo)console.log(t,b.dataToInfo[t]);console.log(b.stats),b.viewer.SYSTEM.events.trigger("progressDone"),b.progressListeners.forEach(function(e){e("done",b.state.nrObjectsRead,b.state.nrObjectsRead)}),b.bimServerApi.call("ServiceInterface","cleanupLongAction",{topicId:b.topicId},function(){})},this.readStart=function(e){var t=e.readUTF8();if("BGS"!=t)return console.log("Stream does not start with BGS ("+t+")"),!1;var i=e.readByte();if(12!=i)return console.log("Unimplemented version"),!1;b.state.version=i,e.align8();var r=e.readDoubleArray(6);b.modelBounds={min:{x:r[0],y:r[1],z:r[2]},max:{x:r[3],y:r[4],z:r[5]}},b.center={x:(b.modelBounds.max.x+b.modelBounds.min.x)/2,y:(b.modelBounds.max.y+b.modelBounds.min.y)/2,z:(b.modelBounds.max.z+b.modelBounds.min.z)/2},b.boundsTranslate=b.viewer.scene.findNode("bounds_translate");var n=!1;if(null==b.boundsTranslate){n=!0;b.boundsTranslate={id:"bounds_translate",type:"translate",x:-b.center.x,y:-b.center.y,z:-b.center.z,nodes:[]},b.boundsTranslate=b.viewer.scene.findNode("my-lights").addNode(b.boundsTranslate)}if(b.modelNode=b.viewer.scene.findNode("model_node_"+b.groupId),null==b.modelNode&&(b.modelNode={id:"model_node_"+b.groupId,type:"translate",x:0,y:0,z:0,data:{groupId:b.groupId},nodes:[]},b.modelNode=b.boundsTranslate.addNode(b.modelNode)),n){var s=b.viewer.scene.findNode("main-lookAt"),o={x:.5*(b.modelBounds.max.x-b.modelBounds.min.x),y:-1*(b.modelBounds.max.y-b.modelBounds.min.y),z:.5*(b.modelBounds.max.z-b.modelBounds.min.z)};s.set("eye",o);var a=b.viewer.scene.findNode("main-camera"),c=5*Math.sqrt(Math.pow(b.modelBounds.max.x-b.modelBounds.min.x,2)+Math.pow(b.modelBounds.max.y-b.modelBounds.min.y,2)+Math.pow(b.modelBounds.max.z-b.modelBounds.min.z,2));a.setOptics({type:"perspective",far:c,near:c/1e3,aspect:jQuery(b.viewer.canvas).width()/jQuery(b.viewer.canvas).height(),fovy:37.8493}),b.viewer.events.trigger("sceneLoaded",[b.viewer.scene])}b.state.mode=1},this.process=function(){for(var e=b.todo.shift();null!=e;){inputStream=new BIMSURFER.DataInputStreamReader(null,e);inputStream.readLong();var t=inputStream.readByte();0==t?b.readStart(inputStream):6==t?b.readEnd(inputStream):b.readObject(inputStream,t),e=b.todo.shift()}},this.progressHandler=function(e,t){e==b.topicId&&("Done preparing"==t.title&&(b.prepareReceived||(b.prepareReceived=!0,b.downloadInitiated())),"FINISHED"==t.state&&b.bimServerApi.unregisterProgressHandler(b.topicId,b.progressHandler),b.progressListeners.forEach(function(e){e("Loading"+(null==b.options.title?"":" "+b.options.title)+"...",t.progress)}))},this.setTitle=function(e){b.options.title=e},this.setLoadOids=function(e,t){b.options={type:"oids",roids:e,oids:t}},this.start=function(){if(null!=b.options){b.groupId=b.options.roids[0],b.infoToOid={};var t=[];if(b.options.oids.forEach(function(e){null!=e.gid&&(b.infoToOid[e.gid]=e.oid,t.push(e.gid))}),0<t.length){var i={type:"GeometryInfo",oids:t,include:{type:"GeometryInfo",field:"data"}};b.bimServerApi.getSerializerByPluginClassName("org.bimserver.serializers.binarygeometry.BinaryGeometryMessagingStreamingSerializerPlugin3",function(e){b.bimServerApi.call("ServiceInterface","download",{roids:b.options.roids,serializerOid:e.oid,sync:!1,query:JSON.stringify(i)},function(e){b.topicId=e,b.bimServerApi.registerProgressHandler(b.topicId,b.progressHandler)})})}}}}function StringView(e,t,i,r){var n,s,o,a,c,h,l=isFinite(i)?i:0,u=15;t&&(this.encoding=t.toString());e:switch(this.encoding){case"UTF-8":a=StringView.putUTF8CharCode,c=StringView.getUTF8CharLength,n=Uint8Array;break e;case"UTF-16":a=StringView.putUTF16CharCode,c=StringView.getUTF16CharLength,n=Uint16Array;break e;case"UTF-32":n=Uint32Array,u&=14;break e;default:n=Uint8Array,u&=14}e:switch(typeof e){case"string":u&=7;break e;case"object":switch(e.constructor){case StringView:u&=3;break e;case String:u&=7;break e;case ArrayBuffer:s=new n(e),h="UTF-32"===this.encoding?e.byteLength>>>2:"UTF-16"===this.encoding?e.byteLength>>>1:e.byteLength,o=0!==l||isFinite(r)&&r!==h?new n(e,l,isFinite(r)?r:h-l):s;break e;case Uint32Array:case Uint16Array:case Uint8Array:n=e.constructor,h=e.length,s=0===e.byteOffset&&e.length===(n===Uint32Array?e.buffer.byteLength>>>2:n===Uint16Array?e.buffer.byteLength>>>1:e.buffer.byteLength)?e:new n(e.buffer),o=0!==l||isFinite(r)&&r!==h?e.subarray(l,isFinite(r)?l+r:h):e;break e;default:h=(s=new n(e)).length,o=0!==l||isFinite(r)&&r!==h?s.subarray(l,isFinite(r)?l+r:h):s}break e;default:s=o=new n(Number(e)||0)}if(u<8){var d,p,f,g,m,_,S;4&u?(p=h=(d=e).length,u^="UTF-32"===this.encoding?0:2,l=f=i?Math.max((p+i)%p,0):0,m=g=(Number.isInteger(r)?Math.min(Math.max(r,0)+l,p):p)-1):(d=e.rawData,h=e.makeIndex(),l=f=i?Math.max((h+i)%h,0):0,m=g=(p=Number.isInteger(r)?Math.min(Math.max(r,0),h-f):h)+f,"UTF-8"===e.encoding?(_=StringView.getUTF8CharLength,S=StringView.loadUTF8CharCode):"UTF-16"===e.encoding?(_=StringView.getUTF16CharLength,S=StringView.loadUTF16CharCode):u&=1),(0===p||u<4&&d.encoding===this.encoding&&0===f&&p===h)&&(u=7);e:switch(u){case 0:s=new n(p);for(var v=0;v<p;s[v]=d[l+v++]);break e;case 1:p=0;for(var y=l;y<m;y++)p+=c(d[y]);s=new n(p);for(y=l,v=0;v<p;y++)v=a(s,d[y],v);break e;case 2:for(E=l=0;E<f;E++)l+=_(b=S(d,l));s=new n(p);for(y=l,v=0;v<p;y+=_(b),v++)b=S(d,y),s[v]=b;break e;case 3:var b,E=p=0;for(y=0;E<g;y+=_(b))b=S(d,y),E===f&&(l=y),++E>f&&(p+=c(b));s=new n(p);for(y=l,v=0;v<p;y+=_(b))v=a(s,b=S(d,y),v);break e;case 4:s=new n(p);for(var x=0;x<p;x++)s[x]=255&d.charCodeAt(x);break e;case 5:for(var M=p=0;M<h;M++)M===f&&(l=p),p+=c(d.charCodeAt(M)),M===g&&(m=p);s=new n(p);for(v=0,E=0;v<p;E++)v=a(s,d.charCodeAt(E),v);break e;case 6:s=new n(p);for(x=0;x<p;x++)s[x]=d.charCodeAt(x);break e;case 7:s=new n(p?d:0)}o=3<u&&(0<l||m<s.length-1)?s.subarray(l,m):s}this.buffer=s.buffer,this.bufferView=s,this.rawData=o,Object.freeze(this)}function removeA(e){for(var t,i,r=arguments,n=r.length;1<n&&e.length;)for(t=r[--n];-1!==(i=e.indexOf(t));)e.splice(i,1);return e}if(BIMSURFER.Class=function(e,t){var i=t||e,r="function"==typeof i.__construct?i.__construct:"function"==typeof e.prototype.__construct?function(){e.prototype.__construct.apply(this,arguments)}:function(){};if(void 0===t)r.prototype=i;else{var n=function(){};n.prototype=jQuery.extend({},e.prototype),jQuery.extend(n.prototype,t),r.prototype=new n}return r},"object"!=typeof BIMSURFER.Constants&&(BIMSURFER.Constants={}),BIMSURFER.Constants.timeoutTime=1e4,BIMSURFER.Constants.defaultTypes=["IfcColumn","IfcStair","IfcSlab","IfcWindow","IfcDoor","IfcBuildingElementProxy","IfcWallStandardCase","IfcWall","IfcBeam","IfcRailing","IfcProxy","IfcRoof"],BIMSURFER.Constants.materials={IfcSpace:{r:.137255,g:.403922,b:.870588,a:1},IfcRoof:{r:.837255,g:.203922,b:.270588,a:1},IfcSlab:{r:.637255,g:.603922,b:.670588,a:1},IfcWall:{r:.537255,g:.337255,b:.237255,a:1},IfcWallStandardCase:{r:.537255,g:.337255,b:.237255,a:1},IfcDoor:{r:.637255,g:.603922,b:.670588,a:1},IfcWindow:{r:.137255,g:.403922,b:.870588,a:.5},IfcOpeningElement:{r:.137255,g:.403922,b:.870588,a:0},IfcRailing:{r:.137255,g:.403922,b:.870588,a:1},IfcColumn:{r:.137255,g:.403922,b:.870588,a:1},IfcBeam:{r:.137255,g:.403922,b:.870588,a:1},IfcBeamStandardCase:{r:.137255,g:.403922,b:.870588,a:1},IfcFurnishingElement:{r:.137255,g:.403922,b:.870588,a:1},IfcCurtainWall:{r:.137255,g:.403922,b:.870588,a:1},IfcStair:{r:.637255,g:.603922,b:.670588,a:1},IfcStairFlight:{r:.637255,g:.603922,b:.670588,a:1},IfcBuildingElementProxy:{r:.5,g:.5,b:.5,a:1},IfcFlowSegment:{r:.137255,g:.403922,b:.870588,a:1},IfcFlowitting:{r:.137255,g:.403922,b:.870588,a:1},IfcFlowTerminal:{r:.137255,g:.403922,b:.870588,a:1},IfcProxy:{r:.137255,g:.403922,b:.870588,a:1},IfcSite:{r:.137255,g:.403922,b:.870588,a:1},IfcLightFixture:{r:.8470588235,g:.8470588235,b:.870588,a:1},IfcDuctSegment:{r:.8470588235,g:.427450980392,b:0,a:1},IfcDistributionFlowElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcDuctFitting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcPlate:{r:.8470588235,g:.427450980392,b:0,a:.5},IfcPile:{r:.8470588235,g:.427450980392,b:0,a:1},IfcAirTerminal:{r:.8470588235,g:.427450980392,b:0,a:1},IfcMember:{r:.8470588235,g:.427450980392,b:0,a:1},IfcCovering:{r:.8470588235,g:.427450980392,b:0,a:1},IfcTransportElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFlowController:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFlowFitting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcRamp:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFurniture:{r:.8470588235,g:.427450980392,b:0,a:1},IfcFooting:{r:.8470588235,g:.427450980392,b:0,a:1},IfcSystemFurnitureElement:{r:.8470588235,g:.427450980392,b:0,a:1},IfcSpace:{r:.137255,g:.303922,b:.570588,a:.5},IfcBuildingElementPart:{r:1,g:.5,b:.5,a:1},IfcDistributionElement:{r:1,g:.5,b:.5,a:1},DEFAULT:{r:.8470588235,g:.427450980392,b:0,a:1}},BIMSURFER.Constants.camera={maxOrbitSpeed:.1*Math.PI,orbitSpeedFactor:.05,zoomSpeedFactor:.1,panSpeedFactor:.6},BIMSURFER.Constants.highlightSelectedObject={type:"material",wire:!0,id:"highlight",emit:0,baseColor:{r:0,g:1,b:0}},BIMSURFER.Constants.highlightSelectedSpecialObject={type:"material",id:"specialselectedhighlight",emit:1,baseColor:{r:.16,g:.7,b:.88},shine:10},BIMSURFER.Constants.ProgressBarStyle={Continuous:1,Marquee:2},BIMSURFER.Constants.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},BIMSURFER.Control=BIMSURFER.Class({CLASS:"BIMSURFER.Control",SYSTEM:null,div:null,DOMelement:null,active:!1,events:null,__construct:function(e){"string"==typeof e?this.div=jQuery(document).find("div#"+e)[0]||null:jQuery(e).is("div")&&(this.div=e),this.events=new BIMSURFER.Events(this)},redraw:function(){return jQuery(this.div).empty(),jQuery(this.DOMelement).remove(),this.DOMelement=jQuery("<div />").addClass(this.CLASS.replace(/\./g,"-")),this.active&&jQuery(this.div).append(this.DOMelement),this},setViewer:function(e){return this.active&&this.deactivate(),this.SYSTEM=e,this},removeFromSurfer:function(){return this.SYSTEM=null,this},initEvents:function(){return this},activate:function(){return this.div&&(this.active=!0,this.redraw(),this.initEvents(),this.show()),this.events.trigger("activated"),this},activateWhenReady:function(){if(this.SYSTEM.sceneLoaded)this.activate();else{var e=this,t=function(){e.SYSTEM.events.unregister("sceneLoaded",t),e.activate()};this.SYSTEM.events.register("sceneLoaded",t)}return this},deactivate:function(){return this.active=!1,this.initEvents(),jQuery(this.DOMelement).remove(),this.DOMelement=null,this.events.trigger("deactivated"),this},show:function(e){switch(e){case"fast":case"normal":case"slow":jQuery(this.DOMelement).stop().fadeIn(e);break;default:jQuery(this.DOMelement).stop().show()}return this},hide:function(e){switch(e){case"fast":case"normal":case"slow":jQuery(this.DOMelement).stop().fadeOut(e);break;default:jQuery(this.DOMelement).stop().hide()}return this}}),BIMSURFER.DataInputStreamReader=BIMSURFER.Class({CLASS:"BIMSurfer.DataInputStreamReader",SYSTEM:null,arrayBuffer:null,dataView:null,pos:null,__construct:function(e,t){this.arrayBuffer=t,this.dataView=new DataView(this.arrayBuffer),this.pos=0},readUTF8:function(){var e=this.dataView.getInt16(this.pos);this.pos+=2;var t=new StringView(this.arrayBuffer.slice(this.pos,this.pos+e)).toString();return this.pos+=e,t},align4:function(){var e=4-this.pos%4;0<e&&4!=e&&(this.pos+=e)},align8:function(){var e=8-this.pos%8;0<e&&8!=e&&(this.pos+=e)},readFloat:function(){var e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e},readInt:function(){var e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e},readByte:function(){var e=this.dataView.getInt8(this.pos);return this.pos+=1,e},readLong:function(){var e=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getUint32(this.pos+4,!0);return this.pos+=8,e},readFloatArray2:function(e){for(var t=[],i=0;i<e;i++){var r=this.dataView.getFloat32(this.pos,!0);this.pos+=4,t.push(r)}return t},readFloatArray:function(t){try{var e=new Float32Array(this.arrayBuffer,this.pos,t);return this.pos+=4*t,e}catch(e){console.error(e,this.arrayBuffer.byteLength,this.pos,t)}},readDoubleArray:function(e){var t=new Float64Array(this.arrayBuffer,this.pos,e);return this.pos+=8*e,t},readIntArray2:function(e){for(var t=[],i=0;i<e;i++){var r=this.dataView.getInt32(this.pos,!0);this.pos+=4,t.push(r)}return t},readIntArray:function(e){var t=new Int32Array(this.arrayBuffer,this.pos,e);return this.pos+=4*e,t},readShortArray:function(t){try{var e=new Int16Array(this.arrayBuffer,this.pos,t);return this.pos+=2*t,e}catch(e){console.error(e,this.pos,t)}}}),BIMSURFER.Events=BIMSURFER.Class({CLASS:"BIMSURFER.Events",SYSTEM:null,listeners:{},object:null,__construct:function(e){this.object=e,this.listeners={}},register:function(e,t,i){"string"==typeof e&&"function"==typeof t&&(this.listeners[e]||(this.listeners[e]=new Array),this.listeners[e].push({object:BIMSURFER.Util.isset(i)?i:this.object,callback:t}))},unregister:function(e,t,i){if("string"==typeof e&&"function"==typeof t&&(i=BIMSURFER.Util.isset(i)?i:this.object,this.listeners[e]))for(var r=0;r<this.listeners[e].length;r++)if(this.listeners[e][r].object==i&&this.listeners[e][r].callback==t){this.listeners[e].splice(r,1);break}},trigger:function(e,t,i){if("string"!=typeof e)return!1;if(t=t||new Array,BIMSURFER.Util.isset(t)?BIMSURFER.Util.isArray(t)||(t=[t]):t=new Array,"mouse"==e.substring(0,5).toLowerCase()&&(t[0]=this.normalizeEvent(t[0])),!this.listeners[e]||0==this.listeners[e].length)return!0;for(var r=this.listeners[e].slice(0),n=0;n<r.length;n++){if(!1===(BIMSURFER.Util.isset(i)?r[n].callback.apply(i,t):r[n].callback.apply(r[n].object,t)))return!1}return!0},normalizeEvent:function(e){return e}}),BIMSURFER.ProgressLoader=BIMSURFER.Class({CLASS:"BIMSURFER.Class",SYSTEM:null,server:null,topicId:null,step:null,done:null,autoUnregister:null,registered:null,__construct:function(e,t,i,r,n,s){this.SYSTEM=e,this.server=t,this.topicId=i,this.step=r,this.done=n,this.autoUnregister=s,this.registered=!1;var o=this,a=!0;this.responseHandler=function(e,t){(o.registered||a)&&(o.registered=!0,o.progressHandler.apply(o,[e,t]))},this.server.registerProgressHandler(this.topicId,this.responseHandler,function(){o.registered=!0,a=!1})},unregister:function(){this.server.unregisterProgressHandler(this.topicId,this.responseHandler),this.registered=!1},responseHandler:null,progressHandler:function(e,t){"FINISHED"==t.state?(this.autoUnregister&&this.registered&&this.unregister(),this.done(t,this)):this.step(t,this)}}),"object"!=typeof SceneJS&&console.error("SceneJS: SceneJS is not loaded!"),SceneJS.FX={},SceneJS.FX.Tween={},SceneJS.FX.TweenSpline=function(){var r,n,s,e,o,a;return r=function(){function e(e,t){this._target=e,this._sequence=[],this._timeline=[],this._play=null==t||t,this._t=0}return e.prototype.tick=function(e){if(this._play)return this._t+=e},e.prototype.start=function(e){return this._sequence=[null!=e?e:{eye:this._target.get("eye"),look:this._target.get("look"),up:this._target.get("up")}],this._timeline=[0],this._t=0},e.prototype.push=function(e,t){var i;return 0===this._sequence.length&&(this._t=0),i=null!=t?t:5e3,0===this._timeline.length&&(i=0),this._timeline.push(this.totalTime()+i),this._sequence.push(e)},e.prototype.sequence=function(e,t){var i,r,n,s;for(0===this._sequence.length&&(this._t=0),n=0,s=e.length;n<s;n++)r=e[n],i=null!=t?t:800,0===this._timeline.length&&(i=0),this._timeline.push(this.totalTime()+i),this._sequence.push(r);return null},e.prototype.pause=function(){return this._play=!1},e.prototype.play=function(){return this._play=!0},e.prototype.totalTime=function(){return 0<this._timeline.length?this._timeline[this._timeline.length-1]:0},e.prototype.update=function(){var e,t;if(0===this._sequence.length)return!1;if(!this._play)return!0;if(this._t>=this.totalTime()||1===this._sequence.length)return this._target.set(this._sequence[this._sequence.length-1]),!1;for(t=0;this._timeline[t]<=this._t;)++t;return e=this._timeline[t]-this._timeline[t-1],_this.lerpLookAtNode(this._target,(this._t-this._timeline[t-1])/e,this._sequence[t-1],this._sequence[t]),!0},e}(),a=[],s=null,n=0,o=function(){var e,t;for(e=0,t=a.length;e<t;e++)a[e].tick(n);return null},(e=function(e,t){var i;return n=t||50,null!==s&&clearInterval(s),s=setInterval(o,n),i=new r(e),a.push(i),i}).update=function(){var e,t;for(e=0,t=[];e<a.length;)a[e].update()?t.push(e+=1):t.push(a.splice(e,1));return t},e}(),SceneJS.FX.idle=function(){return SceneJS.FX.TweenSpline.update(),null},Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&-9007199254740992<e&&e<9007199254740992&&Math.floor(e)===e}),StringView.loadUTF8CharCode=function(e,t){var i=e.length,r=e[t];return 251<r&&r<254&&t+5<i?1073741824*(r-252)+(e[t+1]-128<<24)+(e[t+2]-128<<18)+(e[t+3]-128<<12)+(e[t+4]-128<<6)+e[t+5]-128:247<r&&r<252&&t+4<i?(r-248<<24)+(e[t+1]-128<<18)+(e[t+2]-128<<12)+(e[t+3]-128<<6)+e[t+4]-128:239<r&&r<248&&t+3<i?(r-240<<18)+(e[t+1]-128<<12)+(e[t+2]-128<<6)+e[t+3]-128:223<r&&r<240&&t+2<i?(r-224<<12)+(e[t+1]-128<<6)+e[t+2]-128:191<r&&r<224&&t+1<i?(r-192<<6)+e[t+1]-128:r},StringView.putUTF8CharCode=function(e,t,i){var r=i;return t<128?e[r++]=t:(t<2048?e[r++]=192+(t>>>6):(t<65536?e[r++]=224+(t>>>12):(t<2097152?e[r++]=240+(t>>>18):(t<67108864?e[r++]=248+(t>>>24):(e[r++]=252+t/1073741824,e[r++]=128+(t>>>24&63)),e[r++]=128+(t>>>18&63)),e[r++]=128+(t>>>12&63)),e[r++]=128+(t>>>6&63)),e[r++]=128+(63&t)),r},StringView.getUTF8CharLength=function(e){return e<128?1:e<2048?2:e<65536?3:e<2097152?4:e<67108864?5:6},StringView.loadUTF16CharCode=function(e,t){var i=e[t];return 55231<i&&t+1<e.length?(i-55296<<10)+e[t+1]+9216:i},StringView.putUTF16CharCode=function(e,t,i){var r=i;return t<65536?e[r++]=t:(e[r++]=55232+(t>>>10),e[r++]=56320+(1023&t)),r},StringView.getUTF16CharLength=function(e){return e<65536?1:2},StringView.b64ToUint6=function(e){return 64<e&&e<91?e-65:96<e&&e<123?e-71:47<e&&e<58?e+4:43===e?62:47===e?63:0},StringView.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},StringView.bytesToBase64=function(e){for(var t,i="",r=e.length,n=0,s=0;s<r;s++)t=s%3,0<s&&4*s/3%76==0&&(i+="\r\n"),n|=e[s]<<(16>>>t&24),2!==t&&e.length-s!=1||(i+=String.fromCharCode(StringView.uint6ToB64(n>>>18&63),StringView.uint6ToB64(n>>>12&63),StringView.uint6ToB64(n>>>6&63),StringView.uint6ToB64(63&n)),n=0);return i.replace(/A(?=A$|$)/g,"=")},StringView.base64ToBytes=function(e,t){for(var i,r,n=e.replace(/[^A-Za-z0-9\+\/]/g,""),s=n.length,o=t?Math.ceil((3*s+1>>>2)/t)*t:3*s+1>>>2,a=new Uint8Array(o),c=0,h=0,l=0;l<s;l++)if(r=3&l,c|=StringView.b64ToUint6(n.charCodeAt(l))<<18-6*r,3===r||s-l==1){for(i=0;i<3&&h<o;i++,h++)a[h]=c>>>(16>>>i&24)&255;c=0}return a},StringView.makeFromBase64=function(e,t,i,r){return new StringView("UTF-16"===t||"UTF-32"===t?StringView.base64ToBytes(e,"UTF-16"===t?2:4).buffer:StringView.base64ToBytes(e),t,i,r)},StringView.prototype.encoding="UTF-8",StringView.prototype.makeIndex=function(e,t){var i,r=this.rawData,n=r.length,s=t||0,o=s,a=isNaN(e)?1/0:e;if(e+1>r.length)throw new RangeError("StringView.prototype.makeIndex - The offset can't be major than the length of the array - 1.");switch(this.encoding){case"UTF-8":var c;for(i=0;o<n&&i<a;i++)o+=251<(c=r[o])&&c<254&&o+5<n?6:247<c&&c<252&&o+4<n?5:239<c&&c<248&&o+3<n?4:223<c&&c<240&&o+2<n?3:191<c&&c<224&&o+1<n?2:1;break;case"UTF-16":for(i=s;o<n&&i<a;i++)o+=55231<r[o]&&o+1<r.length?2:1;break;default:o=i=isFinite(e)?e:n-1}return e?o:i},StringView.prototype.toBase64=function(e){return StringView.bytesToBase64(e?this.bufferView.constructor===Uint8Array?this.bufferView:new Uint8Array(this.buffer):this.rawData.constructor===Uint8Array?this.rawData:new Uint8Array(this.buffer,this.rawData.byteOffset,this.rawData.length<<(this.rawData.constructor===Uint16Array?1:2)))},StringView.prototype.subview=function(e,t){var i,r,n,s,o="UTF-8"===this.encoding||"UTF-16"===this.encoding,a=e,c=this.rawData.length;return 0===c?new StringView(this.buffer,this.encoding):(s=o?this.makeIndex():c,r=e?Math.max((s+e)%s,0):0,n=Number.isInteger(t)?Math.max(t,0)+r>s?s-r:t:s,0===r&&n===s?this:(o?(a=this.makeIndex(r),i=this.makeIndex(n,a)-a):i=n-(a=r),"UTF-16"===this.encoding?a<<=1:"UTF-32"===this.encoding&&(a<<=2),new StringView(this.buffer,this.encoding,a,i)))},StringView.prototype.forEachChar=function(e,t,i,r){var n,s,o=this.rawData;if("UTF-8"===this.encoding||"UTF-16"===this.encoding){var a,c;"UTF-8"===this.encoding?(a=StringView.getUTF8CharLength,c=StringView.loadUTF8CharCode):"UTF-16"===this.encoding&&(a=StringView.getUTF16CharLength,c=StringView.loadUTF16CharCode),s=isFinite(i)?this.makeIndex(i):0,n=isFinite(r)?this.makeIndex(r,s):o.length;for(var h,l=0;s<n;l++)h=c(o,s),e.call(t||null,h,l,s,o),s+=a(h)}else for(s=isFinite(i)?i:0,n=isFinite(r)?r+s:o.length;s<n;s++)e.call(t||null,o[s],s,s,o)},StringView.prototype.valueOf=StringView.prototype.toString=function(){if("UTF-8"!==this.encoding&&"UTF-16"!==this.encoding)return String.fromCharCode.apply(null,this.rawData);var e,t,i="";"UTF-8"===this.encoding?(t=StringView.getUTF8CharLength,e=StringView.loadUTF8CharCode):"UTF-16"===this.encoding&&(t=StringView.getUTF16CharLength,e=StringView.loadUTF16CharCode);for(var r,n=this.rawData.length,s=0;s<n;s+=t(r))r=e(this.rawData,s),i+=String.fromCharCode(r);return i},"object"!=typeof BIMSURFER.Util&&(BIMSURFER.Util={}),BIMSURFER.Util.isset=function(e){for(var t=0;t<arguments.length;t++)if(void 0===arguments[t]||null==arguments[t])return!1;return!0},BIMSURFER.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},!GLMAT_EPSILON)var GLMAT_EPSILON=1e-6;if(!GLMAT_ARRAY_TYPE)var GLMAT_ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;if(!GLMAT_RANDOM)var GLMAT_RANDOM=Math.random;BIMSURFER.Util.glMatrix={},BIMSURFER.Util.glMatrix.setMatrixArrayType=function(e){GLMAT_ARRAY_TYPE=e},BIMSURFER.Util.glMatrix.toRadian=function(e){return e*(Math.PI/180)},BIMSURFER.Util.glMatrix.vec4={},BIMSURFER.Util.glMatrix.vec4.create=function(){var e=new GLMAT_ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},BIMSURFER.Util.glMatrix.vec4.clone=function(e){var t=new GLMAT_ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},BIMSURFER.Util.glMatrix.vec4.fromValues=function(e,t,i,r){var n=new GLMAT_ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},BIMSURFER.Util.glMatrix.vec4.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},BIMSURFER.Util.glMatrix.vec4.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},BIMSURFER.Util.glMatrix.vec4.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},BIMSURFER.Util.glMatrix.vec4.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e},BIMSURFER.Util.glMatrix.vec4.sub=BIMSURFER.Util.glMatrix.vec4.subtract,BIMSURFER.Util.glMatrix.vec4.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e},BIMSURFER.Util.glMatrix.vec4.mul=BIMSURFER.Util.glMatrix.vec4.multiply,BIMSURFER.Util.glMatrix.vec4.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e},BIMSURFER.Util.glMatrix.vec4.div=BIMSURFER.Util.glMatrix.vec4.divide,BIMSURFER.Util.glMatrix.vec4.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},BIMSURFER.Util.glMatrix.vec4.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},BIMSURFER.Util.glMatrix.vec4.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},BIMSURFER.Util.glMatrix.vec4.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},BIMSURFER.Util.glMatrix.vec4.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(i*i+r*r+n*n+s*s)},BIMSURFER.Util.glMatrix.vec4.dist=BIMSURFER.Util.glMatrix.vec4.distance,BIMSURFER.Util.glMatrix.vec4.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return i*i+r*r+n*n+s*s},BIMSURFER.Util.glMatrix.vec4.sqrDist=BIMSURFER.Util.glMatrix.vec4.squaredDistance,BIMSURFER.Util.glMatrix.vec4.length=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)},BIMSURFER.Util.glMatrix.vec4.len=BIMSURFER.Util.glMatrix.vec4.length,BIMSURFER.Util.glMatrix.vec4.squaredLength=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n},BIMSURFER.Util.glMatrix.vec4.sqrLen=BIMSURFER.Util.glMatrix.vec4.squaredLength,BIMSURFER.Util.glMatrix.vec4.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},BIMSURFER.Util.glMatrix.vec4.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s;return 0<o&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},BIMSURFER.Util.glMatrix.vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},BIMSURFER.Util.glMatrix.vec4.lerp=function(e,t,i,r){var n=t[0],s=t[1],o=t[2],a=t[3];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e},BIMSURFER.Util.glMatrix.vec4.random=function(e,t){return t=t||1,e[0]=GLMAT_RANDOM(),e[1]=GLMAT_RANDOM(),e[2]=GLMAT_RANDOM(),e[3]=GLMAT_RANDOM(),BIMSURFER.Util.glMatrix.vec4.normalize(e,e),BIMSURFER.Util.glMatrix.vec4.scale(e,e,t),e},BIMSURFER.Util.glMatrix.vec4.transformMat4=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,e},BIMSURFER.Util.glMatrix.vec4.transformQuat=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],c=i[2],h=i[3],l=h*r+a*s-c*n,u=h*n+c*r-o*s,d=h*s+o*n-a*r,p=-o*r-a*n-c*s;return e[0]=l*h+p*-o+u*-c-d*-a,e[1]=u*h+p*-a+d*-o-l*-c,e[2]=d*h+p*-c+l*-a-u*-o,e},BIMSURFER.Util.glMatrix.vec4.forEach=function(){var c=BIMSURFER.Util.glMatrix.vec4.create();return function(e,t,i,r,n,s){var o,a;for(t||(t=4),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,o=i;o<a;o+=t)c[0]=e[o],c[1]=e[o+1],c[2]=e[o+2],c[3]=e[o+3],n(c,c,s),e[o]=c[0],e[o+1]=c[1],e[o+2]=c[2],e[o+3]=c[3];return e}}(),BIMSURFER.Util.glMatrix.vec4.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},BIMSURFER.Util.glMatrix.vec3={},BIMSURFER.Util.glMatrix.vec3.create=function(){var e=new GLMAT_ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},BIMSURFER.Util.glMatrix.vec3.clone=function(e){var t=new GLMAT_ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},BIMSURFER.Util.glMatrix.vec3.fromValues=function(e,t,i){var r=new GLMAT_ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=i,r},BIMSURFER.Util.glMatrix.vec3.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},BIMSURFER.Util.glMatrix.vec3.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},BIMSURFER.Util.glMatrix.vec3.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},BIMSURFER.Util.glMatrix.vec3.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},BIMSURFER.Util.glMatrix.vec3.sub=BIMSURFER.Util.glMatrix.vec3.subtract,BIMSURFER.Util.glMatrix.vec3.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e},BIMSURFER.Util.glMatrix.vec3.mul=BIMSURFER.Util.glMatrix.vec3.multiply,BIMSURFER.Util.glMatrix.vec3.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},BIMSURFER.Util.glMatrix.vec3.div=BIMSURFER.Util.glMatrix.vec3.divide,BIMSURFER.Util.glMatrix.vec3.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},BIMSURFER.Util.glMatrix.vec3.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},BIMSURFER.Util.glMatrix.vec3.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},BIMSURFER.Util.glMatrix.vec3.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},BIMSURFER.Util.glMatrix.vec3.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)},BIMSURFER.Util.glMatrix.vec3.dist=BIMSURFER.Util.glMatrix.vec3.distance,BIMSURFER.Util.glMatrix.vec3.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n},BIMSURFER.Util.glMatrix.vec3.sqrDist=BIMSURFER.Util.glMatrix.vec3.squaredDistance,BIMSURFER.Util.glMatrix.vec3.length=function(e){var t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)},BIMSURFER.Util.glMatrix.vec3.len=BIMSURFER.Util.glMatrix.vec3.length,BIMSURFER.Util.glMatrix.vec3.squaredLength=function(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r},BIMSURFER.Util.glMatrix.vec3.sqrLen=BIMSURFER.Util.glMatrix.vec3.squaredLength,BIMSURFER.Util.glMatrix.vec3.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},BIMSURFER.Util.glMatrix.vec3.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],s=i*i+r*r+n*n;return 0<s&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},BIMSURFER.Util.glMatrix.vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},BIMSURFER.Util.glMatrix.vec3.cross=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],c=i[2];return e[0]=n*c-s*a,e[1]=s*o-r*c,e[2]=r*a-n*o,e},BIMSURFER.Util.glMatrix.vec3.lerp=function(e,t,i,r){var n=t[0],s=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e[2]=o+r*(i[2]-o),e},BIMSURFER.Util.glMatrix.vec3.random=function(e,t){t=t||1;var i=2*GLMAT_RANDOM()*Math.PI,r=2*GLMAT_RANDOM()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e},BIMSURFER.Util.glMatrix.vec3.transformMat4=function(e,t,i){var r=t[0],n=t[1],s=t[2];return e[0]=i[0]*r+i[4]*n+i[8]*s+i[12],e[1]=i[1]*r+i[5]*n+i[9]*s+i[13],e[2]=i[2]*r+i[6]*n+i[10]*s+i[14],e},BIMSURFER.Util.glMatrix.vec3.transformMat3=function(e,t,i){var r=t[0],n=t[1],s=t[2];return e[0]=r*i[0]+n*i[3]+s*i[6],e[1]=r*i[1]+n*i[4]+s*i[7],e[2]=r*i[2]+n*i[5]+s*i[8],e},BIMSURFER.Util.glMatrix.vec3.transformQuat=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=i[0],a=i[1],c=i[2],h=i[3],l=h*r+a*s-c*n,u=h*n+c*r-o*s,d=h*s+o*n-a*r,p=-o*r-a*n-c*s;return e[0]=l*h+p*-o+u*-c-d*-a,e[1]=u*h+p*-a+d*-o-l*-c,e[2]=d*h+p*-c+l*-a-u*-o,e},BIMSURFER.Util.glMatrix.vec3.forEach=function(){var c=BIMSURFER.Util.glMatrix.vec3.create();return function(e,t,i,r,n,s){var o,a;for(t||(t=3),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,o=i;o<a;o+=t)c[0]=e[o],c[1]=e[o+1],c[2]=e[o+2],n(c,c,s),e[o]=c[0],e[o+1]=c[1],e[o+2]=c[2];return e}}(),BIMSURFER.Util.glMatrix.vec3.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},BIMSURFER.Util.glMatrix.vec2={},BIMSURFER.Util.glMatrix.vec2.create=function(){var e=new GLMAT_ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},BIMSURFER.Util.glMatrix.vec2.clone=function(e){var t=new GLMAT_ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},BIMSURFER.Util.glMatrix.vec2.fromValues=function(e,t){var i=new GLMAT_ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},BIMSURFER.Util.glMatrix.vec2.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},BIMSURFER.Util.glMatrix.vec2.set=function(e,t,i){return e[0]=t,e[1]=i,e},BIMSURFER.Util.glMatrix.vec2.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},BIMSURFER.Util.glMatrix.vec2.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},BIMSURFER.Util.glMatrix.vec2.sub=BIMSURFER.Util.glMatrix.vec2.subtract,BIMSURFER.Util.glMatrix.vec2.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e},BIMSURFER.Util.glMatrix.vec2.mul=BIMSURFER.Util.glMatrix.vec2.multiply,BIMSURFER.Util.glMatrix.vec2.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e},BIMSURFER.Util.glMatrix.vec2.div=BIMSURFER.Util.glMatrix.vec2.divide,BIMSURFER.Util.glMatrix.vec2.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},BIMSURFER.Util.glMatrix.vec2.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},BIMSURFER.Util.glMatrix.vec2.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},BIMSURFER.Util.glMatrix.vec2.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},BIMSURFER.Util.glMatrix.vec2.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)},BIMSURFER.Util.glMatrix.vec2.dist=BIMSURFER.Util.glMatrix.vec2.distance,BIMSURFER.Util.glMatrix.vec2.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r},BIMSURFER.Util.glMatrix.vec2.sqrDist=BIMSURFER.Util.glMatrix.vec2.squaredDistance,BIMSURFER.Util.glMatrix.vec2.length=function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},BIMSURFER.Util.glMatrix.vec2.len=BIMSURFER.Util.glMatrix.vec2.length,BIMSURFER.Util.glMatrix.vec2.squaredLength=function(e){var t=e[0],i=e[1];return t*t+i*i},BIMSURFER.Util.glMatrix.vec2.sqrLen=BIMSURFER.Util.glMatrix.vec2.squaredLength,BIMSURFER.Util.glMatrix.vec2.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},BIMSURFER.Util.glMatrix.vec2.normalize=function(e,t){var i=t[0],r=t[1],n=i*i+r*r;return 0<n&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},BIMSURFER.Util.glMatrix.vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},BIMSURFER.Util.glMatrix.vec2.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},BIMSURFER.Util.glMatrix.vec2.lerp=function(e,t,i,r){var n=t[0],s=t[1];return e[0]=n+r*(i[0]-n),e[1]=s+r*(i[1]-s),e},BIMSURFER.Util.glMatrix.vec2.random=function(e,t){t=t||1;var i=2*GLMAT_RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},BIMSURFER.Util.glMatrix.vec2.transformMat2=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e},BIMSURFER.Util.glMatrix.vec2.transformMat2d=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e},BIMSURFER.Util.glMatrix.vec2.transformMat3=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},BIMSURFER.Util.glMatrix.vec2.transformMat4=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},BIMSURFER.Util.glMatrix.vec2.forEach=function(){var c=BIMSURFER.Util.glMatrix.vec2.create();return function(e,t,i,r,n,s){var o,a;for(t||(t=2),i||(i=0),a=r?Math.min(r*t+i,e.length):e.length,o=i;o<a;o+=t)c[0]=e[o],c[1]=e[o+1],n(c,c,s),e[o]=c[0],e[o+1]=c[1];return e}}(),BIMSURFER.Util.glMatrix.vec2.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},BIMSURFER.Util.glMatrix.mat4={},BIMSURFER.Util.glMatrix.mat4.create=function(){var e=new GLMAT_ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},BIMSURFER.Util.glMatrix.mat4.clone=function(e){var t=new GLMAT_ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},BIMSURFER.Util.glMatrix.mat4.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},BIMSURFER.Util.glMatrix.mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},BIMSURFER.Util.glMatrix.mat4.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=n,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},BIMSURFER.Util.glMatrix.mat4.invert=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],_=t[15],S=i*a-r*o,v=i*c-n*o,y=i*h-s*o,b=r*c-n*a,E=r*h-s*a,x=n*h-s*c,M=l*g-u*f,w=l*m-d*f,C=l*_-p*f,J=u*m-d*g,T=u*_-p*g,N=d*_-p*m,R=S*N-v*T+y*J+b*C-E*w+x*M;return R?(R=1/R,e[0]=(a*N-c*T+h*J)*R,e[1]=(n*T-r*N-s*J)*R,e[2]=(g*x-m*E+_*b)*R,e[3]=(d*E-u*x-p*b)*R,e[4]=(c*C-o*N-h*w)*R,e[5]=(i*N-n*C+s*w)*R,e[6]=(m*y-f*x-_*v)*R,e[7]=(l*x-d*y+p*v)*R,e[8]=(o*T-a*C+h*M)*R,e[9]=(r*C-i*T-s*M)*R,e[10]=(f*E-g*y+_*S)*R,e[11]=(u*y-l*E-p*S)*R,e[12]=(a*w-o*J-c*M)*R,e[13]=(i*J-r*w+n*M)*R,e[14]=(g*v-f*b-m*S)*R,e[15]=(l*b-u*v+d*S)*R,e):null},BIMSURFER.Util.glMatrix.mat4.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],_=t[15];return e[0]=a*(d*_-p*m)-u*(c*_-h*m)+g*(c*p-h*d),e[1]=-(r*(d*_-p*m)-u*(n*_-s*m)+g*(n*p-s*d)),e[2]=r*(c*_-h*m)-a*(n*_-s*m)+g*(n*h-s*c),e[3]=-(r*(c*p-h*d)-a*(n*p-s*d)+u*(n*h-s*c)),e[4]=-(o*(d*_-p*m)-l*(c*_-h*m)+f*(c*p-h*d)),e[5]=i*(d*_-p*m)-l*(n*_-s*m)+f*(n*p-s*d),e[6]=-(i*(c*_-h*m)-o*(n*_-s*m)+f*(n*h-s*c)),e[7]=i*(c*p-h*d)-o*(n*p-s*d)+l*(n*h-s*c),e[8]=o*(u*_-p*g)-l*(a*_-h*g)+f*(a*p-h*u),e[9]=-(i*(u*_-p*g)-l*(r*_-s*g)+f*(r*p-s*u)),e[10]=i*(a*_-h*g)-o*(r*_-s*g)+f*(r*h-s*a),e[11]=-(i*(a*p-h*u)-o*(r*p-s*u)+l*(r*h-s*a)),e[12]=-(o*(u*m-d*g)-l*(a*m-c*g)+f*(a*d-c*u)),e[13]=i*(u*m-d*g)-l*(r*m-n*g)+f*(r*d-n*u),e[14]=-(i*(a*m-c*g)-o*(r*m-n*g)+f*(r*c-n*a)),e[15]=i*(a*d-c*u)-o*(r*d-n*u)+l*(r*c-n*a),e},BIMSURFER.Util.glMatrix.mat4.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],c=e[7],h=e[8],l=e[9],u=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return(t*o-i*s)*(u*m-d*g)-(t*a-r*s)*(l*m-d*f)+(t*c-n*s)*(l*g-u*f)+(i*a-r*o)*(h*m-d*p)-(i*c-n*o)*(h*g-u*p)+(r*c-n*a)*(h*f-l*p)},BIMSURFER.Util.glMatrix.mat4.multiply=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],_=t[14],S=t[15],v=i[0],y=i[1],b=i[2],E=i[3];return e[0]=v*r+y*a+b*u+E*g,e[1]=v*n+y*c+b*d+E*m,e[2]=v*s+y*h+b*p+E*_,e[3]=v*o+y*l+b*f+E*S,v=i[4],y=i[5],b=i[6],E=i[7],e[4]=v*r+y*a+b*u+E*g,e[5]=v*n+y*c+b*d+E*m,e[6]=v*s+y*h+b*p+E*_,e[7]=v*o+y*l+b*f+E*S,v=i[8],y=i[9],b=i[10],E=i[11],e[8]=v*r+y*a+b*u+E*g,e[9]=v*n+y*c+b*d+E*m,e[10]=v*s+y*h+b*p+E*_,e[11]=v*o+y*l+b*f+E*S,v=i[12],y=i[13],b=i[14],E=i[15],e[12]=v*r+y*a+b*u+E*g,e[13]=v*n+y*c+b*d+E*m,e[14]=v*s+y*h+b*p+E*_,e[15]=v*o+y*l+b*f+E*S,e},BIMSURFER.Util.glMatrix.mat4.mul=BIMSURFER.Util.glMatrix.mat4.multiply,BIMSURFER.Util.glMatrix.mat4.translate=function(e,t,i){var r,n,s,o,a,c,h,l,u,d,p,f,g=i[0],m=i[1],_=i[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*_+t[12],e[13]=t[1]*g+t[5]*m+t[9]*_+t[13],e[14]=t[2]*g+t[6]*m+t[10]*_+t[14],e[15]=t[3]*g+t[7]*m+t[11]*_+t[15]):(r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=c,e[6]=h,e[7]=l,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=r*g+a*m+u*_+t[12],e[13]=n*g+c*m+d*_+t[13],e[14]=s*g+h*m+p*_+t[14],e[15]=o*g+l*m+f*_+t[15]),e},BIMSURFER.Util.glMatrix.mat4.scale=function(e,t,i){var r=i[0],n=i[1],s=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},BIMSURFER.Util.glMatrix.mat4.rotate=function(e,t,i,r){var n,s,o,a,c,h,l,u,d,p,f,g,m,_,S,v,y,b,E,x,M,w,C,J,T=r[0],N=r[1],R=r[2],I=Math.sqrt(T*T+N*N+R*R);return Math.abs(I)<GLMAT_EPSILON?null:(T*=I=1/I,N*=I,R*=I,n=Math.sin(i),o=1-(s=Math.cos(i)),a=t[0],c=t[1],h=t[2],l=t[3],u=t[4],d=t[5],p=t[6],f=t[7],g=t[8],m=t[9],_=t[10],S=t[11],v=T*T*o+s,y=N*T*o+R*n,b=R*T*o-N*n,E=T*N*o-R*n,x=N*N*o+s,M=R*N*o+T*n,w=T*R*o+N*n,C=N*R*o-T*n,J=R*R*o+s,e[0]=a*v+u*y+g*b,e[1]=c*v+d*y+m*b,e[2]=h*v+p*y+_*b,e[3]=l*v+f*y+S*b,e[4]=a*E+u*x+g*M,e[5]=c*E+d*x+m*M,e[6]=h*E+p*x+_*M,e[7]=l*E+f*x+S*M,e[8]=a*w+u*C+g*J,e[9]=c*w+d*C+m*J,e[10]=h*w+p*C+_*J,e[11]=l*w+f*C+S*J,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},BIMSURFER.Util.glMatrix.mat4.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),s=t[4],o=t[5],a=t[6],c=t[7],h=t[8],l=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+h*r,e[5]=o*n+l*r,e[6]=a*n+u*r,e[7]=c*n+d*r,e[8]=h*n-s*r,e[9]=l*n-o*r,e[10]=u*n-a*r,e[11]=d*n-c*r,e},BIMSURFER.Util.glMatrix.mat4.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],c=t[3],h=t[8],l=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-h*r,e[1]=o*n-l*r,e[2]=a*n-u*r,e[3]=c*n-d*r,e[8]=s*r+h*n,e[9]=o*r+l*n,e[10]=a*r+u*n,e[11]=c*r+d*n,e},BIMSURFER.Util.glMatrix.mat4.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),s=t[0],o=t[1],a=t[2],c=t[3],h=t[4],l=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+h*r,e[1]=o*n+l*r,e[2]=a*n+u*r,e[3]=c*n+d*r,e[4]=h*n-s*r,e[5]=l*n-o*r,e[6]=u*n-a*r,e[7]=d*n-c*r,e},BIMSURFER.Util.glMatrix.mat4.fromRotationTranslation=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,c=n+n,h=s+s,l=r*a,u=r*c,d=r*h,p=n*c,f=n*h,g=s*h,m=o*a,_=o*c,S=o*h;return e[0]=1-(p+g),e[1]=u+S,e[2]=d-_,e[3]=0,e[4]=u-S,e[5]=1-(l+g),e[6]=f+m,e[7]=0,e[8]=d+_,e[9]=f-m,e[10]=1-(l+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},BIMSURFER.Util.glMatrix.mat4.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,c=n+n,h=i*o,l=i*a,u=i*c,d=r*a,p=r*c,f=n*c,g=s*o,m=s*a,_=s*c;return e[0]=1-(d+f),e[1]=l+_,e[2]=u-m,e[3]=0,e[4]=l-_,e[5]=1-(h+f),e[6]=p+g,e[7]=0,e[8]=u+m,e[9]=p-g,e[10]=1-(h+d),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},BIMSURFER.Util.glMatrix.mat4.frustum=function(e,t,i,r,n,s,o){var a=1/(i-t),c=1/(n-r),h=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*c,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(n+r)*c,e[10]=(o+s)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*h,e[15]=0,e},BIMSURFER.Util.glMatrix.mat4.perspective=function(e,t,i,r,n){var s=1/Math.tan(t/2),o=1/(r-n);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*r*o,e[15]=0,e},BIMSURFER.Util.glMatrix.mat4.ortho=function(e,t,i,r,n,s,o){var a=1/(t-i),c=1/(r-n),h=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*c,e[14]=(o+s)*h,e[15]=1,e},BIMSURFER.Util.glMatrix.mat4.lookAt=function(e,t,i,r){var n,s,o,a,c,h,l,u,d,p,f=t[0],g=t[1],m=t[2],_=r[0],S=r[1],v=r[2],y=i[0],b=i[1],E=i[2];return Math.abs(f-y)<GLMAT_EPSILON&&Math.abs(g-b)<GLMAT_EPSILON&&Math.abs(m-E)<GLMAT_EPSILON?BIMSURFER.Util.glMatrix.mat4.identity(e):(l=f-y,u=g-b,d=m-E,n=S*(d*=p=1/Math.sqrt(l*l+u*u+d*d))-v*(u*=p),s=v*(l*=p)-_*d,o=_*u-S*l,(p=Math.sqrt(n*n+s*s+o*o))?(n*=p=1/p,s*=p,o*=p):o=s=n=0,a=u*o-d*s,c=d*n-l*o,h=l*s-u*n,(p=Math.sqrt(a*a+c*c+h*h))?(a*=p=1/p,c*=p,h*=p):h=c=a=0,e[0]=n,e[1]=a,e[2]=l,e[3]=0,e[4]=s,e[5]=c,e[6]=u,e[7]=0,e[8]=o,e[9]=h,e[10]=d,e[11]=0,e[12]=-(n*f+s*g+o*m),e[13]=-(a*f+c*g+h*m),e[14]=-(l*f+u*g+d*m),e[15]=1,e)},BIMSURFER.Util.glMatrix.mat4.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},BIMSURFER.Util.glMatrix.mat3={},BIMSURFER.Util.glMatrix.mat3.create=function(){var e=new GLMAT_ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},BIMSURFER.Util.glMatrix.mat3.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},BIMSURFER.Util.glMatrix.mat3.clone=function(e){var t=new GLMAT_ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},BIMSURFER.Util.glMatrix.mat3.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},BIMSURFER.Util.glMatrix.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},BIMSURFER.Util.glMatrix.mat3.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},BIMSURFER.Util.glMatrix.mat3.invert=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=l*o-a*h,d=-l*s+a*c,p=h*s-o*c,f=i*u+r*d+n*p;return f?(f=1/f,e[0]=u*f,e[1]=(-l*r+n*h)*f,e[2]=(a*r-n*o)*f,e[3]=d*f,e[4]=(l*i-n*c)*f,e[5]=(-a*i+n*s)*f,e[6]=p*f,e[7]=(-h*i+r*c)*f,e[8]=(o*i-r*s)*f,e):null},BIMSURFER.Util.glMatrix.mat3.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8];return e[0]=o*l-a*h,e[1]=n*h-r*l,e[2]=r*a-n*o,e[3]=a*c-s*l,e[4]=i*l-n*c,e[5]=n*s-i*a,e[6]=s*h-o*c,e[7]=r*c-i*h,e[8]=i*o-r*s,e},BIMSURFER.Util.glMatrix.mat3.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],c=e[7],h=e[8];return t*(h*s-o*c)+i*(-h*n+o*a)+r*(c*n-s*a)},BIMSURFER.Util.glMatrix.mat3.multiply=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=i[0],p=i[1],f=i[2],g=i[3],m=i[4],_=i[5],S=i[6],v=i[7],y=i[8];return e[0]=d*r+p*o+f*h,e[1]=d*n+p*a+f*l,e[2]=d*s+p*c+f*u,e[3]=g*r+m*o+_*h,e[4]=g*n+m*a+_*l,e[5]=g*s+m*c+_*u,e[6]=S*r+v*o+y*h,e[7]=S*n+v*a+y*l,e[8]=S*s+v*c+y*u,e},BIMSURFER.Util.glMatrix.mat3.mul=BIMSURFER.Util.glMatrix.mat3.multiply,BIMSURFER.Util.glMatrix.mat3.translate=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=s,e[3]=o,e[4]=a,e[5]=c,e[6]=d*r+p*o+h,e[7]=d*n+p*a+l,e[8]=d*s+p*c+u,e},BIMSURFER.Util.glMatrix.mat3.rotate=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],l=t[7],u=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*n+d*a,e[2]=p*s+d*c,e[3]=p*o-d*r,e[4]=p*a-d*n,e[5]=p*c-d*s,e[6]=h,e[7]=l,e[8]=u,e},BIMSURFER.Util.glMatrix.mat3.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},BIMSURFER.Util.glMatrix.mat3.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},BIMSURFER.Util.glMatrix.mat3.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=i+i,a=r+r,c=n+n,h=i*o,l=i*a,u=i*c,d=r*a,p=r*c,f=n*c,g=s*o,m=s*a,_=s*c;return e[0]=1-(d+f),e[3]=l+_,e[6]=u-m,e[1]=l-_,e[4]=1-(h+f),e[7]=p+g,e[2]=u+m,e[5]=p-g,e[8]=1-(h+d),e},BIMSURFER.Util.glMatrix.mat3.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=t[6],h=t[7],l=t[8],u=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],_=t[15],S=i*a-r*o,v=i*c-n*o,y=i*h-s*o,b=r*c-n*a,E=r*h-s*a,x=n*h-s*c,M=l*g-u*f,w=l*m-d*f,C=l*_-p*f,J=u*m-d*g,T=u*_-p*g,N=d*_-p*m,R=S*N-v*T+y*J+b*C-E*w+x*M;return R?(R=1/R,e[0]=(a*N-c*T+h*J)*R,e[1]=(c*C-o*N-h*w)*R,e[2]=(o*T-a*C+h*M)*R,e[3]=(n*T-r*N-s*J)*R,e[4]=(i*N-n*C+s*w)*R,e[5]=(r*C-i*T-s*M)*R,e[6]=(g*x-m*E+_*b)*R,e[7]=(m*y-f*x-_*v)*R,e[8]=(f*E-g*y+_*S)*R,e):null},BIMSURFER.Util.glMatrix.mat3.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},BIMSURFER.Util.glMatrix.mat2d={},BIMSURFER.Util.glMatrix.mat2d.create=function(){var e=new GLMAT_ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},BIMSURFER.Util.glMatrix.mat2d.clone=function(e){var t=new GLMAT_ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},BIMSURFER.Util.glMatrix.mat2d.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},BIMSURFER.Util.glMatrix.mat2d.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},BIMSURFER.Util.glMatrix.mat2d.invert=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],c=i*s-r*n;return c?(c=1/c,e[0]=s*c,e[1]=-r*c,e[2]=-n*c,e[3]=i*c,e[4]=(n*a-s*o)*c,e[5]=(r*o-i*a)*c,e):null},BIMSURFER.Util.glMatrix.mat2d.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},BIMSURFER.Util.glMatrix.mat2d.multiply=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=i[0],l=i[1],u=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*h+n*u,e[1]=r*l+n*d,e[2]=s*h+o*u,e[3]=s*l+o*d,e[4]=h*a+u*c+p,e[5]=l*a+d*c+f,e},BIMSURFER.Util.glMatrix.mat2d.mul=BIMSURFER.Util.glMatrix.mat2d.multiply,BIMSURFER.Util.glMatrix.mat2d.rotate=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*h,e[1]=-r*h+n*l,e[2]=s*l+o*h,e[3]=-s*h+l*o,e[4]=l*a+h*c,e[5]=l*c-h*a,e},BIMSURFER.Util.glMatrix.mat2d.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=t[0]*r,e[1]=t[1]*n,e[2]=t[2]*r,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*n,e},BIMSURFER.Util.glMatrix.mat2d.translate=function(e,t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+i[0],e[5]=t[5]+i[1],e},BIMSURFER.Util.glMatrix.mat2d.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},BIMSURFER.Util.glMatrix.mat2={},BIMSURFER.Util.glMatrix.mat2.create=function(){var e=new GLMAT_ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},BIMSURFER.Util.glMatrix.mat2.clone=function(e){var t=new GLMAT_ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},BIMSURFER.Util.glMatrix.mat2.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},BIMSURFER.Util.glMatrix.mat2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},BIMSURFER.Util.glMatrix.mat2.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},BIMSURFER.Util.glMatrix.mat2.invert=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=i*s-n*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-n*o,e[3]=i*o,e):null},BIMSURFER.Util.glMatrix.mat2.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},BIMSURFER.Util.glMatrix.mat2.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},BIMSURFER.Util.glMatrix.mat2.multiply=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=i[0],c=i[1],h=i[2],l=i[3];return e[0]=r*a+n*h,e[1]=r*c+n*l,e[2]=s*a+o*h,e[3]=s*c+o*l,e},BIMSURFER.Util.glMatrix.mat2.mul=BIMSURFER.Util.glMatrix.mat2.multiply,BIMSURFER.Util.glMatrix.mat2.rotate=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*a,e[1]=r*-a+n*c,e[2]=s*c+o*a,e[3]=s*-a+o*c,e},BIMSURFER.Util.glMatrix.mat2.scale=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=i[0],c=i[1];return e[0]=r*a,e[1]=n*c,e[2]=s*a,e[3]=o*c,e},BIMSURFER.Util.glMatrix.mat2.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},BIMSURFER.Util.glMatrix.quat={},BIMSURFER.Util.glMatrix.quat.create=function(){var e=new GLMAT_ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},BIMSURFER.Util.glMatrix.quat.rotationTo=function(){var n=BIMSURFER.Util.glMatrix.vec3.create(),s=BIMSURFER.Util.glMatrix.vec3.fromValues(1,0,0),o=BIMSURFER.Util.glMatrix.vec3.fromValues(0,1,0);return function(e,t,i){var r=BIMSURFER.Util.glMatrix.vec3.dot(t,i);return r<-.999999?(BIMSURFER.Util.glMatrix.vec3.cross(n,s,t),BIMSURFER.Util.glMatrix.vec3.length(n)<1e-6&&BIMSURFER.Util.glMatrix.vec3.cross(n,o,t),BIMSURFER.Util.glMatrix.vec3.normalize(n,n),BIMSURFER.Util.glMatrix.quat.setAxisAngle(e,n,Math.PI),e):.999999<r?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(BIMSURFER.Util.glMatrix.vec3.cross(n,t,i),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=1+r,BIMSURFER.Util.glMatrix.quat.normalize(e,e))}}(),BIMSURFER.Util.glMatrix.quat.setAxes=function(){var n=BIMSURFER.Util.glMatrix.mat3.create();return function(e,t,i,r){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=t[0],n[5]=t[1],n[8]=t[2],BIMSURFER.Util.glMatrix.quat.normalize(e,BIMSURFER.Util.glMatrix.quat.fromMat3(e,n))}}(),BIMSURFER.Util.glMatrix.quat.clone=BIMSURFER.Util.glMatrix.vec4.clone,BIMSURFER.Util.glMatrix.quat.fromValues=BIMSURFER.Util.glMatrix.vec4.fromValues,BIMSURFER.Util.glMatrix.quat.copy=BIMSURFER.Util.glMatrix.vec4.copy,BIMSURFER.Util.glMatrix.quat.set=BIMSURFER.Util.glMatrix.vec4.set,BIMSURFER.Util.glMatrix.quat.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},BIMSURFER.Util.glMatrix.quat.setAxisAngle=function(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e},BIMSURFER.Util.glMatrix.quat.add=BIMSURFER.Util.glMatrix.vec4.add,BIMSURFER.Util.glMatrix.quat.multiply=function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=i[0],c=i[1],h=i[2],l=i[3];return e[0]=r*l+o*a+n*h-s*c,e[1]=n*l+o*c+s*a-r*h,e[2]=s*l+o*h+r*c-n*a,e[3]=o*l-r*a-n*c-s*h,e},BIMSURFER.Util.glMatrix.quat.mul=BIMSURFER.Util.glMatrix.quat.multiply,BIMSURFER.Util.glMatrix.quat.scale=BIMSURFER.Util.glMatrix.vec4.scale,BIMSURFER.Util.glMatrix.quat.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),c=Math.cos(i);return e[0]=r*c+o*a,e[1]=n*c+s*a,e[2]=s*c-n*a,e[3]=o*c-r*a,e},BIMSURFER.Util.glMatrix.quat.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),c=Math.cos(i);return e[0]=r*c-s*a,e[1]=n*c+o*a,e[2]=s*c+r*a,e[3]=o*c-n*a,e},BIMSURFER.Util.glMatrix.quat.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],s=t[2],o=t[3],a=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*a,e[1]=n*c-r*a,e[2]=s*c+o*a,e[3]=o*c-s*a,e},BIMSURFER.Util.glMatrix.quat.calculateW=function(e,t){var i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},BIMSURFER.Util.glMatrix.quat.dot=BIMSURFER.Util.glMatrix.vec4.dot,BIMSURFER.Util.glMatrix.quat.lerp=BIMSURFER.Util.glMatrix.vec4.lerp,BIMSURFER.Util.glMatrix.quat.slerp=function(e,t,i,r){var n,s,o,a,c,h=t[0],l=t[1],u=t[2],d=t[3],p=i[0],f=i[1],g=i[2],m=i[3];return(s=h*p+l*f+u*g+d*m)<0&&(s=-s,p=-p,f=-f,g=-g,m=-m),1e-6<1-s?(n=Math.acos(s),o=Math.sin(n),a=Math.sin((1-r)*n)/o,c=Math.sin(r*n)/o):(a=1-r,c=r),e[0]=a*h+c*p,e[1]=a*l+c*f,e[2]=a*u+c*g,e[3]=a*d+c*m,e},BIMSURFER.Util.glMatrix.quat.invert=function(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-n*a,e[3]=s*a,e},BIMSURFER.Util.glMatrix.quat.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},BIMSURFER.Util.glMatrix.quat.length=BIMSURFER.Util.glMatrix.vec4.length,BIMSURFER.Util.glMatrix.quat.len=BIMSURFER.Util.glMatrix.quat.length,BIMSURFER.Util.glMatrix.quat.squaredLength=BIMSURFER.Util.glMatrix.vec4.squaredLength,BIMSURFER.Util.glMatrix.quat.sqrLen=BIMSURFER.Util.glMatrix.quat.squaredLength,BIMSURFER.Util.glMatrix.quat.normalize=BIMSURFER.Util.glMatrix.vec4.normalize,BIMSURFER.Util.glMatrix.quat.fromMat3=function(e,t){var i,r=t[0]+t[4]+t[8];if(0<r)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[7]-t[5])*i,e[1]=(t[2]-t[6])*i,e[2]=(t[3]-t[1])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*s+s]-t[3*o+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*o+s]-t[3*s+o])*i,e[s]=(t[3*s+n]+t[3*n+s])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e},BIMSURFER.Util.glMatrix.quat.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var GEOMETRY_TYPE_TRIANGLES=0,GEOMETRY_TYPE_INSTANCE=1;BIMSURFER.Viewer=BIMSURFER.Class({CLASS:"BIMSURFER.Viewer",SYSTEM:null,connectedServers:null,div:null,mode:null,canvas:null,events:null,controls:null,lights:null,scene:null,sceneLoaded:!1,bimServerApi:null,activeGeometryLoaders:[],waitingGeometryLoaders:[],tick:0,__construct:function(e,t,i,r){if(this.bimServerApi=e,"string"==typeof t&&(t=jQuery("div#"+t)[0]),jQuery(t).is("div")){if(BIMSURFER.Util.isset(i)||(i={}),(this.SYSTEM=this).div=t,this.events=new BIMSURFER.Events(this),this.connectedServers=new Array,this.controls=new Array,BIMSURFER.Util.isset(i.controls)){if(BIMSURFER.Util.isArray(i.controls))for(var n=0;n<i.controls.length;n++)this.addControl(i.controls[n]).activateWhenReady()}else this.addControl(new BIMSURFER.Control.PickFlyOrbit).activateWhenReady();if(this.lights=new Array,void 0===i.lights)this.addLight(new BIMSURFER.Light.Sun),this.addLight(new BIMSURFER.Light.Ambient);else if(BIMSURFER.Util.isArray(i.lights))for(n=0;n<i.lights.length;n++)this.addLight(i.lights[n]);if(this.visibleTypes=new Array,BIMSURFER.Util.isset(i,i.autoStart)){if(!BIMSURFER.Util.isset(i.autoStart.serverUrl,i.autoStart.serverUsername,i.autoStart.serverPassword,i.autoStart.projectOid))return void console.error("Some autostart parameters are missing");var s=this,o=new BIMSURFER.Server(this,i.autoStart.serverUrl,i.autoStart.serverUsername,i.autoStart.serverPassword,!1,!0,!0,function(){if("loggedin"!=o.loginStatus)return s.div.innerHTML="Something went wrong while connecting",void console.error("Something went wrong while connecting");o.getProjectByOid(i.autoStart.projectOid).loadScene(BIMSURFER.Util.isset(i.autoStart.revisionOid)?i.autoStart.revisionOid:null,!0)})}setInterval(this.startNewLoaders,200,this)}else console.error("BIMSURFER: Can not find div element")},addConnectedServer:function(e){-1==this.connectedServers.indexOf(e)&&this.connectedServers.push(e)},addControl:function(e){return BIMSURFER.Util.isset(this.controls[e.CLASS])||(this.controls[e.CLASS]=new Array),-1==this.controls[e.CLASS].indexOf(e)&&this.controls[e.CLASS].push(e),e.setViewer(this),e},removeControl:function(e){if(BIMSURFER.Util.isArray(this.controls[e.CLASS])){var t=this.controls[e.CLASS].indexOf(e);-1!=t&&(this.controls[e.CLASS].splice(t,1),e.deactivate(),e.removeFromViewer())}return e},getControl:function(e){var t=this.controls[e];return 0<t.length?t[0]:null},addLight:function(e){if("BIMSURFER.Light."==e.CLASS.substr(0,16))return-1==this.lights.indexOf(e)&&this.lights.push(e),e.setViewer(this),this.scene&&e.activate(),e},resize:function(e,t){if(this.canvas&&(jQuery(this.canvas).width(e).height(t),BIMSURFER.Util.isset(this.canvas[0])&&(this.canvas[0].width=e,this.canvas[0].height=t)),null!==this.scene){var i=this.scene.findNode("main-camera").get("optics");i.aspect=jQuery(this.canvas).width()/jQuery(this.canvas).height(),this.scene.findNode("main-camera").set("optics",i)}},drawCanvas:function(){var e=jQuery(this.div).width(),t=jQuery(this.div).height();if(0<e&&0<t)return 1==jQuery(this.canvas).length&&jQuery(this.canvas).remove(),jQuery(this.div).empty(),this.canvas=jQuery("<canvas />").attr("id",jQuery(this.div).attr("id")+"-canvas").attr("width",e).attr("height",t).html('<p>This application requires a browser that supports the <a href="http://www.w3.org/html/wg/html5/">HTML5</a> &lt;canvas&gt; feature.</p>').addClass(this.CLASS.replace(/\./g,"-")).appendTo(this.div),this.canvas},initEvents:function(){var t=this,e=this.scene.getCanvas();e.addEventListener("mousedown",function(e){t.events.trigger("mouseDown",[e])},!0),e.addEventListener("mousemove",function(e){t.events.trigger("mouseMove",[e])},!0),e.addEventListener("mouseup",function(e){t.events.trigger("mouseUp",[e])},!0),e.addEventListener("touchstart",function(e){t.events.trigger("touchStart",[e])},!0),e.addEventListener("touchmove",function(e){t.events.trigger("touchMove",[e])},!0),e.addEventListener("touchend",function(e){t.events.trigger("touchEnd",[e])},!0),e.addEventListener("mousewheel",function(e){t.events.trigger("mouseWheel",[e])},!0),e.addEventListener("DOMMouseScroll",function(e){t.events.trigger("mouseWheel",[e])},!0),this.scene.on("pick",function(e){t.events.trigger("pick",[e])}),this.scene.on("tick",function(){t.events.trigger("tick",[])});var i={x:null,y:null,scene:this.scene};this.events.register("mouseDown",function(e){this.x=e.offsetX,this.y=e.offsetY},i),this.events.register("mouseUp",function(e){(e.offsetX>this.x?e.offsetX-this.x<5:this.x-e.offsetX<5)&&(e.offsetY>this.y?e.offsetY-this.y<5:this.y-e.offsetY<5)&&this.scene.pick(this.x,this.y,{rayPick:!0})},i)},loadScene:function(e,t){if(SceneJS.reset(),"object"!=typeof t&&(t={}),null==this.scene)try{var i="canvasCaptureNode";this.scene={backfaces:!1,type:"scene",nodes:[{type:"lookAt",id:"main-lookAt",eye:"object"==typeof t.eye?t.eye:{x:1,y:1,z:1},look:"object"==typeof t.look?t.look:{x:0,y:0,z:0},up:"object"==typeof t.up?t.up:{x:0,y:0,z:1},nodes:[{nodes:(o=[{type:"camera",id:"main-camera",optics:{type:"perspective",far:"number"==typeof t.far?t.far:100,near:"number"==typeof t.near?t.near:.001,aspect:"number"==typeof t.aspect?t.aspect:jQuery(this.canvas).width()/jQuery(this.canvas).height(),fovy:"number"==typeof t.fovy?t.fovy:37.8493},nodes:[{type:"renderer",id:"main-renderer",clear:{color:"boolean"!=typeof t.clearColor||t.clearColor,depth:"boolean"!=typeof t.clearDepth||t.clearDepth,stencil:"boolean"!=typeof t.clearStencil||t.clearStencil},nodes:[{type:"lights",id:"my-lights",lights:[]}]}]}],t.useCapture&&o.push({type:"canvas/capture",id:i}),o)}]}]},this.drawCanvas(),this.scene.canvasId=jQuery(this.canvas).attr("id"),this.scene.id=this.scene.canvasId,this.scene=SceneJS.createScene(this.scene);var r=this;t.useCapture&&this.scene.getNode(i,function(t){var i;t.on("image",function(e){i.resolve(e)}),r.capture=function(e){return i=jQuery.Deferred(),t.capture({format:(e||{}).format||"png",width:(e||{}).width||1024,height:(e||{}).height||1024}),i}}),this.scene.on("tick",function(){r.tick%5==0&&r.activeGeometryLoaders.forEach(function(e){e.process()}),r.tick++});for(var n=0;n<this.lights.length;n++)this.lights[n].activate();var s=new BIMSURFER.Control.ClickSelect;this.addControl(s),null!=this.scene&&(this.initEvents(),this.sceneLoaded=!0),e()}catch(e){console.error("loadScene: ",e,e.stack,this,arguments),console.debug("loadScene ERROR",e,e.stack,this,arguments)}else e();var o;return null},startNewLoaders:function(t){if(0<t.waitingGeometryLoaders.length&&t.activeGeometryLoaders.length<3){var i=t.waitingGeometryLoaders[0];t.waitingGeometryLoaders=t.waitingGeometryLoaders.slice(1),t.activeGeometryLoaders.push(i),i.progressListeners.push(function(e){"done"==e&&(t.tick=0,removeA(t.activeGeometryLoaders,i))}),i.start()}},loadGeometry:function(t){var i=this;i.activeGeometryLoaders.length<3?(i.activeGeometryLoaders.push(t),t.progressListeners.push(function(e){"done"==e&&(i.tick=0,removeA(i.activeGeometryLoaders,t))}),t.start()):i.waitingGeometryLoaders.push(t)},hideType:function(e,t){var i=t.visibleTypes.indexOf(e.toLowerCase());-1!=i&&(t.visibleTypes.splice(i,1),this.refreshMask())},refreshMask:function(){var t=new Array;this.visibleTypes.forEach(function(e){t.push(e)});var e="^("+t.join("|")+")$";this.scene.set("tagMask",e),this.events.trigger("tagMaskUpdated")},hideRevision:function(e){for(var t=e.visibleTypes.slice(0),i=0;i<t.length;i++)this.hideType(t[i],e)},showRevision:function(e,t){if(!BIMSURFER.Util.isset(t)){t=new Array;for(var i=0;i<e.ifcTypes.length;i++)-1!=BIMSURFER.Constants.defaultTypes.indexOf(e.ifcTypes[i])&&t.push(e.ifcTypes[i])}this.showType(t,e)}}),BIMSURFER.Control.ClickSelect=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.ClickSelect",downX:null,downY:null,active:!1,highlighted:null,lastSelected:0,__construct:function(){this.events=new BIMSURFER.Events(this)},activate:function(){return null!=this.SYSTEM&&this.SYSTEM.sceneLoaded?(this.active||(this.active=!0,this.initEvents(),this.events.trigger("activated")),this):(console.error("Cannot activate "+this.CLASS+": Surfer or scene not ready"),null)},initEvents:function(){return this.active?(this.SYSTEM.events.register("pick",this.pick,this),this.SYSTEM.events.register("mouseDown",this.mouseDown,this),this.SYSTEM.events.register("mouseUp",this.mouseUp,this)):(this.SYSTEM.events.unregister("pick",this.pick,this),this.SYSTEM.events.unregister("mouseDown",this.mouseDown,this),this.SYSTEM.events.unregister("mouseUp",this.mouseUp,this)),this},mouseDown:function(e){this.downX=e.offsetX,this.downY=e.offsetY},mouseUp:function(e){(e.offsetX>this.downX?e.offsetX-this.downX<5:this.downX-e.offsetX<5)&&(e.offsetY>this.downY?e.offsetY-this.downY<5:this.downY-e.offsetY<5)&&10<Date.now()-this.lastSelected&&this.unselect()},pick:function(e){this.unselect(),this.highlighted=this.SYSTEM.scene.findNode(e.nodeId);var t=this.highlighted.findParentByType("translate").data.groupId,i=this.highlighted.nodes[0],r=i.nodes[0];if(null!=r._core.arrays.colors){var n={type:"geometry",primitive:"triangles"};n.coreId=r.getCoreId()+"Highlighted",n.indices=r._core.arrays.indices,n.positions=r._core.arrays.positions,n.normals=r._core.arrays.normals,n.colors=[];for(var s=0;s<r._core.arrays.colors.length;s+=4)n.colors[s]=0,n.colors[s+1]=1,n.colors[s+2]=0,n.colors[s+3]=1;this.SYSTEM.scene.findNode("library-"+t).add("node",n);var o={type:"geometry",coreId:r.getCoreId()+"Highlighted"};i.removeNode(r),i.addNode(o)}this.highlighted.insert("node",BIMSURFER.Constants.highlightSelectedObject),this.lastSelected=Date.now();var a=this;window.setTimeout(function(){a.events.trigger("select",[t,a.highlighted])},0)},unselect:function(){var e=this.SYSTEM.scene.findNode(BIMSURFER.Constants.highlightSelectedObject.id);if(null!=e){e.findParentByType("translate").data.groupId;if(null!=e){var t=e.nodes[0],i=t.nodes[0];if(null!=i._core.arrays.colors){t.removeNode(i);var r={type:"geometry",coreId:i.getCoreId().replace("Highlighted","")};t.addNode(r)}e.splice(),this.events.trigger("unselect",[null==this.highlighted?null:this.highlighted.findParentByType("translate").groupId,this.highlighted]),this.highlighted=null}}}}),BIMSURFER.Control.LayerList=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.LayerList",showCheckboxes:!0,autoDraw:!0,redraw:function(){jQuery(this.div).empty(),jQuery(this.DOMelement).remove();var e=this.CLASS.replace(/\./g,"-");if(this.DOMelement=jQuery("<ul />").addClass(e),this.active){jQuery(this.div).append(this.DOMelement);for(var t=0;t<this.SYSTEM.loadedProjects.length;t++){var i=this.SYSTEM.loadedProjects[t],r=jQuery("<li />").addClass(e+"-Project");jQuery("<span />").addClass(e+"-Project-Title").text(i.name).appendTo(r);for(var n=jQuery("<ul />").addClass(e+"-Revisions").appendTo(r),s=0;s<i.loadedRevisions.length;s++){var o=i.loadedRevisions[s],a=jQuery("<li />").addClass(e+"-Revision");1<i.loadedRevisions.length&&jQuery("<span />").addClass(e+"-Revision-Title").text(o.comment).appendTo(a);for(var c=jQuery("<ul />").addClass(e+"-ifcTypes").appendTo(a),h=0;h<o.ifcTypes.length;h++){var l=o.ifcTypes[h],u=jQuery("<li />").addClass(e+"-ifcType"),d=jQuery("<label />").addClass(e+"-ifcType-Label").appendTo(u);if(this.showCheckboxes){var p=this,f=jQuery("<input />").attr("type","checkbox").attr("name",e+"-"+i.oid+"-"+o.oid+"-"+l).addClass(e+"-ifcType-Checkbox").data("ifcType",l).data("revision",o).change(function(){jQuery(this).is(":checked")?p.SYSTEM.showType(jQuery(this).data("ifcType"),jQuery(this).data("revision")):p.SYSTEM.hideType(jQuery(this).data("ifcType"),jQuery(this).data("revision"))});jQuery("<span />").addClass(e+"-ifcType-checkboxContainer").append(f).appendTo(d),-1<o.visibleTypes.indexOf(l.toLowerCase())&&jQuery(f).attr("checked","checked")}jQuery("<span />").addClass(e+"-ifcType-Name").text(l).appendTo(d),jQuery(u).appendTo(c)}jQuery(a).appendTo(n)}jQuery(r).appendTo(this.DOMelement)}}return this},initEvents:function(){if(this.SYSTEM&&this.active){var e=this;this.SYSTEM.events.register("revisionSceneLoaded",function(){e.autoDraw&&e.redraw()}),this.SYSTEM.events.register("tagMaskUpdated",function(){e.autoDraw&&e.redraw()})}}}),BIMSURFER.Control.ObjectTreeView=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.ObjectTreeView",showCheckboxes:!0,projectHtml:null,__construct:function(e){"string"==typeof e?this.div=jQuery(document).find("div#"+e)[0]||null:jQuery(e).is("div")&&(this.div=e),this.events=new BIMSURFER.Events(this)},redraw:function(){jQuery(this.div).empty(),jQuery(this.DOMelement).remove();var e,t,i=this.CLASS.replace(/\./g,"-");if(this.DOMelement=jQuery("<ul />").addClass(i),this.active){jQuery(this.div).append(this.DOMelement);this.SYSTEM.scene.data.relationships;var r=this.showCheckboxes;function n(e,t){if(null==e||0==e.length)return null;var i=jQuery("<div />");jQuery("<span />").text(t).appendTo(i);for(var r=jQuery("<ul />").appendTo(i),n=0;n<e.length;n++)jQuery(r).append(s(e[n]));return i}function s(e){var t=jQuery("<li />"),i=jQuery("<div />").appendTo(t);return r&&jQuery("<span />").append(jQuery("<input />").attr("type","checkbox").attr("checked","checked")).appendTo(i),jQuery("<span />").text(e.name).appendTo(i),jQuery("<span />").text("("+e.type+")"),jQuery(t).append(n(e.decomposedBy,"Decomposed by")),jQuery(t).append(n(e.definedBy,"Defined by")),jQuery(t).append(n(e.contains,"Contains")),t}for(var o=0;o<this.SYSTEM.scene.data.relationships.length;o++){var a=this.SYSTEM.scene.data.relationships[o];jQuery(this.DOMelement).append((e=a,void 0,t=jQuery("<li />").attr("id",i+"-project-"+e.id).addClass(NaN),jQuery("<div />").appendTo(t).append(jQuery("<span />").addClass(i+"-project-name").text(e.name)).append(jQuery("<span />").addClass(i+"-project-type").text("("+e.type+")")),jQuery(t).append(n(e.decomposedBy,"Decomposed by")),jQuery(t).append(n(e.definedBy,"Defined by")),jQuery(t).append(n(e.contains,"Contains")),t))}}return this}});var vecCrossProduct=function(e,t){var i=SceneJS_math_cross3Vec3([e.x,e.y,e.z],[t.x,t.y,t.z]);return{x:i[0],y:i[1],z:i[2]}},vecMultiplyScalar=function(e,t){return{x:e.x*t,y:e.y*t,z:e.z*t}},vecSubtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}},vecMagnitude=function(e){var t=e.x,i=e.y,r=e.z;return Math.sqrt(t*t+i*i+r*r)},vecNormalize=function(e){return vecMultiplyScalar(e,1/vecMagnitude(e))},vecNegate=function(e){return{x:-e.x,y:-e.y,z:-e.z}},vecAdd=function(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}};BIMSURFER.Control.PickFlyOrbit=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.PickFlyOrbit",touching:!1,orbitDragging:!1,panDragging:!1,orbiting:!1,flying:!1,panning:!1,lastX:null,lastY:null,downX:null,downY:null,direction:1,yaw:0,pitch:0,zoom:0,prevZoom:0,scale:1,prevScale:1,rate:40,lookAt:null,startEye:{x:0,y:0,z:0},eye:{x:0,y:0,z:0},look:{x:0,y:0,z:0},startPivot:{x:0,y:0,z:0},endPivot:{x:0,y:0,z:0},currentPivot:{x:0,y:0,z:0},flightStartTime:null,flightDuration:null,__construct:function(e){this.events=new BIMSURFER.Events(this),BIMSURFER.Util.isset(e)&&(this.eye=e.eye||this.eye,this.look=e.look||this.look,this.zoom=e.zoom||this.zoom)},activate:function(){return null!=this.SYSTEM&&this.SYSTEM.sceneLoaded?(this.lookAt=this.SYSTEM.scene.findNode("main-lookAt"),this.eye=this.lookAt.getEye(),this.startEye=this.lookAt.getEye(),this.rate=Math.abs(this.eye.z)/500,this.look=this.lookAt.getLook(),this.currentPivot=this.look,this.active=!0,this.initEvents(),this.events.trigger("activated"),this):(console.error("Cannot activate "+this.CLASS+": Surfer or scene not ready"),null)},deactivate:function(){return this.active=!1,this.initEvents(),this.events.trigger("deactivated"),this},initEvents:function(){return this.active?(this.SYSTEM.events.register("mouseDown",this.mouseDown,this),this.SYSTEM.events.register("mouseUp",this.mouseUp,this),this.SYSTEM.events.register("mouseMove",this.mouseMove,this),this.SYSTEM.events.register("mouseWheel",this.mouseWheel,this),this.SYSTEM.events.register("DOMMouseScroll",this.mouseWheel,this),this.SYSTEM.events.register("touchStart",this.touchStart,this),this.SYSTEM.events.register("touchMove",this.touchMove,this),this.SYSTEM.events.register("touchEnd",this.touchEnd,this),this.SYSTEM.events.register("pick",this.pick,this),this.SYSTEM.events.register("tick",this.tick,this),this.SYSTEM.events.register("touchPinch",this.touchPinch,this),this.SYSTEM.events.register("touchPan",this.touchPan,this)):(this.SYSTEM.events.unregister("mouseDown",this.mouseDown,this),this.SYSTEM.events.unregister("mouseUp",this.mouseUp,this),this.SYSTEM.events.unregister("mouseMove",this.mouseMove,this),this.SYSTEM.events.unregister("mouseWheel",this.mouseWheel,this),this.SYSTEM.events.unregister("touchStart",this.touchStart,this),this.SYSTEM.events.unregister("touchMove",this.touchMove,this),this.SYSTEM.events.unregister("touchEnd",this.touchEnd,this),this.SYSTEM.events.unregister("pick",this.pick,this),this.SYSTEM.events.unregister("tick",this.tick,this),this.SYSTEM.events.unregister("touchPinch",this.touchPinch,this),this.SYSTEM.events.unregister("touchPan",this.touchPan,this)),this},ease:function(e,t,i,r){var n=(e/=r=r||1)*e;return(t=t||0)+(i=i||1)*(-1*n*n+4*(n*e)+-6*n+4*e)},lerp:function(e,t,i){return e+(t-e)*i},lerp3:function(e,t,i,r){for(var n=0;n<3;++n){var s=String.fromCharCode("x".charCodeAt(0)+n);e[s]=this.lerp(t[s],i[s],r)}},updateTimer:function(){this.timeNow=+new Date,null===this.flightStartTime&&(this.flightStartTime=this.timeNow),this.timeElapsed=this.timeNow-this.flightStartTime,this.timeElapsedNormalized=Math.min(this.timeElapsed/this.flightDuration,1),this.timeElapsed>=this.flightDuration&&(this.flying=!1,this.flightStartTime=null,this.rotating=!1,this.startYaw=this.startPitch=this.endYaw=this.endPitch=null)},sphericalCoords:function(e){var t=vecMagnitude(e);return{phi:Math.acos(e.z/t),theta:Math.atan2(e.y,e.x)}},tick:function(){if(this.flying){this.updateTimer();var e=this.ease(this.timeElapsedNormalized);this.lerp3(this.currentPivot,this.startPivot,this.endPivot,e),this.orbiting=!0,this.rotating&&(this.pitch=this.lerp(this.startPitch,this.endPitch,e),this.yaw=this.lerp(this.startYaw,this.endYaw,e))}if(this.orbiting){for(var t=vecMagnitude(this.startEye),i=this.sphericalCoords(this.startEye),r=i.phi,n=i.theta,s=2*Math.PI,o=this.pitch*BIMSURFER.Constants.camera.orbitSpeedFactor+r;s<o;)o-=s;for(;o<0;)o+=s;o>Math.PI?-1!=this.direction&&(this.direction=-1,this.lookAt.set("up",{x:0,y:0,z:-1})):1!=this.direction&&(this.direction=1,this.lookAt.set("up",{x:0,y:0,z:1}));var a=this.yaw*BIMSURFER.Constants.camera.orbitSpeedFactor+n,c=t*Math.sin(o)*Math.cos(a),h=t*Math.sin(o)*Math.sin(a),l=t*Math.cos(o),u=c*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,d=h*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,p=l*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor;(0<=c&&c<u||c<0&&u<c||0<=h&&h<d||h<0&&d<h||0<=l&&l<p||l<0&&p<l)&&(this.zoom=this.prevZoom,u=c*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,d=h*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor,p=l*this.zoom*BIMSURFER.Constants.camera.zoomSpeedFactor),c-=u,h-=d,l-=p,this.prevZoom=this.zoom,c+=this.currentPivot.x,h+=this.currentPivot.y,l+=this.currentPivot.z,this.eye={x:c,y:h,z:l},this.lookAt.setLook(this.currentPivot),this.lookAt.setEye(this.eye),this.orbiting=!1}this.panning&&(this.lookAt.setLook(this.currentPivot),this.lookAt.setEye(this.eye),this.panning=!1)},pick:function(e){if("__SceneJS_dontPickMe"!=e.name){this.startPivot={x:this.currentPivot.x,y:this.currentPivot.y,z:this.currentPivot.z},this.endPivot={x:e.worldPos[0],y:e.worldPos[1],z:e.worldPos[2]};var t=this.endPivot.x-this.startPivot.x,i=this.endPivot.y-this.startPivot.y,r=this.endPivot.z-this.startPivot.z,n=Math.sqrt(t*t+i*i+r*r);this.flightStartTime=null,this.flightDuration=1e3*(n/15e3+1),this.flying=!0}},obtainView:function(){var e=this.lookAt.getEye(),t=this.lookAt.getLook(),i=this.lookAt.getUp(),r=vecNormalize(vecSubtract(t,e));return i=vecCrossProduct(vecCrossProduct(r,i),r),{eye:e,dir:r,up:i=vecNormalize(i)}},restoreView:function(e){var t=vecMagnitude(vecSubtract(this.eye,this.currentPivot)),i=vecSubtract(this.eye,this.currentPivot);this.startEye={x:i.x,y:i.y,z:i.z};var r=this.sphericalCoords(this.startEye),n=this.sphericalCoords(vecNegate(e.dir));this.endYaw=(n.theta-r.theta)/BIMSURFER.Constants.camera.orbitSpeedFactor,this.endPitch=(n.phi-r.phi)/BIMSURFER.Constants.camera.orbitSpeedFactor,this.rotating=!0,this.startYaw=this.startPitch=this.yaw=this.pitch=0,this.zoom=this.prevZoom=0,this.startPivot={x:this.currentPivot.x,y:this.currentPivot.y,z:this.currentPivot.z},this.endPivot=vecSubtract(e.eye,vecNegate(vecMultiplyScalar(e.dir,t))),this.flightStartTime=null,this.flightDuration=1e3,this.flying=!0},actionMove:function(e,t){if(this.orbitDragging)this.yaw-=(e-this.lastX)*this.direction*.1,this.pitch-=.1*(t-this.lastY),this.orbiting=!0;else if(this.panDragging){var i=this.rate,r=this.lookAt.getEye(),n=this.currentPivot,s=vecNormalize(this.lookAt.getUp()),o=vecNormalize(vecSubtract({x:n.x,y:n.y,z:n.z},{x:r.x,y:r.y,z:r.z})),a=vecCrossProduct(s,o);s=vecNormalize(vecCrossProduct(a,o));var c=vecNormalize(vecCrossProduct(o,s)),h=vecMultiplyScalar(c,(e-this.lastX)*i),l=vecMultiplyScalar(s,-1*(t-this.lastY)*i),u=vecAdd(h,l);this.currentPivot=vecAdd({x:n.x,y:n.y,z:n.z},u),this.eye=vecAdd({x:r.x,y:r.y,z:r.z},u),this.panning=!0}this.lastX=e,this.lastY=t},mouseDown:function(e){this.lastX=this.downX=e.offsetX,this.lastY=this.downY=e.offsetY,1==e.which&&(this.orbitDragging=!0),2!=e.which&&3!=e.which||(this.panDragging=!0,e.preventDefault(),e.stopPropagation())},mouseUp:function(e){this.orbitDragging=!1,this.panDragging=!1,2!=e.which&&3!=e.which||(e.preventDefault(),e.stopPropagation())},mouseMove:function(e){this.touching||this.actionMove(e.offsetX,e.offsetY)},mouseWheel:function(e){var t=0,i=e;i.wheelDelta?(t=i.wheelDelta/120,window.opera&&(t=-t)):i.detail&&(t=-i.detail/3),t&&(t<0&&-25<this.zoom?this.zoom-=1:0<t&&(this.zoom+=1)),i.preventDefault&&i.preventDefault(),i.preventDefault(),this.orbiting=!0},touchStart:function(e){1==e.targetTouches.length&&(this.lastX=this.downX=e.targetTouches[0].clientX,this.lastY=this.downY=e.targetTouches[0].clientY,this.orbitDragging=!0,this.touching=!0)},touchMove:function(e){1==e.targetTouches.length&&this.actionMove(e.targetTouches[0].clientX,e.targetTouches[0].clientY)},touchEnd:function(e){1==e.targetTouches.length?(this.orbitDragging=!1,this.panDragging=!1,this.touching=!1):this.prevScale=1},touchPinch:function(e){var t=0,i=e;i.scale&&(this.scale=i.scale,t=this.prevScale-this.scale),t&&(.1<t&&-25<this.zoom?(this.zoom-=1,this.prevScale=this.scale):t<-.1&&(this.zoom+=1,this.prevScale=this.scale)),i.preventDefault&&i.preventDefault(),i.preventDefault(),this.orbiting=!0},touchPan:function(e){this.orbitDragging=!1,this.panDragging=!0,this.actionMove(this.downX+e.deltaX,this.downY+e.deltaY),this.panDragging=!1}}),BIMSURFER.Control.ProgressBar=BIMSURFER.Class(BIMSURFER.Control,{CLASS:"BIMSURFER.Control.ProgressBar",percentage:0,shownPercentage:0,message:"",animationSpeed:200,animationTimer:null,currentType:BIMSURFER.Constants.ProgressBarStyle.Continuous,marqueeImageSrc:"./images/loader.png",marqueeImage:null,marqueeSpeed:20,activate:function(){return this.div&&this.SYSTEM&&(this.active=!0,this.marqueeImage=new Image,this.marqueeImage.src=this.marqueeImageSrc,this.redraw(),this.initEvents()),this.events.trigger("activated"),this},deactivate:function(){return this.active=!1,this.marqueeImage=null,this.initEvents(),jQuery(this.DOMelement).remove(),this.DOMelement=null,this.events.trigger("deactivated"),this},initEvents:function(){this.active?(this.SYSTEM.events.register("progressStarted",this.start,this),this.SYSTEM.events.register("progressDone",this.stop,this),this.SYSTEM.events.register("progressBarStyleChanged",this.changeType,this),this.SYSTEM.events.register("progressChanged",this.animateProgress,this),this.SYSTEM.events.register("progressMessageChanged",this.changeMessage,this)):(this.SYSTEM.events.register("progressLoadingTypeChanged",this.animateProgress,this),this.SYSTEM.events.unregister("progressChanged",this.animateProgress,this),this.SYSTEM.events.unregister("progressMessageChanged",this.changeMessage,this))},redraw:function(){return jQuery(this.div).empty(),jQuery(this.DOMelement).remove(),this.DOMelement=jQuery("<div />").addClass(this.CLASS.replace(/\./g,"-")),this.active&&jQuery(this.div).append(this.DOMelement),jQuery("<div />").addClass(this.CLASS.replace(/\./g,"-")+"-progress").appendTo(this.DOMelement),jQuery("<div />").addClass(this.CLASS.replace(/\./g,"-")+"-text").appendTo(this.DOMelement).text("0%"),this},start:function(e){this.active&&(this.changeMessage(e),this.show())},stop:function(){this.hide("slow")},changeType:function(e){var t=jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-progress"),i=jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-text");switch(e){case BIMSURFER.Constants.ProgressBarStyle.Continuous:null!=this.animationTimer&&(clearInterval(this.animationTimer),this.animationTimer=null),jQuery(t).removeAttr("style"),jQuery(i).show(),this.currentType=BIMSURFER.Constants.ProgressBarStyle.Continuous;break;case BIMSURFER.Constants.ProgressBarStyle.Marquee:jQuery(i).hide();var r=Math.round(jQuery(this.DOMelement).height()/this.marqueeImage.height*this.marqueeImage.width);jQuery(t).css({width:"100%","background-image":"url("+this.marqueeImageSrc+")","background-position":"0px 0px","background-size":r+"px "+jQuery(this.DOMelement).height()+"px"}),null!=this.animationTimer&&(clearInterval(this.animationTimer),this.animationTimer=null);this.animationTimer=setInterval(function(){var e=jQuery(t).css("background-position").split("px");e=e[0],r<=e&&(e=0),jQuery(t).css("background-position",e/1+1+"px 0px")},this.marqueeSpeed),this.currentType=BIMSURFER.Constants.ProgressBarStyle.Marquee}},setAnimationSpeed:function(e){return this.animationSpeed=e,this},changeShownProgress:function(e){return this.currentType!=BIMSURFER.Constants.ProgressBarStyle.Continuous&&this.changeType(BIMSURFER.Constants.ProgressBarStyle.Continuous),100<e?e=100:e<0&&(e=0),this.shownPercentage=e,jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-text").text(this.shownPercentage+"%"+(0<this.message.length?" ("+this.message+")":"")),this},animateProgress:function(e){if(100<e?e=100:e<0&&(e=0),null!=this.animationTimer&&(clearInterval(this.animationTimer),this.animationTimer=null),this.percentage<e){jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-progress").stop(!0,!1).animate({width:e+"%"},{duration:this.animationSpeed,queue:!1});var t=this;this.animationTimer=setInterval(function(){if(t.shownPercentage==t.percentage)return clearInterval(t.animationTimer),void(t.animationTimer=null);t.changeShownProgress(t.shownPercentage+1)},Math.floor(this.animationSpeed/(e-this.shownPercentage)))}else jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-progress").stop().css("width",e+"%"),this.changeShownProgress(e);return this.percentage=e,this},changeMessage:function(e){return jQuery(this.DOMelement).find("."+this.CLASS.replace(/\./g,"-")+"-text").text(this.percentage+"%"+(0<e.length?" ("+e+")":"")),this.message=e,this}}),BIMSURFER.Light=BIMSURFER.Class({CLASS:"BIMSURFER.Light",SYSTEM:null,lightObject:null,__construct:function(){},activate:function(){var e=this.SYSTEM.scene.findNode("my-lights"),t=e._core.lights;if(BIMSURFER.Util.isArray(this.lightObject))for(var i=0;i<this.lightObject.length;i++)-1==t.indexOf(this.lightObject[i])&&t.push(this.lightObject[i]);else-1==t.indexOf(this.lightObject)&&t.push(this.lightObject);e.setLights(t)},deactivate:function(){this.SYSTEM.scene.findNode("my-lights");var e=myLights._core.lights,t=-1;if(BIMSURFER.Util.isArray(this.lightObject))for(t=0;t<this.lightObject.length;t++){var i=e.indexOf(this.lightObject[t]);-1<i&&e.splice(i,1)}else(t=-1<e.indexOf(this.lightObject))&&e.splice(t,1);myLights.setLights(e)},setViewer:function(e){this.SYSTEM=e}}),BIMSURFER.Light.Ambient=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Ambient",__construct:function(e){this.SYSTEM=e,this.lightObject=new Array({mode:"ambient",color:{r:.3,g:.3,b:.3},diffuse:!1,specular:!1},{mode:"dir",color:{r:1,g:1,b:1},diffuse:!0,specular:!0,dir:{x:-.5,y:-.5,z:-1},space:"view"})}}),BIMSURFER.Light.Camera=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Camera",__construct:function(e){this.SYSTEM=e,this.lightObject={type:"light",id:"sun-light",mode:"dir",color:{r:1,g:1,b:1},dir:{x:-.5,y:-.5,z:-1},space:"world",diffuse:!0,specular:!0}}}),BIMSURFER.Light.Sun=BIMSURFER.Class(BIMSURFER.Light,{CLASS:"BIMSURFER.Light.Sun",__construct:function(e){this.SYSTEM=e,this.lightObject={type:"light",id:"sun-light",mode:"dir",color:{r:.8,g:.8,b:.8},dir:{x:-.5,y:.5,z:-1},diffuse:!0,specular:!0}}});